const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/firebase-config-live.BLX6uSpr.js","js/monkeytype-packages.DpltDhLZ.js","js/vendor.DcpIuIDj.js","js/vendor-firebase.DWAEsj2b.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill.DOPQzM1u.js";import{q as V,e as at,a as Y,p as ci,c as se,t as lt,b as Nn,s as oe,h as j,d as gt,f as Ee,g as dr,r as Ao,i as Wb,j as h2,k as Ae,m as b2,n as y2,o as Js,z as v2,u as Ia,v as Un,w as w2,x as zb,y as Hb,A as di,B as C2,C as ui,D as Ob,E as L,F as k2,G as ur,H as Za,I as S2,J as Nb,K as x2,L as Fn,M as T2,N as Vn,O as L2,P as $2,Q as Ag,R as Ub,S as _g,T as M2,U as A2,V as _2,W as E2,X as q2,Y as Eg,Z as I2,_ as D2,$ as qg,a0 as Ig,a1 as F2,a2 as cp,a3 as P2}from"./misc.CSFX4dEo.js";/* empty css              */import{h as K,y as jt,k as B2,q as Au,C as R2,v as W2,b as Vb,g as Kb,f as ge,c as fr,a as jb,d as dp,t as z2,E as ws,s as Wl,A as Wr,e as zr,i as Gb,j as zl,X as H2,N as St,l as Qb,H as O2,m as Zs,x as _u,n as Yd,o as Yb,M as N2,p as U2,r as up,u as V2,w as hc,z as vl,I as K2,B as j2,P as Cs,L as bc,F as Xb,D as Jb,G as G2,J as nd,K as Q2,U as Y2,O as X2,_ as J2,Q as Z2,R as ek,S as tk,T as ak,V as ok,Z as ik,W as nk}from"./monkeytype-packages.DpltDhLZ.js";import{d as Bt,b as O,c as sk,t as rk,U as Ka,e as lk,s as ck,f as Eu,j as dk,k as Mn,m as uk,n as fk,p as pk,q as mk,r as te,u as Dg,v as gk,w as Fg,x as hk,y as bk,z as I,H as yc,A as vc,C as wa,B as yk,D as vk,E as wk,F as Ck,L as kk,G as Sk,I as xk,P as Tk,S as Lk,T as $k,J as Mk,K as Ak,M as _k,N as Ek,O as qk,Q as Fi,R as Ik,V as Pg,W as Zb,X as Dk,Y as Fk,_ as et,$ as ey,a0 as ty,a1 as fp,a2 as ay,a3 as oy,a4 as Pk,a5 as Bk,a6 as iy,a7 as Rk,a8 as Wk,a9 as ny,aa as zk,ab as Bg,ac as sy,ad as Rg,ae as Hk,af as Ok}from"./vendor.DcpIuIDj.js";import{g as Nk,i as Uk,a as Vk,b as Kk,c as jk,o as Gk,s as Qk,d as Yk,e as Xk,f as Jk,h as Zk,j as eS,k as pp,l as tS,F as aS,m as oS,n as iS,G as nS,p as sS,q as rS,u as ry,t as mp,E as ly,v as lS,w as cS,x as dS,y as uS}from"./vendor-firebase.DWAEsj2b.js";import{$ as s}from"./vendor-jquery.L4SRbR-g.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="703d7d4b-654c-4f72-a00d-b72b7a0e9008",e._sentryDebugIdIdentifier="sentry-dbid-703d7d4b-654c-4f72-a00d-b72b7a0e9008")}catch{}{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:monkeytype-frontend":!0})}const ks={backendUrl:"https://api.monkeytype.com",recaptchaSiteKey:"6Lc-V8McAAAAAJ7s6LGNe7MBZnRiwbsbiWts87aj",clientVersion:"2025.12.20_09.48_eb92e1af0"},fS="modulepreload",pS=function(e){return"/"+e},Wg={},Hr=function(t,a,o){let i=Promise.resolve();if(a&&a.length>0){let d=function(u){return Promise.all(u.map(m=>Promise.resolve(m).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");i=d(a.map(u=>{if(u=pS(u),u in Wg)return;Wg[u]=!0;const m=u.endsWith(".css"),p=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${p}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":fS,m||(g.as="script"),g.crossOrigin="",g.href=u,c&&g.setAttribute("nonce",c),document.head.appendChild(g),m)return new Promise((h,y)=>{g.addEventListener("load",h),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return i.then(l=>{for(const c of l||[])c.status==="rejected"&&n(c.reason);return t().catch(n)})};let cy=!0;function Xd(e){cy=e}function Kn(){return cy}const dy=[];function mS(e){dy.push(e)}function zg(){dy.forEach(e=>{try{e()}catch(t){console.error("Banner event subscriber threw an error"),console.error(t)}})}const uy=[];function gS(e){uy.push(e)}function hS(e,t,a){uy.forEach(o=>{try{o(e,t,a)}catch(i){console.error("Notification event subscriber threw an error"),console.error(i)}})}function pr(e){return e*parseFloat(getComputedStyle(document.documentElement).fontSize)}function Jd(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function Hg(e){const t=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion","septillion","octillion","nonillion","decillion"];let a=0,o=e;for(;o>=1e3;)o/=1e3,a++;const i=t[a]??"unknown";return{rounded:Math.round(o),roundedTo2:K(o),orderOfMagnitude:i}}function wc(e,t=1){if(e<1e3)return e.toFixed(t);const a=Math.floor(Math.log(e)/Math.log(1e3)),o="kmbtqQsSond".charAt(a-1);return(e/Math.pow(1e3,a)).toFixed(t)+o}function bS(e){let t=0,a=0,o=0,i=0,n=0,l=0,c=0;const d=e.length;if(d===0)return null;for(let h=0;h<d;h++)l=h+1,c=e[h],t+=l,a+=c,i+=l*l,o+=l*c,n++;const u=(n*o-t*a)/(n*i-t*t),m=a/n-u*t/n,p=[1,1*u+m],g=[d,d*u+m];return[p,g]}function Og(e,t=10){return e!=null?parseInt(e,t):void 0}const Yo=V("#notificationCenter"),Ng=Yo.qsr(".history"),kn=V("#bannerCenter"),yS=V("#app"),wl=Yo.qsr(".clearAll");function qu(){const e=kn.native.offsetHeight;yS.setStyle({paddingTop:e+pr(2)+"px"}),Yo.setStyle({marginTop:e+"px"})}let jn=0,vS=0;class gp{constructor(t,a,o,i,n,l,c,d=()=>{},u){this.type=t,this.message=u?a:at(a),this.level=o,this.important=i??!1,t==="banner"||t==="psa"?this.duration=n:n===void 0?o===-1?this.duration=0:this.duration=3e3:this.duration=n*1e3,this.customTitle=l,this.customIcon=c,this.id=vS++,this.closeCallback=d}show(){let t="notice",a='<i class="fas fa-info-circle"></i>',o="Notice";if(this.level===1?(t="good",a='<i class="fas fa-check-circle"></i>',o="Success"):this.level===-1&&(t="bad",a='<i class="fas fa-times-circle"></i>',o="Error"),this.important&&(t+=" important"),this.customTitle!==void 0&&(o=this.customTitle),(this.type==="banner"||this.type==="psa")&&(a='<i class="fas fa-fw fa-bullhorn"></i>'),this.customIcon!==void 0&&(a=`<i class="fas fa-fw fa-${this.customIcon}"></i>`),this.type==="notification"){this.duration===0&&(jn++,Cc()),Ng.prependHtml(`
        <div class="notif ${t}" id=${this.id} style="opacity: 0;">
            <div class="message"><div class="title"><div class="icon">${a}</div>${o}</div>${this.message}</div>
        </div>
      `);const i=Yo.qs(`.notif[id='${this.id}']`);if(i===null)return;const n=i.native.offsetHeight,l=Y(250);O(i.native,{opacity:[0,1],duration:l/2,delay:l/2}),i?.on("click",()=>{this.hide(),this.closeCallback(),this.duration===0&&jn--,Cc()}),O(Ng.native,{marginTop:{from:"-="+n,to:0},duration:l/2}),i?.on("hover",()=>{i?.toggleClass("hover")})}else if(this.type==="banner"||this.type==="psa"){let i=`<div class="icon lefticon">${a}</div>`,n=!1;/images\/.*/.test(this.customIcon)&&(n=!0,i=`<div class="icon lefticon"><i class="fas fa-fw fa-bullhorn"></i></div><div class="image" style="background-image: url(${this.customIcon})"></div>`),kn.prependHtml(`
        <div class="${this.type} ${t} content-grid ${n?"withImage":""}" id="${this.id}">
        <div class="container">
          ${i}
          <div class="text">
            ${this.message}
          </div>
          ${this.duration>=0?`
          <div class="closeButton">
            <i class="fas fa-fw fa-times"></i>
          </div>
          `:`<div class="righticon">${a}</div>`}
        </div>
      </div>
      `),qu(),zg(),this.duration>=0&&kn.qsa(`.banner[id='${this.id}'] .closeButton, .psa[id='${this.id}'] .closeButton`).on("click",()=>{this.hide(),this.closeCallback()}),/please (<a.*>)?refresh/i.test(this.message)&&(kn.qsa(`.banner[id='${this.id}'], .psa[id='${this.id}']`).addClass("clickable"),kn.qsa(`.banner[id='${this.id}'], .psa[id='${this.id}']`).on("click",()=>{window.location.reload()}))}this.duration>0&&setTimeout(()=>{this.hide()},this.duration+250)}hide(){if(this.type==="notification"){const t=Yo.qs(`.notif[id='${this.id}']`);if(t===null)return;const a=Y(250);O(t.native,{opacity:{to:0,duration:a},height:{to:0,duration:a/2,delay:a/2},marginBottom:{to:0,duration:a/2,delay:a/2},onComplete:()=>{t.remove()}})}else(this.type==="banner"||this.type==="psa")&&(kn.qsa(`.banner[id='${this.id}'], .psa[id='${this.id}']`).remove(),qu(),zg())}}function Cc(){jn>1?O(wl.native,{height:[0,"2.25em"],padding:[0,"0.5em"],duration:125,onBegin:()=>{wl?.removeClass("hidden")}}):jn<1&&O(wl.native,{height:["2.25em",0],padding:["0.5em",0],duration:125,onComplete:()=>{wl?.addClass("hidden")}})}function f(e,t=0,a={}){let o=a.details;a.response!==void 0&&(o={status:a.response.status,additionalDetails:a.details,validationErrors:a.response.status===422?a.response.body.validationErrors:void 0},e=e+": "+a.response.body.message),hS(e,t,{customTitle:a.customTitle,details:o}),new gp("notification",e,t,a.important,a.duration,a.customTitle,a.customIcon,a.closeCallback,a.allowHTML).show()}function wS(e,t=-1,a="bullhorn",o=!1,i,n){const l=new gp("banner",e,t,!1,o?-1:0,void 0,a,i,n);return l.show(),l.id}function Pi(e,t=-1,a="bullhorn",o=!1,i,n){const l=new gp("psa",e,t,!1,o?-1:0,void 0,a,i,n);return l.show(),l.id}function CS(){Yo.qsa(".notif").remove(),jn=0,Cc()}const kS=Bt(100,qu);window.addEventListener("resize",()=>{kS()});Yo.qs(".clearAll")?.on("click",()=>{Yo.qsa(".notif").forEach(e=>{e.native.click()}),jn=0,Cc()});const fy=[];function SS(e){fy.push(e)}function xS(e,t){fy.forEach(a=>{try{a(e,t)}catch(o){console.error("Google Sign Up event subscriber threw an error"),console.error(o)}})}let Hl,xt,Pn=!1,py;const{promise:TS,resolve:LS}=ci();async function $S(e){try{let t;const o=Object.assign({"./constants/firebase-config-live.ts":()=>Hr(()=>import("./firebase-config-live.BLX6uSpr.js"),__vite__mapDeps([0,1,2,3]))})["./constants/firebase-config-live.ts"];if(o)t=(await o()).firebaseConfig;else throw new Error("No config file found. Make sure frontend/src/ts/constants/firebase-config.ts exists");py=e,Hl=Kk().length===0?Uk(t):Vk(),xt=jk(Hl);const i=window.localStorage.getItem("firebasePersistence")==="LOCAL";await hp(i,!1),Gk(xt,async n=>{Pn||await e(!0,n)})}catch(t){Hl=void 0,xt=void 0,console.error("Firebase failed to initialize",t),await e(!1,null)}finally{LS()}}function _(){return xt?.currentUser!==void 0&&xt?.currentUser!==null}function ct(){return xt?.currentUser??null}function MS(){return Nk(Hl)}function ga(){return xt!==void 0}async function AS(){console.log("auth signout"),await xt?.signOut()}async function _S(e,t,a){if(xt===void 0)throw new Error("Authentication uninitialized");await hp(a,!0);const{data:o,error:i}=await jt(Zk(xt,e,t));if(i!==null)throw console.error(i),my(i,"Failed to sign in with email and password");return o}async function ES(e,t){if(xt===void 0)throw new Error("Authentication uninitialized");await hp(t,!0),Pn=!0;const{data:a,error:o}=await jt(eS(xt,e));if(o!==null)throw Pn=!1,console.log(o),my(o,"Failed to sign in with popup");pp(a)?.isNewUser?xS(a,!0):(Pn=!1,await py?.(!0,a.user))}async function qS(e,t){if(xt===void 0)throw new Error("Authentication uninitialized");return Pn=!0,await tS(xt,e,t)}async function IS(){const e=ct();return e===null?null:Jk(e)}async function hp(e,t=!1){if(xt===void 0)throw new Error("Authentication uninitialized");const a=e?Yk:Xk;t&&window.localStorage.setItem("firebasePersistence",e?"LOCAL":"SESSION"),await Qk(xt,a)}function my(e,t){let a=se(e,t);return e instanceof aS&&(e.code==="auth/wrong-password"?a="Incorrect password":e.code==="auth/user-not-found"?a="User not found":e.code==="auth/invalid-email"?a="Invalid email format (make sure you are using your email to login - not your username)":e.code==="auth/invalid-credential"?a="Email/password is incorrect or your account does not have password authentication enabled.":e.code==="auth/popup-closed-by-user"?a="":e.code==="auth/popup-blocked"?a="Sign in popup was blocked by the browser. Check the address bar for a blocked popup icon, or update your browser settings to allow popups.":e.code==="auth/user-cancelled"?a="":e.code==="auth/account-exists-with-different-credential"&&(a="Account already exists, but its using a different authentication method. Try signing in with a different method")),new Error(a,{cause:e})}function gy(){Pn=!1}let Ug=!1,hy;function DS(e){const t=new AbortController;return setTimeout(()=>t.abort(new Error("request timed out")),e),t.signal}function FS(e){return async t=>{try{const a=await IS();a!==null&&(t.headers.Authorization=`Bearer ${a}`);const o=AbortSignal?.timeout===void 0;t.fetchOptions={...t.fetchOptions,signal:o?DS(e):AbortSignal.timeout(e)};const i=await rk(t);i.status>=400&&console.error(`${t.method} ${t.path} failed`,{status:i.status,...i.body});const n=i.headers.get(B2);if(n!==null&&(hy=parseInt(n)),n!==null&&!Ug){const l=parseInt(n);if(l!==Au){const c=l>Au?'Looks like the client and server versions are mismatched (backend is newer). Please <a onClick="location.reload(true)">refresh</a> the page.':"Looks like our monkeys didn't deploy the new server version correctly. If this message persists contact support.";Pi(c,1,void 0,!1,void 0,!0),Ug=!0}}return i}catch(a){let o="Unknown error";return a instanceof Error&&(a.message.includes("timed out")?o="request took too long to complete":o=a.message),{status:500,body:{message:o},headers:new Headers}}}}function by(e,t,a=1e4){return sk(e,{baseUrl:t,jsonQuery:!0,api:FS(a),baseHeaders:{Accept:"application/json","X-Client-Version":ks.clientVersion}})}const yy=ks.backendUrl,PS=by(R2,yy,1e4),BS=by(W2,yy,24e4),$={...PS,dev:BS},vy=[];function RS(e){vy.push(e)}window.addEventListener("load",()=>{window.addEventListener("online",()=>{Vg(!0)}),window.addEventListener("offline",()=>{Vg(!1)})});function Vg(e){vy.forEach(t=>{try{t(e)}catch(a){console.error("Connection event subscriber threw an error"),console.error(a)}})}let Aa=!1,Oi=!1,Me=!1,Ot=null,Or=!0,$i=!1,Iu=1,ne=0,ia=!1,fi=!1,Lt=!1,Ie=!1;function wy(e){Aa=e}function WS(e){Oi=e}function bp(e){Me=e}function Cy(e){Ot=e}function Kg(e){Or=e}function yp(e){$i=e}function vp(e){Iu=e}function zS(e){ne=e}function HS(){ne++}function OS(){ne--}function NS(e){ia=e}function US(e){fi=e}let{promise:VS,resolve:jg}=ci();function Ol(e){Lt=e,e?{promise:VS,resolve:jg}=ci():jg()}function ky(e){Ie=e}let mr=navigator.onLine;function nt(){return mr}let kc,Du=!1;function sd(){Du||(kc??=Pi("No internet connection",0,"exclamation-triangle",!1,()=>{Du=!0,kc=void 0}))}const KS=Bt(5e3,()=>{mr?(kc!==void 0&&(f("You're back online",1,{customTitle:"Connection"}),s(`#bannerCenter .psa.notice[id="${kc}"] .closeButton`).trigger("click")),Du=!1):Me||sd()});RS(e=>{mr=e,KS()});window.addEventListener("load",()=>{mr=navigator.onLine,mr||sd()});function Gg(e,t){if(e!==void 0){if(Array.isArray(e))return t.length===e.length?void 0:e.filter((a,o)=>!t.includes(o));{const a=Object.entries(e);return t.length===a.length?void 0:Object.fromEntries(a.filter(([o])=>!t.includes(o)))}}}function jS(e,t){return t.slice(0,-1).reduce((a,o)=>a[o],e)}function wp(e,t){let o,i=structuredClone(t);for(let l=0;l<=2;l++){if(o=e.safeParse(i),o.success)return o.data;if(l===2)break;const c=o.error.errors.reduce((d,{path:u})=>{const m=u.slice(0,-1).join("."),p=u.at(-1);return p!==void 0&&d.set(m,[...d.get(m)??[],p]),d},new Map);for(const[d,u]of c.entries())if(d==="")i=Gg(i,u)??(Array.isArray(i)?[]:{});else{const m=d.split("."),p=jS(i,m),g=m.at(-1),h=Gg(p[g],u);h===void 0?delete p[g]:p[g]=h}}const n=o?.error.errors.map(l=>`${l.path.join(".")}: ${l.message}`).join(", ");throw new Error("unable to sanitize: "+n)}const GS={theme:"serika_dark",themeLight:"serika",themeDark:"serika_dark",autoSwitchTheme:!1,customTheme:!1,customThemeColors:["#323437","#e2b714","#e2b714","#646669","#2c2e31","#d1d0c5","#ca4754","#7e2a33","#ca4754","#7e2a33"],favThemes:[],showKeyTips:!0,smoothCaret:"medium",codeUnindentOnBackspace:!1,quickRestart:"off",punctuation:!1,numbers:!1,words:50,time:30,mode:"time",quoteLength:[1],language:"english",fontSize:2,freedomMode:!1,difficulty:"normal",blindMode:!1,quickEnd:!1,caretStyle:"default",paceCaretStyle:"default",flipTestColors:!1,layout:"default",funbox:[],confidenceMode:"off",indicateTypos:"off",compositionDisplay:"replace",timerStyle:"mini",liveSpeedStyle:"off",liveAccStyle:"off",liveBurstStyle:"off",colorfulMode:!1,randomTheme:"off",timerColor:"main",timerOpacity:"1",stopOnError:"off",showAllLines:!1,keymapMode:"off",keymapStyle:"staggered",keymapLegendStyle:"lowercase",keymapLayout:"overrideSync",keymapShowTopRow:"layout",keymapSize:1,fontFamily:"Roboto_Mono",smoothLineScroll:!1,alwaysShowDecimalPlaces:!1,alwaysShowWordsHistory:!1,singleListCommandLine:"on",capsLockWarning:!0,playSoundOnError:"off",playSoundOnClick:"off",soundVolume:.5,startGraphsAtZero:!0,showOutOfFocusWarning:!0,paceCaret:"off",paceCaretCustomSpeed:100,repeatedPace:!0,accountChart:["on","on","on","on"],minWpm:"off",minWpmCustomSpeed:100,highlightMode:"letter",typingSpeedUnit:"wpm",ads:"result",hideExtraLetters:!1,strictSpace:!1,minAcc:"off",minAccCustom:90,monkey:!1,repeatQuotes:"off",oppositeShiftMode:"off",customBackground:"",customBackgroundSize:"cover",customBackgroundFilter:[0,1,1,1],customLayoutfluid:["qwerty","dvorak","colemak"],customPolyglot:["english","spanish","french","german"],monkeyPowerLevel:"off",minBurst:"off",minBurstCustomSpeed:100,burstHeatmap:!1,britishEnglish:!1,lazyMode:!1,showAverage:"off",showPb:!1,tapeMode:"off",tapeMargin:50,maxLineWidth:0,playTimeWarning:"off"};function Pa(){return structuredClone(GS)}function rd(e){return QS(YS(XS(e)))}function QS(e){const t=Pa(),a={};for(const o of lt(t)){const i=e[o]??t[o];a[o]=i}return a}function YS(e){return wp(Vb.strip(),e)}function XS(e){if(e.quickTab===!0&&e.quickRestart===void 0&&(e.quickRestart="tab"),typeof e.smoothCaret=="boolean"&&(e.smoothCaret=e.smoothCaret?"medium":"off"),e.swapEscAndTab===!0&&e.quickRestart===void 0&&(e.quickRestart="esc"),e.alwaysShowCPM===!0&&e.typingSpeedUnit===void 0&&(e.typingSpeedUnit="cpm"),e.showAverage==="wpm"&&(e.showAverage="speed"),typeof e.playSoundOnError=="boolean"&&(e.playSoundOnError=e.playSoundOnError?"1":"off"),e.showTimerProgress===!1&&e.timerStyle===void 0&&(e.timerStyle="off"),e.showLiveWpm===!0&&e.liveSpeedStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveSpeedStyle=t}if(e.showLiveBurst===!0&&e.liveBurstStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveBurstStyle=t}if(e.showLiveAcc===!0&&e.liveAccStyle===void 0){let t="mini";e.timerStyle!=="bar"&&e.timerStyle!=="off"&&(t=e.timerStyle),e.liveAccStyle=t}if(typeof e.soundVolume=="string"&&(e.soundVolume=parseFloat(e.soundVolume)),typeof e.funbox=="string"&&(e.funbox==="none"?e.funbox=[]:e.funbox=e.funbox.split("#")),typeof e.customLayoutfluid=="string"&&(e.customLayoutfluid=e.customLayoutfluid.split("#")),typeof e.indicateTypos=="boolean"&&(e.indicateTypos=e.indicateTypos===!1?"off":"replace"),typeof e.fontSize=="string"){const t=e.fontSize;let a=parseInt(t);t==="125"?a=1.25:t==="15"&&(a=1.5),e.fontSize=a}else e.fontSize!==void 0&&e.fontSize<0&&(e.fontSize=1);if(Array.isArray(e.accountChart)&&e.accountChart.length!==4&&(e.accountChart=["on","on","on","on"]),typeof e.minAccCustom=="number"&&e.minAccCustom>100&&(e.minAccCustom=100),Array.isArray(e.customThemeColors)&&e.customThemeColors.length===9){const t=e.customThemeColors;t.splice(4,0,"#000000"),e.customThemeColors=t}if(Array.isArray(e.customBackgroundFilter)&&e.customBackgroundFilter.length===5){const t=e.customBackgroundFilter;e.customBackgroundFilter=[t[0],t[1],t[2],t[3]]}return typeof e.quoteLength=="number"&&(e.quoteLength===-1?e.quoteLength=[0,1,2,3]:e.quoteLength=[e.quoteLength]),e.tapeMargin!==void 0&&(e.tapeMargin<10?e.tapeMargin=10:e.tapeMargin>90&&(e.tapeMargin=90)),e.maxLineWidth!==void 0&&(e.maxLineWidth<20&&e.maxLineWidth!==0?e.maxLineWidth=20:e.maxLineWidth>1e3&&(e.maxLineWidth=1e3)),e}class er{constructor(t,a,o,i=!1){this.firstDayOfWeek=o;const n=new Ka(a),l=this.getInterval(n,i);this.startDay=l.start,this.endDay=l.end,this.data=this.buildData(t,n),this.isFullYear=i}getInterval(t,a=!1){const o=a?lk(t):new Ka;let i=ck(t);return a||(i=Eu(dk(o),1),this.isFirstDayOfWeek(i)||(i=this.previousFirstDayOfWeek(i))),{start:i,end:o}}buildData(t,a){const o=new Array(Math.max(0,386-t.length)).fill(void 0);o.push(...t);const i=Mn(this.endDay,this.startDay)+1,n=o.length-i+Mn(this.endDay,a);return o.slice(n)}getMonths(){const t=uk({start:this.startDay,end:this.endDay}),a=[];for(let o=0;o<t.length;o++){const i=t[o];let n=o===0?this.startDay:fk(i),l=o===t.length-1?this.endDay:pk(n);this.isFirstDayOfWeek(n)||(n=o===0?this.previousFirstDayOfWeek(n):this.nextFirstDayOfWeek(n)),this.isLastDayOfWeek(l)||(l=this.nextLastDayOfWeek(l));const c=mk(l,n,{roundingMethod:"ceil"});c>2?a.push({text:te(i,"MMM").toLowerCase(),weeks:c}):o===0&&a.push({text:"",weeks:c})}return a}getDays(){const t=[],a=this.getBuckets(),o=l=>{if(l===void 0||l===null||l===0)return"0";for(let c=0;c<4;c++)if(l<=(a[c]??0))return(1+c).toString();return"4"};for(let l=0;l<this.startDay.getDay()-this.firstDayOfWeek;l++)t.push({level:"filler"});const i=Mn(this.endDay,this.startDay);let n=this.startDay;for(let l=0;l<=i;l++){const c=this.data[l],d=te(n,"EEEE dd MMM yyyy");t.push({level:o(c),label:c!=null?`${c} ${c===1?"test":"tests"} on ${d}`:`no activity on ${d}`}),n=Eu(n,1)}for(let l=this.endDay.getDay()-this.firstDayOfWeek;l<6;l++)t.push({level:"filler"});return t}getTotalTests(){const t=Mn(this.endDay,this.startDay);return this.data.slice(0,t+1).reduce((a,o)=>(a??0)+(o??0),0)??0}getBuckets(){const a=this.data.filter(l=>l!=null).sort((l,c)=>l-c),o=a.slice(Math.round(a.length*.1),a.length-Math.round(a.length*.1)),n=o.reduce((l,c)=>l+c,0)/o.length;return[Math.floor(n/2),Math.round(n),Math.round(n*1.5)]}isFirstDayOfWeek(t){return Dg(t).getDay()===this.firstDayOfWeek}previousFirstDayOfWeek(t){return gk(t,this.firstDayOfWeek)}nextFirstDayOfWeek(t){return Fg(t,this.firstDayOfWeek)}isLastDayOfWeek(t){return Dg(t).getDay()===(this.firstDayOfWeek+6)%7}nextLastDayOfWeek(t){return Fg(t,(this.firstDayOfWeek+6)%7)}}class JS extends er{constructor(t,a,o){super(t,a,o),this.lastDay=new Ka(a)}increment(t){const a=new Ka(t),o=new Ka(this.lastDay);if(hk(a,o)){const i=this.data.length-1;this.data[i]=(Kb(this.data[i])??0)+1}else{if(bk(a,o))throw new Error("cannot alter data in the past.");{const i=Mn(a,o)-1;for(let l=0;l<i;l++)this.data.push(void 0);this.data.push(1);const n=this.getInterval(a);this.startDay=n.start,this.endDay=n.end,this.lastDay=a}}this.data=this.buildData(this.data,this.lastDay)}getFullYearCalendar(){const t=new Date;return this.lastDay.getFullYear()!==new Ka(t).getFullYear()?new er([],t,this.firstDayOfWeek,!0):new er(this.data,this.lastDay,this.firstDayOfWeek,!0)}}const ZS={results:void 0,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}},name:"",email:"",uid:"",isPremium:!1,config:Pa(),customThemes:[],presets:[],tags:[],banned:void 0,verified:void 0,lbMemory:{time:{15:{english:0},60:{english:0}}},typingStats:{timeTyping:0,startedTests:0,completedTests:0},quoteRatings:void 0,quoteMod:!1,favoriteQuotes:{},addedAt:0,filterPresets:[],xp:0,inboxUnreadSize:0,streak:0,maxStreak:0,streakHourOffset:void 0,allTimeLbs:{time:{15:{english:{count:0,rank:0}},60:{english:{count:0,rank:0}}}},connections:{}};function Qg(){return structuredClone(ZS)}function Re(e,t=!1,a=!1,o=":",i=!0,n=!1){e=Math.abs(e);let l=0,c;n?(l=Math.floor(e/86400),c=Math.floor(e%86400/3600)):c=Math.floor(e/3600);const d=Math.floor(e%3600/60),u=K(e%3600%60);let m,p,g,h;n&&(l<10&&o!=="text"?m="0"+l:m=l),c<10&&o!=="text"?p="0"+c:p=c,d<10&&o!=="text"?g="0"+d:g=d,u<10&&(d>0||c>0||t)&&o!=="text"?h="0"+u:h=u;let y="";return l>0&&n&&(y+=m,o==="text"?l===1?y+=" day ":y+=" days ":y+=o),(c>0||a)&&(y+=p,o==="text"?c===1?y+=" hour ":y+=" hours ":y+=o),(d>0||c>0||t)&&(y+=g,o==="text"?d===1?y+=" minute ":y+=" minutes ":i&&(y+=o)),i&&(y+=h,o==="text"&&(u===1?y+=" second":y+=" seconds")),c===0&&d===0&&!i&&o==="text"&&(y="less than 1 minute"),y.trim()}const Yg={af:0,ar:6,arDZ:0,arEG:0,arMA:1,arSA:0,arTN:1,az:1,be:1,beTarask:1,bg:1,bn:0,bs:1,ca:1,ckb:0,cs:1,cy:0,da:1,de:1,deAT:1,el:1,enAU:1,enCA:0,enGB:1,enIE:1,enIN:1,enNZ:1,enUS:0,enZA:0,eo:1,es:1,et:1,eu:1,faIR:6,fi:1,fr:1,frCA:0,frCH:1,fy:1,gd:0,gl:1,gu:1,he:0,hi:0,hr:1,ht:1,hu:1,hy:1,id:1,is:1,it:1,itCH:1,ja:0,jaHira:0,ka:1,kk:1,km:0,kn:1,ko:0,lb:1,lt:1,lv:1,mk:1,mn:1,ms:1,mt:1,nb:1,nl:1,nlBE:1,nn:1,oc:1,pl:1,pt:1,ptBR:0,ro:1,ru:1,se:1,sk:1,sl:1,sq:1,sr:1,srLatn:1,sv:1,ta:1,te:0,th:0,tr:1,ug:0,uk:1,uz:1,uzCyrl:1,vi:1,zhCN:1,zhHK:0,zhTW:1};function Sy(){if(navigator.language===void 0||navigator.language===null)return 0;const e=new Intl.Locale(navigator.language);if(e==null)return 0;if("weekInfo"in e)return e.weekInfo.firstDay%7;if("getWeekInfo"in e)return e.getWeekInfo().firstDay%7;let t=Yg[navigator.language.replaceAll("-","")];return t!==void 0||(t=Yg[navigator.language.split("-")[0]],t!==void 0)?t:0}const xy=[];function Wa(e){xy.push(e)}function ld(e){xy.forEach(t=>{try{t(e)}catch(a){console.error("Auth event subscriber threw an error"),console.error(a)}})}let Ty;const{promise:Cp,resolve:e5,reject:t5}=ci();function Ba(){return Ty}async function a5(){const e=await $.configuration.get();if(e.status!==200){const t=`Could not fetch configuration: ${e.body.message}`;console.error(t),t5(t);return}else Ty=e.body.data??void 0,e5(!0)}let G;const Ly=Sy();class Sn extends Error{constructor(t,a){super(t),this.responseCode=a,this.name="SnapshotInitError",this.responseCode=a}}function S(){return G}function dt(e,t){const a=G?.banned,o=G?.verified,i=G?.lbOptOut;try{delete e?.banned}catch{}try{delete e?.verified}catch{}try{delete e?.lbOptOut}catch{}G=e,G&&(G.banned=a,G.verified=o,G.lbOptOut=i),t?.dispatchEvent!==!1&&ld({type:"snapshotUpdated",data:{isInitial:!1}})}async function o5(){const e=Qg();await Cp;try{if(!_())return!1;const t=Ba()?.connections.enabled?$.connections.get():{status:200,body:{message:"",data:[]}},[a,o,i,n]=await Promise.all([$.users.get(),$.configs.get(),$.presets.get(),t]);if(a.status!==200)throw new Sn(`${a.body.message} (user)`,a.status);if(o.status!==200)throw new Sn(`${o.body.message} (config)`,o.status);if(i.status!==200)throw new Sn(`${i.body.message} (presets)`,i.status);if(n.status!==200)throw new Sn(`${n.body.message} (connections)`,n.status);const l=a.body.data,c=o.body.data,d=i.body.data,u=n.body.data;if(l===null)throw new Sn("Request was successful but user data is null",200);if(c!==null&&"config"in c)throw new Error("Config data is not in the correct format. Please refresh the page or contact support.");e.name=l.name,e.personalBests=l.personalBests,e.personalBests??={time:{},words:{},quote:{},zen:{},custom:{}};for(const p of["time","words","quote","zen","custom"])e.personalBests[p]??={};e.banned=l.banned,e.lbOptOut=l.lbOptOut,e.verified=l.verified,e.discordId=l.discordId,e.discordAvatar=l.discordAvatar,e.needsToChangeName=l.needsToChangeName,e.typingStats={timeTyping:l.timeTyping??0,startedTests:l.startedTests??0,completedTests:l.completedTests??0},e.quoteMod=l.quoteMod,e.favoriteQuotes=l.favoriteQuotes??{},e.quoteRatings=l.quoteRatings,e.details=l.profileDetails,e.addedAt=l.addedAt,e.inventory=l.inventory,e.xp=l.xp??0,e.inboxUnreadSize=l.inboxUnreadSize??0,e.streak=l?.streak?.length??0,e.maxStreak=l?.streak?.maxLength??0,e.filterPresets=l.resultFilterPresets??[],e.isPremium=l?.isPremium??!1,e.allTimeLbs=l.allTimeLbs,l.testActivity!==void 0&&(e.testActivity=new JS(l.testActivity.testsByDays,new Date(l.testActivity.lastDay),Ly));const m=l?.streak?.hourOffset;if(e.streakHourOffset=m??void 0,l.lbMemory!==void 0&&(e.lbMemory=l.lbMemory),c==null?e.config={...Pa()}:e.config=rd(c),e.customThemes=l.customThemes??[],e.tags=l.tags?.map(p=>({...p,display:p.name.replaceAll("_"," ")}))??[],e.tags=e.tags?.sort((p,g)=>p.name>g.name?1:p.name<g.name?-1:0),d!=null){const p=d.map(g=>({...g,display:g.name.replace(/_/gi," ")}));e.presets=p,e.presets=e.presets?.sort((g,h)=>g.name>h.name?1:g.name<h.name?-1:0)}return e.connections=Ey(u),G=e,G}catch(t){throw G=Qg(),t}}async function kp(e){if(!_()||!G||G.results!==void 0&&(e===void 0||G.results.length>e)||!nt())return!1;const t=await $.results.get({query:{offset:e}});if(t.status!==200)return f("Error getting results",-1,{response:t}),!1;if(!_())return!1;const a=t.body.data.map(o=>(o.bailedOut??=!1,o.blindMode??=!1,o.lazyMode??=!1,o.difficulty??="normal",o.funbox??=[],o.language??="english",o.numbers??=!1,o.punctuation??=!1,o.numbers??=!1,o.quoteLength??=-1,o.restartCount??=0,o.incompleteTestSeconds??=0,o.afkDuration??=0,o.tags??=[],o));if(a?.sort((o,i)=>i.timestamp-o.timestamp),G.results!==void 0&&G.results.length>0){const o=Nn(G.results)?.timestamp,i=a.filter(n=>n.timestamp<o);G.results.push(...i)}else G.results=a;return!0}async function i5(e){if(!G)return!1;if(G.customThemes??=[],G.customThemes.length>=20)return f("Too many custom themes!",0),!1;const t=await $.users.addCustomTheme({body:{...e}});if(t.status!==200)return f("Error adding custom theme",-1,{response:t}),!1;if(t.body.data===null)return f("Error adding custom theme: No data returned",-1),!1;const a={...e,_id:t.body.data._id};return G.customThemes.push(a),!0}async function n5(e,t){if(!_()||!G)return!1;G.customThemes??=[];const a=G.customThemes?.find(n=>n._id===e);if(!a)return f("Editing failed: Custom theme with id: "+e+" does not exist",-1),!1;const o=await $.users.editCustomTheme({body:{themeId:e,theme:t}});if(o.status!==200)return f("Error editing custom theme",-1,{response:o}),!1;const i={...t,_id:e};return G.customThemes[G.customThemes.indexOf(a)]=i,!0}async function s5(e){if(!_()||!G||!G.customThemes?.find(o=>o._id===e))return!1;const a=await $.users.deleteCustomTheme({body:{themeId:e}});return a.status!==200?(f("Error deleting custom theme",-1,{response:a}),!1):(G.customThemes=G.customThemes?.filter(o=>o._id!==e),!0)}async function $y(e,t,a,o,i,n,l){const c=S();if(!c)return[0,0];function d(){const m=[];c?.tags?.forEach(C=>{C.active===!0&&m.push(C._id)});let p=0,g=0,h=0,y=0,k=0,x=0;if(c?.results!==void 0){for(const C of c.results)if(C.mode===e&&(C.punctuation??!1)===a&&(C.numbers??!1)===o&&C.language===i&&C.difficulty===n&&(C.lazyMode===l||C.lazyMode===void 0&&!l)&&(m.length===0||m.some(D=>C.tags?.includes(D)))){if(`${C.mode2}`!=`${t}`&&e!=="quote")continue;if(x<10&&(h+=C.wpm,y+=C.acc,x++),`${C.mode2}`==`${t}`&&(p+=C.wpm,g+=C.acc,k++,k>=10))break}}return k===0&&e==="quote"?[h/x,y/x]:[p/k,g/k]}return c===null||await kp()===null?[0,0]:d()}async function r5(e,t,a,o,i,n,l){const c=S();if(!c)return 0;function d(){const m=[];c?.tags?.forEach(g=>{g.active===!0&&m.push(g._id)});let p=0;if(c?.results!==void 0){for(const g of c.results)if(g.mode===e&&(g.punctuation??!1)===a&&(g.numbers??!1)===o&&g.language===i&&g.difficulty===n&&(g.lazyMode===l||g.lazyMode===void 0&&!l)&&(m.length===0||m.some(h=>g.tags?.includes(h)))){if(g.timestamp<Date.now()-864e5||`${g.mode2}`!=`${t}`&&e!=="quote")continue;g.wpm>p&&(p=g.wpm)}}return p}return c===null||await kp()===null?0:d()}async function l5(e,t,a,o,i,n,l){const c=S();if(!c)return 0;let d=0;for(const u of c.tags){if(!u.active)continue;const m=await My(u._id,e,t,a,o,i,n,l);m>d&&(d=m)}return d}async function Gn(e,t,a,o,i,n,l,c){return c.every(u=>u.canGetPb)?G?.personalBests?.[e]?.[t]?.find(u=>(u.punctuation??!1)===a&&(u.numbers??!1)===o&&u.difficulty===n&&u.language===i&&(u.lazyMode??!1)===l):void 0}function c5(e,t,a,o,i,n,l,c,d,u,m){if(e==="quote"||!G)return;function p(){if(!G)return;let g=!1;G.personalBests??={time:{},words:{},quote:{},zen:{},custom:{}},G.personalBests[e]??={[t]:[]},G.personalBests[e][t]??=[],G.personalBests[e][t].forEach(h=>{(h.punctuation??!1)===a&&(h.numbers??!1)===o&&h.difficulty===n&&h.language===i&&(h.lazyMode??!1)===l&&(g=!0,h.wpm=c,h.acc=d,h.raw=u,h.timestamp=Date.now(),h.consistency=m,h.lazyMode=l)}),g||G.personalBests[e][t].push({language:i,difficulty:n,lazyMode:l,punctuation:a,numbers:o,wpm:c,acc:d,raw:u,timestamp:Date.now(),consistency:m})}G!==null&&p()}async function My(e,t,a,o,i,n,l,c){if(G===null)return 0;let d=0;const u=(S()?.tags??[]).find(p=>p._id===e);return u===void 0||(u.personalBests??={time:{},words:{},quote:{},zen:{},custom:{}},u.personalBests[t]??={[a]:[]},u.personalBests[t][a]??=[],d=(u.personalBests[t][a]??[]).find(p=>(p.punctuation??!1)===o&&(p.numbers??!1)===i&&p.difficulty===l&&p.language===n&&(p.lazyMode===c||p.lazyMode===void 0&&!c))?.wpm??0),d}async function d5(e,t,a,o,i,n,l,c,d,u,m,p){if(!G||t==="quote")return;function g(){const h=G?.tags?.find(y=>y._id===e);h.personalBests??={time:{},words:{},quote:{},zen:{},custom:{}},h.personalBests[t]??={[a]:[]},h.personalBests[t][a]??=[];try{let y=!1;h.personalBests[t][a].forEach(k=>{(k.punctuation??!1)===o&&(k.numbers??!1)===i&&k.difficulty===l&&k.language===n&&(k.lazyMode===c||k.lazyMode===void 0&&!c)&&(y=!0,k.wpm=d,k.acc=u,k.raw=m,k.timestamp=Date.now(),k.consistency=p,k.lazyMode=c)}),y||h.personalBests[t][a].push({language:n,difficulty:l,lazyMode:c,punctuation:o,numbers:i,wpm:d,acc:u,raw:m,timestamp:Date.now(),consistency:p})}catch{h.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},h.personalBests[t][a]=[{language:n,difficulty:l,lazyMode:c,punctuation:o,numbers:i,wpm:d,acc:u,raw:m,timestamp:Date.now(),consistency:p}]}}G!==null&&g()}async function u5(e,t,a,o,i=!1){{const n=e,l=t,c=S();if(!c)return;c.lbMemory??={time:{15:{english:0},60:{english:0}}},c.lbMemory[n]??={15:{english:0},60:{english:0}},c.lbMemory[n][l]??={};const d=c.lbMemory?.[n]?.[l]?.[a],u=c.lbMemory[n][l];u[a]=o,i&&d!==o&&await $.users.updateLeaderboardMemory({body:{mode:e,mode2:t,language:a,rank:o}}),dt(c)}}async function Ay(e){if(_()){const t=await $.configs.save({body:e});t.status!==200&&f("Failed to save config",-1,{response:t})}}async function f5(){if(_()){const e=await $.configs.delete();e.status!==200&&f("Failed to reset config",-1,{response:e})}}function _y(e){const t=S();if(t){if(e.result!==void 0){t?.results!==void 0&&t.results.unshift(e.result),t.testActivity!==void 0&&t.testActivity.increment(new Date(e.result.timestamp)),t.typingStats??={timeTyping:0,startedTests:0,completedTests:0};const a=e.result.testDuration+e.result.incompleteTestSeconds-e.result.afkDuration;t.typingStats.timeTyping+=a,t.typingStats.startedTests+=e.result.restartCount+1,t.typingStats.completedTests+=1,e.isPb&&c5(e.result.mode,e.result.mode2,e.result.punctuation,e.result.numbers,e.result.language,e.result.difficulty,e.result.lazyMode,e.result.wpm,e.result.acc,e.result.rawWpm,e.result.consistency)}e.xp!==void 0&&(t.xp??=0,t.xp+=e.xp),e.streak!==void 0&&(t.streak=e.streak,t.streak>t.maxStreak&&(t.maxStreak=t.streak)),dt(t,{dispatchEvent:!1})}}function p5(e){const t=S();t&&(t.xp??=0,t.xp+=e,dt(t,{dispatchEvent:!1}))}function m5(e){const t=S();t&&(t.inboxUnreadSize=e,dt(t))}function g5(e){const t=S();t&&(t.inventory??={badges:[]},t.inventory.badges.push(e),dt(t))}async function h5(e){if(!_()||G===void 0)return;if(e==="current")return G.testActivity;const t=new Date().getFullYear().toString();if(e===t)return G.testActivity?.getFullYearCalendar();if(G.testActivityByYear===void 0){if(!nt())return;oe();const a=await $.users.getTestActivity();if(a.status!==200){f("Error getting test activities",-1,{response:a}),j();return}G.testActivityByYear={};for(const o in a.body.data){if(o===t)continue;const i=a.body.data[o]??[],n=Eu(new Date(parseInt(o),0,1),i.length);G.testActivityByYear[o]=new er(i,n,Ly,!0)}j()}return G.testActivityByYear[e]}function b5(e){const t=S();if(!t)return;const a=Ey(e);for(const[o,i]of Object.entries(a))t.connections[o]=i;dt(t)}function Ey(e){return Object.fromEntries(e.map(t=>{const a=ct()?.uid===t.initiatorUid;return[a?t.receiverUid:t.initiatorUid,t.status==="pending"&&!a?"incoming":t.status]}))}function Sp(e){if(e===void 0||e===ct()?.uid)return!1;const t=S();return t?Object.entries(t.connections).some(([a,o])=>a===e&&o==="accepted"):!1}async function cd(){return await Hr(()=>import("./vendor-sentry.MS4h6M3c.js"),[])}let Nl=!1,gr=!1;async function y5(){if(gr){console.warn("Sentry already activated");return}gr=!0,console.log("Activating Sentry");const e=await cd();e.init({release:ks.clientVersion,dsn:"https://f50c25dc9dd75304a63776063896a39b@o4509236448133120.ingest.us.sentry.io/4509237217394688",sendDefaultPii:!0,environment:"production",integrations:[e.browserTracingIntegration(),e.thirdPartyErrorFilterIntegration({filterKeys:["monkeytype-frontend"],behaviour:"drop-error-if-contains-third-party-frames"})],tracesSampleRate:.25,tracePropagationTargets:["localhost",/^https:\/\/api\.monkeytype\.com/],replaysSessionSampleRate:0,replaysOnErrorSampleRate:.5,ignoreErrors:["TypeError: can't access dead object","NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.","NotFoundError: Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.","Error: There is no clipping info for given tab","Non-Error promise rejection captured","Object captured as promise rejection"],beforeSend(t){return Nl&&console.debug("Sentry beforeSend",t),t},beforeBreadcrumb(t,a){return t.category==="console"&&t.level==="debug"?null:t}})}async function v5(e,t){if(!gr)return;(await cd()).setUser({id:e,username:t})}async function w5(){if(!gr)return;(await cd()).setUser(null)}async function xp(e){if(!gr)return;(await cd()).captureException(e)}function C5(){Nl=!Nl,console.debug("Sentry debug mode:",Nl)}function k5(e,t,a){let o=`Invalid value for ${e} (${t}). Please try to change this setting again.`;f(o,-1),console.error(o),xp(new Error(o))}function qy(e,t,a){const o=a.safeParse(t).success;return o||k5(e,t),o}const Iy=[];function Ce(e){Iy.push(e)}function Sc(e){Iy.forEach(t=>{try{t(e)}catch(a){console.error("Config event subscriber threw an error"),console.error(a)}})}const S5=[{name:"Prime Ape",description:"Paying for a monthly subscription",icon:"fa-dollar-sign",test:e=>e.isPremium===!0},{name:"Banned",description:"This account is banned",icon:"fa-gavel",color:"var(--error-color)",test:e=>e.banned===!0},{name:"LbOptOut",description:"This account has opted out of leaderboards",icon:"fa-crown",color:"var(--error-color)",test:e=>e.lbOptOut===!0},{name:"Friend",description:"Friend :)",icon:"fa-user-friends",test:e=>e.isFriend===!0}],x5={iconsOnly:!1};function T5(e){return S5.filter(a=>a.test(e))}function L5(e,t){const a=`<i class="fas ${e.icon}"></i>`;if(t.iconsOnly)return a;const o=[];return e.background!==void 0&&o.push(`background: ${e.background};`),e?.color!==void 0&&o.push(`color: ${e.color};`),e?.customStyle!==void 0&&o.push(e.customStyle),`<div class="flag" ${`aria-label="${e.description}" data-balloon-pos="right"`} style="${o.join("")}">${a}</div>`}function Ss(e,t){const a={...x5,...t};return T5(e).map(o=>L5(o,a)).join("")}function xc(e){return Math.floor((Math.sqrt(392*e+22801)-53)/98)}function $5(e){return 49*(e-1)+100}function M5(e){return(49*Math.pow(e,2)+53*e-102)/2}function Qn(e){const t=xc(e);return{level:t,levelCurrentXp:e-M5(t),levelMaxXp:$5(t)}}function Ns(e){return e<1e3?Math.round(e).toString():wc(e)}let _t={bg:"#323437",main:"#e2b714",caret:"#e2b714",sub:"#646669",subAlt:"#2c2e31",text:"#d1d0c5",error:"#ca4754",errorExtra:"#7e2a33",colorfulError:"#ca4754",colorfulErrorExtra:"#7e2a33"};async function Zt(e){return _t[e]||Nr(),_t[e]}async function pi(){return _t.bg||Nr(),_t}function A5(){_t={bg:"",main:"",caret:"",sub:"",subAlt:"",text:"",error:"",errorExtra:"",colorfulError:"",colorfulErrorExtra:""}}function Nr(){const e=getComputedStyle(document.body);_t.bg=e.getPropertyValue("--bg-color").replace(" ",""),_t.main=e.getPropertyValue("--main-color").replace(" ",""),_t.caret=e.getPropertyValue("--caret-color").replace(" ",""),_t.sub=e.getPropertyValue("--sub-color").replace(" ",""),_t.subAlt=e.getPropertyValue("--sub-alt-color").replace(" ",""),_t.text=e.getPropertyValue("--text-color").replace(" ",""),_t.error=e.getPropertyValue("--error-color").replace(" ",""),_t.errorExtra=e.getPropertyValue("--error-extra-color").replace(" ",""),_t.colorfulError=e.getPropertyValue("--colorful-error-color").replace(" ",""),_t.colorfulErrorExtra=e.getPropertyValue("--colorful-error-extra-color").replace(" ","")}let Tc=!1,Ve=!1,Dy=!1,ki={currentXp:0,addedXp:0};const Bi=document.querySelector("nav .xpBar .xpBreakdown .total"),It=document.querySelector("nav .xpBar .xpBreakdown .list"),Ri=document.querySelector("nav .level"),Ha=document.querySelector("nav .xpBar .bar"),Ul=document.querySelector("nav .xpBar");async function _5(){if(Ve=!0,!Tc)return;Dy?Bi.textContent=`+${ki.addedXp}`:da(ki.addedXp,!0),O(It,{opacity:[1,0],duration:Y(250),onComplete:()=>{It.innerHTML="",It.classList.add("hidden")}}),Ri.textContent=`${xc(ki.currentXp+ki.addedXp)}`;const e=Qn(ki.currentXp+ki.addedXp),t=e.level+e.levelCurrentXp/e.levelMaxXp;Ha.style.width=`${t%1*100}%`,await Ee(2e3),Tc=!1,O(Ul,{opacity:[1,0],duration:Y(250)})}function Xg(e){const t=Qn(e),a=t.levelCurrentXp/t.levelMaxXp;Ri.textContent=`${t.level}`,Ha.style.width=a*100+"%"}async function Fy(e,t,a){Ve=!1,Tc=!0,ki={currentXp:e,addedXp:t,breakdown:a},Ri.textContent=`${xc(e)}`;const o=Qn(e),i=Qn(e+t),n=o.level+o.levelCurrentXp/o.levelMaxXp,l=i.level+i.levelCurrentXp/i.levelMaxXp;It.style.opacity="0",It.innerHTML="",Ul.style.opacity="0",Bi.textContent="";const c=gt(Ul,{opacity:1,duration:Y(125),ease:"linear"}),d=gt(It,{opacity:1,duration:Y(125),ease:"linear"});if(a!==void 0?(It.classList.remove("hidden"),Promise.all([c,d])):It.classList.add("hidden"),Ve)return;const u=q5(n,l),m=E5(t,a);await Promise.all([u,m]),!Ve&&(await Ee(5e3),!Ve&&(Tc=!1,Ri.textContent=`${xc(e+t)}`,O(Ul,{opacity:[1,0],duration:Y(250)})))}async function da(e,t=!1){if(!t&&Ve)return;Bi.textContent=`+${e}`;const a=(Math.random()*2-1)/4,o=(Math.random()+1)/2;O(Bi,{scale:[1+.5*o,1],rotate:[10*a,0],duration:Y(2e3),ease:"out(5)"})}async function ca(e,t,a){if(Ve)return;if(t===void 0)It.insertAdjacentHTML("beforeend",`<div class="line" data-string='${e}'><div>${e}</div><div></div></div>`);else if(typeof t=="string")It.insertAdjacentHTML("beforeend",`
      <div class="line" data-string='${e}'>
      <div class="${a?.extraClass}">${e}</div>
      <div class="${a?.extraClass}">${t}</div>
      </div>`);else{const i=t===void 0?void 0:t>=0;It.insertAdjacentHTML("beforeend",`
      <div class="line" data-string='${e}'>

        <div class="${a?.extraClass}">${e}</div>
        <div class="${i?"positive":"negative"} ${a?.extraClass}">${i?"+":"-"}${Math.abs(t)}</div>
      </div>`)}if(a?.noAnimation)return;const o=It.querySelector(`.line[data-string='${e}']`);await gt(o,{opacity:[0,1],duration:Y(250)})}async function E5(e,t){if(Ve)return;if(It.style.opacity="1",!t){Bi.textContent=`+${e}`;return}const a=Y(250);let o=0;It.innerHTML="",It.classList.remove("hidden"),Bi.textContent="+0",o+=t.base??0,Bi.textContent=`+${o}`,await ca("time typing",t.base,{noAnimation:!0}),await Ee(a),ge(t.fullAccuracy)?(await Ee(a),o+=t.fullAccuracy,da(o),await ca("perfect",t.fullAccuracy)):ge(t.corrected)&&(await Ee(a),o+=t.corrected,da(o),await ca("clean",t.corrected)),!Ve&&(ge(t.quote)?(await Ee(a),o+=t.quote,da(o),await ca("quote",t.quote)):(ge(t.punctuation)&&(await Ee(a),o+=t.punctuation,da(o),await ca("punctuation",t.punctuation)),ge(t.numbers)&&(await Ee(a),o+=t.numbers,da(o),await ca("numbers",t.numbers))),!Ve&&(ge(t.funbox)&&(await Ee(a),o+=t.funbox,da(o),await ca("funbox",t.funbox)),!Ve&&(ge(t.streak)&&(await Ee(a),o+=t.streak,da(o),await ca("streak",t.streak)),!Ve&&(ge(t.accPenalty)&&t.accPenalty>0&&(await Ee(a),o-=t.accPenalty,da(o),await ca("accuracy penalty",t.accPenalty*-1)),!Ve&&(ge(t.incomplete)&&t.incomplete>0&&(await Ee(a),o+=t.incomplete,da(o),await ca("incomplete tests",t.incomplete)),!Ve&&(ge(t.configMultiplier)&&(await Ee(a),o*=t.configMultiplier,da(o),await ca("global multiplier",`x${t.configMultiplier}`)),!Ve&&(ge(t.daily)&&(await Ee(a),o+=t.daily,da(o),await ca("daily bonus",t.daily)),Dy=!0,!Ve&&await Ee(a))))))))}async function q5(e,t){if(Ve)return;const a=t-e;if(Ha.style.width=`${e%1*100}%`,t%1===0){if(await gt(Ha,{width:"100%",duration:Y(1e3),ease:"out(5)"}),Ve)return;Zd(),Ha.style.width="0%"}else if(Math.floor(e)===Math.floor(t))await gt(Ha,{width:`${t%1*100}%`,duration:Y(1e3),ease:"out(5)"});else{const o=Math.min(1e3/a,200);let i=a,n=!1,l=o,c=1-e%1;do{if(Ve)return;n&&(Zd(),Ha.style.width="0%",c=1),await gt(Ha,{width:"100%",duration:Y(l),ease:"linear"}),i-=c,n=!0}while(i>1);if(Ve||(Zd(),Ha.style.width="0%",Ve))return;await gt(Ha,{width:`${i%1*100}%`,duration:Y(1e3),ease:"out(5)"})}}async function Zd(){const e=await pi();Ri.textContent=`${parseInt(Ri.textContent??"0")+1}`;const t=Math.random()*2-1,a=Math.random()+1;O(Ri,{scale:[1+.5*a,1],backgroundColor:[e.main,e.sub],rotate:[10*t,0],duration:Y(2e3),ease:"out(5)"})}const Jg=new Set;function Fu(e,t){const a=document.createElement("div");if(a.classList.add("avatar"),e===null||Jg.has(e))a.innerHTML=`<div class="userIcon"><i class="${t?.userIcon??"fas fa-user-circle"}"></i></div>`;else{const o=document.createElement("div");o.className="loading",o.innerHTML='<i class="fas fa-circle-notch fa-spin"></i>';const i=document.createElement("div");i.className="discordImage";const n=document.createElement("img");n.src=`${e}?size=${t?.size??32}`,n.addEventListener("load",async()=>{o.remove()}),n.addEventListener("error",()=>{Jg.add(e),a.replaceWith(Fu(null,t))}),i.appendChild(n),a.appendChild(o),a.appendChild(i)}return a}function Ur({discordId:e,discordAvatar:t},a){return Fu(e===void 0||e===""||t===void 0||t===""?null:`https://cdn.discordapp.com/avatars/${e}/${t}.png`,a)}const Py=V("header nav"),Da=Py.qsr(".accountButtonAndMenu"),Pu=Py.qsr(".textButton.view-login");function I5(){Da.addClass("hidden"),Pu.addClass("hidden")}function ho(e){Da.qs(".spinner")?.setStyle({opacity:e?"1":"0"}),Da.qs(".avatar")?.setStyle({opacity:e?"0":"1"})}function Zg(e){Da.qs(".view-account > .text")?.setText(e)}function eh(e){Da.qs(".view-account > .text")?.appendHtml(Ss(e,{iconsOnly:!0}))}function Bu(e){const t=Ur(e??{},{userIcon:"fas fa-fw fa-user"});Da.qs(".avatar")?.replaceWith(t)}function D5(){if(_()){const e=S();if(e===void 0)return;const{xp:t,name:a}=e;ho(!1),Zg(a),eh(e??{}),Xg(t),Bu(e),Da.qs(".menu .items .goToProfile")?.setAttribute("href",`/profile/${a}`),dr(Pu,Da,250)}else dr(Da,Pu,250,async()=>{Zg(""),eh({}),Xg(0),Bu()});By()}function By(){const e=S()?.connections,t=Da.qsa(".view-account > .notificationBubble, .goToFriends > .notificationBubble");if(e!==void 0&&Object.values(e).filter(o=>o==="incoming").length>0){t.show();return}t.hide()}const F5=window.matchMedia("(pointer:coarse)")?.matches;F5&&Da.qs(".view-account")?.setAttribute("href","");Wa(e=>{(e.type==="authStateChanged"&&!e.data.isUserSignedIn||e.type==="snapshotUpdated")&&D5()});function P5(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Ry(e){return e.replace(/([A-Z])/g," $1").trim().toLowerCase()}function Wy(e){try{return e.charAt(e.length-1)}catch{return""}}function th(e,t,a){return t>e.length-1?e:e.substring(0,t)+a+e.substring(t+1)}function an(e){return e.split(/ +/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function Pt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function eu(e,t){if(t=t.filter(o=>o!==""),t.length===0)return e;const a=new RegExp(`(?<!\\p{L})(?:${t.join("|")})(?!\\p{L})`,"gu");return e.replace(a,'<span class="highlight">$&</span>')}function Ra(e,t=!1){let a="";return t?a=Ta(e):a=e,a.replace(/_/g," ")}function Ta(e){return e.replace(/_\d*k$/g,"")}function zy(e){const t={"“":'"',"”":'"',"„":'"',"’":"'","‘":"'",",":",","—":"-","…":"...","«":"<<","»":">>","–":"-"," ":" "," ":" "," ":" ","᾽":"'"};return e.replace(/[“”’‘—,…«»–\u2007\u202F\u00A0]/g,a=>t[a]||"")}function Vo(e){const t=[];for(const a of e)t.push(a);return t}function B5(e){return e=e.replace(new RegExp("(?<!\\\\)\\\\t","g"),"	"),e=e.replace(/\\n/g,` 
`),e=e.replace(/([^\\]|^)\\n/gm,`$1
`),e=e.replace(/\\\\t/gm,"\\t"),e=e.replace(/\\\\n/gm,"\\n"),e}function R5(e){return!e||e.length===0?!1:/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/.test(e)}let Ru=new Map;function W5(){Ru.clear()}function Hy(e,t,a){if(e===void 0||e.length===0)return a?!t:t;const o=e.replace(/^[\p{P}\p{S}\s]+|[\p{P}\p{S}\s]+$/gu,"");if(o.length===0)return a?!t:t;const i=Ru.get(o);if(i!==void 0)return a?!i:i;const n=R5(o);return Ru.set(o,n),a?!n:n}const z5=[new Set(["’","‘","'","ʼ","׳","ʻ","᾽","᾽"]),new Set(['"',"”","“","„"]),new Set(["–","—","-","‐"]),new Set([",","‚"])],H5={russian:new Set(["ё","е","e"])};function O5(e,t,a){if(e===t)return!0;for(const o of z5)if(o.has(e)&&o.has(t))return!0;if(a!==void 0){const o=H5[Ta(a)];if(o!==void 0&&o.has(e)&&o.has(t))return!0}return!1}function N5(e){return Uint8Array.prototype.toHex!==void 0?new Uint8Array(e).toHex():Array.from(new Uint8Array(e)).map(o=>o.toString(16).padStart(2,"0")).join("")}function hr(e){if(e.length!==1)return!1;const t=e.codePointAt(0);return t===void 0?!1:new Set([32,8194,8195,8201,12288,160,5760,8239,65279,8199,8200,8196,8202,8203]).has(t)}function Wu(e,t,a){if(a.length===0)return{result:!0};if(e==="words"||e==="time")return t===0?a.filter(i=>i.properties?.includes("noInfiniteDuration")).length>0?{result:!1,forcedConfigs:[e==="words"?10:15]}:{result:!0}:{result:!0};{const o={};for(const i of a)if(i.frontendForcedConfig)for(const n in i.frontendForcedConfig)o[n]===void 0?o[n]=i.frontendForcedConfig[n]:o[n]=jb(o[n],i.frontendForcedConfig[n],!0);if(o[e]===void 0)return{result:!0};if(o[e]?.length===0)throw new Error("No intersection of forced configs");return{result:(o[e]??[]).includes(t),forcedConfigs:o[e]}}}function Oy(e,t,a=[],o=!1){let i=0;const n=fr(a);if(e==="mode"){let l=fr(a).filter(c=>c.frontendForcedConfig?.mode!==void 0&&!c.frontendForcedConfig.mode.includes(t));t==="zen"&&(l=l.concat(n.filter(c=>{const d=c.frontendFunctions??[],u=c.properties??[];return d.includes("getWord")||d.includes("pullSection")||d.includes("alterText")||d.includes("withWords")||u.includes("changesCapitalisation")||u.includes("nospace")||u.some(m=>m.startsWith("toPush:"))||u.includes("changesWordsVisibility")||u.includes("speaks")||u.includes("changesLayout")||u.includes("changesWordsFrequency")}))),(t==="quote"||t==="custom")&&(l=l.concat(n.filter(c=>{const d=c.frontendFunctions??[],u=c.properties??[];return d.includes("getWord")||d.includes("pullSection")||d.includes("withWords")||u.includes("changesWordsFrequency")}))),l.length>0&&(i+=1)}if(e==="words"||e==="time"){if(!Wu(e,t,n).result)if(o)i+=1;else return f("Active funboxes do not support infinite tests",0),!1}else Wu(e,t,n).result||(i+=1);return i>0?(o||f(`You can't set ${Ry(e)} to ${t.toString()} with currently active funboxes.`,0,{duration:5}),!1):!0}function Ny(e,t){console.log("cansetfunboxwithconfig",e,t.mode);let a=[...t.funbox,e];const o=[];for(const[i,n]of Object.entries(t))Oy(i,n,a,!0)||o.push({key:i,value:n});if(o.length>0){const i=[];for(const n of o)i.push(`${Pt(Ry(n.key))} cannot be set to ${n.value.toString()}.`);return f(`You can't enable ${e.replace(/_/g," ")}:<br>${i.join("<br>")}`,0,{duration:5,allowHTML:!0}),!1}else return!0}class ut{constructor(t){this.key=t.key,this.schema=t.schema,this.fallback=t.fallback,this.migrate=t.migrate}get(){if(this.cache!==void 0)return console.debug(`LS ${this.key} Got cached value:`,this.cache),this.cache;console.debug(`LS ${this.key} Getting value from localStorage`);const t=window.localStorage.getItem(this.key);if(t===null)return console.debug(`LS ${this.key} No value found, returning fallback`),this.cache=this.fallback,this.cache;let a=!1;const{data:o,error:i}=dp(()=>ws(t,this.schema,{fallback:this.fallback,migrate:(n,l)=>(console.debug(`LS ${this.key} Schema validation failed`),a=!0,this.migrate?(console.debug(`LS ${this.key} Migrating from old format to new format`),this.cache=this.migrate(n,l),this.cache):(console.debug(`LS ${this.key} No migration function provided, returning fallback`),this.cache=this.fallback,this.cache))}));return i?(console.error(`LS ${this.key} Failed to parse from localStorage: ${i.message}`),window.localStorage.setItem(this.key,JSON.stringify(this.fallback)),this.cache=this.fallback,this.cache):((a||o===this.fallback)&&(console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(o))),console.debug(`LS ${this.key} Got value:`,o),this.cache=o,this.cache)}set(t){try{console.debug(`LS ${this.key} Parsing to set in localStorage`);const a=this.schema.parse(t);return console.debug(`LS ${this.key} Setting in localStorage`),window.localStorage.setItem(this.key,JSON.stringify(a)),this.cache=a,!0}catch(a){let o="Unknown error occurred";z2(a)?(console.error(a),o="Schema validation failed"):a.message.includes("exceeded the quota")&&(o="Local storage is full. Please clear some space and try again.");const i=`Failed to set ${this.key} in localStorage: ${o}`;return console.error(i),f(i,-1),!1}}}const Tp={punctuation:{icon:"fa-at",changeRequiresRestart:!0,group:"test",overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},numbers:{icon:"fa-hashtag",changeRequiresRestart:!0,group:"test",overrideValue:({value:e,currentConfig:t})=>t.mode==="quote"?!1:e},words:{icon:"fa-font",displayString:"word count",changeRequiresRestart:!0,group:"test",overrideConfig:({currentConfig:e})=>e.mode!=="words"?{mode:"words"}:{}},time:{icon:"fa-clock",changeRequiresRestart:!0,displayString:"time",group:"test",overrideConfig:({currentConfig:e})=>e.mode!=="time"?{mode:"time"}:{}},mode:{icon:"fa-bars",changeRequiresRestart:!0,group:"test",overrideConfig:({value:e})=>e==="custom"||e==="quote"||e==="zen"?{numbers:!1,punctuation:!1}:{},afterSet:({currentConfig:e})=>{e.mode==="zen"&&e.paceCaret!=="off"&&f("Pace caret will not work with zen mode.",0)}},quoteLength:{icon:"fa-quote-right",displayString:"quote length",changeRequiresRestart:!0,group:"test",overrideConfig:({currentConfig:e})=>e.mode!=="quote"?{mode:"quote"}:{}},language:{icon:"fa-language",displayString:"language",changeRequiresRestart:!0,group:"test"},burstHeatmap:{icon:"fa-fire",displayString:"word burst heatmap",changeRequiresRestart:!1,group:"test"},difficulty:{icon:"fa-star",changeRequiresRestart:!0,group:"behavior"},quickRestart:{icon:"fa-redo-alt",displayString:"quick restart",changeRequiresRestart:!1,group:"behavior"},repeatQuotes:{icon:"fa-sync-alt",displayString:"repeat quotes",changeRequiresRestart:!1,group:"behavior"},blindMode:{icon:"fa-eye-slash",displayString:"blind mode",changeRequiresRestart:!1,group:"behavior"},alwaysShowWordsHistory:{icon:"fa-align-left",displayString:"always show words history",changeRequiresRestart:!1,group:"behavior"},singleListCommandLine:{icon:"fa-list",displayString:"single list command line",changeRequiresRestart:!1,group:"behavior"},minWpm:{icon:"fa-bomb",displayString:"min speed",changeRequiresRestart:!0,group:"behavior"},minWpmCustomSpeed:{icon:"fa-bomb",displayString:"min speed custom",changeRequiresRestart:!0,group:"behavior",overrideConfig:({currentConfig:e})=>e.minWpm!=="custom"?{minWpm:"custom"}:{}},minAcc:{icon:"fa-bomb",displayString:"min accuracy",changeRequiresRestart:!0,group:"behavior"},minAccCustom:{icon:"fa-bomb",displayString:"min accuracy custom",changeRequiresRestart:!0,group:"behavior",overrideConfig:({currentConfig:e})=>e.minAcc!=="custom"?{minAcc:"custom"}:{}},minBurst:{icon:"fa-bomb",displayString:"min word burst",changeRequiresRestart:!0,group:"behavior"},minBurstCustomSpeed:{icon:"fa-bomb",displayString:"min word burst custom speed",changeRequiresRestart:!0,group:"behavior"},britishEnglish:{icon:"fa-language",displayString:"british english",changeRequiresRestart:!0,group:"behavior"},funbox:{icon:"fa-gamepad",changeRequiresRestart:!0,group:"behavior",isBlocked:({value:e,currentConfig:t})=>{if(!Wr(e))return f(`${Pt(e.join(", "))} is an invalid combination of funboxes`,0),!0;for(const a of e)if(!Ny(a,t))return f(`${e}" cannot be enabled with the current config`,0),!0;return!1}},customLayoutfluid:{icon:"fa-tint",displayString:"custom layoutfluid",changeRequiresRestart:!0,group:"behavior",overrideValue:({value:e})=>Array.from(new Set(e))},customPolyglot:{icon:"fa-language",displayString:"custom polyglot",changeRequiresRestart:!1,group:"behavior",overrideValue:({value:e})=>Array.from(new Set(e))},freedomMode:{icon:"fa-feather-alt",changeRequiresRestart:!1,displayString:"freedom mode",group:"input",overrideConfig:({value:e})=>e?{confidenceMode:"off"}:{}},strictSpace:{icon:"fa-minus",displayString:"strict space",changeRequiresRestart:!0,group:"input"},oppositeShiftMode:{icon:"fa-exchange-alt",displayString:"opposite shift mode",changeRequiresRestart:!1,group:"input"},stopOnError:{icon:"fa-hand-paper",displayString:"stop on error",changeRequiresRestart:!0,group:"input",overrideConfig:({value:e})=>e!=="off"?{confidenceMode:"off"}:{}},confidenceMode:{icon:"fa-backspace",displayString:"confidence mode",changeRequiresRestart:!1,group:"input",overrideConfig:({value:e})=>e!=="off"?{freedomMode:!1,stopOnError:"off"}:{}},quickEnd:{icon:"fa-step-forward",displayString:"quick end",changeRequiresRestart:!1,group:"input"},indicateTypos:{icon:"fa-exclamation",displayString:"indicate typos",changeRequiresRestart:!1,group:"input"},compositionDisplay:{icon:"fa-language",displayString:"composition display",changeRequiresRestart:!1,group:"input"},hideExtraLetters:{icon:"fa-eye-slash",displayString:"hide extra letters",changeRequiresRestart:!1,group:"input"},lazyMode:{icon:"fa-couch",displayString:"lazy mode",changeRequiresRestart:!0,group:"input"},layout:{icon:"fa-keyboard",displayString:"layout",changeRequiresRestart:!0,group:"input"},codeUnindentOnBackspace:{icon:"fa-code",displayString:"code unindent on backspace",changeRequiresRestart:!0,group:"input"},soundVolume:{icon:"fa-volume-down",displayString:"sound volume",changeRequiresRestart:!1,group:"sound"},playSoundOnClick:{icon:"fa-volume-up",displayString:"play sound on click",changeRequiresRestart:!1,group:"sound"},playSoundOnError:{icon:"fa-volume-mute",displayString:"play sound on error",changeRequiresRestart:!1,group:"sound"},playTimeWarning:{icon:"fa-exclamation-triangle",displayString:"play time warning",changeRequiresRestart:!1,group:"sound"},smoothCaret:{icon:"fa-i-cursor",displayString:"smooth caret",changeRequiresRestart:!1,group:"caret"},caretStyle:{icon:"fa-i-cursor",displayString:"caret style",changeRequiresRestart:!1,group:"caret"},paceCaret:{icon:"fa-i-cursor",displayString:"pace caret",changeRequiresRestart:!1,group:"caret",isBlocked:({value:e})=>document.readyState==="complete"&&(e==="pb"||e==="tagPb")&&!_()?(f('Pace caret "pb" and "tag pb" are unavailable without an account',0),!0):!1},paceCaretCustomSpeed:{icon:"fa-i-cursor",displayString:"pace caret custom speed",changeRequiresRestart:!1,group:"caret",overrideConfig:({currentConfig:e})=>e.paceCaret!=="custom"?{paceCaret:"custom"}:{}},paceCaretStyle:{icon:"fa-i-cursor",displayString:"pace caret style",changeRequiresRestart:!1,group:"caret"},repeatedPace:{icon:"fa-i-cursor",displayString:"repeated pace",changeRequiresRestart:!1,group:"caret"},timerStyle:{icon:"fa-chart-pie",displayString:"live progress style",changeRequiresRestart:!1,group:"appearance"},liveSpeedStyle:{icon:"fa-tachometer-alt",displayString:"live speed style",changeRequiresRestart:!1,group:"appearance"},liveAccStyle:{icon:"fa-tachometer-alt",displayString:"live accuracy style",changeRequiresRestart:!1,group:"appearance"},liveBurstStyle:{icon:"fa-tachometer-alt",displayString:"live word burst style",changeRequiresRestart:!1,group:"appearance"},timerColor:{icon:"fa-chart-pie",displayString:"timer color",changeRequiresRestart:!1,group:"appearance"},timerOpacity:{icon:"fa-chart-pie",displayString:"timer opacity",changeRequiresRestart:!1,group:"appearance"},highlightMode:{icon:"fa-highlighter",displayString:"highlight mode",changeRequiresRestart:!1,group:"appearance"},tapeMode:{icon:"fa-tape",triggerResize:!0,changeRequiresRestart:!1,displayString:"tape mode",group:"appearance",overrideConfig:({value:e})=>e!=="off"?{showAllLines:!1}:{}},tapeMargin:{icon:"fa-tape",displayString:"tape margin",triggerResize:!0,changeRequiresRestart:!1,group:"appearance"},smoothLineScroll:{icon:"fa-align-left",displayString:"smooth line scroll",changeRequiresRestart:!1,group:"appearance"},showAllLines:{icon:"fa-align-left",changeRequiresRestart:!1,displayString:"show all lines",group:"appearance",isBlocked:({value:e,currentConfig:t})=>e&&t.tapeMode!=="off"?(f("Show all lines doesn't support tape mode.",0),!0):!1},alwaysShowDecimalPlaces:{icon:"00",displayString:"always show decimal places",changeRequiresRestart:!1,group:"appearance"},typingSpeedUnit:{icon:"fa-tachometer-alt",displayString:"typing speed unit",changeRequiresRestart:!1,group:"appearance"},startGraphsAtZero:{icon:"fa-chart-line",displayString:"start graphs at zero",changeRequiresRestart:!1,group:"appearance"},maxLineWidth:{icon:"fa-text-width",changeRequiresRestart:!1,triggerResize:!0,displayString:"max line width",group:"appearance"},fontSize:{icon:"fa-font",changeRequiresRestart:!1,triggerResize:!0,displayString:"font size",group:"appearance"},fontFamily:{icon:"fa-font",displayString:"font family",changeRequiresRestart:!1,group:"appearance"},keymapMode:{icon:"fa-keyboard",displayString:"keymap mode",changeRequiresRestart:!1,group:"appearance"},keymapLayout:{icon:"fa-keyboard",displayString:"keymap layout",changeRequiresRestart:!1,group:"appearance",overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapStyle:{icon:"fa-keyboard",displayString:"keymap style",changeRequiresRestart:!1,group:"appearance",overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapLegendStyle:{icon:"fa-keyboard",displayString:"keymap legend style",changeRequiresRestart:!1,group:"appearance",overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapShowTopRow:{icon:"fa-keyboard",displayString:"keymap show top row",changeRequiresRestart:!1,group:"appearance",overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},keymapSize:{icon:"fa-keyboard",triggerResize:!0,changeRequiresRestart:!1,displayString:"keymap size",group:"appearance",overrideValue:({value:e})=>(e<.5&&(e=.5),e>3.5&&(e=3.5),Wl(e)),overrideConfig:({currentConfig:e})=>e.keymapMode==="off"?{keymapMode:"static"}:{}},flipTestColors:{icon:"fa-adjust",displayString:"flip test colors",changeRequiresRestart:!1,group:"theme"},colorfulMode:{icon:"fa-fill-drip",displayString:"colorful mode",changeRequiresRestart:!1,group:"theme"},customBackground:{icon:"fa-link",displayString:"URL background",changeRequiresRestart:!1,group:"theme",overrideValue:({value:e})=>e.trim()},customBackgroundSize:{icon:"fa-image",displayString:"custom background size",changeRequiresRestart:!1,group:"theme"},customBackgroundFilter:{icon:"fa-image",displayString:"custom background filter",changeRequiresRestart:!1,group:"theme"},autoSwitchTheme:{icon:"fa-palette",displayString:"auto switch theme",changeRequiresRestart:!1,group:"theme"},themeLight:{icon:"fa-palette",displayString:"theme light",changeRequiresRestart:!1,group:"theme"},themeDark:{icon:"fa-palette",displayString:"theme dark",changeRequiresRestart:!1,group:"theme"},randomTheme:{icon:"fa-palette",changeRequiresRestart:!1,displayString:"random theme",group:"theme",isBlocked:({value:e})=>{if(e==="custom"){const t=S();if(!_())return f("Random theme 'custom' is unavailable without an account",0),!0;if(!t)return f("Random theme 'custom' requires a snapshot to be set",0),!0;if(t?.customThemes?.length===0)return f("Random theme 'custom' requires at least one custom theme to be saved",0),!0}return!1}},favThemes:{icon:"fa-palette",displayString:"favorite themes",changeRequiresRestart:!1,group:"theme"},theme:{icon:"fa-palette",changeRequiresRestart:!1,group:"theme",overrideConfig:()=>({customTheme:!1})},customTheme:{icon:"fa-palette",displayString:"custom theme",changeRequiresRestart:!1,group:"theme"},customThemeColors:{icon:"fa-palette",displayString:"custom theme colors",changeRequiresRestart:!1,group:"theme",overrideValue:({value:e})=>e.every(a=>a===e[0])?Pa().customThemeColors:e},showKeyTips:{icon:"fa-question",displayString:"show key tips",changeRequiresRestart:!1,group:"hideElements"},showOutOfFocusWarning:{icon:"fa-exclamation",displayString:"show out of focus warning",changeRequiresRestart:!1,group:"hideElements"},capsLockWarning:{icon:"fa-exclamation-triangle",displayString:"caps lock warning",changeRequiresRestart:!1,group:"hideElements"},showAverage:{icon:"fa-chart-bar",displayString:"show average",changeRequiresRestart:!1,group:"hideElements"},showPb:{icon:"fa-crown",displayString:"show personal best",changeRequiresRestart:!1,group:"hideElements"},accountChart:{icon:"fa-chart-line",displayString:"account chart",changeRequiresRestart:!1,group:"hidden",overrideValue:({value:e,currentValue:t})=>{if(e[0]==="off"&&e[1]==="off"){const a=e[0]===t[0]?0:1;e[a]="on"}return e}},monkey:{icon:"fa-egg",displayString:"monkey",changeRequiresRestart:!1,group:"hidden"},monkeyPowerLevel:{icon:"fa-egg",displayString:"monkey power level",changeRequiresRestart:!1,group:"hidden"},ads:{icon:"fa-ad",changeRequiresRestart:!1,group:"ads",overrideValue:({value:e})=>e,isBlocked:({value:e})=>!1,afterSet:({nosave:e})=>{e||(Ao(3),f("Ad settings changed. Refreshing...",0))}}},Lp=new ut({key:"config",schema:zr,fallback:Pa(),migrate:(e,t)=>Wb(e)?rd(e):Pa()});let r={...Pa()},Vl={};const U5=Bt(1e3,()=>{Object.keys(Vl).length>0&&(ho(!0),Ay(Vl).then(()=>{ho(!1)})),Vl={}});function $p(e,t=!1,a=!1){t||(Lp.set(r),a||(Vl[e]=r[e],U5()))}function xs(e=!1){console.log("saving full config to localStorage"),Lp.set(r),e||(ho(!0),Ay(r),ho(!1))}function V5(){return Me&&r.funbox.includes("no_quit")?(f("No quit funbox is active. Please finish the test.",0,{important:!0}),!0):!1}function v(e,t,a){const o=Tp[e];if(o===void 0)throw new Error(`Config metadata for key "${e}" is not defined.`);o.overrideValue&&(t=o.overrideValue({value:t,currentValue:r[e],currentConfig:r}));const i=r[e];if(o.changeRequiresRestart&&Me&&r.funbox.includes("no_quit"))return f("No quit funbox is active. Please finish the test.",0,{important:!0}),console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - no quit funbox active.`),!1;if(o.isBlocked?.({value:t,currentConfig:r}))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - blocked.`),!1;const n=zr.shape[e];if(!qy(o.displayString??e,t,n))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - invalid value.`),!1;if(!Oy(e,t,r.funbox))return console.warn(`Could not set config key "${e}" with value "${JSON.stringify(t)}" - funbox conflict.`),!1;if(o.overrideConfig){const l=o.overrideConfig({value:t,currentConfig:r});for(const c of lt(l)){const d=l[c];if(r[c]===d)continue;if(!v(c,d,a))throw new Error(`Failed to set config key "${c}" with value "${d}" for ${o.displayString} config override.`)}}return r[e]=t,a?.nosave||$p(e,a?.nosave),Sc({key:e,newValue:t,nosave:a?.nosave??!1,previousValue:i}),o.triggerResize&&!a?.nosave&&h2(),o.afterSet?.({nosave:a?.nosave??!1,currentConfig:r}),!0}function Bn(e,t){if(V5()||!Ny(e,r))return!1;const a=r.funbox;let o=r.funbox;return o.includes(e)?o=o.filter(i=>i!==e):(o.push(e),o.sort()),qy("funbox",o,Gb)?(r.funbox=o,$p("funbox",t),Sc({key:"funbox",newValue:r.funbox,nosave:t,previousValue:a}),!0):!1}function Rn(e){return v("quoteLength",[0,1,2,3],{nosave:e})}const ah=new Set(["keymapMode","minWpm","minAcc","minBurst","paceCaret","quoteLength","words","time","mode","numbers","punctuation","funbox"]);async function Yn(e){if(e==null)return;const t=rd(e);Sc({key:"fullConfigChange"});const a=Pa();for(const n of lt(t))r[n]=a[n];const o=[],i=lt(t).filter(n=>!ah.has(n));for(const n of[...i,...ah]){const l=t[n];v(n,l,{nosave:!0})||o.push(n)}for(const n of o)$p(n);Sc({key:"fullConfigChangeFinished"})}async function Mp(){await Yn(Pa()),await f5(),xs(!0)}async function K5(){console.log("loading localStorage config");const e=Lp.get();e===void 0?await Mp():(await Yn(e),xs(!0)),j5()}function oh(){const e={};return lt(r).filter(t=>r[t]!==Pa()[t]).forEach(t=>{e[t]=r[t]}),e}async function Uy(e){try{const t=ws(e,Vb.strip(),{migrate:a=>{if(Array.isArray(a))throw new Error("Invalid config");return rd(a)}});await Yn(t),xs(),f("Done",1)}catch(t){const a=se(t,"Failed to import settings");console.error(a),f(a,-1)}}const{promise:Vy,resolve:j5}=ci();class G5{constructor(){this.list=[],this.sectionIndexList=[],this.length=0}get(t,a=!1){return t===void 0?this.list:a?this.list[t]?.replace(/[.?!":\-,]/g,"")?.toLowerCase():this.list[t]}getCurrent(){return this.list[ne]??""}getLast(){return this.list[this.list.length-1]}push(t,a){this.list.push(t),this.sectionIndexList.push(a),this.length=this.list.length}reset(){this.list=[],this.sectionIndexList=[],this.length=this.list.length}clean(){for(const t of this.list)if(/ +/.test(t)){const a=this.list.indexOf(t),o=t.split(" ");this.list.splice(a,1);for(let i=0;i<o.length;i++)this.list.splice(a+i,0,o[i])}}}const F=new G5;let Wi=!1,Xn=!1,Ky=!1,be=null;function zu(e){be=e}function Q5(e){Wi=e}function Y5(e){Xn=e}function X5(e){Ky=e}const ya=document.querySelector("#wordsInput");if(ya===null)throw new Error("Words input element not found");function mi(){return ya}function La(e){ya.value=" "+e}function J5(e){ya.value+=e}function Ts(){return{inputValue:ya.value.slice(1),realInputValue:ya.value}}function jy(){ya.setSelectionRange(ya.value.length,ya.value.length)}function Gy(e){const{inputValue:t}=Ts();La(t.slice(0,-1)+e)}function Jn(){return document.activeElement===ya}function Z5(e=!1){ya.focus({preventScroll:e})}function Ap(){ya.blur()}const Qy=new Set(["NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space","Enter","Tab","NoCode"]);class e3{constructor(){this.current="",this.history=[],this.koreanStatus=!1}reset(){this.current="",this.history=[]}resetHistory(){this.history=[]}setKoreanStatus(t){this.koreanStatus=t}getKoreanStatus(){return this.koreanStatus}pushHistory(){this.history.push(this.current),this.current=""}popHistory(){return this.history.pop()??""}get(t){return this.history[t]}getHistory(t){return t===void 0?this.history:this.history[t]}getHistoryLast(){return Nn(this.history)}syncWithInputElement(){this.current=Ts().inputValue}}class t3{constructor(){this.current="",this.history=[]}reset(){this.history=[],this.current=""}update(t,a){if(this.current==="")this.current+=A.current;else{const o=this.current.length,i=A.current.length-1;i>=o?this.current+=t:a||(this.current=this.current.substring(0,i)+t+this.current.substring(i+1))}}getHistory(t){return this.history[t]}popHistory(){const t=this.history.pop()??"";return this.current=t,t}pushHistory(){this.history.push(this.current),this.current=""}}let qt={};const A=new e3,on=new t3;let Ni=[],Lc=0,dd=0,yo={},ha={correct:0,incorrect:0},ve={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},co={total:0,lastStartTime:-1},Xo=[],Vr=[],aa=[],Kr=[],br={count:0,words:[]},jr=[],$c=!0;function a3(){Lc++}function Yy(){$c=!1}function o3(){br.count++}function i3(e){br.words.push(e)}function n3(e){dd=e}function ud(){Ni.push(Lc),Lc=0}function fd(){jr.push($c),$c=!0}function pd(){Kr.push(br),br={count:0,words:[]}}function s3(e){e?ha.correct++:ha.incorrect++}function r3(e){const t=new Set(Object.values(qt).map(n=>n.index)),a=ve.duration.array.filter((n,l)=>!t.has(l));if(a.length===0)return;const o=K(zl(a)),i=Object.entries(qt).sort((n,l)=>n[1].timestamp-l[1].timestamp);for(const[n,{index:l}]of i)ve.duration.array[l]=o,n==="NoCode"&&Zn--,delete qt[n],_p(e)}function Xy(e){return e.code==="NumpadEnter"&&r.funbox.includes("58008")?"Space":e.code.includes("Arrow")&&r.funbox.includes("arrows")||e.code===""||e.code===void 0||e.key==="Unidentified"?"NoCode":e.code}let Zn=0;function l3(e,t){if(t.repeat){console.log("Keyup not recorded - repeat",t.key,t.code,t.which);return}let a=Xy(t);if(!Qy.has(a))return;a==="NoCode"&&(Zn--,a="NoCode"+Zn);const o=qt[a];if(o===void 0)return;const i=Math.abs(o.timestamp-e);ve.duration.array[o.index]=i,console.debug("Keyup recorded",a,i),delete qt[a],_p(e)}function c3(e,t){if(t.repeat){console.log("Keydown not recorded - repeat",t.key,t.code,t.which);return}let a=Xy(t);if(!Qy.has(a)){console.debug("Keydown not recorded - not tracked",a);return}if(qt[a]!==void 0){console.debug("Key already down",a);return}if(a==="NoCode"&&(a="NoCode"+Zn,Zn++),qt[a]={timestamp:e,index:ve.duration.array.length},ve.duration.array.push(0),_p(qt[a]?.timestamp),ve.spacing.last!==-1){const o=Math.abs(e-ve.spacing.last);ve.spacing.array.push(K(o)),console.debug("Keydown recorded",a,o)}ve.spacing.last=e,ve.spacing.first===-1&&(ve.spacing.first=e,console.debug("First keydown recorded",a,e))}function _p(e){Object.keys(qt).length>1?co.lastStartTime===-1&&(co.lastStartTime=e):co.lastStartTime!==-1&&(co.total+=e-co.lastStartTime,co.lastStartTime=-1)}function d3(){const e=Object.keys(qt).reduce((a,o)=>{const i=qt[a]?.index,n=qt[o]?.index;return i===void 0?o:n===void 0||i>n?a:o},""),t=qt[e];ve={spacing:{first:-1,last:-1,array:[]},duration:{array:[]}},co={total:0,lastStartTime:-1},qt={},Zn=0,t!==void 0&&(ve={spacing:{first:t.timestamp,last:t.timestamp,array:[]},duration:{array:[0]}},qt[e]={timestamp:t.timestamp,index:0}),console.debug("Keypress timings reset")}function u3(e){Object.keys(yo).includes(e)?yo[e]++:yo[e]=1}function Jy(e){Xo.push(e)}function Zy(e){Vr.push(e)}function e0(e){aa[ne]===void 0?aa.push(e):aa[ne]=e}function f3(){Xo=[],Vr=[],aa=[],Ni=[],Lc=0,jr=[],$c=!0,Kr=[],br={count:0,words:[]},dd=0,yo={},ha={correct:0,incorrect:0}}const p3=V("#words"),tu=V("#wordsWrapper");let Fs=!0;class t0{constructor(t,a){this.style="default",this.readyToResetMarginTop=!1,this.readyToResetMarginLeft=!1,this.isMainCaret=!1,this.cumulativeTapeMarginCorrection=0,this.posAnimation=null,this.marginTopAnimation=null,this.marginLeftAnimation=null,this.id=t.native.id,this.element=t,this.setStyle(a),this.id==="caret"&&(this.isMainCaret=!0)}setStyle(t){this.style=t,this.resetWidth(),this.element.removeClass(["off","default","underline","outline","block","carrot","banana","monkey"]),this.element.addClass(t)}show(){this.element.show(),this.element.setStyle({display:""})}hide(){this.element.hide()}isHidden(){return this.element.hasClass("hidden")}getWidth(){return this.element.getOffsetWidth()}resetWidth(){this.element.setStyle({width:""})}getHeight(){if(!this.isHidden())return this.element.getOffsetHeight();let t=0;return this.show(),t=this.element.getOffsetHeight(),this.hide(),t}isFullWidth(){return["block","outline","underline"].includes(this.style)}setPosition(t){this.posAnimation?.cancel();let a={left:`${t.left}px`,top:`${t.top}px`};t.width!==void 0&&(a={...a,width:`${t.width}px`}),this.element.setStyle(a)}startBlinking(){r.smoothCaret!=="off"?this.element.setStyle({animationName:"caretFlashSmooth"}):this.element.setStyle({animationName:"caretFlashHard"})}stopBlinking(){this.element.setStyle({animationName:"none",opacity:"1"})}updateBlinkingAnimation(){r.smoothCaret==="off"?this.element.setStyle({animationName:"caretFlashHard"}):this.element.setStyle({animationName:"caretFlashSmooth"})}stopAllAnimations(){this.posAnimation?.cancel(),this.marginTopAnimation?.cancel(),this.marginLeftAnimation?.cancel()}clearMargins(){this.element.setStyle({marginTop:"",marginLeft:""}),this.readyToResetMarginTop=!1,this.readyToResetMarginLeft=!1,this.cumulativeTapeMarginCorrection=0}handleTapeWordsRemoved(t){this.cumulativeTapeMarginCorrection+=t}handleTapeScroll(t){if(this.isMainCaret&&Fs)return;this.readyToResetMarginLeft=!1;const a=t.newValue-this.cumulativeTapeMarginCorrection;if(t.duration===0){this.marginLeftAnimation?.cancel(),this.element.setStyle({marginLeft:`${a}px`}),this.readyToResetMarginLeft=!0;return}this.marginLeftAnimation=this.element.animate({marginLeft:a,duration:t.duration,ease:t.ease,onComplete:()=>{this.readyToResetMarginLeft=!0}})}handleLineJump(t){if(!(this.isMainCaret&&t.duration===0)){if(this.readyToResetMarginTop&&this.element.setStyle({marginTop:"0px"}),this.readyToResetMarginTop=!1,t.duration===0){this.marginTopAnimation?.cancel(),this.element.setStyle({marginTop:`${t.newMarginTop}px`}),this.readyToResetMarginTop=!0;return}this.marginTopAnimation=this.element.animate({marginTop:t.newMarginTop,duration:t.duration,onComplete:()=>{this.readyToResetMarginTop=!0}})}}animatePosition(t){const a=r.smoothCaret==="off"?0:r.smoothCaret==="slow"?150:r.smoothCaret==="medium"?100:r.smoothCaret==="fast"?85:0,o=t.duration??a,i={left:t.left,top:t.top};t.width!==void 0&&(i.width=t.width),this.posAnimation=this.element.animate({...i,duration:o,ease:t.easing??"inOut(1.25)"})}goTo(t){this.style!=="off"&&Ae(`caret.${this.id}.goTo`,()=>{const a=p3.qs(`.word[data-wordindex="${t.wordIndex}"]`),o=a?.qsa("letter")??[],i=F.get(t.wordIndex);let n="beforeLetter";t.letterIndex>=o.length&&(n="afterLetter",r.blindMode||r.hideExtraLetters?t.letterIndex=i?.length-1:t.letterIndex=o.length-1),t.letterIndex<0&&(t.letterIndex=0);let l=a?.qsa("letter")[t.letterIndex];if(a===null||l===void 0)return;this.element.removeClass("debug");const{left:c,top:d,width:u}=this.getTargetPositionAndWidth({word:a,letter:l,wordText:i,side:n,isLanguageRightToLeft:t.isLanguageRightToLeft,isDirectionReversed:t.isDirectionReversed});let m=parseFloat(this.element.getStyle().marginTop||"0");if(this.readyToResetMarginTop){this.readyToResetMarginTop=!1;const h=parseFloat(this.element.getStyle().top||"0");this.element.setStyle({marginTop:"0px",top:`${h+m}px`}),m=0}let p=parseFloat(this.element.getStyle().marginLeft||"0");if(this.readyToResetMarginLeft){this.readyToResetMarginLeft=!1;const h=parseFloat(this.element.getStyle().left||"0");this.element.setStyle({marginLeft:"0px",left:`${h+p}px`}),this.cumulativeTapeMarginCorrection+=p,p=0}const g={left:c-p,top:d-m,...this.isFullWidth()&&{width:u},...t.animate&&t.animationOptions};t.animate?this.animatePosition(g):this.setPosition(g)})}getTargetPositionAndWidth(t){const a=Hy(t.wordText,t.isLanguageRightToLeft,t.isDirectionReversed);if(!(t.letter.getOffsetWidth()>0)){const u=t.word.qsa("letter");if(u.length===0)throw new Error("Caret getLeftTopWidth: no letters found in word");let m=!0;for(let p=u.length-1;p>=0;p--){const g=u[p];if(g===t.letter){m=!1;continue}if(!m&&g.getOffsetWidth()>0){t.letter=g;break}}}const i=b2(t.word.native);let n=i;this.isFullWidth()&&t.side==="beforeLetter"&&(n=t.letter.getOffsetWidth());let l=0,c=0;const d=tu.getOffsetWidth()*(r.tapeMargin/100);if(a){let u=0;t.side==="afterLetter"&&(this.isFullWidth()?u+=i*-1:u+=t.letter.getOffsetWidth()*-1),r.tapeMode==="off"?(this.isFullWidth()||(l+=t.letter.getOffsetWidth()),l+=t.letter.getOffsetLeft(),l+=t.word.getOffsetLeft(),l+=u):r.tapeMode==="word"?(this.isFullWidth()||(l+=t.letter.getOffsetWidth()),l+=t.word.getOffsetWidth()*-1,l+=t.letter.getOffsetLeft(),l+=u,this.isMainCaret&&Fs?l+=tu.getOffsetWidth()-d:(l+=t.word.getOffsetLeft(),l+=t.word.getOffsetWidth())):r.tapeMode==="letter"&&(this.isFullWidth()&&(l+=n*-1),this.isMainCaret&&Fs?l+=tu.getOffsetWidth()-d:(l+=t.letter.getOffsetLeft(),l+=t.word.getOffsetLeft(),l+=u,l+=n))}else{let u=0;t.side==="afterLetter"&&(u+=t.letter.getOffsetWidth()),r.tapeMode==="off"?(l+=t.letter.getOffsetLeft(),l+=t.word.getOffsetLeft(),l+=u):r.tapeMode==="word"?(l+=t.letter.getOffsetLeft(),l+=u,this.isMainCaret&&Fs?l+=d:l+=t.word.getOffsetLeft()):r.tapeMode==="letter"&&(this.isMainCaret&&Fs?l+=d:(l+=t.letter.getOffsetLeft(),l+=t.word.getOffsetLeft(),l+=u))}return c+=t.letter.getOffsetTop(),c+=t.word.getOffsetTop(),this.style==="underline"?c+=t.letter.getOffsetHeight():c+=(t.letter.getOffsetHeight()-this.getHeight())/2,this.isFullWidth()||(l+=this.getWidth()/2*-1),{left:l,top:c,width:n}}}const md={composing:!1,data:""};function m3(){return md.composing}function Ep(e){md.composing=e}function gd(e){md.data=e}function nn(){return md.data}function a0(){oa.stopBlinking()}function o0(){oa.startBlinking()}function Gr(){oa.hide()}function g3(){oa.stopAllAnimations(),oa.clearMargins(),oa.goTo({wordIndex:0,letterIndex:0,isLanguageRightToLeft:ia,isDirectionReversed:fi,animate:!1})}function Qr(e=!1){oa.goTo({wordIndex:ne,letterIndex:A.current.length+nn().length,isLanguageRightToLeft:ia,isDirectionReversed:fi,animate:r.smoothCaret!=="off"&&!e})}const oa=new t0(V("#caret"),r.caretStyle);Ce(({key:e})=>{e==="caretStyle"&&(oa.setStyle(r.caretStyle),Qr(!0)),e==="smoothCaret"&&oa.updateBlinkingAnimation()});function i0(e=!1){oa.show(),Qr(e),o0()}class Ps{constructor(t,a,o,i,n){this.unit=t,this.convertFactor=a,this.fullUnitString=o,this.histogramDataBucketSize=i,this.historyStepSize=n}fromWpm(t){return t*this.convertFactor}toWpm(t){return t/this.convertFactor}}const h3={wpm:new Ps("wpm",1,"Words per Minute",10,10),cpm:new Ps("cpm",5,"Characters per Minute",50,100),wps:new Ps("wps",1/60,"Words per Second",.5,2),cps:new Ps("cps",5/60,"Characters per Second",5,5),wph:new Ps("wph",60,"Words per Hour",250,1e3)};function bt(e){return h3[e]}const au={suffix:"",fallback:"-",showDecimalPlaces:void 0,rounding:Math.round};class b3{constructor(t){this.config=t}typingSpeed(t,a={}){const o={...au,...a};if(t==null)return o.fallback??"";const i=bt(this.config.typingSpeedUnit).fromWpm(t);return this.number(i,o)}percentage(t,a={}){const o={...au,...a};return o.suffix="%"+(o.suffix??""),this.number(t,o)}accuracy(t,a={}){return this.percentage(t,{rounding:Math.floor,...a})}decimals(t,a={}){const o={...au,...a};return this.number(t,o)}number(t,a){if(t==null)return a.fallback??"";const o=a.suffix??"";return a.showDecimalPlaces??this.config.alwaysShowDecimalPlaces?K(t).toFixed(2)+o:(a.rounding??Math.round)(t).toString()+o}rank(t,a={}){const o={fallback:"-",...a};if(t==null)return o.fallback??"";let i="th";const n=t%10,l=t%100;return n===1&&l!==11&&(i="st"),n===2&&l!==12&&(i="nd"),n===3&&l!==13&&(i="rd"),t+i}}const W=new b3(r),Jo=document.querySelector("#liveStatsTextBottom .liveSpeed"),Zo=document.querySelector("#liveStatsMini .speed");function y3(){Ae("live-speed.reset",()=>{Jo.innerHTML="0",Zo.innerHTML="0"})}function v3(e,t){Ae("live-speed.update",()=>{let a=e;r.blindMode&&(a=t);const o=W.typingSpeed(a,{showDecimalPlaces:!1});Jo.innerHTML=o,Zo.innerHTML=o})}let es=!1;function qp(){r.liveSpeedStyle!=="off"&&Me&&(es||Ae("live-speed.show",()=>{r.liveSpeedStyle==="mini"?(Zo.classList.remove("hidden"),O(Zo,{opacity:[0,1],duration:Y(125)})):(Jo.classList.remove("hidden"),O(Jo,{opacity:[0,1],duration:Y(125)})),es=!0}))}function Ip(){es&&Ae("live-speed.hide",()=>{O(Zo,{opacity:[1,0],duration:Y(125),onComplete:()=>{Zo.classList.add("hidden")}}),O(Jo,{opacity:[1,0],duration:Y(125),onComplete:()=>{Jo.classList.add("hidden")}}),es=!1})}function w3(){es&&(Zo.classList.add("hidden"),Zo.style.opacity="0",Jo.classList.add("hidden"),Jo.style.opacity="0",es=!1)}Ce(({key:e,newValue:t})=>{e==="liveSpeedStyle"&&(t==="off"?Ip():qp())});const ei=document.querySelector("#liveStatsTextBottom .liveBurst"),ti=document.querySelector("#liveStatsMini .burst");function C3(){Ae("live-burst.reset",()=>{ei.innerHTML="0",ti.innerHTML="0"})}async function k3(e){Ae("live-burst.update",()=>{const t=W.typingSpeed(e,{showDecimalPlaces:!1});ti.innerHTML=t,ei.innerHTML=t})}let ts=!1;function Dp(){r.liveBurstStyle!=="off"&&Me&&(ts||Ae("live-burst.show",()=>{r.liveBurstStyle==="mini"?(ti.classList.remove("hidden"),O(ti,{opacity:[0,1],duration:Y(125)})):(ei.classList.remove("hidden"),O(ei,{opacity:[0,1],duration:Y(125)})),ts=!0}))}function Fp(){ts&&Ae("live-burst.hide",()=>{O(ei,{opacity:[1,0],duration:Y(125),onComplete:()=>{ei.classList.add("hidden")}}),O(ti,{opacity:[1,0],duration:Y(125),onComplete:()=>{ti.classList.add("hidden")}}),ts=!1})}function S3(){ts&&(ei.classList.add("hidden"),ei.style.opacity="0",ti.classList.add("hidden"),ti.style.opacity="0",ts=!1)}Ce(({key:e,newValue:t})=>{e==="liveBurstStyle"&&(t==="off"?Fp():Dp())});const ai=document.querySelector("#liveStatsTextBottom .liveAcc"),oi=document.querySelector("#liveStatsMini .acc");function x3(e){Ae("live-acc.update",()=>{let t=Math.floor(e);r.blindMode&&(t=100),oi.innerHTML=t+"%",ai.innerHTML=t+"%"})}function T3(){Ae("live-acc.reset",()=>{oi.innerHTML="100%",ai.innerHTML="100%"})}let as=!1;function Pp(){r.liveAccStyle!=="off"&&Me&&(as||Ae("live-acc.show",()=>{r.liveAccStyle==="mini"?(oi.classList.remove("hidden"),O(oi,{opacity:[0,1],duration:Y(125)})):(ai.classList.remove("hidden"),O(ai,{opacity:[0,1],duration:Y(125)})),as=!0}))}function Bp(){as&&Ae("live-acc.hide",()=>{O(ai,{opacity:[1,0],duration:Y(125),onComplete:()=>{ai.classList.add("hidden")}}),O(oi,{opacity:[1,0],duration:Y(125),onComplete:()=>{oi.classList.add("hidden")}}),as=!1})}function L3(){as&&(ai.classList.add("hidden"),ai.style.opacity="0",oi.classList.add("hidden"),oi.style.opacity="0",as=!1)}Ce(({key:e,newValue:t})=>{e==="liveAccStyle"&&(t==="off"?Bp():Pp())});const $3=I.record(I.string(),I.string()),M3=I.record(I.string(),I.object({text:I.string(),progress:I.number()})),n0=new ut({key:"customText",schema:$3,fallback:{}}),s0=new ut({key:"customTextLong",schema:M3,fallback:{}}),r0=H2.omit({textLen:!0}).extend({text:I.array(I.string()).min(1)}),ih={text:["The","quick","brown","fox","jumps","over","the","lazy","dog"],mode:"repeat",limit:{value:9,mode:"word"},pipeDelimiter:!1},yt=new ut({key:"customTextSettings",schema:r0,fallback:ih,migrate:(e,t)=>{const a=structuredClone(ih);if(typeof e!="object"||e===null)return a;const o=a;return"text"in e&&I.array(I.string()).safeParse(o.text).success&&(o.text=e.text),o}});function Yr(){return yt.get().text}function So(e){const t=yt.get();yt.set({...t,text:e,limit:{value:e.length,mode:t.limit.mode}})}function Kl(){return yt.get().mode}function os(e){const t=yt.get();yt.set({...t,mode:e,limit:{value:t.text.length,mode:t.limit.mode}})}function Hu(){return yt.get().limit}function we(){return yt.get().limit.value}function Se(){return yt.get().limit.mode}function ja(e){const t=yt.get();yt.set({...t,limit:{value:e,mode:t.limit.mode}})}function _a(e){const t=yt.get();yt.set({...t,limit:{value:t.limit.value,mode:e}})}function Ls(){return yt.get().pipeDelimiter}function Ui(e){const t=yt.get();yt.set({...t,pipeDelimiter:e})}function xo(){return yt.get()}function Mc(e,t=!1){if(t){const o=$s()[e];if(o===void 0)throw new Error(`Custom text ${e} not found`);return o.text.split(/ +/)}else{const a=hd()[e];if(a===void 0)throw new Error(`Custom text ${e} not found`);return a.split(/ +/)}}function A3(e,t,a=!1){if(a){const o=$s();o[e]={text:"",progress:0};const i=o[e];if(i===void 0)throw new Error("Custom text not found");return typeof t=="string"?i.text=t:i.text=t.join(" "),Wp(o)}else{const o=hd();return typeof t=="string"?o[e]=t:o[e]=t.join(" "),c0(o)}}function l0(e,t){const a=t?$s():hd();delete a[e],t?Wp(a):c0(a)}function Rp(e){const t=$s()[e];if(t===void 0)throw new Error("Custom text not found");return t.progress??0}function Ou(e,t){const a=$s(),o=a[e];if(o===void 0)throw new Error("Custom text not found");o.progress=t,Wp(a)}function hd(){return n0.get()}function $s(){return s0.get()}function c0(e){return n0.set(e)}function Wp(e){return s0.set(e)}function Nu(e=!1){return Object.keys(e?$s():hd())}let zp=0;function Xr(){return zp}function _3(e){zp=e}function E3(){zp++}const Uu=document.querySelector("#barTimerProgress .bar"),Ac=document.querySelector("#barTimerProgress .opacityWrapper"),Je=document.querySelector("#liveStatsTextTop .timerProgress"),Ue=document.querySelector("#liveStatsMini .time");function Hp(){Me&&Ae("timer-progress.show",()=>{r.mode!=="zen"&&r.timerStyle==="bar"?O(Ac,{opacity:[0,1],duration:Y(125),onBegin:()=>{Ac.classList.remove("hidden")}}):r.timerStyle==="text"?O(Je,{opacity:[0,1],duration:Y(125),onBegin:()=>{Je.classList.remove("hidden")}}):r.timerStyle==="flash_mini"?O(Ue,{opacity:[0,1],duration:Y(125),onBegin:()=>{Ue.classList.remove("hidden")}}):r.timerStyle==="flash_text"?O(Je,{opacity:[0,1],duration:Y(125),onBegin:()=>{Je.classList.remove("hidden")}}):(r.mode==="zen"||r.timerStyle==="mini")&&O(Ue,{opacity:[0,1],duration:Y(125),onBegin:()=>{Ue.classList.remove("hidden")}})})}function q3(){Ae("timer-progress.reset",()=>{let e="0vw";(r.mode==="time"||r.mode==="custom"&&Se()==="time")&&(e="100vw"),O(Uu,{width:e,duration:0}),Ue.textContent="0",Je.textContent="0"})}function Op(){Ae("timer-progress.hide",()=>{O(Ac,{opacity:0,duration:Y(125)}),O(Ue,{opacity:0,duration:Y(125),onComplete:()=>{Ue.classList.add("hidden")}}),O(Je,{opacity:0,duration:Y(125),onComplete:()=>{Je.classList.add("hidden")}})})}function I3(){Ac.style.opacity="0",Ue.classList.add("hidden"),Ue.style.opacity="0",Je.classList.add("hidden"),Je.style.opacity="0"}function Cl(){return r.mode==="custom"&&Se()==="section"?F.sectionIndexList[ne]-1:A.getHistory().length}function bd(){Ae("timer-progress.update",()=>{const e=Xr();if(r.mode==="time"||r.mode==="custom"&&Se()==="time"){let t=r.time;if(r.mode==="custom"&&Se()==="time"&&(t=we()),r.timerStyle==="bar"){const a=100-(e+1)/t*100;O(Uu,{width:a+"vw",duration:1e3,ease:"linear"})}else if(r.timerStyle==="text"){let a=Re(t-e);t===0&&(a=Re(e)),Je!==null&&(Je.innerHTML="<div>"+a+"</div>")}else if(r.timerStyle==="flash_mini"){let a=Re(t-e);t===0&&(a=Re(e)),Ue!==null&&((t-e)%15!==0?Ue.style.opacity="0":Ue.style.opacity="1",Ue.innerHTML="<div>"+a+"</div>")}else if(r.timerStyle==="flash_text"){let a=Re(t-e);t===0&&(a=Re(e)),Je!==null&&(Je.innerHTML=`<div>${(t-e)%15!==0?"":a}</div>`)}else if(r.timerStyle==="mini"){let a=Re(t-e);t===0&&(a=Re(e)),Ue!==null&&(Ue.innerHTML=a)}}else if(r.mode==="words"||r.mode==="custom"||r.mode==="quote"){let t=F.length;if(r.mode==="words"&&(t=r.words),r.mode==="custom"&&(t=we()),r.mode==="quote"&&(t=be?.textSplit.length??1),r.timerStyle==="bar"){const a=Math.floor((ne+1)/t*100);O(Uu,{width:a+"vw",duration:250})}else r.timerStyle==="text"?t===0?Je.innerHTML=`<div>${A.getHistory().length}</div>`:Je.innerHTML=`<div>${Cl()}/${t}</div>`:r.timerStyle==="flash_mini"?t===0?Ue.innerHTML=`${A.getHistory().length}`:Ue.innerHTML=`${Cl()}/${t}`:r.timerStyle==="flash_text"?t===0?Je.innerHTML=`<div>${A.getHistory().length}</div>`:Je.innerHTML=`<div>${Cl()}/${t}</div>`:r.timerStyle==="mini"&&(t===0?Ue.innerHTML=`${A.getHistory().length}`:Ue.innerHTML=`${Cl()}/${t}`)}else r.mode==="zen"&&(r.timerStyle==="text"?Je.innerHTML=`<div>${A.getHistory().length}</div>`:r.timerStyle==="flash_mini"?Ue.innerHTML=`${A.getHistory().length}`:r.timerStyle==="flash_text"?Je.innerHTML=`<div>${A.getHistory().length}</div>`:Ue.innerHTML=`${A.getHistory().length}`)})}function D3(){Me&&(Op(),bd(),r.timerStyle!=="off"&&setTimeout(()=>{Hp()},125))}Ce(({key:e})=>{e==="timerStyle"&&D3()});const nh=3;let Us=!1,sh=!1,Oa={};function F3(){if(sh)return;const e="body, button, a",t=["app","header","footer","main","#bannerCenter","#notificationCenter","#capsWarning","#ad-vertical-right-wrapper","#ad-vertical-left-wrapper","#ad-footer-wrapper","#ad-footer-small-wrapper"].join(",");Oa.cursor=[...document.querySelectorAll(e)],Oa.focus=[...document.querySelectorAll(t)],sh=!0}function eo(e,t=!1){Ae("focus.set",()=>{if(F3(),e&&!Us){if(Us=!0,Oa.focus)for(const a of Oa.focus)a.classList.add("focus");if(!t&&Oa.cursor)for(const a of Oa.cursor)a.style.cursor="none";a0(),qp(),Dp(),Pp(),Hp()}else if(!e&&Us){if(Us=!1,Oa.focus)for(const a of Oa.focus)a.classList.remove("focus");if(Oa.cursor)for(const a of Oa.cursor)a.style.cursor="";o0(),Ip(),Fp(),Bp(),Op()}})}s(document).on("mousemove",function(e){Kn()||Us&&e.originalEvent&&(e.originalEvent.movementX>nh||e.originalEvent.movementY>nh)&&eo(!1)});const P3={title:"Minimum word burst...",configKey:"minBurst",list:[{id:"setMinBurstOff",display:"off",configValue:"off",exec:()=>{v("minBurst","off")}},{id:"setMinBurstFixed",display:"fixed...",configValue:"fixed",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;v("minBurst","fixed");const t=bt(r.typingSpeedUnit).toWpm(parseInt(e));v("minBurstCustomSpeed",t)}},{id:"setMinBurstFlex",display:"flex...",configValue:"flex",input:!0,exec:({input:e})=>{if(e===void 0||e==="")return;v("minBurst","flex");const t=bt(r.typingSpeedUnit).toWpm(parseInt(e));v("minBurstCustomSpeed",t)}}]},d0=[{id:"changeMinBurst",display:"Minimum word burst...",alias:"minimum",icon:"fa-bomb",subgroup:P3}],u0=[];function Jr(){s("#words, #compositionDisplay").css("transition","none").removeClass("blurred"),s(".outOfFocusWarning").addClass("hidden"),y2(u0)}function Np(){r.showOutOfFocusWarning&&u0.push(setTimeout(()=>{s("#words, #compositionDisplay").css("transition","0.25s").addClass("blurred"),s(".outOfFocusWarning").removeClass("hidden")},1e3))}function fa(e,t,a){const o=rh(e),i=rh(t);if(o&&i){const n=o.a??1,l=i.a??1,c=Math.round(o.r*(1-a)+i.r*a),d=Math.round(o.g*(1-a)+i.g*a),u=Math.round(o.b*(1-a)+i.b*a),m=n*(1-a)+l*a;return o.a!==void 0||i.a!==void 0||m!==1?lh(c,d,u,m):lh(c,d,u)}else return"#ff00ffff"}function rh(e){if(e.length!==4&&e.length!==5&&e.length!==7&&e.length!==9||!e.startsWith("#"))return;let t,a,o,i;if(e.length===4)t=+("0x"+e[1]+e[1]),a=+("0x"+e[2]+e[2]),o=+("0x"+e[3]+e[3]);else if(e.length===5)t=+("0x"+e[1]+e[1]),a=+("0x"+e[2]+e[2]),o=+("0x"+e[3]+e[3]),i=+("0x"+e[4]+e[4])/255;else if(e.length===7)t=+("0x"+e[1]+e[2]),a=+("0x"+e[3]+e[4]),o=+("0x"+e[5]+e[6]);else if(e.length===9)t=+("0x"+e[1]+e[2]),a=+("0x"+e[3]+e[4]),o=+("0x"+e[5]+e[6]),i=+("0x"+e[7]+e[8])/255;else return;const n={r:t,g:a,b:o};return i!==void 0&&(n.a=i),n}function lh(e,t,a,o){const i=Math.round(e).toString(16).padStart(2,"0"),n=Math.round(t).toString(16).padStart(2,"0"),l=Math.round(a).toString(16).padStart(2,"0");if(o!==void 0){const c=Math.round(o*255).toString(16).padStart(2,"0");return`#${i}${n}${l}${c}`}return`#${i}${n}${l}`}function _c(e){let t,a,o,i;e.length===4?(t="0x"+e[1]+e[1],a="0x"+e[2]+e[2],o="0x"+e[3]+e[3]):e.length===5?(t="0x"+e[1]+e[1],a="0x"+e[2]+e[2],o="0x"+e[3]+e[3],i=("0x"+e[4]+e[4])/255):e.length===7?(t="0x"+e[1]+e[2],a="0x"+e[3]+e[4],o="0x"+e[5]+e[6]):e.length===9?(t="0x"+e[1]+e[2],a="0x"+e[3]+e[4],o="0x"+e[5]+e[6],i=("0x"+e[7]+e[8])/255):(t=0,a=0,o=0),t/=255,a/=255,o/=255;const n=Math.min(t,a,o),l=Math.max(t,a,o),c=l-n;let d=0,u=0,m=0;c===0?d=0:l===t?d=(a-o)/c%6:l===a?d=(o-t)/c+2:d=(t-a)/c+4,d=Math.round(d*60),d<0&&(d+=360),m=(l+n)/2,u=c===0?0:c/(1-Math.abs(2*m-1)),u=+(u*100).toFixed(1),m=+(m*100).toFixed(1);const p={hue:d,sat:u,lgt:m,string:i!==void 0?`hsla(${d}, ${u}%, ${m}%, ${i.toFixed(3)})`:`hsl(${d}, ${u}%, ${m}%)`};return i!==void 0&&(p.alpha=i),p}function f0(e){return _c(e).lgt>=50}function Up(e){return _c(e).lgt<50}function B3(e){const t=e.match(/^rgb\((\d+), \s*(\d+), \s*(\d+)\)$/);if(t===null||t.length<3)return;function a(o){return("0"+parseInt(o).toString(16)).slice(-2)}return"#"+a(t[1])+a(t[2])+a(t[3])}const Et=16,p0=12,Vu=Et/2,R3=p0/2,ch=250;let Ut=[],ft,is={},Ec=[],yd=[],tr=[],Vp=[],An=[],kl,fn,m0=new Date,yr=!1,g0=!1,Ku=!0,qc=!0,Sl=!1;async function W3(e,t){if(!g0||An!==void 0&&e===An[0]&&t===An[1]||!yr&&!await H3()||e===void 0||t===void 0||e<0||t<0||t<e)return!1;t=Math.min(t,ft.length-1);const a=O3(e,t,ia);for(let o=0;o<Ut.length;o++){const i=yd[o],n=i.children[0];i.classList.remove("highlight-hidden"),!Ku&&!qc?(i.classList.add("withAnimation"),n.classList.add("withAnimation")):(i.classList.remove("withAnimation"),n.classList.remove("withAnimation"));const l=a[o];l&&(i.style.right=l.highlightRight+"px",n.style.left=l.inputContainerLeft+"px",i.style.left=l.highlightLeft+"px")}return Ku=!1,qc=!1,An=[e,t],!0}function z3(){for(const e of yd)e.classList.add("highlight-hidden");qc=!0,An=[]}function Kp(){if(yr){for(const e of Ec)e.remove();yd=[],Ec=[],is={},Ut=[],tr=[],Vp=[],yr=!1,Ku=!0,qc=!0,An=[]}}function h0(e){g0=e}async function H3(){if(yr||Sl)return!1;Sl=!0;const e=new Date().getTime()-m0.getTime();if(e<ch&&await new Promise(d=>setTimeout(d,ch-e)),kl=s("#resultWordsHistory")[0],fn=kl.getBoundingClientRect(),ft=s(kl).find(".words .word[input]"),ft.length===0)return Sl=!1,!1;let t=-1,a,o=0;is[0]=0;for(let d=1;d<ft.length;d++){const u=ft[d],m=ft[d-1];u.offsetTop!==m.offsetTop&&(o++,a=Js([ft[t+1],m]),Ut.push({firstWordIndex:t+1,lastWordIndex:d-1,rect:a}),t=d-1),is[d]=o}a=Js([ft[t+1],ft[ft.length-1]]),Ut.push({firstWordIndex:t+1,lastWordIndex:ft.length-1,rect:a});const i=fn.width,n=fn.height,l=fn.top,c=fn.left;return Ut.forEach(d=>{const u=document.createElement("div");u.classList.add("highlightContainer"),Ec.push(u);const m=d.rect.top-R3,p=d.rect.left-Vu,g=m-l,h=p-c,y=d.rect.width+Et,k=d.rect.height+p0,x=d.rect.width,C=d.rect.height,D=g/n*100+"%",E=h/i*100+"%",B=y/i*100+"%",z=k/n*100+"%";u.style.width=B,u.style.top=D,u.style.left=E,u.style.height=z;const H=document.createElement("div"),ae=document.createElement("div");ae.style.top=d.rect.top-m+"px",ae.style.left=d.rect.left-p+"px",ae.style.width=x+"px",ae.style.height=C+"px",H.className="highlight highlight-hidden",ae.className="inputWordsContainer";for(let xe=d.firstWordIndex;xe<=d.lastWordIndex;xe+=1){const Fe=ft[xe],ze=Fe.getAttribute("input")??"";if(!ze)continue;const N=document.createElement("div");let re;ia?re=d.rect.left-fn.left+Et:re=0,N.style.left=Fe.offsetLeft+Vu-re+"px",N.innerHTML=ze.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt").slice(0,Fe.childElementCount),N.className="inputWord",ae.append(N),Vp.push(N)}tr.push(ae),yd.push(H),H.append(ae),u.append(H),kl.append(u)}),yr=!0,Sl=!1,!0}function O3(e,t,a=!1){const o=is[e],i=new Array(Ut.length).fill(null).map(()=>({highlightLeft:0,highlightRight:0,inputContainerLeft:0,inputContainerRight:0})),n=N3(e,t),l=ft[e],c=Ut[o],d=i[o],u=Ec[o],m=tr[o];if(l===void 0||c===void 0||d===void 0||u===void 0||m===void 0)return i;if(!a)d.highlightLeft=l.offsetLeft,d.highlightRight=c.rect.width-(d.highlightLeft+n)+Et;else{const p=u.offsetLeft;d.highlightRight=c.rect.width-(l.offsetLeft+l.offsetWidth)+p+Vu,d.highlightLeft=c.rect.width-(d.highlightRight+n)+Et}a?d.inputContainerLeft=-1*(m.getBoundingClientRect().width-n-d.highlightRight):d.inputContainerLeft=-1*d.highlightLeft;for(let p=o-1;p>=0;p--){const g=i[p],h=i[p+1],y=Ut[p],k=tr[p];g===void 0||y===void 0||h===void 0||k===void 0||(a?(g.highlightRight=h.highlightRight+y.rect.width+Et,g.highlightLeft=y.rect.width-(g.highlightRight+n)+Et,g.inputContainerLeft=-1*(k.getBoundingClientRect().width-n-g.highlightRight)):(g.highlightLeft=h.highlightLeft+y.rect.width+Et,g.highlightRight=y.rect.width-(g.highlightLeft+n)+Et,g.inputContainerLeft=-1*g.highlightLeft))}for(let p=o+1;p<Ut.length;p++){const g=i[p],h=Ut[p-1],y=Ut[p],k=i[p-1],x=tr[p];g===void 0||h===void 0||y===void 0||k===void 0||x===void 0||(a?(g.highlightRight=-1*(h.rect.width-k.highlightRight+Et),g.highlightLeft=y.rect.width-(g.highlightRight+n)+Et,g.inputContainerLeft=-1*(x.getBoundingClientRect().width-n-g.highlightRight)):(g.highlightLeft=-1*(h.rect.width-k.highlightLeft+Et),g.highlightRight=y.rect.width-(g.highlightLeft+n)+Et,g.inputContainerLeft=-1*g.highlightLeft))}return i}function N3(e,t){const a=is[e],o=is[t];if(a===void 0||o===void 0)return 0;const i=ft[e],n=ft[t],l=Vp[t],c=ft[Ut[a]?.lastWordIndex??-1],d=ft[Ut[o]?.firstWordIndex??-1];if(i===void 0||n===void 0||l===void 0||c===void 0||d===void 0)return 0;if(a===o){const y=Js([i,n]),k=n.getBoundingClientRect(),x=l.getBoundingClientRect();let C=y.width+Et;return C-=k.width-x.width,C}const u=Js([i,c]),m=Js([d,n]);let p=u.width+m.width;for(let y=a+1;y<o;y++)p+=Ut[y].rect.width;p+=2*Et*(o-a);const g=n.getBoundingClientRect(),h=l.getBoundingClientRect();return p-=g.width-h.width,p}function U3(){m0=new Date}let b0="loading";function pe(){return b0}function dh(e){b0=e}let Bs=null;class vd{constructor(t){this.words=t,this.length=this.words.length,this.shuffledIndexes=[],this.orderedIndex=0}resetIndexes(){this.orderedIndex=0,this.shuffledIndexes=[]}randomWord(t){return t==="zipf"?this.words[v2(this.words.length)]:Ia(this.words)}shuffledWord(){return this.shuffledIndexes.length===0&&this.generateShuffledIndexes(),this.words[this.shuffledIndexes.pop()]}generateShuffledIndexes(){this.shuffledIndexes=[];for(let t=0;t<this.length;t++)this.shuffledIndexes.push(t);Un(this.shuffledIndexes)}nextWord(){return this.orderedIndex>=this.length&&(this.orderedIndex=0),this.words[this.orderedIndex++]}}async function V3(e){return(Bs===null||e!==Bs.words)&&(Bs=new vd(e)),Bs.resetIndexes(),Bs}function K3(){return Math.floor(Math.random()*256).toString(2).padStart(8,"0")}function j3(){const e=St(1,4);return Array.from({length:e},()=>Math.floor(Math.random()*256).toString(16).padStart(2,"0")).join("")}function G3(e){const t={a:".-",b:"-...",c:"-.-.",d:"-..",e:".",f:"..-.",g:"--.",h:"....",i:"..",j:".---",k:"-.-",l:".-..",m:"--",n:"-.",o:"---",p:".--.",q:"--.-",r:".-.",s:"...",t:"-",u:"..-",v:"...-",w:".--",x:"-..-",y:"-.--",z:"--..",0:"-----",1:".----",2:"..---",3:"...--",4:"....-",5:".....",6:"-....",7:"--...",8:"---..",9:"----.",".":".-.-.-",",":"--..--","?":"..--..","'":".----.","/":"-..-.","(":"-.--.",")":"-.--.-","&":".-...",":":"---...",";":"-.-.-.","=":"-...-","+":".-.-.","-":"-....-",_:"..--.-",'"':".-..-.",$:"...-..-","!":"-.-.--","@":".--.-."};let a="";const o=P5(e);for(let i=0;i<o.length;i++){const n=t[o.toLowerCase()[i]];a+=n!==void 0?n+"/":""}return a}function Q3(){const e=St(1,7);let t="";for(let a=0;a<e;a++)t+=String.fromCharCode(97+St(0,25));return t}function Y3(){const e=St(1,10);let t="";for(let a=0;a<e;a++){const o=33+St(0,93);t+=String.fromCharCode(o)}return t}const X3=["`","~","!","@","#","$","%","^","&","*","(",")","-","_","=","+","{","}","[","]","'",'"',"/","\\","|","?",";",":",">","<",",","."];function J3(){const e=St(1,7);let t="";for(let a=0;a<e;a++)t+=Ia(X3);return t}function y0(e){const t=St(1,e);let a="";for(let o=0;o<t;o++){let i;o===0?i=St(1,9):i=St(0,9),a+=i.toString()}return a}let jl={};function Xe(e,t){jl[e]??={value:t,setFunction:(a,o)=>v(e,a,{nosave:o??!1})}}function v0(){Object.keys(jl).forEach(e=>{const t=jl[e];t.setFunction(t.value,!0)}),jl={}}const w0=[];function Z3(e){w0.push(e)}async function ex(e){w0.forEach(t=>{try{t(e)}catch(a){console.error("TTS event subscriber threw an error"),console.error(a)}})}let Rs=!1,xl=0,ou=0,uh=0,fh=3,pn=0,mn=0;function tx(e){ou--;let t=Math.round(Math.random()),a=Math.round(Math.random()*5-.5);return e?(Rs=!!Math.round(Math.random()),Rs?a=3:a=0):(Rs?(uh===t?pn++:pn=0,(pn>1||mn>0&&pn>0)&&(t=1-t,pn=0),uh=t,a=t*(xl+1)):(fh===t?mn++:mn=0,(mn>1||mn>0&&pn>0)&&(t=1-t,mn=0),fh=t,a=3-t*(xl+1)),Rs=!Rs,ou<0&&t===0&&(xl=1-xl,ou=Math.floor(Math.random()*3)+3)),a}function ax(e){const t=["←","↓","↑","→"];let a="";for(let o=0;o<4;o++)a+=t[tx(o===0&&e)];return a}const Zr=document.querySelector("#typingTest #layoutfluidTimer");function C0(){O(Zr,{opacity:1,duration:Y(125)})}function Gl(){O(Zr,{opacity:0,duration:Y(125)})}function ox(){Zr.style.opacity="0"}function iu(e,t){Zr.textContent=`${Pt(t)} in: ${e}s`}function ix(e,t){const a=Pt(t.replace(/_/g," "));let o=`${a} in: ${e} words`;e===1&&(o=`${a} starting next word`),Zr.textContent=o}const jp=[];function nx(e){jp.push(e)}async function sx(e,t){jp.forEach(a=>{try{a("flash",e,t)}catch(o){console.error("Keymap flash event subscriber threw an error"),console.error(o)}})}async function vr(e){jp.forEach(t=>{try{t("highlight",e)}catch(a){console.error("Keymap highlight event subscriber threw an error"),console.error(a)}})}let Do=null,Ql=null;const Gp=document.querySelector("#typingTest #memoryTimer");function rx(){O(Gp,{opacity:1,duration:Y(125)})}function k0(){O(Gp,{opacity:0,duration:Y(125)})}function ns(){Ql!==null&&(clearInterval(Ql),Ql=null),Do=null,k0()}function lx(e){ns(),Do=e,ph(Do),rx(),Ql=setInterval(()=>{Do!==null&&(Do-=1,Do===0?k0():ph(Do),Do<=0&&(ns(),s("#wordsWrapper").addClass("hidden")))},1e3)}function ph(e){Gp.textContent=`Timer left to memorise all words: ${e}s`}const cx={afrikaans:"654f8a7ffe6e9e63b08c568c7cf005968981bb91e05e128c1eff8180f740b2a7",afrikaans_10k:"c1e3361c8ea41d021b9505850a191af51d870631c9a3a03cb35056f0b754c43c",afrikaans_1k:"c7f3d0a9f997d44303af6d0393c69efac5e522298394feeda98f41e2c8c9c1c8",albanian:"b5de15563f7ec674f2d531412dba85d83b60220853d90e765c274cf60abe5856",albanian_1k:"83968465aa0ec5052bb96302adef4f70077aa815219afba41b5595b0b6c37c09",amharic:"bc41917d7306f456bd86dc489aae403bb7507f5681960f3b9fd30152a0614d91",amharic_1k:"e759c7c9e64332f430d27c685f77ff4e2c2051165939cf05a877d13c7da55bd4",amharic_5k:"a22f8cabebccd5352d492dab8328bf8a812895f6012f2aa31dfcc5cb116208af",arabic:"4cb6c81a965ea73cb1e91dbfd6c3938146cd8a3c2f7cc79a2ce67fe8065b86e9",arabic_10k:"0ca61d20de7a045a16b14b72adb65bb7d8338a867bf22bec5f4b66589dce678c",arabic_egypt:"3d6a3e4968304d6eb82e029f6c53875cb708f5b0277a237810f353036ef07898",arabic_egypt_1k:"119fc91f555392e4324ea65ba160a14c84f5469c7897ff679c57d8e120a3e8b1",arabic_morocco:"55922ffaf5ac80e54c65f463890c6d6ea1b3465dafaa789e0467a0952929d742",armenian:"7a4371ac5f6b7b6ae455ab011bfac51c8e9065174a896b637949aa3153388a5b",armenian_1k:"b08b7ec92dcc2d9b33d004831034ca9a04df10673b863228a60cd53549181d90",armenian_western:"e4ea65d2311a40ec60857820aca4dbb37a3760c258eb5c13209cb39a7f42f980",armenian_western_1k:"ad979ba585678d20cd707108bcc6a7254e16ebbca95eff6b24c659d51a3542b9",azerbaijani:"95f24bf8668df3b1a76dc175fbc29ffb326d7d8e8205ba73f4b71eb7c98a4b48",azerbaijani_1k:"6b4c07b507c8e3c1ee07f699a6effb07c9e34490ecff4cb43b0a3bcdfc290394",bangla:"15809945d0d74ecceca68e3921d764217ec5376cd7ac2bba0aa6040d8fd9838d",bangla_10k:"9bf45b2fee1461683771a0a686e0185c21e332902cd51ed8cbc41d12d9d5e34e",bangla_letters:"fdaf4185fa1c8663208e6334f684cc8e84934c02573dc4ab990281b504cc8042",bashkir:"dbe83f3f7e97a9fdcf59777f422b3f830a09b93fb638a3a904089dcabb37b913",belarusian:"0b63a4ca1af298b64bdd84990df2aced80ed195fa18399307c76e917d35f7821",belarusian_100k:"8a3887cb8644e42dda0803609e9f1a4b8b383781a06fb8cbeb43f79d6ed9ff65",belarusian_10k:"fcd4adfc487d1405f258ebae17a753aed1fc34da48a1e0ef2501a20c63d7b75d",belarusian_1k:"50742a4854b3fdc198ab0e1da2fdf662d8e3145b5e17a6aedefd25cd522ad426",belarusian_25k:"1ffcd03111f935397f187efdeec0651dbec2bdb452fdc8b0ae5a1bea27c8cb1f",belarusian_50k:"2694fd62f3aa527678b7024f862d4dfed3d655f8161d785d156d3a4df8f71f6b",belarusian_5k:"824b544532e4d40cef933bf3dae36ae5c03541398ba388349bc446205a6cc803",belarusian_lacinka:"3dcf64d002a38001c71d55bc2504c75f4f14f9c86a3c5802a56e0a41f06504e3",belarusian_lacinka_1k:"76f54286481701d3d54747d66eb465d04d005617e7dabcf2481cc368cabd2950",bosnian:"c1dafd4f50c3d8381ba35bca1c82a3a34234120fa23b890c882110f118b59723",bosnian_4k:"7eafc78c84967c8b14b9e7c26d8cd5e43bd8e36c6c1a2b5b41593815c5770382",bulgarian:"63f9a9bcc260046870e8da90bebd9f04e671219e3e8413273fdabc934cf70bbf",bulgarian_1k:"b7dfd5ee79ec8edf057197ca993203986a1909832dde4fb3908d4905b5e6593e",bulgarian_latin:"374a5b36f1ea7e2dc3e118c95bf36fceeab61dbe11a238f51996b94c5acab01a",bulgarian_latin_1k:"7804334861b9c21cf100322b2283700a95c0d8978bd1a1e9bccf95c549068ea7",catalan:"28bd314b770dfa4c3d84a4ad9d4e509616fcac28824cacbfade94d7b9235cfbd",catalan_1k:"f1b96d32471b7fcf93c2d47e7ba71797daf6d7ad037714d72e89088a8441cc10",chinese_simplified:"be597eff68df1330d5e86b16761adacdfff47b8a1b28636e184ed8f1a55835c3",chinese_simplified_10k:"65c7994307985af7a16867e2edf614a984eccbd6bed109fb864656410cb9436a",chinese_simplified_1k:"3b68f48b4ae562300990d85a979907c5db748380e8a2eb13b509bcbefc265c44",chinese_simplified_50k:"209cae39cf2d1fc961442e71c7b1ccd990e8e52da848a607520ad155e1d81bc4",chinese_simplified_5k:"f67a633c820488e85a7e2c8de2b580258da67f0a177b9d311019514203f9a569",chinese_traditional:"16f66cd0a8ff33443fe28fb83f2e29635baae198c2345cdfdd34b59c21e3b74c",code_abap:"62e10348c6d76f84ecf67ae87a60794af59f9aa8ef000b751325988225750186",code_abap_1k:"1cf25cdbf953501fc2e0c612d851fb625d57cda5ebe9068cace694f9803322ac",code_arduino:"818a6d0cdb63d3f059343f5f31c979ead5a55ada8570df4822c62fdab9e99179",code_assembly:"b809d8b99cad85bd43d0c340daf35ac2d58e9114609e969f30981db9af568c49",code_bash:"5d995c9e173d2211f8244a763cf474d9d32274f8e02dfa2c90f597343379204e",code_brainfck:"bd48a900aa32c89075d1edc622c13dbac7331bf70d1cd626f5db8ed4c294608e","code_c++":"8a62cde1ae6572382f9b34fbd031578924eab6fe9197b92975d1ce37937c4016",code_c:"8b8d42d5183a0a113065fc4f03ecf69f317eea5592116f9011bc6260908c7d2d",code_clojure:"3304aa4ca0b1a7021f81c38859dd511871e09044f986fa93fb2c8146e230fa05",code_cobol:"40c79f667c0e2cefcad03225380cceae7476bdc239882115da7db8c1f1b4bb69",code_common_lisp:"7b5e004c5c66b0f5e5dbe103d62164020c52e4646204b2ef18c33de6f0bb95b9",code_csharp:"299c21929376d776644ce45b4efadb8e461a1d554f842c8807c7355e988b4454",code_css:"9236ee768a90d450a8c0e5c3aee45dd06fea4a86f85f69cc313d9d0a3eb463b9",code_cuda:"38d44b996213b50b4de4c79fe9707436f8e58448d1707ede30de00eebcdf40b5",code_dart:"373fe67b30deca1096f307c33baf9367c67ef3a05e8182e7012416bc8bb078d6",code_elixir:"e663677cab488bcb5d85b56695cae6145fa8f1ce5a7ee38244221d3ec01cdf3f",code_erlang:"9b625ebf83d202c03624226a93c08744170769e95d9ec17ab030755ce0441441",code_fortran:"ae3ae038a8b78ec9aa7c043041a9ff41f12c2e6c0fcdb596080bd57b63895d0a",code_fsharp:"36e4f8d025860e3d137ddddde954fa5d69b47439a36f4256d4090001ede577b6",code_gdscript:"3d3ae4a51bca6f6efa9758d96e7af20a1b0e7b3c92076d9cbf77f2189953807f",code_gdscript_2:"7f9d025966bae20675cb012fdb2e2aa63bf35fc6e79d2ec5b877040808bad973",code_gleam:"4e05219fa6e4de0a20bb47ee5db39974ed95baceb2b08bf911594eff93dac12e",code_go:"a597626a3bafc95f004bbf7623096eb983b1294670392a20685a2e647a53ad87",code_haskell:"a4e1d753cc9a6bf705c450e61b5daaeaa14e8d3fc9e4145bab45e5404d14ea4f",code_html:"5af5e15e121adb2e90fd13a42a9e2596bf030bb7159471af626cb426736f0bc6",code_java:"92bc6d6bb22ef2867fa9548a8dc87b0aef27bfcaf9ee6e7e080cf0a71ebbec9b",code_javascript:"3270d6e75633480c0f073f27013e66c01edf55abd1f18727c5dd83a231e1c470",code_javascript_1k:"ad484c1db646b70063d2dba29ae7c0618ba643479f02aef8d4ac2425a78b33b0",code_javascript_react:"79f07fa0d6db6586a7e099a00bd14634420242e4b3a165aca8f86ed5d23fd06f",code_jule:"c995fbe6159f72b73ca01585e4c25d5df55a4ba88dc5e96419d1c6b4e93b6121",code_julia:"27d867aa972185984c1823a5effec781559a7830771d7a9f183d97f2b3fcbe1e",code_kotlin:"2a9226a1c3ed297f772ee5f9c7c72b28b29cc5745f4102d6c2be192618bed953",code_latex:"7cc3447ac9f7d9d8c7b918987ab526a90695581bc0f474e3e9cdf614ee1c5013",code_lua:"e11931badfb2ee1c05cd7d55091ed7209597d8d6d9eac1c4c81690e894d01c1d",code_luau:"807f3f29402e8348ab5c089b271712114b51a292e0ad44cbf0d4aa97046258ea",code_matlab:"78a7c0f1f428b6fa6b0dbbaa661bacdd1c3e0107a9a935afa6f03c01e01706d1",code_nim:"b9d2481a91cdac5327ad5c26cbc50f92c6c46177498fd25f495598ce8f96c479",code_nix:"eaccf934d3ed4dce81d325640ad87da422b2c70828b8082bc597f75e7c7f11ce",code_ocaml:"2c0a5af0e007402c8f807e7b0894e65e9ef04774b5f592bd9c2f1276794168d5",code_odin:"e5cdd8c757e0c7389e7979213eacc166f8fa05400fab639b412433eb7472eae7",code_ook:"f255d31297a126aa4b2d21adf3d516448cf71c7e5f56f0539a5e3cb5d235f00e",code_opencl:"410d313f79db1c7b3a24a5c0b0f030e5b1e07c861025e668ed772d765feb2660",code_pascal:"15386a026d290be50678c422c56828c692aa056b4f31fa51190efa44a4865930",code_perl:"cd532175a2bcfd0f0e4a815fc3b88981b42671141a00886b6a625b947dc845fe",code_php:"acf81331fe0e9f269a1d120c392f633a482bd96120b0b41ad82e2778e97309b2",code_powershell:"319628995a9e02d616b2bbaf6cdedb4dc42c468308dbd812fc7d8b383bf29d9d",code_python:"8e99768d1dd7ed0c904b70f36c0647b41bcd7a1a4c98acaba4cb1a2d68f48255",code_python_1k:"382d0d152126eab82aa115ebc866fcc487800d45e62e5b3e603733d31e4df0c1",code_python_2k:"3e28fa8bceffe0eba9319a33a4d11a5ea2473f4997ff290f0607035c2ba4fa56",code_python_5k:"abd33c6158bd8d46b9913a10469742180353580517462823a30729a282682c78",code_r:"6952bfc9ff965470937164b503c489c5491721a059df2033bf6c266be44803c4",code_r_2k:"c996cb36c7f74d70873cbeba703c50482d3fd861762ac3de823bde72f657c56f",code_rockstar:"31c2921ebd37a7d3d1ef2c46f7ed8053fb073210339ef5cd7a54851e34a5a8a8",code_ruby:"fde2951498e30a353f72743eaf27064e00a757e99ef2014bf109dc46a8b2513a",code_rust:"0b4bf199e69b21c40e0a8a00569ced79a27b19f41fc66a08345fd680cd1b182d",code_scala:"b66c9a0f45130c5234866b4176bd817f9cdb7a63f92e2dbe41ef5bfc68f1b0bb",code_sql:"e1351b4ed8be3bd67913684f71e9b6570a1cca98b207162f5a573443cb1c1ce4",code_swift:"95bcdcd2f3e565a767eab720636af945003d0132e5164c312f7b0ff1caa8b38f",code_systemverilog:"840ace018c4d36942f35c8cb734328d08d2ab113d4530b3682ef9f3157bc1367",code_typescript:"8e5c0be961c5517d53657da355ffdc1973d7c868e77dc27c7d49f7a4fab9a4f5",code_typst:"7c1fa9ac95d5c3f8b842ef997c1a014886c368dfa452c3d45d9f8945dee2ae91",code_v:"b85324670125aa9faf7680db0d6160b10b696dc3cf3b60075c17a28c0bb5d702",code_vim:"29d0478f3063068017579a4a00d4dcb622616511475ae5dc4809b46601043fd3",code_vimscript:"900d791be3f89bd80e0c50bea52bcca1a112fed4ac4df514e662662c121acc3c",code_visual_basic:"55133943d956dd775dd8dab21151b1e4c518ff04be6fb2284242bc80de70b303",code_yoptascript:"f53082b3a0fc9dc25404428ca314336720ab78ba2d9d59eb8baf134477b1da90",code_zig:"1f87ed8920eb2b4ecb733743a37a93e67bce8f093f8d3693de64c218927f1f5c",croatian:"c8e909f0e0af57c1c0a2dd6898e7f54c226d0a12c025453a5e130bacabb8ba80",croatian_1k:"a0f89f20806eff9fefc5d5bba7e9c5b25a65c97d86cb87ab6e363ff71fef9145",czech:"6fd0fc8496b0c990f5fe8a3d7172cb618c6b3b0accaa26e0da15e4f5dc25ba29",czech_10k:"967458b65eac13f1fce48ef3321855278b27a1ec95a3f2d80c5815253e2cd8d8",czech_1k:"0340ef2d13fbdf063023cbf5c5477e875e6ba7a4b5a1ffbdee5542b16f73223b",danish:"b7788e52a047250e514acd7eedd14eca8002b788f013c66fd620e06db2559e7b",danish_10k:"67ec967d43b67a8a70308b4fb1ed2f7620b4ac2e1e8fb637cf005767128ce94c",danish_1k:"45077f00fde0988fccf77e0e767c04a57f02b054d4bd069b505ada3ccf6fa66e",docker_file:"443a1bce00fefe90f69ece5742b140ab1024b69f2675671f8ba44cb277e27bcd",dutch:"b45d538903a4bc37a3590dfad23958ee268e9e96c737e8b42ad70cd7514d5ae6",dutch_10k:"59daa737277a50d63fa9043b7907d4e9587ea2ba12f1276e67b897cab083a95f",dutch_1k:"d12d4acd447560c4701ea5a44df573c5cebaf387b65f1210bd3fd69199f374d1",english:"253965d2581f6cbd8f015272f00f01398bcaa069b00e367a7e6a99f0f66bebf0",english_10k:"4f30781215806d558ea46f61bccecd1793fa1f8bf2f9654ba473dec97f9bbe27",english_1k:"95ddc0c1af383432f228807d6fddbea650c3ec2900c86810acc2659ffbd200ba",english_25k:"5847a211db59307637e4eb793b4a5dc132b102c815d886ae47f6c36b1efb5b9f",english_450k:"8da19763c33ac90330ebd8f2bea6d3e1cc899671f15cc869544a5b1a1d7b8f7c",english_5k:"9b3995bda8615de2515d05a5cb776de382745aae13bbe69aeceea313bad3b916",english_commonly_misspelled:"db9371da74c8097a38345914e1f6a658b7bf63a483b0e7255b8a2c0538b9ba0e",english_contractions:"02ed6cda798cf67180a2c18984cdff212975081614b5da9b6114306b1402c33a",english_doubleletter:"3052132c98599b760ff475a67146320d06e91215c40759b461377c78ced8ee49",english_medical:"16f3533b5803eaef0017793838a04e35f5fe20bd523578fb058b05c21fe87083",english_old:"a0c198a52fde8bb1c39d73ceadaf7aeac5cb0137812bf6263ede5e47077a1cd0",english_shakespearean:"376fd648d2c67e967373b79827c8a57db3a4587e0dd0b484e888d822c8a29508",esperanto:"18898143432b80d22f331b57198f4eb8510949dbc6792d3d66c63077eb0aef7b",esperanto_10k:"e57574c6e2498c9dc602a8d0e3b0fa35ccad20ca64cf35bec8c802be7644e158",esperanto_1k:"5555af14d955ae093d8fd00b3462f5e3a068b9c4b5f2f35fb76af60f2f204008",esperanto_25k:"63b8507e7833205ec5ee21fdfc7c2606fb494155bba456d99b0e998062824658",esperanto_36k:"32bf64ec4c523bc6b07341c93dd8351119ebd58f36e53ae1cde7cce27e5e9935",esperanto_h_sistemo:"a51495e34e5d6e7fd6e980a7c15fed1fb5ed7293312393bac0a97d2fae4533ed",esperanto_h_sistemo_10k:"a9b4ad45ef7222548a07d6f82d9fee2261e5b8f8ba986c64750a8fba25bc2c2b",esperanto_h_sistemo_1k:"a42f549733c204af9ff76811c79cc99abc5a2c53f75c7b40b0d120d1fb4da506",esperanto_h_sistemo_25k:"1176a980150816c8c895a0283e9215cd4592ae96b7f2b0623a0018f55fd0a5b6",esperanto_h_sistemo_36k:"373888cbe1640cc3f4ceffaa0b08e6630b001434ed642f4393757216f443f05e",esperanto_x_sistemo:"9a844890c855a4a6d05073599e5981e6bc63dd4782fe9c8d08ffb40b8e3ab051",esperanto_x_sistemo_10k:"396fa00f80f7cccf326cdaf37fba0598a0d482c141683f955fa41121d6e9f65a",esperanto_x_sistemo_1k:"33ead85cdbe8237da83cbc497f9c162b3b90ee762372218f32df6f21dce0cba7",esperanto_x_sistemo_25k:"07f67e10468a4e2c720ef5c355a0a197ec8eb87963da320da6b0fea95845346d",esperanto_x_sistemo_36k:"fad8cacf82eed3a5f90ddc08bdeca5493e2e8bd36ce9e212662039be22cdf894",estonian:"6e0575cb7222eabd972b720a56af4cb260bbb5608609c574a9918dc780e97419",estonian_10k:"50b95590c235b2081cd5ada4c25bd3a3dd714de4cfa839835b10950dc9f3f634",estonian_1k:"77ff7ad7164a0a6fcb1f046a9d55277154966aec16c0ed33ea42820e1f229a56",estonian_5k:"94c98cc7dc638a1fc6d2918326f7608e6cbc6c4044452767a6e2c140908ea0f9",euskera:"c800126fb5d0cfad8de37e8d8b46252ec47ac16604107e181a9f4d5822838c6b",filipino:"fe7cf2e92e29bce0f2ad97202a350c21b4f26a363ecc41ffb2744c6f138311cb",filipino_1k:"bcbc3fed67db5a8c443e2e2642e3020b57bd679ba56840fee769025a9d4668ea",finnish:"97d060729de2fa3eb3ab6f7da6a58153029641a26384a5f9f23385f801fb5a11",finnish_10k:"79217cd7b4ae9c428d26a762d255f53538eee085818aede3fbc171966c05d339",finnish_1k:"c0a3e82e88c8d3c22a1db9924156bdaf4adc328afefe1d729f26967f438221fc",french:"5b53ce8727edbda94cf4955182d91bdc2d2d6f868f0c7186095ca02fe2d3d945",french_10k:"4aa409ed2006f8773e52672c01c3b91ffe7e85c30ace184635120f48fba17ba9",french_1k:"8268e739cf32c43e851e8a30c331070f02dc1739f457bf92e9f1e64f37f3fccf",french_2k:"36a59623461ece740e05fd55beb02373a0c11f67078fa58428f4e7c217f8c6c1",french_600k:"7cbc0f76c9ab63d4aafadfb072be27ade490325473cf32b770531aec08bd8202",french_bitoduc:"7bf2fb5e0f5d4534ac642041f32c361679fce99c4fed4737f22b8b73a4df514e",frisian:"b24430f7b16f2bbf1afae93c0d9b43405135c01b45b05818cd03cdf5c9e48782",frisian_1k:"1c58dd2b506a7affa8f4ac5a537824f31fd1ff0225fe64034986bf32f552c510",friulian:"3f1110210cc868db0045b1dd7d1c5f200d016b7dc13b5bb9f7e4847a4b513b64",galician:"34301e12606ea2e9d65684f810c13e3874e9b9306ae39daf29239d1b936442a0",georgian:"be5d8d4c69a7538141b6b5c96f467e55acea3ba354210f73853ec701e106041b",german:"c2caf567ee18f09aae0ecee6092a6efe439cea1b7d18a2300e99047bcd1f9961",german_10k:"3b9ee1fcbf5082c3e55a542e5150f9fdf0bebefda0e409c3c15a03f6d11e3569",german_1k:"82bcc90cfe49b785d426ab5b0a760165c25da53e25c2979a1fb69c7b8cd04b59",german_250k:"a638ee31ea4dd7cd64b7db1a86d592243edc912fec26c8609b3f133ad0f37a18",git:"dbd7eeb44833bb642da20d772dc672a3e7c0ed09a17437db322b7eb91c8edcac",greek:"fb1bc21c3ee3923e1942bb95394327b70779fd9477e2a05697ad5a000528030e",greek_10k:"6d305831131f85d09ee7e44059fd6abbdf641619974a18257533ed606abfa627",greek_1k:"de81c001f7db19016866f90431c2ac375c08651fd5240c3ce6d287dc0236d6c6",greek_25k:"7d39919392aec67f2d4c025919a627ffb0e471e63583596e6a6622779a1b7ded",greek_5k:"e4439a1c018792273041e04d788dad6f3e02d4ca0aa8449ad046e2d05d146100",greeklish:"af60eb28e8e13d6b967e92f00d1a6c088cb19c98ce6d4b3bf25482129d66cc0a",greeklish_10k:"81e050d3a22b76836645ab283105546a9af4eba46169397c8c0eb9f00fb3d9eb",greeklish_1k:"7457452b0db40c432e42298d7fad05341249c3d01a66c90f137e77b91031ee81",greeklish_25k:"c55313d8a3f3b7fa33d6a5aba7a77156c6460b46c51cf225c841a2b0a21edd74",greeklish_5k:"1de8c5ba6cfda13519463ac66c58a6b1f4b40b0ff63ffefe402392ba173701d5",gujarati:"29541768926ce62dafb447c2ad7baf6e4e9a59ebb8a2ab76313fb644cb91ece2",gujarati_1k:"48e9a951ca3b380300b902b89ba69d4bfdcb9b47d914c5d0893247761a066bd7",hausa:"12599ee0d7e82d9c189e109e17e325e91c6d843c1f9e45880e3c3ba2bd873655",hausa_1k:"27b79d6e1e47c9a870dbab566f3c74f7a31a811c9f15914b909c7b29ccae70f9",hawaiian:"4eb2e79f6b86ab674d2876e295d87fbd9bd2e53a10c5a2eb35d13e0e45259dea",hawaiian_1k:"19cf51d578cdf847eb87a8a0b2cdec90ed7b0212eb0fd7a05a1bcdf81dc6c8b7",hebrew:"dcba0d86539a926d4fbe19971a2b68a4d9cb303ca6be82778a2c1a853fbddb49",hebrew_10k:"ff831c8c225c82cd81572df1ca0dfe3cf7ac15e7d413518da623401ad5281069",hebrew_1k:"708c4f8c097feb48a16ff0254e787f1152eb45231a1ce06a3063fb9ba81da02e",hebrew_5k:"bc673c4684a2d678476e48325a8ab9e530e0ba45aa5549a6511106ca06b18a96",hindi:"d02d6a1585d060dd39a9c19e09d413c91317986d66802da4fdbea3c3e108f732",hindi_1k:"d577765c0f6d98d0f663a03f05ce038fa6e2432080f7db9d93ba23b0790a72a4",hinglish:"100d213f4bdcf5c429dc648e259947579e3d4bf37655d2982127d19258283823",hungarian:"c3cfe0e30f073f1a8d868c5c8d52f8b02d4d3ad1dbcbbfe231f104468c705231",hungarian_1k:"abd118f6168c93f90304f201abd523c7d29a62485ebf34a90a18215adc515e39",hungarian_2k:"64b2cea7e3ee62dce39a1a50576d09b0eacaa4cd001272e609a2605d8dd61e9b",icelandic:"c353b486606eb13dfdbe4c26c69cb2ae732d0c5303a52f0ff7e55ee51ea3129d",icelandic_1k:"6e7efe95983183268a0b2efdc961be30bdbf5e0d70874f609e38c4cbe1518e32",indonesian:"cc0b723eb64435c4c3be589426d1ec1e76d651e180542c0f03e7da1f3d28e13b",indonesian_10k:"54cc7722c753bf2a10aa29b9c125967ded99c92a39918af549bc4e937ac937c4",indonesian_1k:"b9b4098836e5ff448788c5cd863cb2849cae40505f45b947c67305531b442250",irish:"2e7a5f303d3d6d815a4aceb8e94a183430076e138c8c422870109e875e0eed73",italian:"5a6c3b3afb002d28c6e4535e5758208d8b3117e64b9da99f48d9b76a84ff92c4",italian_1k:"a275c6fb5faef76db524426ddba89172a9d7112be41c7d69db66e532ca3e239a",italian_280k:"db4981e72d2e0e2864039a4cd2fc2c5a8008db3e301bbf2feed24c33586d463b",italian_60k:"37655520e59c9579e3045675c47f424cd007afc9726df6d494655dd1be510109",italian_7k:"4a32cf8e0fc8ad9352bdf25254eabba4ac21aea6d0cc94a9aad48d33e27ad4eb",japanese_hiragana:"a319c93e893af78bc127b12c05c2c2fe220990ba3be6dc37593b379e3bc4fbad",japanese_katakana:"2ee1eba3e2177db9d9c4107b9c6638aca86af7f07f0b2fd835350a8300f707ef",japanese_romaji:"b3d7533ba4948fa39ccddd96bc64e17fc5e60ef84f7d88417bf91109d717eaa8",japanese_romaji_1k:"96092be026fca0735f8d06a5387fffdc249b6ea5a07ade2cc72de6d408ce2020",jyutping:"6f5de5de4b14aa9193898c777e5c53dee94603307128205664f7b39ea21cd8d7",kabyle:"947580bb10f0aa66aee44e3f01d946dc9b23fb4bff132d916b2952e5fa0660bc",kabyle_10k:"9901d2d720c735f515da18bc534adc16622e31847f97e45c355445234a0b1424",kabyle_1k:"530eafe3ab575badcee939c9b34631fbfd3554d2b397a802b7c89897a8ad5273",kabyle_2k:"dd58c67529a45d92b8044a4e90d3556eb304932e17938905212a744d0226416a",kabyle_5k:"bfd15adb2df178af1be05feca954e188c9ece5bb500037ac81b70dd738469660",kannada:"d0ffed0863f660a7957ca6aa35afdc2148b87daaebde65cb7fdb0dba572d24ad",kazakh:"7eadbcd2133a69c4de8e614917ac044160dbbe18c402a4719a9131e89a675f45",kazakh_1k:"17ab99ad8a7c2e315d8783927c4cf55ac4c3e7d7dfa5d80640333bdef2cd6554",khmer:"757b239b8fab806eb22b39da2ac611f6c7f640e3d2eb6ffb7f6d8f8b3e0d4891",klingon:"efb9b0635ec83a0668e00d382a0c3f571ff2c15719a3e8cc176df8901fa73fac",klingon_1k:"4f27bbfe67b92d2b58e473fd7c89e7ec32d6a8f9e622f59a153aca33a1c239a4",korean:"123210dd240c2b508d90e0c923ed915e2fa87772c2c381e79da1a042202dac0a",korean_1k:"b1feb16d21734e4a8b4efd2ce104499f4945029247254db176bb6bc7e68f3074",korean_5k:"8764b4661021f6c2d41d4f1514df72caf18e3e486de1879c0034be3a763cd240",kurdish_central:"a77988c700c5568bcc6caa53d22da6ff6745aa8adebd82ef8d0418f829192593",kurdish_central_2k:"316d537f8cced13c97bad76a0e9c7e2c45e94410e46335fa50c6a0d0386f9e53",kurdish_central_4k:"fcb2b9b450223af340f5a479eec727a6d332f755c06969fc1acfae719b08a97c",kyrgyz:"a7fd20ab0973cf1d3e44f466a3dba009cc3b759d746aa9ae0ea391f4cdab0009",kyrgyz_1k:"2e9eb8559df934bb8b1e96cfcc2d0c5b8fd2fe3c79877cd43557e4ced0f4e70d",latin:"1ec6b10f6e3e412253abe64b55d686fca1db7fc3cb9445b9ab9e28c9ee80d2d1",latvian:"15090d064e6ef5080e6280c2cea036f391aaef152652b945458480730a87284e",latvian_1k:"d6702463da4ffc0bf865921000d3af547ce201f299f19f64213fb5b8ca3df1da",league_of_legends:"badd838e6d593653068fc1db197df0fc3ed0052a37895e0508de7f10b798c275",lithuanian:"f02455846da11fa4e7386a534f133e1e7f2c306b165ebcdf796fb038676ec6b0",lithuanian_1k:"d95c2e4be4c711472effbf4e95edd57b2be9525502b0152a16e073a37ba011f8",lithuanian_3k:"cc0994bad9182a6a9eea922a208314ef154093384082024a67e69250d378e743",lojban_cmavo:"e9eca6a86147f3c319c26960fbe8fc2eeed17c0861e6fae67a8727a2e27948dd",lojban_gismu:"2f78c532ef5d08959744a2b8797789a519d829c7adb261f062b4d08c7a685968",lorem_ipsum:"2d0f8654550ee8b47290cd09983bc5560ab1524f6ef3f397fdadffd16d10c7e2",macedonian:"079eff9ae13ad2b87202c65f08a8e715143a4f5c8a9196f56a526b34d8850462",macedonian_10k:"bbe2aed361bf09781ed23dccb39f4f8465a5850eb0cefe225ae6a7abef81c73d",macedonian_1k:"0d875624ffe073889bfe62fcf3696b7e80e9f599f6556d8f2dde2250920bd485",macedonian_75k:"f603af89735baaaf73dbbaa4a16d915e9d89c0e50d8b03d98bb346475b997ade",malagasy:"3c604d1ff6759e4c1d7d9941388e11401ddd034c60342435fd851f5a135976c3",malagasy_1k:"0bf3ef364fb37976f197280ecfc7d8f70e94ee93249e670cff85dee75cab4bf5",malay:"fd321d10f2472a8ee3b448673021fb2c404244fe7dca3414b8563eac6bd476a9",malay_1k:"51e4f1785a6c09d518e7581987aa6f63e1c0ab438d8bf5294b79c2495b55024c",malayalam:"12a8a828560cacb69d3724f525af3240fa0b8ed0d7de85d711e6466b4d3ac20e",maltese:"d4313f792d3ca5397eb616c3867957a373510482ab17c9c3254ea0817ec19e37",maltese_1k:"126886b0d28d0a4bbdf84f46c003e91754c130b31df05c9aa48b4a6659241b75",maori_1k:"b8b6b7d28744625d1f1a93e2a526f25b5ff1fe0dff573cec5431b4f40f2e9b18",marathi:"72886f8b97ed17fcef73ab97546c5701016c0295109cd31513a211a4d6968599",mongolian:"f58382772bc7b5de7bd9568f82a709a743c0c7cd09e099b601a3f5889242c721",mongolian_10k:"b1019361468cc36fd07fb6b4936504e25a3e30aa15bf82a868d2067b56b36443",myanmar_burmese:"fc5ac6e4c70cf3aaa11643010f963c7d2a402f10f81b8111087f97c38cef6ee8",nepali:"ed63f5b30ce11f96ca25149c68ec94725b38144fa410a33b4ce54c1da90d3be4",nepali_1k:"caab902263e38d0fc073945511b501180a62996c2fcb130b942db4c53a9d2be2",nepali_romanized:"5aab2843b093c22f5ae7eafdd43040bbd38fd3a8791574d8d281db0c06a8733d",norwegian_bokmal:"5809762d30068a2a61c2fca49709a79729ea0d5627e788f93548057ca3333fba",norwegian_bokmal_10k:"4d37f68b0d44a4fc55fbfd545b7fbdf6b614febee6dd9a2944cb599464a40dcc",norwegian_bokmal_150k:"db47ba8a239a38d57cd2ea69954fe7160f872c07f193c2c1d8d28b2d15df2786",norwegian_bokmal_1k:"bf14054e03d604d0dcb9a5a07fb3b29e4e20e06c864ec2cffff0c6e414385da4",norwegian_bokmal_5k:"cf53f353c93fdb4ad40a071cb2cb39f2b2168643d8d7684edc7507d36e81163f",norwegian_bokmal_600k:"0e43bf193dde65683076fef88afb6f887a64f7fb278a64a372af383edfa28341",norwegian_nynorsk:"a3c7fd011ebfc658dfabb81a71c10fcab257f346abb4f714abdb93541c2e8ef7",norwegian_nynorsk_100k:"f72e9ad5af12940cfc9788503e7d6ebd46379ab566e0e46ef8471e7dd939d212",norwegian_nynorsk_10k:"21533df997c261e949556aba71ed2408d1c447496d176a2bfa28249d5bc0dddb",norwegian_nynorsk_1k:"5430194b6e33d1e9fc8725fe0573a892787abc5f2952fdd2d87bec4b63dfa9f6",norwegian_nynorsk_400k:"691091b126cb955672fac29bd8e722d3f352b0e655af6fe38fb81b2222055733",norwegian_nynorsk_5k:"0394aa7d1d989c1cf6d91517cdabc4a6f60b897ab74ecb7067018c0653b2657c",occitan:"5ac6f97bcbcbc6bbb43fd874b6bb2081ca9babab0f3e319383b7076b9bb18725",occitan_10k:"0d163ea55456831ab249c762595a3b44a3f4fbd60c40df17527d479c6bf52ca3",occitan_1k:"d8e6b083bf164f9b0dd9efba9ffaa092d59508f8309ba152c2fecf4397313d82",occitan_2k:"0dd8d764ded7fc69d5c7b91e066a5cb7b20a962bd3f845afa35457ce30c939be",occitan_5k:"c52dfb474201b20a65bd3b924aaedc47a1161ef021992ee92b9b240acb6c1bf5",oromo:"d3a12d48c5271c289b44752b20cd292b8637340bd39d5d2422dd8134bea85266",oromo_1k:"82e388fe4e5c91824244921bdddba1c9be28003cd339c2bfb96fb0be0c2ef82d",oromo_5k:"5ac62b4ccc39f46f9c29878e70e209d569b72cac4651ceda460d9bf6f958e4b2",pashto:"9628308657c3b06bfa9d7356c5bcb002eaec8ccb5e67f3b302e269f769b6fab4",persian:"64aaba40ed14e61e4b1bb5891b163c18d3fd30dab99468d1a773e8ea1c65ad03",persian_1k:"448ad827f61f0b8569a0e106979494cbaa827ded3f4ec1cf3061287db3c150fd",persian_20k:"4113246b95626454c316e93564fd9d950f7a49883fa6617f216747d891c4745d",persian_5k:"cc74c68b29902ee75ed598e4696bb228d834f84bf79ecd559ceea62e298c5656",persian_romanized:"f4edacc72a55173cc70fe67a905b6d0940a03030901b19a016f54a4b4d68edde",pig_latin:"e0cbaa48295107db1a5a7c681c197431b00db195d5df8396b241c057288a5da6",pinyin:"c2b633966a6b6dbb8c7f259e6fb8ef9b38bf50ddef1631c8291930505a937d1e",pinyin_10k:"bd800567b583c5aba5377dfaacffd737f467c8eadefcf5541f8f062b4d65cbb3",pinyin_1k:"d78c5079213d89d026c960ca8e8b9f36c58737987b65b6f2eae1ff4862ff8c60",polish:"66ed5d2f2e71a058d0d872e8b072b0ca09f0d057275de277e20fafed217ecaba",polish_10k:"bea3dfab31bee37d35eaa7abaecfc9745c2a0eab0349da09e190af29850c3de5",polish_200k:"b8368fd682563941327398428b37b08da096ca03cf1d4fac8f42131b385554fd",polish_20k:"c678e3b10a1a64b30c3a57eebb385ca3641ad95574df73fc76d3e9b5e58bf53f",polish_2k:"d20d4cb9a8eddc2fe4e9f0ce8a3f8a1d9db70380d2dd636f7b981f9be829f605",polish_40k:"32c629230e23338610760a52886d85d4c1e3ed9592e5068a810f016e127be989",polish_5k:"3b2c26c7aaf8c814681df4df5eb902b3bc44bea5ed2eaeaf33d141d887d0b095",portuguese:"349962e64a8581fe38ebedd8235663421939e5c28d1d2ec0a51296add4096d60",portuguese_1k:"9a128edfb342a06ac7e49af7b37a0f6947a1aac70bf06b44fdb4c265ef3160c9",portuguese_320k:"988008783f00a81c031226b4b8924d3fb934638adf7bcddeadbcd553d9abe9a8",portuguese_3k:"eb5e9297e07c919d972d87e03327ec3de1d971626313ec3d801c677e1d5fd6a8",portuguese_550k:"5a88275db7e1e36749e677d35c7f4f3bcddcd57b2050d2d14c2a34efaab92b67",portuguese_5k:"e9eae9f93f322520a39fefb8977b00293043d94bdb3ea155ac5f000cc58dd8f0",portuguese_acentos_e_cedilha:"86296fe834926eda5a27aab2bfbffdc30818016f682885e28ee5d8be265b1f87",quenya:"e2ccaf46e0b41fd6d3e3eb30b09b9d10f4b11286dde758c777d86fb67320e7ef",romanian:"20308ebfc8f574768259bd5b8ba28f3b64d084a99b118eb3ddc1d1a27db498ed",romanian_100k:"34fd28c351f7703ecb0c518d8e370bad882ad4d7852dc9c081fd93aedb9f7f38",romanian_10k:"cccd27f68fd0f385ba7cbba2327bde417f2637fd2bb6c5fc4addfcaf4d6112d5",romanian_1k:"493b83f0fd1e04c43ae0c5ee964d6a40b40b7fc037bf56057710721822b45e98",romanian_200k:"30887183f9b167fd0e1062feff03fb6ab0f269d41ef69e48a19fe5f25e804f55",romanian_25k:"6e4a513369400e61fe8b327f256644b3a047c057e396f7af2e716482c53bcc9a",romanian_50k:"4a14faa54f71818b1e6b4bed3157fcb5dba0e6547ad8bfa84b1a20b7942be200",romanian_5k:"6b5ecfda21c22e8f2fd7dad29cd66733614177189a58a2c80801eefdfa4c61c7",russian:"dac5553f360a6d64c01ed39b39ec8652425425923e0f65cecf951e061721355c",russian_10k:"37747c6876e8b5f2c882a0ad86a28bf61e9d56c56863527536447ed7ebf0fe08",russian_1k:"36a778eed866f750bad2bb404dab8161705f7f46e3a34cc7a604c61fc9ed2942",russian_25k:"2d488fa79bcab3bf6ebc1246e735f4f337d687eaf0c24f693a0fc08aa5c1d6ce",russian_375k:"4752fadeb9e25e5c77736d8f78f87d04ee38dd68b513b27251cc8b7cf97410e0",russian_50k:"41591cf880bd92041f6b83c7d4e9e1006a823b53b7dcecccc412027c338cf5ab",russian_5k:"16b60305cbcfcd2a6462f22003ddfff2b0cdde6530bc54dc82d2672dc71ef738",russian_abbreviations:"cf28a5a04c4da920da46e954f34691d94d8e3d4dc5c95d97ebc6be8b35a6f61d",russian_contractions:"12f09f8f5350a649de4395d267c4bda1e16cbf29191a1fb3afa606a189947db0",russian_contractions_1k:"3c13320178c0132add8bbc5e6f4f42ed9ea69c28505a0c4cd5e91446260c7328",sanskrit:"d13f978830dc58c67c56352c1a5cd4d0c55cd54828d70296d6b2c982956a5738",sanskrit_roman:"e2e213ecd435747818eedc4bbce2bf530e9c582cfa801f2703d67e93f505d851",santali:"2870e0a7e7d32cafcbad214ab544ec7622672d7b94b82dd1f5bf5d89ac329b58",serbian:"ac290bf64d0de2331f7299a4f5abfd948e9950a3876cb018a069a64a07e6ab83",serbian_10k:"37999c660de6faff68d9a5017594f57b349e3ea1d684df3c79012cdb24ad1b2a",serbian_latin:"6e0bdadfa8ecf0d529664ef2709b0bf8a74ec884a734ab7da9a35aff20f96382",serbian_latin_10k:"f38e35823f0a42facf0cda4429f6746ee2053b146be8b3d9c1650b9aa6b9ac12",shona:"a028029f20b7588d1b3d084b7543d0435e8a303b85b760e0842e7238ff486a56",shona_1k:"3790b14dd0469cbf7647aca7e762646f1ac6e2d6efa601430366c1c1c1ba0916",sinhala:"84d150168a6d7a0e44e5d2ec0448aa474d439cad984b0a1971d12b6029f8a1b2",slovak:"b4a28738a1c5a7f561899fa4992ac5f676041382dd1229a71515d89caf8bd183",slovak_10k:"1caeebcf033a917ff68b3ff0555ebf7eec21e1baca8b508a16f58ddee24ca681",slovak_1k:"dd3fd5284254ee7abe0b2ba3e62484bca35eb0137553eefd0e933124fe87fb69",slovenian:"b19634ffd1b59bf8a856759a04a9faf4b61b307f54f2ffeb58bdc8c2abb5dfb8",slovenian_1k:"0eddb19672ba2cddc9fe827ffa460aac93bbb8b0ac496550f4826d216d6fae1a",slovenian_5k:"d42d2cfbca696363e0a6d6f077721dd931689c75d9109e2ee97b4252b12f2c7b",spanish:"464f7580531cf85588bd5bc2e0aeed1b6da63e7b686550cb881f4ebfd997528f",spanish_10k:"d92d7e61541245c2088089a780dca0b0b785554d5b06662c740287739a4ef3b7",spanish_1k:"1cf0f31238c063e5ccd022e5e5ff4e072ffa8c717e63dfd5687cefff1a164fd6",spanish_650k:"2745c0a1b939b0a24fddff320de8a928ba1233df1cad17782aa322e289b65ebe",swahili_1k:"a38b530791f3fa73423e0887622529551324e1ac2bedc309d8860d20181fe005",swedish:"7591eb0b1559038f91128a04963c815217bfd4eae900651dd5a0452a423d2156",swedish_1k:"72cca84c0e5a9307137bf8299a0e612219ca2d0a3244314ae34444c973403f82",swedish_diacritics:"ed9a2bcd829dc734a34ddd55495c2d57de27a096c07e3b5a401b26c19fe4851f",swiss_german:"98764305c3fc15fe2f3bc25ff9512003e9e076dafac402a168e93f28a5664bea",swiss_german_1k:"4c47f104d09551de5b92d46d67e7b433a7dff8cfae0e1ee53e219e85e4f2f0e4",swiss_german_2k:"ffde545b319259d8fbe1fb865897906bef0ff83ef02e40bb5efe4e01ece6e3d9",tamil:"1ccddac6dbed10e1dfb9f4fd67afce8158fa323ee6592f3c6985dd369dc6d880",tamil_1k:"7fe640c332e27c8e60261773aa65c737356682d40bdd9a8e27a6de78a7afe2c2",tamil_old:"68273605bdd4b2ac797b32a3281a80d88877fe24385a6b12887d8020e1bbfd68",tanglish:"181f66ba3e401d84403eee9984c509a19beb1f43f27c21f1b2cb1a31d4c5fc81",tatar:"56be46871e14efc1663b8cd5028165859db7cb308c8a24e8c8504a8b9bf90572",tatar_1k:"bb1752f805abc8825149443d498c4b6acfbfbfc0e193b6559aa703afee1c1ed8",tatar_5k:"21732d99bc63cadd62624382a15616d5c643098eaa0270fe4ffc1a221be5ffb9",tatar_9k:"5454d966964cb65fc395abb30498c7f24214fbdbaeac998375ee6c3b4df3e312",tatar_crimean:"a8de360f16e65222db89134ddffc7c44c3f567c1e45817c154acd0f57bc068f1",tatar_crimean_10k:"9acf2f894d5f0ad9626cec17ebc1cafccb4b12511a557ec6bd3e85e4f9c0c463",tatar_crimean_15k:"ef2cefed9315b72be69966861ae4e8d3334f877b038ddafc45ae375d9d232029",tatar_crimean_1k:"fe48d207f4c13f75bafc65dedfed36d94e03ee535218671481ba21af90bb631d",tatar_crimean_5k:"382a618abc5bad9834caf87e3ad9bb51e77734e9f82e006f9375916a68a0c357",tatar_crimean_cyrillic:"499ef50a2e3585fc824781f85fc16891e9904c6a193b8a27de9589c04def759c",tatar_crimean_cyrillic_10k:"83de2484fb1a9a12031b331afaac5c7320dde92666d3649ee0988b252fd21f58",tatar_crimean_cyrillic_15k:"a20e1e977a7b17244b699ba448169ccbf54f3f8aa32640edfebf03cfb2c72f3e",tatar_crimean_cyrillic_1k:"09f5138c012c23987748860531c89fb8b6adab457e5716b59694788a7df25c19",tatar_crimean_cyrillic_5k:"514b71e249cde7272dc026253ff9be632801300d8c1034f7815e969381ddb5d1",telugu:"a5137e48e9285171b00130ddb3c52d27898a2e8abe22f7581ea8a30eb74b8ebe",telugu_1k:"af9e6150a8311bad02d927509e96b026e3d351d4a210701ebd3c70441db15e74",thai:"309d4be5d5a30f0d4f6bf8a1a13a3cbb752c9cf64dcf31c7b24c902ab17335a4",thai_10k:"7ee4dbb7f6cdfac6ec7c239dc99e17e3ca97bcf5793efb5549b3fe4fd468e4da",thai_1k:"dc6dd162bee1f45397d6046d09dd9ee612ebab4ac5f797340d0a4318510d0d43",thai_20k:"68f6ec19ec2b7a641859fbfd113a484ced463b11deb38eb226c33965ba860750",thai_50k:"b9ac5de9640bd450dedff42d752658d5e5e38e0d8a0f784bb202594d9d12611e",thai_5k:"92dcb6812d08ecaeb4b3272b403538301d5cc2f424feeb1ff9bea25114cc2efc",thai_60k:"f27b4e3439addb2f71787e148b650783f8b02639f873fd06240883e9907c1850",tibetan:"a805b31dfde148d7474cb9607959f517dee33d4a199f77d717b5eedd6b7a9042",tibetan_1k:"4cb7db268fde63c8499dee1da85eecba51466ad5b2d6ab9471577ade29c39f11",toki_pona:"152137a84bc9ae578bf1a6c3f72850d7b1b372b4a896dc416a87a863ddee7519",toki_pona_ku_lili:"d7ffe36d1433513b68b94d99c3cc962c2b26ca014bf93a20063483eebb1bf602",toki_pona_ku_suli:"ca0d2ebf0ca820cd4d3928a732a30e9853ac08586f43b394d1f465e63a52c183",turkish:"f6f62100c8dd8f06c37c5b9d1e05627b8c03d42fada25fd651b6cb931149179c",turkish_1k:"823e5b5401cd2a71e631d64982ebb7700def55682f0f82019c93468015aef7b4",turkish_5k:"8cab406413b147ac3664b081cab99dbb421de394f9fda4befa8f8bae76f915ea",twitch_emotes:"f73bf670c9c525e3b803a350346c4ee4fb158d6585061e1a4aeed4c771702292",typing_of_the_dead:"b6f2d2f014afa30787f10d1fc7bb99b4ced7ce765fc7af51d5eff1cb51bc1950",udmurt:"2ac88d0b6a1682aad9f917c73f1919c5020e971f04108453d2b258a8f3965586",ukrainian:"e693520ae92b2d4467e85392b5b2fff89c1c2ef22e594e7373f50941175f3876",ukrainian_10k:"106712ce54c94da4fb2ec3f41c389325cf7d3c64ef59d33c7a05f4755df87c81",ukrainian_1k:"dc9fd23dc8229f66d82692c66298a2995ac07573535e13830a761262293316eb",ukrainian_50k:"6cd51bf11243c0652c4559dc37525e9a2145297cad74b82a323e910c70cab4a9",ukrainian_endings:"0e27e0086c862f556ee2120f03a11f22846358400f24b1f810bc58fd173f3609",ukrainian_latynka:"213883c243ea9feb63943603fb8a6b9fce1495c5e96028ca403e87e21255daf6",ukrainian_latynka_10k:"60ea8e418f98272bf6c7313da82fb6056e48c0b9372b0e70e3cb3a911af8d696",ukrainian_latynka_1k:"d278f196a89cdd75b0d3f8f9d4a134c685acfd071497c8cf6f421fbfecb310fa",ukrainian_latynka_50k:"3f3ed559f26918c22cce4e81bf422e79b0ce9225a3603245440b04b3345274c1",ukrainian_latynka_endings:"e22299f87774eb13c663f62386a5138ca8822e13f86a18e95b596e72a19935f5",urdish:"2458b0c85debfd819b2cbf24cc6621ce1223830307c406db0896c1dc24125549",urdu:"4d14915278b4af72258999a81e9bc15d2c0b4f3a2af7e6072e2f173a4544807e",urdu_1k:"8af4fca80c002d5b6412998b4cdf72f387df751bd285b9b10e3f7784cabaab5b",urdu_5k:"ec2c5eeeacecacbc5783bc004a93c6b743917bcc618a9157eaab53cd781f3f14",uzbek:"aa79f87a2d6bf152198e1eb6f24f2e6c56426f2fd93ac4e8a156818e3aa5ddfd",uzbek_1k:"5f82518428e19e676ed6d5a4aa249ce8f026f7d72a1e75872cc6d15672a6eb43",uzbek_70k:"88a5be27a1215882024a821bd901e741f88cf796a40e973a98e6fc8df2ec80cf",vietnamese:"2bbb05c3214a6da2371dba81e18584a2c368ac18371d6e032e4207355817a5e4",vietnamese_1k:"b715a183634527d6d152b82df4be3311946607e4c062afd33061c9355cb1a473",vietnamese_5k:"00e944d74899089b73f5e774047cd852693b497b8a67fe5866a02b23291239dc",viossa:"09a2bc7f5c6c9dbc576614d33a9a88d446df8f3f597bb2e18e6ad9bdd0dd1434",viossa_njutro:"6debf62d2035df4b3d9712525836440079488b1f61ed77bbdf7f6430221986b5",welsh:"f003979f0d1e21d6ce55f41c61e5eac3e5a693afea3e0bb239947a43a058c847",welsh_1k:"087e8911bf81808bd3565fdf58fcefa9b990e315d7c4b651e1705b19b22da429",wordle:"dc0b4a38eb6271c16df78c38c9619920a0e4e93c8b89563d5bef3ac9ab7ab245",wordle_1k:"4595d47bc80537b428b9ceda7d9df7b073a5328c18528384d515f0cbbb430515",xhosa:"e4b2c64102460458731946ed58468e0119cb8a49ec4dab49fdf93d64b9f97986",xhosa_3k:"cc4569b137f6c6bb1f30a3031dd13b2f5f7f296aa37bfb3593671340f054a0d5",yiddish:"3fbf303c9489e0f915a130e2602e4d7cef5e8e077d57c9b0f5c5e0ab836d4641",yoruba_1k:"b0acb98309268729daeb80c374be9d4c6a434b8a5a1d127f5ccad93be8fa8e53",zulu:"bc07c4c9412abc44751568993d93dbb2d733a3253eebdef80f7e03e4be3f10ae"},dx=window.fetch,ux=window.crypto.subtle;async function fx(e){try{if(!e)throw new Error("No URL");const t=await dx(e);if(t.ok){if(!t.headers.get("content-type")?.startsWith("application/json"))throw new Error("Content is not JSON");return await t.json()}else throw new Error(`${t.status} ${t.statusText}`)}catch(t){throw console.error("Error fetching JSON: "+e,t),t}}function px(e,t){const a=new Map;return(async(...o)=>{const i=o[0];if(a.has(i)){const l=await a.get(i);if(l!==void 0)return l}const n=e.apply(null,o);return a.set(i,n),n})}const gi=px(fx);async function zi(e){return await gi(`/layouts/${e}.json`)}let Tl;async function ii(e){if(Tl===void 0||Tl.name!==e){const t=await gi(`/languages/${e}.json`);{const o=new TextEncoder().encode(JSON.stringify(t,null,0)),i=await ux.digest("SHA-256",o);if(N5(i)!==cx[e])throw new Error("Integrity check failed. Try refreshing the page. If this error persists, please contact support.")}Tl=t}return Tl}async function mx(e){const t=await ii(e);return t.orderedByFrequency===!0?"yes":t.orderedByFrequency===!1?"no":"unknown"}async function gx(e){return await ii(e)}class S0{constructor(t,a,o){this.title=t,this.author=a,this.words=o}}async function x0(){return await gi("/challenges/_list.json")}async function hx(){return await gi("/about/supporters.json")}async function bx(){return await gi("/about/contributors.json")}async function yx(){const e=await gi("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=1");if(e[0]===void 0||e[0].name===void 0)throw new Error("No release found");return e[0].name}async function vx(){return gi("https://api.github.com/repos/monkeytypegame/monkeytype/releases?per_page=5")}const wx=new Set(["—","_"," "]),Cx=100,kx="https://poetrydb.org/random";class Sx extends S0{constructor(t,a,o){super(t,a,o),this.title=t,this.author=a,this.words=o,this.cleanUpText()}cleanUpText(){let t=0;const a=[];for(const o of this.words){let i="";for(const n of o)wx.has(n)||(i+=n);if(i!==""&&(a.push(i),t++,t===Cx))break}this.words=a}}async function xx(){console.log("Getting poem");try{const a=(await(await fetch(kx)).json())[0];if(!a)return!1;const o=[];return a.lines.forEach(i=>{i.split(/ +/).forEach(n=>{o.push(n)})}),new Sx(a.title,a.author,o)}catch(e){return console.log(e),!1}}const Qp=Qb._def.values,T0={english:["english","english_1k","english_5k","english_10k","english_25k","english_450k","english_commonly_misspelled","english_contractions","english_doubleletter","english_shakespearean","english_old","english_medical"],spanish:["spanish","spanish_1k","spanish_10k","spanish_650k"],french:["french","french_1k","french_2k","french_10k","french_600k","french_bitoduc"],german:["german","german_1k","german_10k","german_250k"],swiss_german:["swiss_german","swiss_german_1k","swiss_german_2k"],portuguese:["portuguese","portuguese_1k","portuguese_3k","portuguese_5k","portuguese_320k","portuguese_550k","portuguese_acentos_e_cedilha"],arabic:["arabic","arabic_10k"],arabic_egypt:["arabic_egypt","arabic_egypt_1k"],arabic_morocco:["arabic_morocco"],italian:["italian","italian_1k","italian_7k","italian_60k","italian_280k"],friulian:["friulian"],latin:["latin"],afrikaans:["afrikaans","afrikaans_1k","afrikaans_10k"],mongolian:["mongolian","mongolian_10k"],korean:["korean","korean_1k","korean_5k"],khmer:["khmer"],marathi:["marathi"],chinese:["chinese_traditional","chinese_simplified","chinese_simplified_1k","chinese_simplified_5k","chinese_simplified_10k","chinese_simplified_50k"],russian:["russian","russian_1k","russian_5k","russian_10k","russian_25k","russian_50k","russian_375k","russian_contractions","russian_contractions_1k","russian_abbreviations"],polish:["polish","polish_2k","polish_5k","polish_10k","polish_20k","polish_40k","polish_200k"],czech:["czech","czech_1k","czech_10k"],slovak:["slovak","slovak_1k","slovak_10k"],ukrainian:["ukrainian","ukrainian_1k","ukrainian_10k","ukrainian_50k","ukrainian_endings"],ukrainian_latynka:["ukrainian_latynka","ukrainian_latynka_1k","ukrainian_latynka_10k","ukrainian_latynka_50k","ukrainian_latynka_endings"],lithuanian:["lithuanian","lithuanian_1k","lithuanian_3k"],indonesian:["indonesian","indonesian_1k","indonesian_10k"],kurdish_central:["kurdish_central","kurdish_central_2k","kurdish_central_4k"],greek:["greek","greek_1k","greek_5k","greek_10k","greek_25k"],greeklish:["greeklish","greeklish_1k","greeklish_5k","greeklish_10k","greeklish_25k"],turkish:["turkish","turkish_1k","turkish_5k"],irish:["irish"],galician:["galician"],thai:["thai","thai_1k","thai_5k","thai_10k","thai_20k","thai_50k","thai_60k"],tamil:["tamil","tamil_1k","tanglish","tamil_old"],kannada:["kannada"],telugu:["telugu","telugu_1k"],slovenian:["slovenian","slovenian_1k","slovenian_5k"],croatian:["croatian","croatian_1k"],dutch:["dutch","dutch_1k","dutch_10k"],filipino:["filipino","filipino_1k"],danish:["danish","danish_1k","danish_10k"],hungarian:["hungarian","hungarian_1k","hungarian_2k"],norwegian_bokmal:["norwegian_bokmal","norwegian_bokmal_1k","norwegian_bokmal_5k","norwegian_bokmal_10k","norwegian_bokmal_150k","norwegian_bokmal_600k"],norwegian_nynorsk:["norwegian_nynorsk","norwegian_nynorsk_1k","norwegian_nynorsk_5k","norwegian_nynorsk_10k","norwegian_nynorsk_100k","norwegian_nynorsk_400k"],hebrew:["hebrew","hebrew_1k","hebrew_5k","hebrew_10k"],icelandic:["icelandic","icelandic_1k"],malagasy:["malagasy","malagasy_1k"],malay:["malay","malay_1k"],romanian:["romanian","romanian_1k","romanian_5k","romanian_10k","romanian_25k","romanian_50k","romanian_100k","romanian_200k"],finnish:["finnish","finnish_1k","finnish_10k"],estonian:["estonian","estonian_1k","estonian_5k","estonian_10k"],udmurt:["udmurt"],welsh:["welsh","welsh_1k"],persian:["persian","persian_1k","persian_5k","persian_20k","persian_romanized"],kazakh:["kazakh","kazakh_1k"],vietnamese:["vietnamese","vietnamese_1k","vietnamese_5k"],jyutping:["jyutping"],pinyin:["pinyin","pinyin_1k","pinyin_10k"],hausa:["hausa","hausa_1k"],swedish:["swedish","swedish_1k","swedish_diacritics"],serbian:["serbian","serbian_latin","serbian_10k","serbian_latin_10k"],georgian:["georgian"],yoruba:["yoruba_1k"],swahili:["swahili_1k"],maori:["maori_1k"],catalan:["catalan","catalan_1k"],bulgarian:["bulgarian","bulgarian_1k","bulgarian_latin","bulgarian_latin_1k"],bosnian:["bosnian","bosnian_4k"],esperanto:["esperanto","esperanto_1k","esperanto_10k","esperanto_25k","esperanto_36k","esperanto_x_sistemo","esperanto_x_sistemo_1k","esperanto_x_sistemo_10k","esperanto_x_sistemo_25k","esperanto_x_sistemo_36k","esperanto_h_sistemo","esperanto_h_sistemo_1k","esperanto_h_sistemo_10k","esperanto_h_sistemo_25k","esperanto_h_sistemo_36k"],bangla:["bangla","bangla_letters","bangla_10k"],urdu:["urdu","urdu_1k","urdu_5k","urdish"],albanian:["albanian","albanian_1k"],shona:["shona","shona_1k"],armenian:["armenian","armenian_1k","armenian_western","armenian_western_1k"],myanmar:["myanmar_burmese"],japanese:["japanese_hiragana","japanese_katakana","japanese_romaji","japanese_romaji_1k"],hindi:["hindi","hindi_1k","hinglish"],sanskrit:["sanskrit","sanskrit_roman"],gujarati:["gujarati","gujarati_1k"],nepali:["nepali","nepali_1k","nepali_romanized"],santali:["santali"],macedonian:["macedonian","macedonian_1k","macedonian_10k","macedonian_75k"],uzbek:["uzbek","uzbek_1k","uzbek_70k"],belarusian:["belarusian","belarusian_1k","belarusian_5k","belarusian_10k","belarusian_25k","belarusian_50k","belarusian_100k"],belarusian_lacinka:["belarusian_lacinka","belarusian_lacinka_1k"],tatar:["tatar","tatar_1k","tatar_5k","tatar_9k"],tatar_crimean:["tatar_crimean","tatar_crimean_1k","tatar_crimean_5k","tatar_crimean_10k","tatar_crimean_15k","tatar_crimean_cyrillic","tatar_crimean_cyrillic_1k","tatar_crimean_cyrillic_5k","tatar_crimean_cyrillic_10k","tatar_crimean_cyrillic_15k"],azerbaijani:["azerbaijani","azerbaijani_1k"],malayalam:["malayalam"],sinhala:["sinhala"],latvian:["latvian","latvian_1k"],maltese:["maltese","maltese_1k"],toki_pona:["toki_pona","toki_pona_ku_suli","toki_pona_ku_lili"],xhosa:["xhosa","xhosa_3k"],tibetan:["tibetan","tibetan_1k"],bashkir:["bashkir"],other:["lojban_gismu","lojban_cmavo","pig_latin","twitch_emotes","git","typing_of_the_dead","league_of_legends","docker_file"],amharic:["amharic","amharic_1k","amharic_5k"],oromo:["oromo","oromo_1k","oromo_5k"],wordle:["wordle","wordle_1k"],kyrgyz:["kyrgyz","kyrgyz_1k"],yiddish:["yiddish"],frisian:["frisian","frisian_1k"],pashto:["pashto"],euskera:["euskera"],klingon:["klingon","klingon_1k"],quenya:["quenya"],lorem_ipsum:["lorem_ipsum"],occitan:["occitan","occitan_1k","occitan_2k","occitan_5k","occitan_10k"],kabyle:["kabyle","kabyle_1k","kabyle_2k","kabyle_5k","kabyle_10k"],zulu:["zulu"],hawaiian:["hawaiian","hawaiian_1k"],code:["code_python","code_python_1k","code_python_2k","code_python_5k","code_c","code_css","code_csharp","code_c++","code_dart","code_brainfck","code_fsharp","code_javascript","code_javascript_1k","code_javascript_react","code_jule","code_julia","code_haskell","code_html","code_nim","code_nix","code_pascal","code_java","code_kotlin","code_go","code_rockstar","code_rust","code_ruby","code_r","code_r_2k","code_swift","code_scala","code_bash","code_powershell","code_lua","code_luau","code_latex","code_typst","code_matlab","code_sql","code_perl","code_php","code_vim","code_vimscript","code_opencl","code_visual_basic","code_arduino","code_systemverilog","code_elixir","code_gleam","code_zig","code_gdscript","code_gdscript_2","code_assembly","code_v","code_ook","code_typescript","code_cobol","code_clojure","code_common_lisp","code_erlang","code_ocaml","code_odin","code_fortran","code_abap","code_abap_1k","code_yoptascript","code_cuda"],viossa:["viossa","viossa_njutro"]},Yp=Array.from(Object.keys(T0));function Tx(e){return Yp.find(t=>t.includes(e))}async function Lx(e){switch(e){case"english":return"en";case"spanish":return"es";case"french":return"fr";case"german":return"de";case"portuguese":return"pt";case"arabic":return"ar";case"italian":return"it";case"latin":return"la";case"afrikaans":return"af";case"korean":return"ko";case"russian":return"ru";case"polish":return"pl";case"czech":return"cs";case"slovak":return"sk";case"ukrainian":return"uk";case"lithuanian":return"lt";case"indonesian":return"id";case"greek":return"el";case"turkish":return"tr";case"thai":return"th";case"tamil":return"ta";case"slovenian":return"sl";case"croatian":return"hr";case"dutch":return"nl";case"danish":return"da";case"hungarian":return"hu";case"norwegian_bokmal":return"no";case"norwegian_nynorsk":return"nn";case"hebrew":return"he";case"malay":return"ms";case"romanian":return"ro";case"finnish":return"fi";case"estonian":return"et";case"welsh":return"cy";case"persian":return"fa";case"kazakh":return"kk";case"vietnamese":return"vi";case"swedish":return"sv";case"serbian":return"sr";case"georgian":return"ka";case"catalan":return"ca";case"bulgarian":return"bg";case"esperanto":return"eo";case"bangla":return"bn";case"urdu":return"ur";case"armenian":return"hy";case"myanmar":return"my";case"hindi":return"hi";case"macedonian":return"mk";case"uzbek":return"uz";case"belarusian":return"be";case"azerbaijani":return"az";case"latvian":return"lv";case"euskera":return"eu";default:return"en"}}const $x=I.object({query:I.object({pages:I.record(I.string(),I.object({extract:I.string()}))})});async function Mx(e){oe();let t="en";const a=Tx(e);a!==void 0&&(t=await Lx(a));const o=`https://${t}.wikipedia.org/api/rest_v1/page/random/summary`,i={title:"",author:""},n=await fetch(o);let l=0;if(n.status===200){const c=await n.json();i.title=c.title,i.author=c.author,l=c.pageid}return new Promise((c,d)=>{n.status!==200&&(j(),d(n.status));const u=`https://${t}.wikipedia.org/w/api.php?action=query&format=json&pageids=${l}&prop=extracts&exintro=true&origin=*`,m=new XMLHttpRequest;m.onload=()=>{if(m.readyState===4)if(m.status===200){const g=ws(m.responseText,$x).query.pages[l.toString()];if(!g){j(),d("Page not found");return}let h=g.extract;h=h.replace(/<\/p><p>+/g," "),h=w2(h),h=h.replace(/\[\d+\]/gi,""),h=h.replace(/[\u200B-\u200D\uFEFF]/g,""),h=zy(h),t==="en"&&(h=h.replace(/[^\x20-\x7E]+/g,"")),h=h.replace(/\s+/g," "),h=h.trim();const y=h.split(" "),k=new S0(i.title,i.author,y);j(),c(k)}else j(),d(m.status)},m.open("GET",u),m.send()})}const Ax=50,_x=20,Ex=5e3,ar={};class qx{constructor(){this.average=0,this.count=0}update(t){this.count<Ax&&this.count++;const a=1/this.count;this.average=t*a+this.average*(1-a)}}function Ix(e,t){const a=ve.spacing.array;if(a.length===0||typeof a=="string")return;let o=a[a.length-1];t||(o+=Ex),e in ar||(ar[e]=new qx),ar[e]?.update(o)}function Dx(e){let t=0,a=0;for(const o of e)o in ar&&(t+=ar[o].average,a++);return a===0?0:t/a}function Fx(e){let t,a="";for(let o=0;o<_x;o++){const i=e.randomWord("normal"),n=Dx(i);(o===0||t===void 0||n>t)&&(a=i,t=n)}return a}function L0(e,t,a,o,i){const n=[],l=Math.round(e/t);for(let c=0;c<t;c++){let u=St(0,2**l-1).toString(a);if(o){const m=Math.ceil(l/Math.ceil(Math.log2(a)));u="0".repeat(Math.max(0,m-u.length))+u}n.push(u)}return n.join(i)}function mh(e,t,a,o,i,n){const l=i.split(o).map(u=>parseInt(u,a)),c=Math.round(e/t);let d=n;for(let u=0;u<t;u++)d-=c,d<0&&(-d<=c?l[u]&=2**c-1^2**-d-1:l[u]=0);return l.map(u=>u.toString(a)).join(o)+"/"+n.toString()}function Px(){return L0(32,4,10,!1,".")}function Bx(){return L0(128,8,16,!0,":")}function gh(e){return e.includes(":")?mh(128,8,16,":",e,St(16,32)*4):mh(32,4,10,".",e,St(8,32))}function Rx(e){const t=e.split("/");let a=t[0].split(":"),o="";a=a.map(m=>m.replace(/^0+/gm,""));let i=0,n=-1,l=-1,c=0,d=-1,u=-1;for(let m=0;m<a.length;m++)a[m]===""?(d===-1&&(d=m),c++):(u=m-1,i<c&&(i=c,n=d,l=u),c=0,d=-1,u=-1);return i<c&&(i=c,n=d,l=a.length-1),a=a.map((m,p)=>m===""?p>=n&&p<=l&&n!==l?":":"0":m),o=a.join(":"),o=o.replace(/:{3,}/gm,"::"),t.length>1&&(o+="/"+t[1]),o}class tt extends Error{constructor(t){super(t),this.name="WordGenError"}}async function nu(e){const t=(A.current??"").slice(-1),a=F.getCurrent().slice(A.current.length-1,A.current.length),o=t===a;e.key==="Backspace"&&!o&&(A.current!==""||A.getHistory(ne-1)!==F.get(ne-1)||r.freedomMode)?s("#words").addClass("read_ahead_disabled"):e.key===" "&&s("#words").removeClass("read_ahead_disabled")}class Wx{constructor(){this.chars={},this.count=0}addChar(t){this.count++,t in this.chars?this.chars[t]++:this.chars[t]=1}randomChar(){const t=St(0,this.count-1);let a=0;for(const[o,i]of Object.entries(this.chars))if(a+=i,a>t)return o;return Object.keys(this.chars)[0]}}class zx extends vd{constructor(t){super(t),this.ngrams={},this.length=1/0;for(let a of t){a+=" ";let o="";for(const i of a)o in this.ngrams||(this.ngrams[o]=new Wx),this.ngrams[o].addChar(i),o=(o+i).slice(-2)}}randomWord(){let t="";for(;;){const a=t.slice(-2),o=this.ngrams[a];if(!o){t="";continue}const i=o.randomChar();if(i===" ")break;t+=i}return t}}class Xp extends vd{constructor(t,a){const o=Array.from(t.keys());Un(o),super(o),this.wordsWithLanguage=t,this.languageProperties=a}}const Hx={58008:{getWord(){let e=y0(7);return r.language.startsWith("kurdish")?e=zb(e):r.language.startsWith("nepali")&&(e=Hb(e)),e},punctuateWord(e){if(e.length>3&&(Math.random()<.5&&(e=th(e,St(1,e.length-2),".")),Math.random()<.75)){const t=St(1,e.length-2);if(e[t-1]!=="."&&e[t+1]!=="."&&e[t+1]!=="0"){const a=Ia(["/","*","-","+"]);e=th(e,t,a)}}return e},rememberSettings(){Xe("numbers",r.numbers)},getEmulatedChar(e){return e.key==="Enter"?" ":null}},simon_says:{applyConfig(){v("keymapMode","next",{nosave:!0})},rememberSettings(){Xe("keymapMode",r.keymapMode)}},tts:{applyConfig(){v("keymapMode","off",{nosave:!0})},rememberSettings(){Xe("keymapMode",r.keymapMode)},toggleScript(e){if(window.speechSynthesis===void 0){f("Failed to load text-to-speech script",-1);return}e[0]!==void 0&&ex(e[0])}},arrows:{getWord(e,t){return ax(t===0)},rememberSettings(){Xe("highlightMode",r.highlightMode)},getEmulatedChar(e){const t=e.key;return t==="a"||t==="ArrowLeft"||t==="j"?"←":t==="s"||t==="ArrowDown"||t==="k"?"↓":t==="w"||t==="ArrowUp"||t==="i"?"↑":t==="d"||t==="ArrowRight"||t==="l"?"→":null},isCharCorrect(e,t){return(e==="a"||e==="ArrowLeft"||e==="j"||e==="←")&&t==="←"||(e==="s"||e==="ArrowDown"||e==="k"||e==="↓")&&t==="↓"||(e==="w"||e==="ArrowUp"||e==="i"||e==="↑")&&t==="↑"||(e==="d"||e==="ArrowRight"||e==="l"||e==="→")&&t==="→"},getWordHtml(e,t){let a="";return e==="↑"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-up"></i>',t&&(a+="</letter>")),e==="↓"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-down"></i>',t&&(a+="</letter>")),e==="←"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-left"></i>',t&&(a+="</letter>")),e==="→"&&(t&&(a+="<letter>"),a+='<i class="fas fa-arrow-right"></i>',t&&(a+="</letter>")),a}},rAnDoMcAsE:{alterText(e){let t=e[0];for(let a=1;a<e.length;a++)t[a-1]===t[a-1].toUpperCase()?t+=e[a].toLowerCase():t+=e[a].toUpperCase();return t}},rot13:{alterText(e){let t="abcdefghijklmnopqrstuvwxyz",a="";for(let o of e){let i=t.indexOf(o.toLowerCase());if(i===-1){a+=o;continue}let n=(i+13)%26;o.toUpperCase()===o?a+=t[n]?.toUpperCase():a+=t[n]}return a}},backwards:{alterText(e){return e.split("").reverse().join("")}},capitals:{alterText(e){return an(e)}},layout_mirror:{applyConfig(){let e=r.layout;r.layout==="default"&&(e="qwerty"),v("layout",e,{nosave:!0}),v("keymapLayout","overrideSync",{nosave:!0})},rememberSettings(){Xe("keymapMode",r.keymapMode),Xe("layout",r.layout)}},layoutfluid:{applyConfig(){const e=r.customLayoutfluid[0]??"qwerty";v("layout",e,{nosave:!0}),v("keymapLayout",e,{nosave:!0})},rememberSettings(){Xe("keymapMode",r.keymapMode),Xe("layout",r.layout),Xe("keymapLayout",r.keymapLayout)},handleSpace(){if(r.mode!=="time"){const e=r.customLayoutfluid,t=F.length,a=Math.floor(t/e.length),o=Math.floor((A.getHistory().length+1)/a),i=a-(ne+1)%a;e[o]?(i<=3&&e[o+1]?(C0(),ix(i,e[o+1])):Gl(),i===a&&(v("layout",e[o]),v("keymapLayout",e[o]),i>3&&Gl())):Gl(),setTimeout(()=>{vr(F.getCurrent().charAt(A.current.length))},1)}},getResultContent(){return r.customLayoutfluid.join(" ")},restart(){this.applyConfig&&this.applyConfig(),setTimeout(()=>{vr(F.getCurrent().substring(A.current.length,A.current.length+1))},1)}},gibberish:{getWord(){return Q3()}},ascii:{getWord(){return Y3()}},specials:{getWord(){return J3()}},read_ahead_easy:{rememberSettings(){Xe("highlightMode",r.highlightMode)},async handleKeydown(e){await nu(e)}},read_ahead:{rememberSettings(){Xe("highlightMode",r.highlightMode)},async handleKeydown(e){await nu(e)}},read_ahead_hard:{rememberSettings(){Xe("highlightMode",r.highlightMode)},async handleKeydown(e){await nu(e)}},memory:{applyConfig(){s("#wordsWrapper").addClass("hidden"),v("showAllLines",!0,{nosave:!0}),r.keymapMode==="next"&&v("keymapMode","react",{nosave:!0})},rememberSettings(){Xe("mode",r.mode),Xe("showAllLines",r.showAllLines),r.keymapMode==="next"&&Xe("keymapMode",r.keymapMode)},start(){ns(),s("#words").addClass("hidden")},restart(){lx(Math.round(Math.pow(F.length,1.2))),s("#words").removeClass("hidden"),r.keymapMode==="next"&&v("keymapMode","react")}},nospace:{rememberSettings(){Xe("highlightMode",r.highlightMode)}},poetry:{async pullSection(){return xx()}},wikipedia:{async pullSection(e){return Mx((e??"")||"english")}},weakspot:{getWord(e){return e!==void 0?Fx(e):""}},pseudolang:{async withWords(e){return e!==void 0?new zx(e):new vd([])}},IPv4:{getWord(){return Px()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=gh(e)),t},rememberSettings(){Xe("numbers",r.numbers)}},IPv6:{getWord(){return Bx()},punctuateWord(e){let t=e;return Math.random()<.25&&(t=gh(e)),t.includes(":")&&(t=Rx(t)),t},rememberSettings(){Xe("numbers",r.numbers)}},binary:{getWord(){return K3()}},hexadecimal:{getWord(){return j3()},punctuateWord(e){return`0x${e}`},rememberSettings(){Xe("punctuation",r.punctuation)}},zipf:{getWordsFrequencyMode(){return"zipf"}},ddoouubblleedd:{alterText(e){return e.replace(/./gu,"$&$&")}},instant_messaging:{alterText(e){return e.toLowerCase().replace(/[.!?]$/g,`
`).replace(/[().'"]/g,"").replace(/\n+/g,`
`)}},morse:{alterText(e){return G3(e)}},underscore_spaces:{alterText(e,t,a){return t===a-1?e:e+"_"}},crt:{applyGlobalCSS(){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){const t=navigator.userAgent.match(/.*Version\/([0-9]*)\.([0-9]*).*/),a=t!==null?parseInt(t[1]??"0"):0,o=t!==null?parseInt(t[2]??"0"):0;if(a<=16&&o<=5){f("CRT is not available on Safari 16.5 or earlier.",0,{duration:5}),Bn("crt");return}}s("body").append('<div id="scanline" />'),s("body").addClass("crtmode"),s("#globalFunBoxTheme").attr("href","funbox/crt.css")},clearGlobal(){s("#scanline").remove(),s("body").removeClass("crtmode"),s("#globalFunBoxTheme").attr("href","")}},ALL_CAPS:{alterText(e){return e.toUpperCase()}},polyglot:{async withWords(e){const t=r.customPolyglot.map(async u=>ii(u).catch(()=>(f(`Failed to load language: ${u}. It will be ignored.`,0),null))),a=(await Promise.all(t)).filter(u=>u!==null);if(a.length===0)throw Bn("polyglot"),new Error(`No valid languages found. Please check your polyglot languages config (${r.customPolyglot.join(", ")}).`);if(a.length===1){const u=a[0];throw v("language",u.name,{nosave:!0}),Bn("polyglot",!0),f(`Disabled polyglot funbox because only one valid language was found. Check your polyglot languages config (${r.customPolyglot.join(", ")}).`,0,{duration:7}),new tt("")}const o=a.every(u=>u.rightToLeft),i=a.every(u=>!u.rightToLeft),l=(await ii(r.language))?.rightToLeft??!1;if(l&&i||!l&&o){const u=a[0]?.name??(o?"arabic":"english");throw v("language",u),f(`Language direction conflict: switched to ${u} for consistency.`,0,{duration:5}),new tt("")}const c=new Map(a.map(u=>[u.name,{noLazyMode:u.noLazyMode,ligatures:u.ligatures,rightToLeft:u.rightToLeft,additionalAccents:u.additionalAccents}])),d=new Map(a.flatMap(u=>u.words.map(m=>[m,u.name])));return new Xp(d,c)}}};function Ox(){return Hx}const Nx=O2(),Ux=Ox(),ju={};for(const[e,t]of Object.entries(Nx))ju[e]={...t,functions:Ux[e]};function Gu(e){return Array.isArray(e)?e.map(a=>ju[a]):ju[e]}function no(){return Gu(na())}function na(){return r.funbox??[]}function $0(e){return no().filter(t=>t.properties?.includes(e))}function _o(e){return $0(e).length>0}function M0(e){return na().includes(e)}function $t(e){return no().filter(t=>t.functions?.[e]!==void 0)}function A0(e){return $t(e).length>0}function Eo(e){const t=$t(e);if(t.length!==0){if(t.length===1)return t[0];throw new Error(`Expecting exactly one funbox implementing "${e} but found ${t.length}`)}}let Jp=0,Z=null;const Kt=new t0(V("#paceCaret"),r.paceCaretStyle);let Qu=0;function Vx(e){(!Oi||Oi&&e>Qu)&&(Qu=e)}function Kx(){r.paceCaret==="off"&&!Oi||r.mode!=="zen"&&(Kt.hide(),Kt.stopAllAnimations(),Kt.clearMargins(),Kt.goTo({wordIndex:0,letterIndex:0,isLanguageRightToLeft:ia,isDirectionReversed:fi,animate:!1}))}async function Ic(){Kt.hide();const e=di(r,be);let t=0;if(r.paceCaret==="pb"?t=(await Gn(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,no()))?.wpm??0:r.paceCaret==="tagPb"?t=await l5(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode):r.paceCaret==="average"?([t]=await $y(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="daily"?(t=await r5(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode),t=Math.round(t)):r.paceCaret==="custom"?t=r.paceCaretCustomSpeed:(r.paceCaret==="last"||Oi)&&(t=Qu),t===void 0||t<1||Number.isNaN(t)){Z=null;return}const a=t*5,o=a/60,i=60/a;Z={wpm:t,cps:o,spc:i,correction:0,currentWordIndex:0,currentLetterIndex:0,wordsStatus:{},timeout:null}}async function _0(e){const t=Z;if(!(t===null||!Me||Ie)){Kt.isHidden()&&Kt.show(),Gx();try{const a=performance.now(),i=Jp+e-a;Kt.goTo({wordIndex:t.currentWordIndex,letterIndex:t.currentLetterIndex,isLanguageRightToLeft:ia,isDirectionReversed:fi,animate:!0,animationOptions:{duration:i,easing:"linear"}}),t.timeout=setTimeout(()=>{Z===t&&_0(e+(t.spc??0)*1e3).catch(()=>{Z===t&&(Z=null)})},Math.max(0,i))}catch(a){console.error(a),Kt.hide();return}}}function jx(){Z?.timeout!==null&&Z?.timeout!==void 0&&clearTimeout(Z.timeout),Z=null,Jp=0}function Gx(){if(Z!==null)try{if(Z.currentLetterIndex++,Z.currentLetterIndex>=F.get(Z.currentWordIndex).length+1&&(Z.currentLetterIndex=0,Z.currentWordIndex++),!r.blindMode){if(Z.correction<0)for(;Z.correction<0;)Z.currentLetterIndex--,Z.currentLetterIndex<=-2&&(Z.currentLetterIndex=F.get(Z.currentWordIndex-1).length-1,Z.currentWordIndex--),Z.correction++;else if(Z.correction>0)for(;Z.correction>0;)Z.currentLetterIndex++,Z.currentLetterIndex>=F.get(Z.currentWordIndex).length&&(Z.currentLetterIndex=0,Z.currentWordIndex++),Z.correction--}}catch{Z=null,console.log("pace caret out of words"),Kt.hide();return}}function Qx(e,t){e?Z!==null&&Z.wordsStatus[ne]===!0&&!r.blindMode&&(Z.wordsStatus[ne]=void 0,Z.correction-=t.length+1):Z!==null&&Z.wordsStatus[ne]===void 0&&!r.blindMode&&(Z.wordsStatus[ne]=!0,Z.correction+=t.length+1)}function Yx(){Jp=performance.now(),_0((Z?.spc??0)*1e3)}Ce(({key:e})=>{e==="paceCaret"&&Ic(),e==="paceCaretStyle"&&Kt.setStyle(r.paceCaretStyle)});const hh=[["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],["Space"]],Xx=new Set(["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyA","KeyS","KeyD","KeyF","KeyG","ShiftLeft","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","Space"]),Jx=new Set(["Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","Backspace","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Enter","KeyB","KeyN","KeyM","Comma","Period","Slash","ShiftRight","ArrowUp","ArrowLeft","ArrowDown","ArrowRight","NumpadMultiply","NumpadSubtract","NumpadAdd","NumpadDecimal","NumpadEqual","NumpadDivide","Numpad0","Numpad1","Numpad2","Numpad3","Numpad4","Numpad5","Numpad6","Numpad7","Numpad8","Numpad9","NumpadEnter","Space"]);function E0(e,t){const a=Object.values(t.keys),o=a.findIndex(c=>c.find(d=>d.includes(e))),i=a[o];if(i===void 0)return;const n=i.findIndex(c=>c.includes(e));if(n===-1)return;let l=hh[o]?.[n];return t.type==="iso"&&(o===2&&n===11?l="Backslash":o===3&&n===0?l="IntlBackslash":o===3&&(l=hh[3]?.[n-1])),l}function Zp(e){const t=Xx.has(e),a=Jx.has(e);return{leftSide:t,rightSide:a}}function em(e){const t=[11,10,10,10,10],a={row1:[...[...e.keys.row1.slice(0,t[0])].reverse(),...e.keys.row1.slice(t[0])],row2:[...[...e.keys.row2.slice(0,t[1])].reverse(),...e.keys.row2.slice(t[1])],row3:[...[...e.keys.row3.slice(0,t[2])].reverse(),...e.keys.row3.slice(t[2])],row4:[...[...e.keys.row4.slice(0,t[3])].reverse(),...e.keys.row4.slice(t[3])],row5:[...[...e.keys.row5.slice(0,t[4])].reverse(),...e.keys.row5.slice(t[4])]};return{...e,keys:a}}let ni=!1,si=!1;document.addEventListener("keydown",e=>{e.code==="ShiftLeft"?(ni=!0,si=!1):e.code==="ShiftRight"&&(ni=!1,si=!0)});document.addEventListener("keyup",e=>{(e.code==="ShiftLeft"||e.code==="ShiftRight")&&(ni=!1,si=!1)});function Zx(){ni=!1,si=!1}function Yu(e){if(!ni&&!si||r.oppositeShiftMode==="off")return!0;const{leftSide:t,rightSide:a}=Zp(e);return!!(!t&&!a||ni&&a||si&&t)}const q0=V("#capsWarning");let fo=!1,Dc=!1;function e4(){Dc||(q0.removeClass("hidden"),Dc=!0)}function t4(){Dc&&(q0.addClass("hidden"),Dc=!1)}function I0(e){if(e.key==="CapsLock"&&fo!==null)fo=!fo;else{const t=e.getModifierState?.("CapsLock");t!==void 0&&(fo=t)}try{r.capsLockWarning&&fo?e4():t4()}catch{}}document.addEventListener("keyup",I0);document.addEventListener("keydown",e=>{C2()&&I0(e)});async function wd(){return await Hr(()=>import("./vendor.DcpIuIDj.js").then(e=>e.h),__vite__mapDeps([2,3,1]))}let zo=null,Vi=null,Fc=null;async function a4(){const e=(await wd()).Howl;Fc===null&&(Fc=new e({src:"../sound/timeWarning.wav"}))}async function D0(){const e=(await wd()).Howl;zo===null&&(zo={1:[{sounds:[new e({src:"../sound/error1/error1_1.wav"}),new e({src:"../sound/error1/error1_1.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/error2/error2_1.wav"}),new e({src:"../sound/error2/error2_1.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/error3/error3_1.wav"}),new e({src:"../sound/error3/error3_1.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/error4/error4_1.wav"}),new e({src:"../sound/error4/error4_1.wav"})],counter:0},{sounds:[new e({src:"../sound/error4/error4_2.wav"}),new e({src:"../sound/error4/error4_2.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function Cd(){const e=(await wd()).Howl;Vi===null&&(Vi={1:[{sounds:[new e({src:"../sound/click1/click1_1.wav"}),new e({src:"../sound/click1/click1_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_2.wav"}),new e({src:"../sound/click1/click1_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click1/click1_3.wav"}),new e({src:"../sound/click1/click1_3.wav"})],counter:0}],2:[{sounds:[new e({src:"../sound/click2/click2_1.wav"}),new e({src:"../sound/click2/click2_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_2.wav"}),new e({src:"../sound/click2/click2_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click2/click2_3.wav"}),new e({src:"../sound/click2/click2_3.wav"})],counter:0}],3:[{sounds:[new e({src:"../sound/click3/click3_1.wav"}),new e({src:"../sound/click3/click3_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_2.wav"}),new e({src:"../sound/click3/click3_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click3/click3_3.wav"}),new e({src:"../sound/click3/click3_3.wav"})],counter:0}],4:[{sounds:[new e({src:"../sound/click4/click4_1.wav"}),new e({src:"../sound/click4/click4_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_2.wav"}),new e({src:"../sound/click4/click4_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_3.wav"}),new e({src:"../sound/click4/click4_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_4.wav"}),new e({src:"../sound/click4/click4_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_5.wav"}),new e({src:"../sound/click4/click4_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click4/click4_6.wav"}),new e({src:"../sound/click4/click4_66.wav"})],counter:0}],5:[{sounds:[new e({src:"../sound/click5/click5_1.wav"}),new e({src:"../sound/click5/click5_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_2.wav"}),new e({src:"../sound/click5/click5_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_3.wav"}),new e({src:"../sound/click5/click5_33.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_4.wav"}),new e({src:"../sound/click5/click5_44.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_5.wav"}),new e({src:"../sound/click5/click5_55.wav"})],counter:0},{sounds:[new e({src:"../sound/click5/click5_6.wav"}),new e({src:"../sound/click5/click5_66.wav"})],counter:0}],6:[{sounds:[new e({src:"../sound/click6/click6_1.wav"}),new e({src:"../sound/click6/click6_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_2.wav"}),new e({src:"../sound/click6/click6_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click6/click6_3.wav"}),new e({src:"../sound/click6/click6_33.wav"})],counter:0}],7:[{sounds:[new e({src:"../sound/click7/click7_1.wav"}),new e({src:"../sound/click7/click7_11.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_2.wav"}),new e({src:"../sound/click7/click7_22.wav"})],counter:0},{sounds:[new e({src:"../sound/click7/click7_3.wav"}),new e({src:"../sound/click7/click7_33.wav"})],counter:0}],14:[{sounds:[new e({src:"../sound/click14/click14_1.wav"}),new e({src:"../sound/click14/click14_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_2.wav"}),new e({src:"../sound/click14/click14_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_3.wav"}),new e({src:"../sound/click14/click14_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_4.wav"}),new e({src:"../sound/click14/click14_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_5.wav"}),new e({src:"../sound/click14/click14_5.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_6.wav"}),new e({src:"../sound/click14/click14_6.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_7.wav"}),new e({src:"../sound/click14/click14_7.wav"})],counter:0},{sounds:[new e({src:"../sound/click14/click14_8.wav"}),new e({src:"../sound/click14/click14_8.wav"})],counter:0}],15:[{sounds:[new e({src:"../sound/click15/click15_1.wav"}),new e({src:"../sound/click15/click15_1.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_2.wav"}),new e({src:"../sound/click15/click15_2.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_3.wav"}),new e({src:"../sound/click15/click15_3.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_4.wav"}),new e({src:"../sound/click15/click15_4.wav"})],counter:0},{sounds:[new e({src:"../sound/click15/click15_5.wav"}),new e({src:"../sound/click15/click15_5.wav"})],counter:0}]},Howler.volume(r.soundVolume))}async function o4(e){if(["8","9","10","11"].includes(e)){B0("KeyQ",tm[e]);return}if(["12","13"].includes(e)){Xu[e].preview();return}Vi===null&&await Cd();const t=Vi;Object.keys(t).includes(e)&&(t?.[e]?.[0]?.sounds[0]?.seek(0),t?.[e]?.[0]?.sounds[0]?.play())}async function i4(e){zo===null&&await D0(),Object.keys(zo).includes(e)&&(zo?.[e]?.[0]?.sounds[0]?.seek(0),zo?.[e]?.[0]?.sounds[0]?.play())}let Vs="KeyA";document.addEventListener("keydown",e=>{Vs=e.code||"KeyA"});const le={C:[16.35,32.7,65.41,130.81,261.63,523.25,1046.5,2093,4186.01],Db:[17.32,34.65,69.3,138.59,277.18,554.37,1108.73,2217.46,4434.92],D:[18.35,36.71,73.42,146.83,293.66,587.33,1174.66,2349.32,4698.64],Eb:[19.45,38.89,77.78,155.56,311.13,622.25,1244.51,2489.02,4978.03],E:[20.6,41.2,82.41,164.81,329.63,659.26,1318.51,2637.02],F:[21.83,43.65,87.31,174.61,349.23,698.46,1396.91,2793.83],Gb:[23.12,46.25,92.5,185,369.99,739.99,1479.98,2959.96],G:[24.5,49,98,196,392,783.99,1567.98,3135.96],Ab:[25.96,51.91,103.83,207.65,415.3,830.61,1661.22,3322.44],A:[27.5,55,110,220,440,880,1760,3520],Bb:[29.14,58.27,116.54,233.08,466.16,932.33,1864.66,3729.31],B:[30.87,61.74,123.47,246.94,493.88,987.77,1975.53,3951.07]};function de(e,t=0){return a=>e[a+t]??0}const bh={KeyZ:de(le.C),KeyS:de(le.Db),KeyX:de(le.D),KeyD:de(le.Eb),KeyC:de(le.E),KeyV:de(le.F),KeyG:de(le.Gb),KeyB:de(le.G),KeyH:de(le.Ab),KeyN:de(le.A),KeyJ:de(le.Bb),KeyM:de(le.B),Comma:de(le.C,1),KeyL:de(le.Db,1),Period:de(le.D,1),Semicolon:de(le.Eb,1),Slash:de(le.E,1),KeyQ:de(le.C,1),Digit2:de(le.Db,1),KeyW:de(le.D,1),Digit3:de(le.Eb,1),KeyE:de(le.E,1),KeyR:de(le.F,1),Digit5:de(le.Gb,1),KeyT:de(le.G,1),Digit6:de(le.Ab,1),KeyY:de(le.A,1),Digit7:de(le.Bb,1),KeyU:de(le.B,1),KeyI:de(le.C,2),Digit9:de(le.Db,2),KeyO:de(le.D,2),Digit0:de(le.Eb,2),KeyP:de(le.E,2),BracketLeft:de(le.F,2),Equal:de(le.Gb,2),BracketRight:de(le.G,2)},tm={8:"sine",9:"sawtooth",10:"square",11:"triangle"};let Ze;function F0(){if(Ze!==null)try{Ze=new AudioContext}catch(e){Ze=null,console.error(e),f(se(e,"Error initializing audio context")+". Notes will not play.",-1)}}const yh={pentatonic:["C","D","E","G","A"],wholetone:["C","D","E","Gb","Ab","Bb"]};function vh(e){const t={octave:4,direction:1};return async()=>{Vi===null&&await Cd(),P0(e,t)}}const wh={position:0,octave:4,direction:1},Xu={12:{name:"pentatonic",preview:vh("pentatonic"),meta:wh},13:{name:"wholetone",preview:vh("wholetone"),meta:wh}};function P0(e,t){if(Ze===void 0&&F0(),!Ze)return;const a=St(0,yh[e].length-1);Math.random()<.5&&(t.octave+=t.direction),t.octave>=6&&(t.direction=-1),t.octave<=4&&(t.direction=1);const o=yh[e][a],i=le[o][t.octave],n=Ze.createOscillator(),l=Ze.createGain();n.type="sine",l.gain.value=r.soundVolume/10,n.connect(l),l.connect(Ze.destination),n.frequency.value=i,n.start(Ze.currentTime),l.gain.setTargetAtTime(0,Ze.currentTime,.3),n.stop(Ze.currentTime+2)}async function Pc(){Fc===null&&await a4();const e=Fc;e.stop(),e.seek(0),e.play()}async function n4(){(await wd()).Howler.stop()}function B0(e,t){if(Ze===void 0&&F0(),!Ze||(Vs=e??Vs,!(Vs in bh)))return;const o=3+(ni||si||fo?1:0),i=bh[Vs]?.(o),n=Ze.createOscillator(),l=Ze.createGain();n.type=t??tm[r.playSoundOnClick],l.gain.value=r.soundVolume/10,n.connect(l),l.connect(Ze.destination),n.frequency.value=i,n.start(Ze.currentTime),l.gain.setTargetAtTime(0,Ze.currentTime,.15),n.stop(Ze.currentTime+.5)}async function Ki(e){if(r.playSoundOnClick==="off")return;if(r.playSoundOnClick in Xu){const{name:i,meta:n}=Xu[r.playSoundOnClick];P0(i,n);return}if(r.playSoundOnClick in tm){B0(e??void 0);return}Vi===null&&await Cd();const t=Vi[r.playSoundOnClick];if(t===void 0)throw new Error("Invalid click sound ID");const a=Ia(t),o=a.sounds[a.counter];a.counter++,a.counter===2&&(a.counter=0),o.seek(0),o.play()}async function kd(){if(r.playSoundOnError==="off")return;zo===null&&await D0();const e=zo[r.playSoundOnError];if(e===void 0)throw new Error("Invalid error sound ID");const t=Ia(e),a=t.sounds[t.counter];t.counter++,t.counter===2&&(t.counter=0),a.seek(0),a.play()}function s4(e){try{Howler.volume(e)}catch{}}Ce(({key:e,newValue:t})=>{e==="playSoundOnClick"&&t!=="off"&&Cd(),e==="soundVolume"&&s4(t)});let am=!1,ss,Ms,Ju,Zu,wr,Cr,ji=!1,R0;function r4(e){R0=e}function W0(){const e={lastResult:R0,start:ss,end:Ms,start3:wr,end3:Cr,afkHistory:jr,errorHistory:Kr,wpmHistory:Xo,rawHistory:Vr,burstHistory:aa,keypressCountHistory:Ni,currentBurstStart:dd,lastSecondNotRound:ji,missedWords:yo,accuracy:ha,keypressTimings:ve,keyOverlap:co,wordsHistory:F.list.slice(0,A.getHistory().length),inputHistory:A.getHistory()};try{e.keypressTimings.spacing.average=ve.spacing.array.reduce((t,a)=>a+=t)/ve.spacing.array.length,e.keypressTimings.spacing.sd=Zs(ve.spacing.array)}catch{}try{e.keypressTimings.duration.average=ve.duration.array.reduce((t,a)=>a+=t)/ve.duration.array.length,e.keypressTimings.duration.sd=Zs(ve.duration.array)}catch{}return e}function l4(){ss=0,Ms=0,am=!1,ji=!1}let om=0,Bc=0,im=[];function nm(){om++}function sm(e){Bc+=e}function rm(e,t){im.push({acc:e,seconds:t})}function z0(){om=0,Bc=0,im=[]}function Ll(){am=!0}function el(e){let t=(Ms-ss)/1e3;return e!==void 0&&(t=(e-ss)/1e3),r.mode==="zen"&&t<0&&(t=0,console.log("Zen mode with negative duration detected, setting to 0")),t}function lm(e,t=!1){const a=el(Me?performance.now():Ms),o=O0(t),i=K((o.correctWordChars+o.correctSpaces)*(60/a)/5),n=K((o.allCorrectChars+o.spaces+o.incorrectChars+o.extraChars)*(60/a)/5);return{wpm:e?i:Math.round(i),raw:e?n:Math.round(n)}}function Ch(e){Ms=e,Zu=Date.now(),Cr=new Date().getTime()}function c4(e){ss=e,Ju=Date.now(),wr=new Date().getTime()}function cm(e){let t=0;return e!==void 0&&(r.mode==="time"?t=Math.round(e)-Ni.length:t=Math.ceil(e)-Ni.length,t<0&&(t=0)),jr.filter(o=>o).length+t}function d4(){ji=!0}function H0(){const e=A.getKoreanStatus(),t=(performance.now()-dd)/1e3;let a;if(a=e?yc.disassemble(A.current).length:A.current.length,a===0&&(a=e?yc.disassemble(A.getHistoryLast())?.length??0:A.getHistoryLast()?.length??0),a===0)return 0;const o=K(a*(60/t)/5);return Math.round(o)}function tl(){const e=ha.correct/(ha.correct+ha.incorrect)*100;return isNaN(e)?100:e}function u4(){const e=el();Ni.splice(e),Xo.splice(e),aa.splice(e),Vr.splice(e)}function f4(){const e=A.getKoreanStatus();let t=[...A.getHistory()];return Me&&t.push(A.current),e&&(t=t.map(a=>yc.disassemble(a).join(""))),t}function p4(){const e=A.getKoreanStatus();let t=[...r.mode==="zen"?A.getHistory():F.list];return Me&&t.push(r.mode==="zen"?A.current:F.getCurrent()),e&&(t=t.map(a=>yc.disassemble(a).join(""))),t}function O0(e=!1){let t=0,a=0,o=0,i=0,n=0,l=0,c=0;const d=f4(),u=p4();for(let m=0;m<d.length;m++){const p=d[m],g=u[m];if(p===g)t+=g.length,a+=g.length,m<d.length-1&&Wy(p)!==`
`&&c++;else if(p.length>=g.length)for(let h=0;h<p.length;h++)h<g.length?p[h]===g[h]?a++:o++:i++;else{const h={correct:0,incorrect:0,missed:0};for(let x=0;x<g.length;x++)x<p.length?p[x]===g[x]?h.correct++:h.incorrect++:h.missed++;a+=h.correct,o+=h.incorrect;const y=r.mode==="time"||r.mode==="custom"&&Hu().mode==="time",k=!e||e&&y;m===d.length-1&&k?h.incorrect===0&&(t+=h.correct):n+=h.missed}m<d.length-1&&l++}return _o("nospace")&&(l=0,c=0),{spaces:l,correctWordChars:t,allCorrectChars:a,incorrectChars:r.mode==="zen"?ha.incorrect:o,extraChars:i,missedChars:n,correctSpaces:c}}function m4(){console.debug("Calculating result stats");let e=el();console.debug("Test seconds",e," (date based) ",(Zu-Ju)/1e3," (performance.now based)",(Cr-wr)/1e3," (new Date based)"),console.debug("Test seconds",Wl(e)," (date based) ",Wl((Zu-Ju)/1e3)," (performance.now based)",Wl((Cr-wr)/1e3)," (new Date based)"),r.mode!=="custom"&&(e=K(e),console.debug("Mode is not custom - rounding to 2. New time: ",e));const t=O0(!0),{wpm:a,raw:o}=lm(!0,!0),i=K(tl()),n={wpm:isNaN(a)?0:a,wpmRaw:isNaN(o)?0:o,acc:i,correctChars:t.correctWordChars,incorrectChars:t.incorrectChars,missedChars:t.missedChars,extraChars:t.extraChars,allChars:t.allCorrectChars+t.spaces+t.incorrectChars+t.extraChars,time:K(e),spaces:t.spaces,correctSpaces:t.correctSpaces};return console.debug("Result stats",n),n}const kt=document.querySelector("#monkey"),Ai=document.querySelector("#monkey .fast");Ce(({key:e})=>{e==="monkey"&&Me&&(r.monkey?kt.classList.remove("hidden"):kt.classList.add("hidden"))});let pa=!1,ma=!1;const pt={left:!1,right:!1,last:"right"},su={"00":kt.querySelector(".up"),"01":kt.querySelector(".right"),10:kt.querySelector(".left"),11:kt.querySelector(".both")},ru={"00":Ai.querySelector(".up"),"01":Ai.querySelector(".right"),10:Ai.querySelector(".left"),11:Ai.querySelector(".both")};function kh(e){return e?"1":"0"}function N0(){if(r.monkey&&!kt?.classList.contains("hidden")){Object.keys(su).forEach(t=>{su[t]?.classList.add("hidden")}),Object.keys(ru).forEach(t=>{ru[t]?.classList.add("hidden")});const e=`${kh(pa)}${kh(ma)}`;su[e]?.classList.remove("hidden"),ru[e]?.classList.remove("hidden")}}function g4(e){if(!r.monkey)return;const t=_u(e,130,180,0,1);O(Ai,{opacity:t,duration:1e3});let a=_u(e,130,180,.25,.01);a===.25&&(a=0),kt.style.animationDuration=a+"s"}function h4(e){if(!r.monkey)return;const{leftSide:t,rightSide:a}=Zp(e.code);t&&a?pt.last==="left"?ma?pa||(pa=!0,pt.last="left",pt.left=!0):(ma=!0,pt.last="right",pt.right=!0):pa?ma||(ma=!0,pt.last="right",pt.right=!0):(pa=!0,pt.last="left",pt.left=!0):(pa=pa||t,ma=ma||a),N0()}function b4(e){if(!r.monkey)return;const{leftSide:t,rightSide:a}=Zp(e.code);t&&a?pt.left&&pt.last==="left"?(pa=!1,pt.left=!1):pt.right&&pt.last==="right"?(ma=!1,pt.right=!1):(pa=pa&&!pt.left,ma=ma&&!pt.right):(pa=pa&&!t,ma=ma&&!a),N0()}function y4(){r.monkey&&(kt.classList.remove("hidden"),O(kt,{opacity:[0,1],duration:125}))}function v4(){O(kt,{opacity:[1,0],duration:125,onComplete:()=>{kt.classList.add("hidden"),kt.style.animationDuration="0s",Ai.style.opacity="0"}})}function w4(){kt.classList.add("hidden"),kt.style.opacity="0",kt.style.animationDuration="0s",Ai.style.opacity="0"}let Rc=!1;function C4(){Rc||(Rc=!0,console.error("Slow timer, disabling animations"))}function Wc(){Rc=!1}function Sd(){return Rc}const U0=V("html"),ef=V("body"),Q={particles:[],rendering:!1},k4=1e3,S4=.05,x4=4,T4=.6,$l=1500,gn=.3,Sh=[6,3],Ml=10;function L4(){const e=document.createElement("canvas");return e.style.cssText="position:fixed;top:0;left:0;pointer-events:none;z-index:999999",e.height=window.innerHeight,e.width=window.innerWidth,window.addEventListener("resize",()=>{e.height=window.innerHeight,e.width=window.innerWidth}),document.body.appendChild(e),e}function $4(e,t,a){return{x:e,y:t,color:a,alpha:1,prev:{x:e,y:t},vel:{x:$l-Math.random()*$l*2,y:$l-Math.random()*$l*2}}}function M4(e){!Q.canvas||!ge(Q.deltaTime)||(e.prev.x=e.x,e.prev.y=e.y,e.x+=e.vel.x*Q.deltaTime,e.y+=e.vel.y*Q.deltaTime,e.x>Q.canvas.width?(e.vel.x*=-gn,e.x=Q.canvas.width-(e.x-Q.canvas.width)*gn):e.x<0&&(e.vel.x*=-gn,e.x*=-gn),e.y>Q.canvas.height?(e.vel.y*=-gn,e.y=Q.canvas.height-(e.y-Q.canvas.height)*gn):e.y<0&&(e.vel.y*=-1,e.y*=-1),e.vel.y+=k4*Q.deltaTime,e.vel.x*=1-S4*Q.deltaTime,e.alpha*=1-T4*Q.deltaTime)}function A4(){Q.caret=V("#caret"),Q.canvas=L4(),Q.context2d=Q.canvas.getContext("2d")}function V0(){if(!ge(Q.lastFrame)||!Q.context2d||!Q.canvas)return;Q.rendering=!0;const e=Date.now();Q.deltaTime=(e-Q.lastFrame)/1e3,Q.lastFrame=e,Q.context2d.clearRect(0,0,Q.canvas.width,Q.canvas.height);const t=[];for(const a of Q.particles)a.alpha<.1||(M4(a),Q.context2d.globalAlpha=a.alpha,Q.context2d.strokeStyle=a.color,Q.context2d.lineWidth=x4,Q.context2d.beginPath(),Q.context2d.moveTo(Math.round(a.prev.x),Math.round(a.prev.y)),Q.context2d.lineTo(Math.round(a.x),Math.round(a.y)),Q.context2d.stroke(),t.push(a));Q.particles=t,Q.particles.length?requestAnimationFrame(V0):(Q.context2d.clearRect(0,0,Q.canvas.width,Q.canvas.height),Q.rendering=!1)}function K0(e=!1){ge(Q.resetTimeOut)&&(delete Q.resetTimeOut,clearTimeout(Q.resetTimeOut),ef.setStyle({transition:"all .25s, transform 0.8s",transform:"translate(0,0)"}),setTimeout(()=>{ef.setStyle({transition:"all .25s, transform .05s"}),U0.setStyle({overflow:"inherit",overflowY:"scroll"})},e?0:1e3))}function _4(){Q.rendering||(Q.lastFrame=Date.now(),V0())}function E4(){const e=Math.floor(Math.random()*256).toString(16),t=Math.floor(Math.random()*256).toString(16),a=Math.floor(Math.random()*256).toString(16);return`#${e}${t}${a}`}async function q4(e=!0,t=!1){r.monkeyPowerLevel==="off"||Sd()||Ae("monkey-power.addPower",async()=>{if(r.blindMode&&(e=!0),["3","4"].includes(r.monkeyPowerLevel)){U0.setStyle({overflow:"hidden"});const i=[Math.round(Ml-Math.random()*Ml),Math.round(Ml-Math.random()*Ml)];ef.setStyle({transform:`translate(${i[0]}px, ${i[1]}px)`}),ge(Q.resetTimeOut)&&clearTimeout(Q.resetTimeOut),Q.resetTimeOut=setTimeout(K0,2e3)}const a=Q.caret?.native.getBoundingClientRect(),o=[a?.left??0,(a?.top??0)+(Q.caret?.native.offsetHeight??0)/2];for(let i=Math.round((Sh[0]+Math.random()*Sh[1])*(t?2:1));i>0;i--){const n=["2","4"].includes(r.monkeyPowerLevel)?E4():e?await Zt("caret"):await Zt("error");Q.particles.push($4(...o,n))}_4()})}function I4(){s("#testConfig").removeClass("invisible"),s("#mobileTestConfigButton").removeClass("invisible")}function D4(){s("#testConfig").addClass("invisible"),s("#mobileTestConfigButton").addClass("invisible")}async function j0(){s("#testConfig .mode .textButton").removeClass("active"),s("#testConfig .mode .textButton[mode='"+r.mode+"']").addClass("active"),s("#testConfig .puncAndNum").addClass("hidden"),s("#testConfig .spacer").addClass("hidden"),s("#testConfig .time").addClass("hidden"),s("#testConfig .wordCount").addClass("hidden"),s("#testConfig .customText").addClass("hidden"),s("#testConfig .quoteLength").addClass("hidden"),s("#testConfig .zen").addClass("hidden"),r.mode==="time"?(s("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),s("#testConfig .leftSpacer").removeClass("hidden"),s("#testConfig .rightSpacer").removeClass("hidden"),s("#testConfig .time").removeClass("hidden"),Bo("time",r.time)):r.mode==="words"?(s("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),s("#testConfig .leftSpacer").removeClass("hidden"),s("#testConfig .rightSpacer").removeClass("hidden"),s("#testConfig .wordCount").removeClass("hidden"),Bo("words",r.words)):r.mode==="quote"?(s("#testConfig .rightSpacer").removeClass("hidden"),s("#testConfig .quoteLength").removeClass("hidden"),Bo("quoteLength",r.quoteLength)):r.mode==="custom"&&(s("#testConfig .puncAndNum").removeClass("hidden").css({width:"",opacity:""}),s("#testConfig .leftSpacer").removeClass("hidden"),s("#testConfig .rightSpacer").removeClass("hidden"),s("#testConfig .customText").removeClass("hidden")),Bo("quoteLength",r.quoteLength),Bo("numbers",r.numbers),Bo("punctuation",r.punctuation)}async function F4(e,t){if(e===t)return;P4(t);let a;r.mode==="time"?a=r.time:r.mode==="words"?a=r.words:r.mode==="quote"&&(a=r.quoteLength),a!==void 0&&Bo(r.mode,a);const o={time:"time",words:"wordCount",custom:"customText",quote:"quoteLength",zen:"zen"},i=Y(250),n=2,l={both:`inOut(${n})`,in:`in(${n})`,out:`out(${n})`},c={time:!0,words:!0,custom:!0,quote:!1,zen:!1},d=s("#testConfig .puncAndNum");if(c[t]!==c[e]){d.css({width:"unset",opacity:1}).removeClass("hidden");const x=Math.round(d[0]?.getBoundingClientRect().width??0);O(d[0],{width:[(c[e]?x:0)+"px",(c[t]?x:0)+"px"],opacity:{duration:i/2,delay:c[t]?i/2:0,from:c[e]?1:0,to:c[t]?1:0},duration:i,ease:l.both,onComplete:()=>{c[t]?d.css("width","unset"):d.addClass("hidden")}});const C=document.querySelector("#testConfig .leftSpacer");C.style.width="0.5em",C.style.opacity="1",C.classList.remove("hidden"),O(C,{width:[c[e]?"0.5em":0,c[t]?"0.5em":0],duration:i,ease:l.both,onComplete:()=>{c[t]?C.style.width="":C.classList.add("hidden")}})}const u=document.querySelector("#testConfig .rightSpacer");u.style.width="0.5em",u.style.opacity="1",u.classList.remove("hidden"),O(u,{width:[e==="zen"?"0px":"0.5em",t==="zen"?"0px":"0.5em"],duration:i,ease:l.both,onComplete:()=>{t==="zen"?u.classList.add("hidden"):u.style.width=""}});const m=s(`#testConfig .${o[t]}`),p=s(`#testConfig .${o[e]}`),g=Math.round(p[0]?.getBoundingClientRect().width??0);p.addClass("hidden"),m.removeClass("hidden");const h=Math.round(m[0]?.getBoundingClientRect().width??0);p.removeClass("hidden"),m.addClass("hidden");const k=(h-g)/2;await gt(p[0],{opacity:[1,0],width:[g+"px",g+k+"px"],duration:i/2,ease:l.in}),p.css({opacity:1,width:"unset"}).addClass("hidden"),m.css({opacity:0,width:g+k+"px"}).removeClass("hidden"),await gt(m[0],{opacity:[0,1],width:[g+k+"px",h+"px"],duration:i/2,ease:l.out})}function P4(e){s("#testConfig .mode .textButton").removeClass("active"),s("#testConfig .mode .textButton[mode='"+e+"']").addClass("active")}function Bo(e,t){if(e==="time"){s("#testConfig .time .textButton").removeClass("active");const a=[15,30,60,120].includes(t)?t:"custom";s("#testConfig .time .textButton[timeConfig='"+a+"']").addClass("active")}else if(e==="words"){s("#testConfig .wordCount .textButton").removeClass("active");const a=[10,25,50,100,200].includes(t)?t:"custom";s("#testConfig .wordCount .textButton[wordCount='"+a+"']").addClass("active")}else e==="quoteLength"?(s("#testConfig .quoteLength .textButton").removeClass("active"),ui(t,[0,1,2,3])?s("#testConfig .quoteLength .textButton[quotelength='all']").addClass("active"):t.forEach(a=>{s("#testConfig .quoteLength .textButton[quoteLength='"+a+"']").addClass("active")})):e==="numbers"?t===!1?s("#testConfig .numbersMode.textButton").removeClass("active"):s("#testConfig .numbersMode.textButton").addClass("active"):e==="punctuation"&&(t===!1?s("#testConfig .punctuationMode.textButton").removeClass("active"):s("#testConfig .punctuationMode.textButton").addClass("active"))}function B4(){s("#testConfig .quoteLength .favorite").removeClass("hidden")}function R4(){s("#testConfig .quoteLength .favorite").addClass("hidden")}let lu=!1;Ce(({key:e,newValue:t,previousValue:a})=>{e==="fullConfigChange"&&(lu=!0),e==="fullConfigChangeFinished"&&(lu=!1,j0()),!lu&&pe()==="test"&&(e==="mode"?F4(a,t):["time","quoteLength","words","numbers","punctuation"].includes(e??"")&&t!==void 0&&Bo(e,t))});Wa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?B4():R4())});const dm=document.getElementById("compositionDisplay");function xd(e){dm.innerText=e}function G0(){dm.classList.add("hidden")}function Q0(){dm.classList.remove("hidden")}const W4=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"}],z4=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"}],H4=[{type:"leaderboard_atf",selectorId:"ad-result-wrapper"},{type:"med_rect_btf",selectorId:"ad-result-small-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-right-wrapper"},{type:"sky_btf",selectorId:"ad-vertical-left-wrapper"},{type:"leaderboard_btf",selectorId:"ad-footer-wrapper"},{type:"med_rect_btf",selectorId:"ad-footer-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-about-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-about-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-2-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-settings-3-wrapper"},{type:"med_rect_btf",selectorId:"ad-settings-3-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-1-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-1-small-wrapper"},{type:"leaderboard_btf",selectorId:"ad-account-2-wrapper"},{type:"med_rect_btf",selectorId:"ad-account-2-small-wrapper"}];let Td=!1;function O4(){const e="1024888",t="74058";window.ramp={que:[],passiveMode:!0,forcePath:"320x50-test",onReady:()=>{Td=!0,Ld()}};const a=document.getElementsByTagName("head")[0],o=document.createElement("script");o.setAttribute("async",!0),o.src=`//cdn.intergient.com/${e}/${t}/ramp.js`,a.appendChild(o),window._pwGA4PageviewId="".concat(Date.now()),window.dataLayer=window.dataLayer||[],window.gtag=window.gtag||function(){dataLayer.push(arguments)},gtag("js",new Date),gtag("config","G-KETCPNHRJF",{send_page_view:!1}),gtag("event","ramp_js",{send_to:"G-KETCPNHRJF",pageview_id:window._pwGA4PageviewId})}function Y0(){let e;r.ads==="result"?e=W4:r.ads==="on"?e=z4:r.ads==="sellout"&&(e=H4);const t=[];for(const a of e){const o=document.querySelector(`#${a.selectorId}`);o&&window.getComputedStyle(o).display!=="none"&&o.offsetParent!==null&&t.push(a)}return t}async function Ld(){if(Td){if(pe()==="test"&&!Ie){ramp.destroyUnits("all");return}await ramp.destroyUnits("all"),await ramp.addUnits(Y0()),await ramp.displayUnits()}}async function N4(){}function U4(){Td&&ramp.destroyUnits("all")}async function V4(){if(!Td)return;const e=Y0();await ramp.addUnits(e),await ramp.displayUnits()}const K4=900;let Al=!0;const j4=1330;let _l=!0,al=!1,$d,kr;function X0(){O4(),setInterval(()=>{Me||N4()},6e4),al=!0}function G4(){tf(),J0(),Q4()}function tf(){L("#ad-footer-wrapper")?.remove(),L("#ad-footer-small-wrapper")?.remove(),L("#ad-about-1-wrapper")?.remove(),L("#ad-about-1-small-wrapper")?.remove(),L("#ad-about-2-wrapper")?.remove(),L("#ad-about-2-small-wrapper")?.remove(),L("#ad-settings-1-wrapper")?.remove(),L("#ad-settings-1-small-wrapper")?.remove(),L("#ad-settings-2-wrapper")?.remove(),L("#ad-settings-2-small-wrapper")?.remove(),L("#ad-settings-3-wrapper")?.remove(),L("#ad-settings-3-small-wrapper")?.remove(),L("#ad-account-1-wrapper")?.remove(),L("#ad-account-1-small-wrapper")?.remove(),L("#ad-account-2-wrapper")?.remove(),L("#ad-account-2-small-wrapper")?.remove()}function J0(){L("#ad-vertical-right-wrapper")?.remove(),L("#ad-vertical-left-wrapper")?.remove()}function Q4(){L("#ad-result-wrapper")?.remove(),L("#ad-result-small-wrapper")?.remove()}function Y4(){}function Z0(e=!1){const t=Al;window.innerWidth>K4?Al=!0:Al=!1,!e&&(r.ads==="off"||!al||t!==Al&&Ld())}function ev(e=!1){const t=_l;window.innerWidth>j4?_l=!0:_l=!1,!e&&(r.ads==="off"||!al||t!==_l&&Ld())}async function um(){return new Promise(e=>{window.ramp===void 0&&($d=!0),e()})}async function fm(){return new Promise(e=>{if(kr===void 0){kr=!1,e();return}e()})}async function X4(){return r.ads==="off"?!1:al?(await um(),await fm(),$d||kr?!1:Ld()):(X0(),!0)}async function J4(){if(r.ads!=="off"){if(al||X0(),await um(),await fm(),$d){L("#ad-result-wrapper .iconAndText .text")?.setHtml(`
    Using an ad blocker? No worries
    <div class="smalltext">
      We understand ads can be annoying
      <br />
      You can
      <i>disable all ads</i>
      in the settings
    </div>
    `);return}if(kr){L("#ad-result-wrapper .iconAndText .text")?.setHtml(`
    Ads not working? Ooops
    <div class="smalltext">
      You may have a cookie popup blocker enabled - ads will not show without your consent
      <br />
      You can also 
      <i>disable all ads</i>
      in the settings if you wish
    </div>
    `);return}V4()}}function zc(e){e?(L("#ad-vertical-left-wrapper")?.removeClass("testPage"),L("#ad-vertical-right-wrapper")?.removeClass("testPage"),L("#ad-footer-wrapper")?.removeClass("testPage"),L("#ad-footer-small-wrapper")?.removeClass("testPage")):(L("#ad-vertical-left-wrapper")?.addClass("testPage"),L("#ad-vertical-right-wrapper")?.addClass("testPage"),L("#ad-footer-wrapper")?.addClass("testPage"),L("#ad-footer-small-wrapper")?.addClass("testPage"))}function Z4(){ramp.showCmpModal()}function e6(){U4()}const t6=Bt(500,Y4),a6=Bt(500,Z0),o6=Bt(500,ev);window.addEventListener("resize",()=>{t6(),a6(),o6()});Ce(({key:e,newValue:t})=>{e==="ads"&&(t==="off"?G4():t==="result"?(tf(),J0()):t==="on"&&tf())});mS(()=>{});Ob(()=>{Z0(!0),ev()});window.onerror=function(e){};let Md=!1,Ad=!1;document.addEventListener("keydown",e=>{e.code==="AltLeft"?Md=!0:e.code==="AltRight"&&(Ad=!0)});document.addEventListener("keyup",e=>{e.code==="AltLeft"?Md=!1:e.code==="AltRight"&&(Ad=!1)});function i6(){Md=!1,Ad=!1}const tv="",mt=V("#keymap"),n6={keymapShowTopRow:!0,type:"matrix",keys:{row1:[],row2:[["s","S"],["t","T"],["p","P"],["h","H"],["*","*"],["f","F"],["p","P"],["l","L"],["t","T"],["d","D"]],row3:[["s","S"],["k","K"],["w","W"],["r","R"],["*","*"],["r","R"],["b","B"],["g","G"],["s","S"],["z","Z"]],row4:[["a","A"],["o","O"],["e","E"],["u","U"]],row5:[]}};function av(e){return e===`
`?null:e===" "?mt.qsa(".keySpace"):e==='"'?mt.qsa(`.keymapKey[data-key*='${e}']`):mt.qsa(`.keymapKey[data-key*="${e}"]`)}function s6(e){r.mode!=="zen"&&Ae("keymap.highlightKey",async()=>{e===""&&(e=" ");try{document.querySelectorAll(".activeKey").forEach(a=>a.classList.remove("activeKey")),r.language.startsWith("korean")&&(e=vc.disassemble(e)[0]??e);const t=av(e);if(t===null||t.length===0)return;t.addClass("activeKey")}catch(t){t instanceof Error&&console.log("could not update highlighted keymap key: "+t.message)}})}async function r6(e,t){e!==void 0&&Ae(`keymap.flashKey.${e}`,async()=>{const a=av(e);if(a===null||a.length===0)return;const o=await pi();try{let i={color:o.bg,backgroundColor:o.sub,borderColor:o.sub};t||r.blindMode?i={color:o.bg,backgroundColor:o.main,borderColor:o.main}:i={color:o.bg,backgroundColor:o.error,borderColor:o.error},O(a.native,{color:[i.color,o.sub],backgroundColor:[i.backgroundColor,o.subAlt],borderColor:[i.borderColor,o.sub],duration:250,easing:"out(5)"})}catch{}})}function l6(){mt.addClass("hidden")}function c6(){mt.removeClass("hidden")}function d6(e){const{layoutData:t,rowId:a,isMatrix:o,showTopRow:i,isSteno:n,isISO:l,layoutNameDisplayString:c,isAlice:d}=e;let{rowKeys:u}=e,m=!1,p="",g="",h="";if(a==="row1"&&(o||r.keymapStyle==="staggered")&&(u=u.slice(1)),a==="row1"&&(!i||n))return"";if((a==="row2"||a==="row3"||a==="row4")&&!o&&!n&&(h+="<div></div>"),a==="row4"&&!l&&!o&&!n&&(h+="<div></div>"),o&&(a!=="row5"&&t.matrixShowRightColumn?h+='<div class="keymapKey"></div>':h+="<div></div>"),a==="row5"){if(n)return"";let y=c.replace(/_/g," "),k="";r.keymapLegendStyle==="blank"&&(k='style="display: none;"');const x=D=>ur(D??[],[" "]);u.length===1&&x(u[0])&&(u[1]=u[0]??[]),u.length===1&&!x(u[0])&&(u[1]=[" "],u.reverse()),u.length>1&&!x(u[0])&&ur(u[0],u[1])&&(u[0]=[" "]);const C=D=>D.some(E=>E!==" ");m=u.some(C),h+="<div></div>";for(let D=0;D<u.length;D++){const E=u[D];let B=E[0];r.keymapLegendStyle==="uppercase"&&(B=B.toUpperCase());const z=E.map(ae=>ae.replace('"',"&quot;"));let H=D<1?"left":"right";m&&!d&&(H=""),D===1&&(h+='<div class="keymapSplitSpacer"></div>',p+="-"),x(z)?(h+=`<div class="keymapKey keySpace layoutIndicator ${H}">
              <div class="letter" ${k}>${y}</div>
            </div>`,p+="3",y=""):(h+=`<div class="keymapKey ${H}">
              <div class="letter">${B}</div>
            </div>`,p+="1")}}else for(let y=0;y<u.length;y++){if(a==="row2"&&y===12||a==="row4"&&o&&l&&y===0)continue;let k=10;if(t.matrixShowRightColumn&&(k=11),a==="row4"&&o&&l&&(k+=1),(r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix")&&y>=k)continue;const x=u[y],C=a==="row3"&&(y===3||y===6);let D=x[0],E="";r.keymapLegendStyle==="blank"?E='style="display: none;"':r.keymapLegendStyle==="uppercase"&&(D=D.toUpperCase());let B="";a==="row1"&&y===0&&!o&&r.keymapStyle!=="staggered"&&(B=" invisible");const z=`<div class="keymapKey${B}" data-key="${x.map(ae=>ae.replace('"',"&quot;")).join(tv)}"><span class="letter" ${E}>${D}</span>${C?"<div class='bump'></div>":""}</div>`;let H="";(r.keymapStyle==="split"||r.keymapStyle==="split_matrix"||r.keymapStyle==="alice"||n)&&(a==="row4"&&n&&(y===0||y===2||y===4)?H+='<div class="keymapSplitSpacer"></div>':a==="row4"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")&&l?y===6&&(H+='<div class="keymapSplitSpacer"></div>'):a==="row1"&&(r.keymapStyle==="split"||r.keymapStyle==="alice")?y===7&&(H+='<div class="keymapSplitSpacer"></div>'):a==="row4"&&o&&l?y===6&&(H+='<div class="keymapSplitSpacer"></div>'):y===5&&(H+='<div class="keymapSplitSpacer"></div>')),r.keymapStyle==="alice"&&a==="row4"&&(l&&y===6||!l&&y===5)&&(H+='<div class="extraKey"><span class="letter"></span></div>'),h+=H+z}if(a==="row5")g+=`<div
          class="row r5"
          data-row5-grid="${p}"
          data-row5-has-alpha="${m}"
        >${h}</div>`;else{const y=parseInt(a.replace("row",""));g+=`<div class="row r${y}">${h}</div>`}return g}async function Hc(){const e=r.keymapLayout==="overrideSync"?r.keymapLayout:r.layout;if(r.keymapMode!=="off"&&pe()==="test"&&e)try{let t=e,a;try{r.keymapLayout==="overrideSync"?r.layout==="default"?(a=await zi("qwerty"),t="default"):(a=await zi(r.layout),t=r.layout):(a=await zi(r.keymapLayout),t=r.keymapLayout)}catch(m){f(se(m,`Failed to load keymap ${e}`),-1);return}const o=Ky&&r.keymapMode==="next"||r.keymapShowTopRow==="always"||a.keymapShowTopRow&&r.keymapShowTopRow!=="never",i=r.keymapStyle==="matrix"||r.keymapStyle==="split_matrix",n=r.keymapStyle==="steno"||r.keymapStyle==="steno_matrix",l=r.keymapStyle==="alice";n&&(a=n6),na().includes("layout_mirror")&&(a=em(a));const d=a.type==="iso";let u="";for(const[m,p]of Object.entries(a.keys))u+=d6({layoutData:a,rowId:m,rowKeys:p,isMatrix:i,showTopRow:o,isSteno:n,isISO:d,layoutNameDisplayString:t,isAlice:l});mt.setHtml(u),mt.removeClass(["staggered","matrix","split","split_matrix","alice","steno","steno_matrix"]),mt.addClass(r.keymapStyle)}catch(t){t instanceof Error&&console.log("something went wrong when changing layout, resettings: "+t.message)}}const u6=k2(),f6=/^[^\p{L}\p{N}]{1}$/u;let cu=[0,0];function p6(){const e=ni||si,t=Md||Ad,o=((u6?e||fo:e!==fo)?1:0)+(t?2:0),i=(e?1:0)+(t?2:0),[n,l]=cu;if(!(n===o&&l===i))return cu=[o,i],cu}async function ov(){const e=p6();if(e===void 0)return;const t=[...document.getElementsByClassName("keymapKey")].filter(d=>{const u=d.classList.contains("keymapKey"),m=!d.classList.contains("keySpace");return u&&m}),a=t.map(d=>d.dataset.key?.split(tv));if(a.includes(void 0))return;const o=t.map(d=>d.childNodes[0]),[i,n]=e,l=r.keymapLayout==="overrideSync"?r.layout==="default"?"qwerty":r.layout:r.keymapLayout,c=await zi(l).catch(()=>{});if(c===void 0){f("Failed to load keymap layout",-1);return}for(let d=0;d<a.length;d++){const u=a[d],m=o[d],p=u[0],g=u[1];if(m===void 0||u===void 0||p===void 0||g===void 0)continue;const h=[p,g].some(E=>f6.test(E??"")),y=E0(p,c);if(y===void 0)return;const C=Yu(y)?h?n:i:0,D=u[C]??u[C-2];m.textContent=D??""}}let du=!1;Ce(({key:e})=>{const t=()=>{mt.qsa(".activeKey").removeClass("activeKey"),mt.qsa(".keymapKey").setAttribute("style",""),r.keymapMode==="off"?l6():c6()},a=()=>{mt.setStyle({zoom:r.keymapSize.toString()})},o=()=>{let i=r.keymapLegendStyle;["lowercase","uppercase","blank","dynamic"].forEach(l=>{mt.qsa(".keymapLegendStyle").removeClass(l)}),i=i||"lowercase",mt.qsa(".keymapKey > .letter").setStyle({display:""}),mt.qsa(".keymapKey > .letter").setStyle({textTransform:""}),i==="uppercase"&&mt.qsa(".keymapKey > .letter").setStyle({textTransform:"capitalize"}),i==="blank"&&mt.qsa(".keymapKey > .letter").setStyle({display:"none"}),mt.qsa(".keymapLegendStyle").addClass(i)};e==="fullConfigChange"&&(du=!0),e==="fullConfigChangeFinished"&&(du=!1,Hc(),t(),a(),o()),!du&&((e==="layout"&&r.keymapLayout==="overrideSync"||e==="keymapLayout"||e==="keymapStyle"||e==="keymapShowTopRow"||e==="keymapMode")&&Hc(),e==="keymapMode"&&t(),e==="keymapSize"&&a(),e==="keymapLegendStyle"&&o())});nx((e,t,a)=>{e==="highlight"&&s6(t),e==="flash"&&r6(t,a)});document.addEventListener("keydown",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&ov()});document.addEventListener("keyup",e=>{r.keymapLegendStyle==="dynamic"&&(e.code==="ShiftLeft"||e.code==="ShiftRight"||e.code==="AltRight"||e.code==="AltLeft")&&ov()});wa.register(yk,vk,wk,Ck,kk,Sk,xk,Tk,Lk,$k,Mk,Ak,_k,Ek);wa.defaults.animation.duration=0;wa.defaults.elements.line.tension=.5;wa.defaults.elements.line.fill="origin";class As extends wa{constructor(t,a){super(t,a)}async updateColors(){await g6(this)}getDataset(t){return this.data.datasets?.find(a=>a.yAxisID===t)}getScaleIds(){return lt(this.options?.scales??{})}getScale(t){return this.options.scales[t]}}let xh;const me=new As(document.querySelector("#wpmChart"),{type:"line",data:{labels:[],datasets:[{clip:!1,label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{clip:!1,label:"raw",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:2,yAxisID:"raw",borderDash:[8,8],order:3,pointRadius:0},{clip:!1,label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}},{clip:!1,label:"burst",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"burst",order:4,pointRadius:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},raw:{axis:"y",display:!1,title:{display:!0,text:"Raw Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},burst:{axis:"y",display:!1,title:{display:!0,text:"Burst Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{axis:"y",display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1,callbacks:{afterLabel:function(e){if(xh===e)return"";xh=e;try{const t=Math.round(parseFloat(e.label))-1,a=Kr[t]?.words,o=[...new Set(a)],i=o[0],n=Nn(o);if(i===void 0||n===void 0)return"";W3(i,n)}catch{}return""}}}}}});let iv;const U=new As(document.querySelector(".pageAccount #accountHistoryChart"),{type:"line",data:{datasets:[{yAxisID:"wpm",data:[],fill:!1,borderWidth:0,order:3},{yAxisID:"pb",data:[],fill:!1,stepped:!0,pointRadius:0,pointHoverRadius:0,order:4},{yAxisID:"acc",fill:!1,data:[],pointStyle:"triangle",borderWidth:0,pointRadius:3.5,order:3},{yAxisID:"wpmAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"accAvgTen",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:2},{yAxisID:"wpmAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1},{yAxisID:"accAvgHundred",label:"accAvgHundred",data:[],fill:!1,pointRadius:0,pointHoverRadius:0,order:1}]},options:{maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",type:"linear",reverse:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpm:{axis:"y",type:"linear",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Words per Minute"},position:"right"},pb:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1},acc:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!0,title:{display:!0,text:"Accuracy"},grid:{display:!1},position:"left"},wpmAvgTen:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgTen:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}},wpmAvgHundred:{axis:"y",beginAtZero:!0,min:0,ticks:{stepSize:10},display:!1,grid:{display:!1}},accAvgHundred:{axis:"y",beginAtZero:!0,min:0,max:100,reverse:!0,ticks:{stepSize:10},display:!1,grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},enabled:!0,intersect:!1,external:function(e){e!==void 0&&(e.tooltip.options.displayColors=!1)},filter:function(e){return e.datasetIndex!==1&&e.datasetIndex!==3&&e.datasetIndex!==4&&e.datasetIndex!==5&&e.datasetIndex!==6},callbacks:{title:function(){return""},beforeLabel:function(e){if(e.datasetIndex!==0){const i=e.dataset.data[e.dataIndex];return`error rate: ${K(i.errorRate)}%
acc: ${K(100-i.errorRate)}%`}const t=e.dataset.data[e.dataIndex];let a=`${r.typingSpeedUnit}: ${t.wpm}
raw: ${t.raw}
acc: ${t.acc}

mode: ${t.mode} `;(t.mode==="time"||t.mode==="words")&&(a+=t.mode2);let o=t.difficulty??"normal";return a+=`
difficulty: ${o}`,a+=`
punctuation: ${t.punctuation}
language: ${t.language}${t.isPb?`

new personal best`:""}

date: ${te(new Date(t.timestamp),"dd MMM yyyy HH:mm")}`,a},label:function(){return""},afterLabel:function(e){return iv=e.dataIndex,""}}}}}}),Ho=new As(document.querySelector(".pageAccount #accountActivityChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Seconds",data:[],trendlineLinear:{style:"rgba(255,105,180, .8)",lineStyle:"dotted",width:2},order:3},{yAxisID:"avgWpm",label:"Average Wpm",data:[],type:"line",order:2,tension:0,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},type:"time",time:{unit:"day",displayFormats:{day:"d MMM"}},bounds:"ticks",display:!0,title:{display:!1,text:"Date"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:1},display:!0,title:{display:!0,text:"Time typing (minutes)"}},avgWpm:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,position:"right",title:{display:!0,text:"Average Wpm"},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index",filter:e=>e.datasetIndex===0,callbacks:{title:function(e){const t=e[0],a=t.dataset.data[t.dataIndex];return te(new Date(a.x),"dd MMM yyyy")},beforeLabel:function(e){const t=e.dataset.data[e.dataIndex],a=bt(r.typingSpeedUnit);return`Time Typing: ${Re(Math.round(t.y*60),!0,!0)}
Tests Completed: ${t.amount}
Restarts per test: ${K((t.restarts??0)/(t.amount??0))}
Highest ${r.typingSpeedUnit.toUpperCase()}: ${K(a.fromWpm(t.maxWpm??0))}
Average ${r.typingSpeedUnit.toUpperCase()}: ${K(a.fromWpm(t.avgWpm??0))}
Average Accuracy: ${K(t.avgAcc??0)}%
Average Consistency: ${K(t.avgCon??0)}%`},label:function(){return""}}}}}}),Wn=new As(document.querySelector(".pageAccount #accountHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Tests",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Tests"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),zn=new As(document.querySelector(".pageAbout #publicStatsHistogramChart"),{type:"bar",data:{labels:[],datasets:[{yAxisID:"count",label:"Users",data:[]}]},options:{responsive:!0,maintainAspectRatio:!1,hover:{mode:"nearest",intersect:!1},scales:{x:{axis:"x",bounds:"ticks",display:!0,title:{display:!1,text:"Bucket"},offset:!0},count:{axis:"y",beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20,stepSize:10},display:!0,title:{display:!0,text:"Users"}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},intersect:!1,mode:"index"}}}}),Yt=new As(document.querySelector("#miniResultChartModal canvas"),{type:"line",data:{labels:[],datasets:[{label:"wpm",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"wpm",order:2,pointRadius:1},{label:"burst",data:[],borderColor:"rgba(125, 125, 125, 1)",borderWidth:3,yAxisID:"burst",order:3,pointRadius:1},{label:"errors",data:[],borderColor:"rgba(255, 125, 125, 1)",pointBackgroundColor:"rgba(255, 125, 125, 1)",borderWidth:2,order:1,yAxisID:"error",type:"scatter",pointStyle:"crossRot",pointRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:3},pointHoverRadius:function(e){const t=e.dataIndex;return(e.dataset.data[t]??0)<=0?0:5}}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{axis:"x",ticks:{autoSkip:!0,autoSkipPadding:20},display:!0,title:{display:!1,text:"Seconds"}},wpm:{axis:"y",display:!0,title:{display:!0,text:"Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!0}},burst:{axis:"y",display:!1,title:{display:!0,text:"Burst Words per Minute"},beginAtZero:!0,min:0,ticks:{autoSkip:!0,autoSkipPadding:20},grid:{display:!1}},error:{display:!0,position:"right",title:{display:!0,text:"Errors"},beginAtZero:!0,ticks:{precision:0,autoSkip:!0,autoSkipPadding:20},grid:{display:!1}}},plugins:{annotation:{annotations:[]},tooltip:{animation:{duration:250},mode:"index",intersect:!1}}}});function m6(){nv(!1),sv(!1),rv(!1),lv(!1)}function _d(e,t){e?L(`.pageAccount ${t}`)?.addClass("active"):L(`.pageAccount ${t}`)?.removeClass("active")}function nv(e=!0){const t=r.accountChart[0]==="on";_d(t,".toggleResultsOnChart"),U.getDataset("wpm").hidden=!t,U.getDataset("pb").hidden=!t,U.getDataset("wpmAvgTen").hidden=!t,U.getDataset("wpmAvgHundred").hidden=!t,U.getScale("wpm").display=t,e&&U.updateColors()}function sv(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on";if(_d(a,".toggleAccuracyOnChart"),U.getDataset("acc").hidden=!a,U.getDataset("accAvgTen").hidden=!a,U.getDataset("accAvgHundred").hidden=!a,U.getScale("acc").display=a,t)U.getScale("acc").min=0,U.getScale("accAvgTen").min=0,U.getScale("accAvgHundred").min=0;else{const o=Math.floor(Math.min(...U.getDataset("acc").data.map(i=>i.y))/5)*5;U.getScale("acc").min=o,U.getScale("accAvgTen").min=o,U.getScale("accAvgHundred").min=o}e&&U.updateColors()}function rv(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on",o=r.accountChart[2]==="on";_d(o,".toggleAverage10OnChart"),a&&(U.getDataset("accAvgTen").hidden=!o),t&&(U.getDataset("wpmAvgTen").hidden=!o),e&&U.updateColors()}function lv(e=!0){const t=r.accountChart[0]==="on",a=r.accountChart[1]==="on",o=r.accountChart[3]==="on";_d(o,".toggleAverage100OnChart"),a&&(U.getDataset("accAvgHundred").hidden=!o),t&&(U.getDataset("wpmAvgHundred").hidden=!o),e&&U.updateColors()}async function g6(e){const t=await Zt("bg"),a=await Zt("sub"),o=await Zt("subAlt"),i=await Zt("main"),n=await Zt("error"),l=await Zt("text"),c=o;for(const g of lt(e.scales)){const h=e.getScale(g);h.grid.color=c,h.grid.tickColor=c,h.grid.borderColor=c,h.ticks.color=a,h.title.color=a}if(e.id===me.id){const g=e,h=g.getDataset("wpm");h.backgroundColor="transparent",h.borderColor=i,h.pointBackgroundColor=i,h.pointBorderColor=i;const y=g.getDataset("raw");y.backgroundColor="transparent",y.borderColor=i+"99",y.pointBackgroundColor=i+"99",y.pointBorderColor=i+"99";const k=g.getDataset("error");k.backgroundColor=n,k.borderColor=n,k.pointBackgroundColor=n,k.pointBorderColor=n;const x=g.getDataset("burst");x.backgroundColor=fa(o,o+"00",.5),x.borderColor=a,x.pointBackgroundColor=a,x.pointBorderColor=a,e.update("resize");return}if(e.id===Yt.id){const g=e,h=g.getDataset("wpm");h.backgroundColor="transparent",h.borderColor=i,h.pointBackgroundColor=i,h.pointBorderColor=i;const y=g.getDataset("error");y.backgroundColor=n,y.borderColor=n,y.pointBackgroundColor=n,y.pointBorderColor=n;const k=g.getDataset("burst");k.backgroundColor=fa(o,o+"00",.75),k.borderColor=a,k.pointBackgroundColor=a,k.pointBorderColor=a,e.update("resize");return}e.data.datasets[0].borderColor=g=>g.raw?.isPb?l:i,e.data.datasets[1]&&(e.data.datasets[1].borderColor=a),e.data.datasets[2]&&(e.data.datasets[2].borderColor=n);const d=e.data.datasets[0];e?.data?.datasets[0]?.type===void 0?e.config.type==="line"?d.pointBackgroundColor=g=>g.raw?.isPb?l:i:e.config.type==="bar"&&(d.backgroundColor=i):e.data.datasets[0].type==="bar"?e.data.datasets[0].backgroundColor=i:e.data.datasets[0].type==="line"&&(d.pointBackgroundColor=i);const u=e.data.datasets[1];u!==void 0&&(u.type===void 0?e.config.type==="line"?u.pointBackgroundColor=a:e.config.type==="bar"&&(u.backgroundColor=a):u?.type==="bar"?u.backgroundColor=a:u.type==="line"&&(u.pointBackgroundColor=a)),e.data.datasets.length===2&&(u.borderColor=()=>a);const m=e.data.datasets[2];if(e.data.datasets.length===7){m.borderColor=()=>a;const g=r.accountChart[2]==="on",h=r.accountChart[3]==="on",y=fa(t,l,.2),k=fa(t,i,.2),x=fa(t,i,.4),C=fa(t,a,.2),D=fa(t,a,.4),[E,B,z,H,ae,xe,Fe]=e.data.datasets;if(E===void 0||B===void 0||z===void 0||H===void 0||ae===void 0||xe===void 0||Fe===void 0)return;g&&h?(E.pointBackgroundColor=k,B.borderColor=y,z.pointBackgroundColor=C,H.borderColor=x,ae.borderColor=D,xe.borderColor=i,Fe.borderColor=a):g&&!h||!g&&h?(B.borderColor=y,E.pointBackgroundColor=x,z.pointBackgroundColor=D,H.borderColor=i,xe.borderColor=i,ae.borderColor=a,Fe.borderColor=a):(B.borderColor=y,E.pointBackgroundColor=i,z.pointBackgroundColor=a)}const p=e.options;Object.keys(p.scales).forEach(g=>{const h=p.scales[g];h.ticks.color=a,h.title.color=a,h.grid.color=c,h.grid.tickColor=c,h.grid.borderColor=c});try{d.trendlineLinear.style=a}catch{}e.options.plugins.annotation.annotations.forEach(g=>{g.id!=="funbox-label"&&(g.borderColor=a),g.label.backgroundColor=a,g.label.color=t}),e.update("none")}function h6(e){wa.defaults.font.family=e.replace(/_/g," ")}function cv(){Nr(),me.updateColors(),U.updateColors(),Wn.updateColors(),zn.updateColors(),Ho.updateColors(),Yt.updateColors()}Ce(({key:e,newValue:t})=>{e==="accountChart"&&pe()==="account"&&(nv(),sv(),rv(),lv()),e==="fontFamily"&&h6(t)});const ht=V(".pageSettings .section[data-config-name='customBackgroundFilter']"),$e={blur:{value:0,default:0},brightness:{value:1,default:1},saturate:{value:1,default:1},opacity:{value:1,default:1}};function b6(){let e="";return Object.keys($e).forEach(t=>{const a=t;$e[a].value!==$e[a].default&&(e+=`${t}(${$e[a].value}${t==="blur"?"rem":""}) `)}),e}function _s(){const t={filter:b6(),width:`calc(100% + ${$e.blur.value*4}rem)`,height:`calc(100% + ${$e.blur.value*4}rem)`,left:`-${$e.blur.value*2}rem`,top:`-${$e.blur.value*2}rem`,position:"absolute"};L(".customBackground img")?.setStyle(t)}function y6(){ht.qs(".blur input")?.setValue($e.blur.value.toString()),ht.qs(".brightness input")?.setValue($e.brightness.value.toString()),ht.qs(".saturate input")?.setValue($e.saturate.value.toString()),ht.qs(".opacity input")?.setValue($e.opacity.value.toString())}function ol(){ht.qs(".blur .value")?.setHtml($e.blur.value.toFixed(1)),ht.qs(".brightness .value")?.setHtml($e.brightness.value.toFixed(1)),ht.qs(".saturate .value")?.setHtml($e.saturate.value.toFixed(1)),ht.qs(".opacity .value")?.setHtml($e.opacity.value.toFixed(1))}function dv(){y6(),ol()}function v6(e){$e.blur.value=e[0],$e.brightness.value=e[1],$e.saturate.value=e[2],$e.opacity.value=e[3],dv()}ht.qs(".blur input")?.on("input",()=>{$e.blur.value=parseFloat(ht.qs(".blur input")?.getValue()??"0"),ol(),_s()});ht.qs(".brightness input")?.on("input",()=>{$e.brightness.value=parseFloat(ht.qs(".brightness input")?.getValue()??"1"),ol(),_s()});ht.qs(".saturate input")?.on("input",()=>{$e.saturate.value=parseFloat(ht.qs(".saturate input")?.getValue()??"1"),ol(),_s()});ht.qs(".opacity input")?.on("input",()=>{$e.opacity.value=parseFloat(ht.qs(".opacity input")?.getValue()??"1"),ol(),_s()});ht.qsa("input")?.on("input",()=>{w6()});const w6=Bt(2e3,async()=>{const e=Object.keys($e).map(t=>$e[t].value);v("customBackgroundFilter",e)});Ce(({key:e,newValue:t})=>{e==="customBackgroundFilter"&&(v6(t),_s())});const af={8008:{bgColor:"#333a45",mainColor:"#f44c7f",subColor:"#939eae",textColor:"#e9ecf0"},9009:{bgColor:"#eeebe2",mainColor:"#080909",subColor:"#99947f",textColor:"#080909"},dark_note:{bgColor:"#1f1f1f",mainColor:"#f2c17b",subColor:"#768f95",textColor:"#d2dff4"},viridescent:{bgColor:"#2c3333",mainColor:"#95d5b2",subColor:"#84a98c",textColor:"#e9f5db"},dark:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},phantom:{bgColor:"#1a1b26",mainColor:"#7aa2f7",subColor:"#414868",textColor:"#c0caf5"},muted:{bgColor:"#525252",mainColor:"#c5b4e3",subColor:"#939eae",textColor:"#b1e4e3"},dark_magic_girl:{bgColor:"#091f2c",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#a288d9"},carbon:{bgColor:"#313131",mainColor:"#f66e0d",subColor:"#616161",textColor:"#f5e6c8"},vesper:{bgColor:"#101010",mainColor:"#ffc799",subColor:"#99ffe4",textColor:"#ffffff"},our_theme:{bgColor:"#ce1226",mainColor:"#fcd116",subColor:"#6d0f19",textColor:"#ffffff"},dots:{bgColor:"#121520",mainColor:"#fff",subColor:"#676e8a",textColor:"#fff"},nautilus:{bgColor:"#132237",mainColor:"#ebb723",subColor:"#0b4c6c",textColor:"#1cbaac"},serika:{bgColor:"#e1e1e3",mainColor:"#e2b714",subColor:"#aaaeb3",textColor:"#323437"},serika_dark:{bgColor:"#323437",mainColor:"#e2b714",subColor:"#646669",textColor:"#d1d0c5"},bushido:{bgColor:"#242933",mainColor:"#ec4c56",subColor:"#596172",textColor:"#f6f0e9"},red_samurai:{bgColor:"#84202c",mainColor:"#c79e6e",subColor:"#55131b",textColor:"#e2dad0"},rgb:{bgColor:"#111",mainColor:"#eee",subColor:"#444",textColor:"#eee"},oblivion:{bgColor:"#313231",mainColor:"#a5a096",subColor:"#5d6263",textColor:"#f7f5f1"},magic_girl:{bgColor:"#ffffff",mainColor:"#f5b1cc",subColor:"#93e8d3",textColor:"#00ac8c"},metropolis:{bgColor:"#0f1f2c",mainColor:"#56c3b7",subColor:"#326984",textColor:"#e4edf1"},mountain:{bgColor:"#0f0f0f",mainColor:"#e7e7e7",subColor:"#4c4c4c",textColor:"#e7e7e7"},laser:{bgColor:"#221b44",mainColor:"#009eaf",subColor:"#b82356",textColor:"#dbe7e8"},retro:{bgColor:"#dad3c1",mainColor:"#1d1b17",subColor:"#918b7d",textColor:"#1d1b17"},dracula:{bgColor:"#282a36",mainColor:"#bd93f9",subColor:"#6272a4",textColor:"#f8f8f2"},nord:{bgColor:"#242933",mainColor:"#88C0D0",subColor:"#2E3440",textColor:"#88C0D0"},mr_sleeves:{bgColor:"#d1d7da",mainColor:"#daa99b",subColor:"#9a9fa1",textColor:"#1d1d1d"},olivia:{bgColor:"#1c1b1d",mainColor:"#deaf9d",subColor:"#4e3e3e",textColor:"#f2efed"},bliss:{bgColor:"#262727",mainColor:"#f0d3c9",subColor:"#665957",textColor:"#fff"},mizu:{bgColor:"#afcbdd",mainColor:"#fcfbf6",subColor:"#85a5bb",textColor:"#1a2633"},metaverse:{bgColor:"#232323",mainColor:"#d82934",subColor:"#5e5e5e",textColor:"#e8e8e8"},shadow:{bgColor:"#000",mainColor:"#eee",subColor:"#444",textColor:"#eee"},mint:{bgColor:"#05385b",mainColor:"#5cdb95",subColor:"#20688a",textColor:"#edf5e1"},miami:{bgColor:"#f35588",mainColor:"#05dfd7",subColor:"#94294c",textColor:"#f0e9ec"},miami_nights:{bgColor:"#18181a",mainColor:"#e4609b",subColor:"#47bac0",textColor:"#fff"},modern_dolch:{bgColor:"#2d2e30",mainColor:"#7eddd3",subColor:"#54585c",textColor:"#e3e6eb"},botanical:{bgColor:"#7b9c98",mainColor:"#eaf1f3",subColor:"#495755",textColor:"#eaf1f3"},bingsu:{bgColor:"#b8a7aa",mainColor:"#83616e",subColor:"#48373d",textColor:"#ebe6ea"},terminal:{bgColor:"#191a1b",mainColor:"#79a617",subColor:"#48494b",textColor:"#e7eae0"},lavender:{bgColor:"#ada6c2",mainColor:"#e4e3e9",subColor:"#e4e3e9",textColor:"#2f2a41"},taro:{bgColor:"#b3baff",mainColor:"#130f1a",subColor:"#6f6c91",textColor:"#130f1a"},striker:{bgColor:"#124883",mainColor:"#d7dcda",subColor:"#0f2d4e",textColor:"#d6dbd9"},gruvbox_dark:{bgColor:"#282828",mainColor:"#d79921",subColor:"#665c54",textColor:"#ebdbb2"},gruvbox_light:{bgColor:"#fbf1c7",mainColor:"#689d6a",subColor:"#a89984",textColor:"#3c3836"},monokai:{bgColor:"#272822",mainColor:"#a6e22e",subColor:"#e6db74",textColor:"#e2e2dc"},sonokai:{bgColor:"#2c2e34",mainColor:"#9ed072",subColor:"#e7c664",textColor:"#e2e2e3"},camping:{bgColor:"#faf1e4",mainColor:"#618c56",subColor:"#c2b8aa",textColor:"#3c403b"},voc:{bgColor:"#190618",mainColor:"#e0caac",subColor:"#4c1e48",textColor:"#eeeae4"},vaporwave:{bgColor:"#a4a7ea",mainColor:"#e368da",subColor:"#7c7faf",textColor:"#f1ebf1"},pulse:{bgColor:"#181818",mainColor:"#17b8bd",subColor:"#53565a",textColor:"#e5f4f4"},matrix:{bgColor:"#000000",mainColor:"#15ff00",subColor:"#006500",textColor:"#d1ffcd"},olive:{bgColor:"#e9e5cc",mainColor:"#92946f",subColor:"#b7b39e",textColor:"#373731"},strawberry:{bgColor:"#f37f83",mainColor:"#fcfcf8",subColor:"#e53c58",textColor:"#fcfcf8"},night_runner:{bgColor:"#212121",mainColor:"#feff04",subColor:"#5c4a9c",textColor:"#e8e8e8"},cyberspace:{bgColor:"#181c18",mainColor:"#00ce7c",subColor:"#9578d3",textColor:"#c2fbe1"},joker:{bgColor:"#1a0e25",mainColor:"#99de1e",subColor:"#7554a3",textColor:"#e9e2f5"},dualshot:{bgColor:"#737373",mainColor:"#212222",subColor:"#aaaaaa",textColor:"#212222"},solarized_dark:{bgColor:"#002b36",mainColor:"#859900",subColor:"#2aa198",textColor:"#268bd2"},solarized_light:{bgColor:"#fdf6e3",mainColor:"#859900",subColor:"#2aa198",textColor:"#181819"},solarized_osaka:{bgColor:"#00141a",mainColor:"#859900",subColor:"#2aa198",textColor:"#b58900"},terra:{bgColor:"#0c100e",mainColor:"#89c559",subColor:"#436029",textColor:"#f0edd1"},red_dragon:{bgColor:"#1a0b0c",mainColor:"#ff3a32",subColor:"#e2a528",textColor:"#4a4d4e"},hammerhead:{bgColor:"#030613",mainColor:"#4fcdb9",subColor:"#213c53",textColor:"#e2f1f5"},future_funk:{bgColor:"#2e1a47",mainColor:"#f7f2ea",subColor:"#c18fff",textColor:"#f7f2ea"},milkshake:{bgColor:"#ffffff",mainColor:"#212b43",subColor:"#62cfe6",textColor:"#212b43"},aether:{bgColor:"#101820",mainColor:"#eedaea",subColor:"#cf6bdd",textColor:"#eedaea"},froyo:{bgColor:"#e1dacb",mainColor:"#7b7d7d",subColor:"#b29c5e",textColor:"#7b7d7d"},retrocast:{bgColor:"#07737a",mainColor:"#88dbdf",subColor:"#f3e03b",textColor:"#ffffff"},luna:{bgColor:"#221c35",mainColor:"#f67599",subColor:"#5a3a7e",textColor:"#ffe3eb"},graen:{bgColor:"#303c36",mainColor:"#a59682",subColor:"#181d1a",textColor:"#a59682"},bento:{bgColor:"#2d394d",mainColor:"#ff7a90",subColor:"#4a768d",textColor:"#fffaf8"},watermelon:{bgColor:"#1f4437",mainColor:"#d6686f",subColor:"#3e7a65",textColor:"#cdc6bc"},menthol:{bgColor:"#00c18c",mainColor:"#ffffff",subColor:"#186544",textColor:"#ffffff"},ishtar:{bgColor:"#202020",mainColor:"#91170c",subColor:"#847869",textColor:"#fae1c3"},mashu:{bgColor:"#2b2b2c",mainColor:"#76689a",subColor:"#d8a0a6",textColor:"#f1e2e4"},deku:{bgColor:"#058b8c",mainColor:"#b63530",subColor:"#255458",textColor:"#f7f2ea"},honey:{bgColor:"#f2aa00",mainColor:"#fff546",subColor:"#a66b00",textColor:"#f3eecb"},shoko:{bgColor:"#ced7e0",mainColor:"#81c4dd",subColor:"#7599b1",textColor:"#3b4c58"},norse:{bgColor:"#242425",mainColor:"#2b5f6d",subColor:"#505b5e",textColor:"#ccc2b1"},matcha_moccha:{bgColor:"#523525",mainColor:"#7ec160",subColor:"#9e6749",textColor:"#ecddcc"},cafe:{bgColor:"#ceb18d",mainColor:"#14120f",subColor:"#d4d2d1",textColor:"#14120f"},alpine:{bgColor:"#6c687f",mainColor:"#ffffff",subColor:"#9994b8",textColor:"#ffffff"},superuser:{bgColor:"#262a33",mainColor:"#43ffaf",subColor:"#526777",textColor:"#e5f7ef"},ms_cupcakes:{bgColor:"#ffffff",mainColor:"#5ed5f3",subColor:"#d64090",textColor:"#0a282f"},dollar:{bgColor:"#e4e4d4",mainColor:"#6b886b",subColor:"#8a9b69",textColor:"#555a56"},lime:{bgColor:"#7c878e",mainColor:"#93c247",subColor:"#4b5257",textColor:"#bfcfdc"},sweden:{bgColor:"#0058a3",mainColor:"#ffcc02",subColor:"#57abdb",textColor:"#ffffff"},wavez:{bgColor:"#1c292f",mainColor:"#6bde3b",subColor:"#1f5e6b",textColor:"#e9efe6"},nebula:{bgColor:"#212135",mainColor:"#be3c88",subColor:"#19b3b8",textColor:"#838686"},lil_dragon:{bgColor:"#ebe1ef",mainColor:"#8a5bd6",subColor:"#a28db8",textColor:"#212b43"},pastel:{bgColor:"#e0b2bd",mainColor:"#fbf4b6",subColor:"#b4e9ff",textColor:"#6d5c6f"},alduin:{bgColor:"#1c1c1c",mainColor:"#dfd7af",subColor:"#444444",textColor:"#f5f3ed"},paper:{bgColor:"#eeeeee",mainColor:"#444444",subColor:"#b2b2b2",textColor:"#444444"},fundamentals:{bgColor:"#727474",mainColor:"#7fa482",subColor:"#cac4be",textColor:"#131313"},drowning:{bgColor:"#191826",mainColor:"#4a6fb5",subColor:"#50688c",textColor:"#9393a7"},iceberg_dark:{bgColor:"#161821",mainColor:"#84a0c6",subColor:"#595e76",textColor:"#c6c8d1"},iceberg_light:{bgColor:"#e8e9ec",mainColor:"#2d539e",subColor:"#adb1c4",textColor:"#33374c"},onedark:{bgColor:"#2f343f",mainColor:"#61afef",subColor:"#eceff4",textColor:"#98c379"},darling:{bgColor:"#fec8cd",mainColor:"#ffffff",subColor:"#a30000",textColor:"#ffffff"},repose_dark:{bgColor:"#2f3338",mainColor:"#d6d2bc",subColor:"#8f8e84",textColor:"#d6d2bc"},repose_light:{bgColor:"#efead0",mainColor:"#5f605e",subColor:"#8f8e84",textColor:"#333538"},horizon:{bgColor:"#1c1e26",mainColor:"#c4a88a",subColor:"#db886f",textColor:"#bbbbbb"},rudy:{bgColor:"#1a2b3e",mainColor:"#af8f5c",subColor:"#3a506c",textColor:"#c9c8bf"},stealth:{bgColor:"#010203",mainColor:"#383e42",subColor:"#5e676e",textColor:"#383e42"},"80s_after_dark":{bgColor:"#1b1d36",mainColor:"#fca6d1",subColor:"#99d6ea",textColor:"#e1e7ec"},arch:{bgColor:"#0c0d11",mainColor:"#7ebab5",subColor:"#454864",textColor:"#f6f5f5"},rose_pine:{bgColor:"#1f1d27",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_moon:{bgColor:"#2a273f",mainColor:"#9ccfd8",subColor:"#c4a7e7",textColor:"#e0def4"},rose_pine_dawn:{bgColor:"#fffaf3",mainColor:"#56949f",subColor:"#c4a7e7",textColor:"#286983"},copper:{bgColor:"#442f29",mainColor:"#b46a55",subColor:"#7ebab5",textColor:"#e7e0de"},grand_prix:{bgColor:"#36475c",mainColor:"#c0d036",subColor:"#5c6c80",textColor:"#c1c7d7"},peaches:{bgColor:"#e0d7c1",mainColor:"#dd7a5f",subColor:"#e7b28e",textColor:"#5f4c41"},bouquet:{bgColor:"#173f35",mainColor:"#eaa09c",subColor:"#408e7b",textColor:"#e9e0d2"},midnight:{bgColor:"#0b0e13",mainColor:"#60759f",subColor:"#394760",textColor:"#9fadc6"},blueberry_light:{bgColor:"#dae0f5",mainColor:"#506477",subColor:"#92a4be",textColor:"#678198"},blueberry_dark:{bgColor:"#212b42",mainColor:"#add7ff",subColor:"#5c7da5",textColor:"#91b4d5"},fledgling:{bgColor:"#3b363f",mainColor:"#fc6e83",subColor:"#8e5568",textColor:"#e6d5d3"},ez_mode:{bgColor:"#0068c6",mainColor:"#fa62d5",subColor:"#138bf7",textColor:"#ffffff"},vscode:{bgColor:"#1e1e1e",mainColor:"#007acc",subColor:"#4d4d4d",textColor:"#d4d4d4"},material:{bgColor:"#263238",mainColor:"#80cbc4",subColor:"#4c6772",textColor:"#e6edf3"},godspeed:{bgColor:"#eae4cf",mainColor:"#9abbcd",subColor:"#ada998",textColor:"#646669"},witch_girl:{bgColor:"#f3dbda",mainColor:"#56786a",subColor:"#ddb4a7",textColor:"#56786a"},terror_below:{bgColor:"#0b1e1a",mainColor:"#66ac92",subColor:"#015c53",textColor:"#dceae5"},sewing_tin:{bgColor:"#241963",mainColor:"#f2ce83",subColor:"#446ad5",textColor:"#ffffff"},soaring_skies:{bgColor:"#fff9f2",mainColor:"#55c6f0",subColor:"#1e107a",textColor:"#1d1e1e"},sewing_tin_light:{bgColor:"#ffffff",mainColor:"#2d2076",subColor:"#385eca",textColor:"#2d2076"},chaos_theory:{bgColor:"#141221",mainColor:"#fd77d7",subColor:"#676e8a",textColor:"#dde5ed"},hanok:{bgColor:"#d8d2c3",mainColor:"#513a2a",subColor:"#8b6f5c",textColor:"#393b3b"},comfy:{bgColor:"#4a5b6e",mainColor:"#f8cdc6",subColor:"#9ec1cc",textColor:"#f5efee"},tiramisu:{bgColor:"#cfc6b9",mainColor:"#c0976f",subColor:"#c0976f",textColor:"#7d5448"},diner:{bgColor:"#537997",mainColor:"#c3af5b",subColor:"#445c7f",textColor:"#dfdbc8"},modern_ink:{bgColor:"#ffffff",mainColor:"#ff360d",subColor:"#b7b7b7",textColor:"#000000"},dev:{bgColor:"#1b2028",mainColor:"#23a9d5",subColor:"#4b5975",textColor:"#ccccb5"},moonlight:{bgColor:"#191f28",mainColor:"#c69f68",subColor:"#4b5975",textColor:"#ccccb5"},pink_lemonade:{bgColor:"#f6d992",mainColor:"#f6a192",subColor:"#f6b092",textColor:"#fcfcf8"},creamsicle:{bgColor:"#ff9869",mainColor:"#fcfcf8",subColor:"#ff661f",textColor:"#fcfcf8"},beach:{bgColor:"#ffeead",mainColor:"#96ceb4",subColor:"#ffcc5c",textColor:"#5b7869"},desert_oasis:{bgColor:"#fff2d5",mainColor:"#d19d01",subColor:"#0061fe",textColor:"#332800"},frozen_llama:{bgColor:"#9bf2ea",mainColor:"#6d44a6",subColor:"#b690fd",textColor:"#ffffff"},ryujinscales:{bgColor:"#081426",mainColor:"#f17754",subColor:"#ffbc90",textColor:"#ffe4bc"},trackday:{bgColor:"#464d66",mainColor:"#e0513e",subColor:"#5c7eb9",textColor:"#cfcfcf"},fruit_chew:{bgColor:"#d6d3d6",mainColor:"#5c1e5f",subColor:"#b49cb5",textColor:"#282528"},evil_eye:{bgColor:"#0084c2",mainColor:"#f7f2ea",subColor:"#01589f",textColor:"#171718"},trance:{bgColor:"#00021b",mainColor:"#e51376",subColor:"#3c4c79",textColor:"#fff"},fire:{bgColor:"#0f0000",mainColor:"#b31313",subColor:"#683434",textColor:"#ffffff"},aurora:{bgColor:"#011926",mainColor:"#00e980",subColor:"#245c69",textColor:"#fff"},leather:{bgColor:"#a86948",mainColor:"#ffe4bc",subColor:"#81482b",textColor:"#ffe4bc"},fleuriste:{bgColor:"#c6b294",mainColor:"#405a52",subColor:"#64374d",textColor:"#091914"},dmg:{bgColor:"#dadbdc",mainColor:"#ae185e",subColor:"#3846b1",textColor:"#414141"},catppuccin:{bgColor:"#1e1e2e",mainColor:"#cba6f7",subColor:"#7f849c",textColor:"#cdd6f4"},snes:{bgColor:"#bfbec2",mainColor:"#553d94",subColor:"#9f8ad4",textColor:"#2e2e2e"},passion_fruit:{bgColor:"#7c2142",mainColor:"#f4a3b4",subColor:"#9994b8",textColor:"#ffffff"},blue_dolphin:{bgColor:"#003950",mainColor:"#ffcefb",subColor:"#00e4ff",textColor:"#82eaff"},mexican:{bgColor:"#f8ad34",mainColor:"#b12189",subColor:"#333",textColor:"#eee"},husqy:{bgColor:"#000000",mainColor:"#c58aff",subColor:"#972fff",textColor:"#ebd7ff"},peach_blossom:{bgColor:"#292929",mainColor:"#99b898",subColor:"#616161",textColor:"#fecea8"},dino:{bgColor:"#ffffff",mainColor:"#40d672",subColor:"#d5d5d5",textColor:"#1d221f"},tron_orange:{bgColor:"#0d1c1c",mainColor:"#f0e800",subColor:"#ff6600",textColor:"#ffffff"},hedge:{bgColor:"#415e31",mainColor:"#6a994e",subColor:"#ede5b4",textColor:"#f7f1d6"},modern_dolch_light:{bgColor:"#dbdbdb",mainColor:"#8fd1c3",subColor:"#acacac",textColor:"#454545"},iv_spade:{bgColor:"#0c0c0c",mainColor:"#b7976a",subColor:"#404040",textColor:"#d3c2c3"},iv_clover:{bgColor:"#a0a0a0",mainColor:"#573e40",subColor:"#353535",textColor:"#3b2d3b"},cheesecake:{bgColor:"#fdf0d5",mainColor:"#8e2949",subColor:"#d91c81",textColor:"#3a3335"},earthsong:{bgColor:"#292521",mainColor:"#509452",subColor:"#f5ae2d",textColor:"#e6c7a8"},purpleish:{bgColor:"#1e1e32",mainColor:"#7a52cc",subColor:"#3d3d66",textColor:"#7a52cc"},nord_light:{bgColor:"#eceff4",mainColor:"#8fbcbb",subColor:"#6a7791",textColor:"#8fbcbb"},slambook:{bgColor:"#FFFDDE",mainColor:"#13005A",subColor:"#1c82adc4",textColor:"#125d98"},breeze:{bgColor:"#e8d5c4",mainColor:"#7d67a9",subColor:"#3a98b9",textColor:"#1b4c5e"},cherry_blossom:{bgColor:"#323437",mainColor:"#d65ccc",subColor:"#787d82",textColor:"#d1d0c5"},everblush:{bgColor:"#141b1e",mainColor:"#8ccf7e",subColor:"#838887",textColor:"#dadada"},grape:{bgColor:"#2c003e",mainColor:"#ff8f00",subColor:"#651e56",textColor:"#fff"},rainbow_trail:{bgColor:"#f5f5f5",mainColor:"#363636",subColor:"#4f4f4f",textColor:"#1f1f1f"},tangerine:{bgColor:"#ffede0",mainColor:"#fe5503",subColor:"#ff9562",textColor:"#3d1705"},macroblank:{bgColor:"#b2d2c8",mainColor:"#c13117",subColor:"#717977",textColor:"#490909"},anti_hero:{bgColor:"#00002e",mainColor:"#ffadad",subColor:"#ff3d8b",textColor:"#f1deef"},incognito:{bgColor:"#0e0e0e",mainColor:"#ff9900",subColor:"#2f2f2f",textColor:"#c6c6c6"},discord:{bgColor:"#313338",mainColor:"#5a65ea",subColor:"#565861",textColor:"#dcdee3"},cy_red:{bgColor:"#6e2626",mainColor:"#e55050",subColor:"#ff6060",textColor:"#ffaaaa"},floret:{bgColor:"#00272c",mainColor:" #ffdd6d",subColor:"#779097",textColor:"#E5E5E5"},lilac_mist:{bgColor:"#fffbfe",mainColor:"#b94189",subColor:"#e094c2",textColor:"#5c2954"},terrazzo:{bgColor:"#f1e5da",mainColor:"#e0794e",subColor:"#688e8f",textColor:"#023e3b"},suisei:{bgColor:"#3b4a62",mainColor:"#bef0ff",subColor:"#fe9841",textColor:"#dbdeeb"},github:{bgColor:"#212830",mainColor:"#41ce5c",subColor:"#788386",textColor:"#ccdae6"},sunset:{bgColor:"#211e24",mainColor:"#f79777",subColor:"#5b578e",textColor:"#f4e0c9"},vesper_light:{bgColor:"#ffffff",mainColor:"#fb7100",subColor:"#067a6e",textColor:"#000000"},pale_nimbus:{bgColor:"#433e4c",mainColor:"#94ffc2",subColor:"#ffaca3",textColor:"#feffdb"},spiderman:{bgColor:"#0d1219",mainColor:"#e23636",subColor:"#0476f2",textColor:"#f0f0f0"}},il=Object.keys(af).sort().map(e=>({...af[e],name:e})),C6=[...il.sort((e,t)=>{const a=_c(e.bgColor);return _c(t.bgColor).lgt-a.lgt})];class k6{constructor(t="file-storage-db"){this.dbPromise=qk(t,1,{upgrade(a){a.objectStoreNames.contains("files")||a.createObjectStore("files")}})}async storeFile(t,a){await(await this.dbPromise).put("files",a,t)}async getFile(t){return(await this.dbPromise).get("files",t)}async deleteFile(t){await(await this.dbPromise).delete("files",t)}async listFilenames(){return(await this.dbPromise).getAllKeys("files")}async hasFile(t){return await this.getFile(t)!==void 0}}const it=new k6;let je=null,of=!1,Si=0;const To=["--bg-color","--main-color","--caret-color","--sub-color","--sub-alt-color","--text-color","--error-color","--error-extra-color","--colorful-error-color","--colorful-error-extra-color"];async function S6(){setTimeout(async()=>{let e,t;t=await Zt("bg"),e=await Zt("main"),t===e&&(t="#111",e="#eee");const a=`
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
  <style>
    #bg{fill:${t};}
    path{fill:${e};}
  </style>
  <g>
    <path id="bg" d="M0 16Q0 0 16 0h32q16 0 16 16v32q0 16-16 16H16Q0 64 0 48"/>
    <path d="M9.09 24.1v21.2h5.12V33.1q.256-4.61 4.48-4.61 3.46.384 3.46 3.84v12.9h5.12v-11.5q-.128-5.25 4.48-5.25 3.46.384 3.46 3.84v12.9h5.12v-12.2q0-9.47-7.04-9.47-4.22 0-7.04 3.46-2.18-3.46-6.02-3.46-3.46 0-6.02 2.43v-2.05M47 18.9v5.12h-4.61v5.12H47v16.1h5.12v-16.1h4.61v-5.12h-4.61V18.9"/>
  </g>
</svg>`;L("#favicon")?.setAttribute("href","data:image/svg+xml;base64,"+btoa(a))},125)}function x6(){console.debug("Theme controller clearing custom theme");for(const e of To)document.documentElement.style.setProperty(e,"")}let Ws=[];async function uv(e){return new Promise(t=>{function a(){console.debug("Theme controller swapping elements");const n=L("#currentTheme"),l=L("#nextTheme");if(n===null||l===null){console.debug("Theme controller failed to swap elements, next or current is missing");return}n.remove(),l.setAttribute("id","currentTheme")}console.debug("Theme controller loading style",e),Ws.push(setTimeout(()=>{oe()},100)),L("#nextTheme")?.remove();const o=document.querySelector("#currentTheme"),i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.id="nextTheme",i.onload=()=>{console.debug("Theme controller loaded style",e),j(),a(),Ws.map(n=>clearTimeout(n)),Ws=[],Za("#keymap .keymapKey")?.setStyle({}),t()},i.onerror=n=>{console.debug("Theme controller failed to load style",e,n),console.error(`Failed to load theme ${e}`,n),j(),f("Failed to load theme",0),a(),Ws.map(l=>clearTimeout(l)),Ws=[],Za("#keymap .keymapKey")?.setStyle({}),t()},e==="custom"?i.href="/themes/serika_dark.css":i.href=`/themes/${e}.css`,o===null?(console.debug("Theme controller appending link to the head",i),document.head.appendChild(i)):(console.debug("Theme controller inserting link after current theme",i),o.after(i))})}async function Ko(e,t,a=!1){console.debug("Theme controller applying theme",e,t,a);const o=t?"custom":e;if(r.customTheme&&!a||t){const n=t??r.customThemeColors;for(let l=0;l<To.length;l++){const c=To[l];document.documentElement.style.setProperty(c,n[l])}}A5(),Za("#keymap .keymapKey")?.setStyle({}),await uv(o),o!=="custom"&&x6(),Nr();const i=await pi();Za("#keymap .keymapKey")?.setStyle({}),cv(),S6(),L("#metaThemeColor")?.setAttribute("content",i.bg),fv(a?e:void 0),Up(await Zt("bg"))?L("body")?.addClass("darkMode"):L("body")?.removeClass("darkMode")}function fv(e){const t=document.querySelector("footer .right .current-theme"),a=t?.querySelector(".text"),o=t?.querySelector(".favIndicator");if(!(t instanceof HTMLElement)||!(a instanceof HTMLElement)||!(o instanceof HTMLElement))return;let i=r.theme;if(je!==null&&(i=je),r.customTheme&&(i="custom"),e!==void 0&&e!==""&&(i=e),i=i.replace(/_/g," "),a.innerText=i,r.customTheme){o.style.display="none";return}o.style.display="";const l=e??je??r.theme;l!==null&&r.favThemes.includes(l)?o.style.display="block":o.style.display="none"}let or=null;function pm(e,t){or={theme:e,colors:t},T6()}const T6=Bt(250,()=>{or&&(of=!0,Ko(or.theme,or.colors,!0))});async function At(e,t=!1){console.debug("Theme controller setting theme",e,t),await Ko(e,void 0,t),!t&&r.autoSwitchTheme&&(v("autoSwitchTheme",!1),f("Auto switch theme disabled",0))}async function Sr(e=!0){or=null,of&&(of=!1,e&&(je!==null?await Ko(je):r.customTheme?await Ko("custom"):await Ko(r.theme)))}let Jt=[];async function pv(){const e=il;r.randomTheme==="fav"&&r.favThemes.length>0?Jt=r.favThemes:r.randomTheme==="light"?Jt=e.filter(t=>f0(t.bgColor)).map(t=>t.name):r.randomTheme==="dark"?Jt=e.filter(t=>Up(t.bgColor)).map(t=>t.name):r.randomTheme==="on"||r.randomTheme==="auto"?Jt=e.map(t=>t.name):r.randomTheme==="custom"&&S()&&(Jt=S()?.customThemes?.map(t=>t._id)??[]),Un(Jt),Si=0}async function mv(){if(Jt.length===0&&(await pv(),Jt.length===0))return;let e=o=>!0;r.randomTheme==="auto"&&(e=Yl()?Up:f0);let t=null;do je=Jt[Si],t=af[Jt[Si]],Si++,Si>=Jt.length&&(Un(Jt),Si=0);while(!e(t.bgColor));let a;if(r.randomTheme==="custom"&&(a=S()?.customThemes?.find(i=>i._id===je)?.colors,je="custom"),v("customTheme",!1,{nosave:!0}),await Ko(je,a),Si>=Jt.length){let o=je.replace(/_/g," ");r.randomTheme==="custom"&&(o=(S()?.customThemes?.find(i=>i._id===je)?.name??"custom").replace(/_/g," ")),f(o,0)}}async function uu(){je!==null&&(je=null,r.customTheme?await Ko("custom"):await Ko(r.theme))}function gv(){r.customBackgroundSize==="max"?L(".customBackground img")?.setStyle({objectFit:""}):L(".customBackground img")?.setStyle({objectFit:r.customBackgroundSize})}async function rs(){let e=r.customBackground;L(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']")?.setValue(e);const t=await it.getFile("LocalBackgroundFile");if(t!==void 0&&(e=t),L(".pageSettings .section[data-config-name='customBackgroundFilter']")?.addClass("hidden"),e==="")L("#words")?.removeClass("noErrorBorder"),L("#resultWordsHistory")?.removeClass("noErrorBorder"),L(".customBackground img")?.remove();else{L("#words")?.addClass("noErrorBorder"),L("#resultWordsHistory")?.addClass("noErrorBorder");const a=document.querySelector(".customBackground"),o=document.createElement("img");o.setAttribute("src",e),o.setAttribute("onError","javascript:this.style.display='none'; window.dispatchEvent(new Event('customBackgroundFailed'))"),o.onload=()=>{L(".pageSettings .section[data-config-name='customBackgroundFilter']")?.removeClass("hidden")},a?.replaceChildren(o),_s(),gv()}}async function xr(){let e=r.fontFamily.replace(/_/g," ");const t=await it.getFile("LocalFontFamilyFile");t===void 0?L(".customFont")?.empty():(e="LOCALCUSTOM",L(".customFont")?.setHtml(`
      @font-face{ 
        font-family: LOCALCUSTOM;
        src: url(${t});
        font-weight: 400;
        font-style: normal;
        font-display: block;
      }`)),document.documentElement.style.setProperty("--font",`"${e}", "Roboto Mono", "Vazirmatn", monospace`)}window.matchMedia?.("(prefers-color-scheme: dark)")?.addEventListener?.("change",e=>{!r.autoSwitchTheme||r.customTheme||(e.matches?At(r.themeDark,!0):At(r.themeLight,!0))});let fu=!1;Ce(async({key:e,newValue:t,nosave:a})=>{e==="fullConfigChange"&&(fu=!0),e==="fullConfigChangeFinished"&&(fu=!1,await uu(),await Sr(!1),r.autoSwitchTheme?Yl()?await At(r.themeDark,!0):await At(r.themeLight,!0):r.customTheme?await At("custom"):await At(r.theme),await rs()),!fu&&(e==="randomTheme"&&pv(),e==="customTheme"&&(t?await At("custom"):await At(r.theme)),e==="customThemeColors"&&(a?pm("custom"):await At("custom")),e==="theme"&&(await uu(),await Sr(!1),await At(t)),e==="randomTheme"&&t==="off"&&await uu(),e==="customBackground"&&await rs(),e==="customBackgroundSize"&&gv(),e==="autoSwitchTheme"&&(t?Yl()?await At(r.themeDark,!0):await At(r.themeLight,!0):await At(r.theme)),e==="themeLight"&&r.autoSwitchTheme&&!Yl()&&!a&&await At(r.themeLight,!0),e==="themeDark"&&r.autoSwitchTheme&&window.matchMedia!==void 0&&window.matchMedia("(prefers-color-scheme: dark)").matches&&!a&&await At(r.themeDark,!0),["theme","customTheme","customThemeColors","randomTheme","favThemes"].includes(e)&&fv())});window.addEventListener("customBackgroundFailed",()=>{f("Custom background link is either temporarily unavailable or expired. Please make sure the URL is correct or change it",0,{duration:5})});function Yl(){return window.matchMedia?.("(prefers-color-scheme: dark)").matches}let hv=0,bv=0;async function L6(){const e=di(r,be),[t,a]=(await $y(r.mode,e,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode)).map(K);hv=r.alwaysShowDecimalPlaces?t:Math.round(t),bv=r.alwaysShowDecimalPlaces?a:Math.floor(a)}function $6(){return hv}function M6(){return bv}let yv="",vv=!1;function mm(){return yv}function to(){return vv}function ri(e,t){yv=e,vv=t}Ce(({key:e})=>{["difficulty","blindMode","stopOnError","paceCaret","minWpm","minWpmCustomSpeed","minAcc","minAccCustom","minBurst","confidenceMode","layout","showAverage","showPb","typingSpeedUnit","quickRestart","customPolyglot","alwaysShowDecimalPlaces"].includes(e)&&sa()});const ye=V(".pageTest #testModesNotice");async function sa(){ye.empty(),Aa&&r.mode!=="quote"&&ye.appendHtml('<div class="textButton noInteraction" style="color:var(--error-color);"><i class="fas fa-sync-alt"></i>repeated</div>'),Or||ye.appendHtml('<div class="textButton" commands="resultSaving" style="color:var(--error-color);"><i class="fas fa-save"></i>saving disabled</div>'),Wi&&(r.quickRestart==="esc"&&(ye.appendHtml('<div class="textButton noInteraction"><i class="fas fa-long-arrow-alt-right"></i>shift + tab to open commandline</div>'),ye.appendHtml('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + esc to restart</div>')),r.quickRestart==="tab"&&ye.appendHtml('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + tab to restart</div>')),(Xn||r.funbox.includes("58008"))&&r.quickRestart==="enter"&&ye.appendHtml('<div class="textButton noInteraction"><i class="fas fa-level-down-alt fa-rotate-90"></i>shift + enter to restart</div>');const e=mm(),t=to();r.mode==="custom"&&e!==""&&t&&ye.appendHtml(`<div class="textButton noInteraction"><i class="fas fa-book"></i>${at(e)} (shift + enter to save progress)</div>`),Ot&&ye.appendHtml(`<div class="textButton noInteraction"><i class="fas fa-award"></i>${Ot.display}</div>`),r.mode==="zen"&&ye.appendHtml('<div class="textButton noInteraction"><i class="fas fa-poll"></i>shift + enter to finish zen </div>');const a=na().includes("polyglot");if(r.mode!=="zen"&&!a&&ye.appendHtml(`<button class="textButton" commands="languages"><i class="fas fa-globe-americas"></i>${Ra(r.language,r.mode==="quote")}</button>`),a){const i=r.customPolyglot.map(n=>Ra(n,!0)).join(", ");ye.appendHtml(`<button class="textButton" commandId="setCustomPolyglotCustom"><i class="fas fa-globe-americas"></i>${i}</button>`)}if(r.difficulty==="expert"?ye.appendHtml('<button class="textButton" commands="difficulty"><i class="fas fa-star-half-alt"></i>expert</button>'):r.difficulty==="master"&&ye.appendHtml('<button class="textButton" commands="difficulty"><i class="fas fa-star"></i>master</button>'),r.blindMode&&ye.appendHtml('<button class="textButton" commands="blindMode"><i class="fas fa-eye-slash"></i>blind</button>'),r.lazyMode&&ye.appendHtml('<button class="textButton" commands="lazyMode"><i class="fas fa-couch"></i>lazy</button>'),r.paceCaret!=="off"||r.repeatedPace&&Oi){const i=W.typingSpeed(Z?.wpm??0,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`});ye.appendHtml(`<button class="textButton" commands="paceCaretMode"><i class="fas fa-tachometer-alt"></i>${r.paceCaret==="average"?"average":r.paceCaret==="pb"?"pb":r.paceCaret==="tagPb"?"tag pb":r.paceCaret==="last"?"last":r.paceCaret==="daily"?"daily":"custom"} pace ${i}</button>`)}if(r.showAverage!=="off"){const i=$6(),n=M6();if(_()&&i>0){const l=["speed","both"].includes(r.showAverage)?W.typingSpeed(i,{suffix:` ${r.typingSpeedUnit}`}):"",c=["acc","both"].includes(r.showAverage)?W.accuracy(n,{suffix:" acc"}):"",d=`${l} ${c}`.trim();ye.appendHtml(`<button class="textButton" commands="showAverage"><i class="fas fa-chart-bar"></i>avg: ${d}</button>`)}}if(r.showPb){if(!_())return;const i=di(r,be),n=await Gn(r.mode,i,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,no());let l="no pb";n!==void 0&&(l=`${W.typingSpeed(n.wpm,{showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`})} ${n?.acc}% acc`),ye.appendHtml(`<button class="textButton" commands="showPb"><i class="fas fa-crown"></i>${l}</button>`)}r.minWpm!=="off"&&ye.appendHtml(`<button class="textButton" commands="minWpm"><i class="fas fa-bomb"></i>min ${W.typingSpeed(r.minWpmCustomSpeed,{showDecimalPlaces:!1,suffix:` ${r.typingSpeedUnit}`})}</button>`),r.minAcc!=="off"&&ye.appendHtml(`<button class="textButton" commands="minAcc"><i class="fas fa-bomb"></i>min ${r.minAccCustom}% acc</button>`),r.minBurst!=="off"&&ye.appendHtml(`<button class="textButton" commands="minBurst"><i class="fas fa-bomb"></i>min ${W.typingSpeed(r.minBurstCustomSpeed,{showDecimalPlaces:!1})} ${r.typingSpeedUnit} burst ${r.minBurst==="flex"?"(flex)":""}</button>`),r.funbox.length>0&&ye.appendHtml(`<button class="textButton" commands="funbox"><i class="fas fa-gamepad"></i>${r.funbox.map(i=>i.replace(/_/g," ")).join(", ")}</button>`),r.confidenceMode==="on"&&ye.appendHtml('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>confidence</button>'),r.confidenceMode==="max"&&ye.appendHtml('<button class="textButton" commands="confidenceMode"><i class="fas fa-backspace"></i>max confidence</button>'),r.stopOnError!=="off"&&ye.appendHtml(`<button class="textButton" commands="stopOnError"><i class="fas fa-hand-paper"></i>stop on ${r.stopOnError}</button>`),r.layout!=="default"&&ye.appendHtml(`<button class="textButton" commands="layouts"><i class="fas fa-keyboard"></i>emulating ${r.layout.replace(/_/g," ")}</button>`),r.oppositeShiftMode!=="off"&&ye.appendHtml(`<button class="textButton" commands="oppositeShiftMode"><i class="fas fa-exchange-alt"></i>opposite shift${r.oppositeShiftMode==="keymap"?" (keymap)":""}</button>`);let o="";try{S()?.tags?.forEach(i=>{i.active===!0&&(o+=i.display+", ")}),o!==""&&ye.appendHtml(`<button class="textButton" commands="tags"><i class="fas fa-tag"></i>${o.substring(0,o.length-2)}</button>`)}catch{}}const Ed=S2(A6,{rejectSkippedCalls:!1}),ee=document.querySelector(".pageTest #words"),st=document.querySelector(".pageTest #wordsWrapper");let Tr=0,gm=0,Xl=0,ao=!1;function wv(e){ao=e}function nl(e=!1){if(e&&Ap(),Z5(!0),Me)Cv(!0);else{const t=document.querySelector("#typingTest");Nb(t)}}function Cv(e=!1){const t=mi();if(t===null||st===null)return;const a=st.offsetHeight,o=window.innerHeight;a<o||!(t.getBoundingClientRect().top>o/2)&&!e||t.scrollIntoView({block:"center"})}function Es(e){return ee.querySelector(`.word[data-wordindex='${e}']`)}function sn(){return Es(ne)}function kv(e){Ae("test-ui.updateActiveElement",async()=>{const{direction:t,initial:a}=e;let o=null;if(a===void 0){const l=ee.querySelector(".active");t==="forward"?l.classList.add("typed"):t==="back"&&r.mode==="zen"&&l.remove(),l.classList.remove("active"),o=l.offsetTop}const i=sn();if(i===null)throw new Error("activeWord is null - can't update active element");if(i.classList.add("active"),i.classList.remove("error"),i.classList.remove("typed"),Tr=i.offsetTop,gm=i.offsetHeight,console.log("activewordtopupdated"),hm(),o===null)return;(r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&we()===0||!r.showAllLines)&&i.offsetTop>o&&await bm(o),!a&&r.tapeMode!=="off"&&await qd()})}function nf(e,t,a,o=!0){const i=typeof a=="string",n=i?Vo(a):a;let l="",c=0;for(const d of e)for(const u of d){const m=t[u],p=`${u}`,g=i?n[u]:n[c++];l+=`<hint data-chars-index=${p} style="left:${m.offsetLeft+m.offsetWidth/2}px;">${g}</hint>`}return o&&(l=`<div class="hints">${l}</div>`),l}async function Sv(e,t,a){const o=Hy(F.getCurrent(),ia,fi);let i=!1,n=0,l=a.length;for(;n<l-1;){const c=a[n],d=a[n+1],u=c.dataset.charsIndex?.split(",")??[],m=d.dataset.charsIndex?.split(",")??[],p=parseInt(u[0]??"0"),g=parseInt(m[0]??"0");if(!e.some(z=>z.includes(p)&&z.includes(g))){n++,i=!1;continue}const y=t[p],k=t[g],x=y.offsetTop===k.offsetTop,C=o?d:c,D=o?c:d,E=C.offsetLeft+C.offsetWidth/2,B=D.offsetLeft-D.offsetWidth/2;if(x&&E>B){c.dataset.charsIndex=[...u,...m].join(",");const z=y.offsetLeft+(o?y.offsetWidth:0),H=d.offsetLeft-c.offsetLeft;c.style.left=z+H+"px",c.insertAdjacentHTML("beforeend",d.innerHTML),d.remove(),l--,i&&n>0&&n--}else n++;i=!0}}async function A6(){if(pe()!=="test"||Ie||r.indicateTypos!=="below"&&r.indicateTypos!=="both")return;let e,t=[],a=[];const o=document.querySelectorAll(".hints > hint");for(const n of o){const l=n.parentElement;l!==e&&(await i(e,t,a),e=l,t=[],a=[]);const c=n.dataset.charsIndex?.split(",").map(d=>parseInt(d));if(!(c===void 0||c.length===0)){for(const d of c){const u=t[t.length-1];u&&u[u.length-1]===d-1?u.push(d):t.push([d])}a.push(...Vo(n.innerHTML))}}await i(e,t,a);async function i(n,l,c){if(!n||l.length===0)return;const d=n.parentElement,u=d.querySelectorAll("letter");n.innerHTML=nf(l,u,c,!1);const m=d.getElementsByTagName("hint");await Sv(l,u,m)}}function sf(e,t){let a=!1,o=`<div class='word' data-wordindex='${t}'>`;const i=Eo("getWordHtml"),n=Vo(e);for(const l of n)i?o+=i.functions.getWordHtml(l,!0):l==="	"?o+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:l===`
`?(a=!0,o+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):o+="<letter>"+l+"</letter>";return o+="</div>",a&&(o+="<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),o}function xv(){Jr(),r.tapeMode!=="off"?(ee.classList.add("tape"),st.classList.add("tape")):(ee.classList.remove("tape"),st.classList.remove("tape")),r.blindMode?(ee.classList.add("blind"),st.classList.add("blind")):(ee.classList.remove("blind"),st.classList.remove("blind")),r.indicateTypos==="below"||r.indicateTypos==="both"?(ee.classList.add("indicateTyposBelow"),st.classList.add("indicateTyposBelow")):(ee.classList.remove("indicateTyposBelow"),st.classList.remove("indicateTyposBelow")),r.hideExtraLetters?(ee.classList.add("hideExtraLetters"),st.classList.add("hideExtraLetters")):(ee.classList.remove("hideExtraLetters"),st.classList.remove("hideExtraLetters")),r.flipTestColors?ee.classList.add("flipped"):ee.classList.remove("flipped"),r.colorfulMode?ee.classList.add("colorfulMode"):ee.classList.remove("colorfulMode"),s("#caret, #paceCaret, #liveStatsMini, #typingTest, #wordsInput, #compositionDisplay").css("fontSize",r.fontSize+"rem"),ia?(ee.classList.add("rightToLeftTest"),s("#resultWordsHistory .words").addClass("rightToLeftTest"),s("#resultReplay .words").addClass("rightToLeftTest")):(ee.classList.remove("rightToLeftTest"),s("#resultWordsHistory .words").removeClass("rightToLeftTest"),s("#resultReplay .words").removeClass("rightToLeftTest"));const e=ee?.className.split(/\s+/).filter(t=>!t.startsWith("highlight-"))??[];r.highlightMode!==null&&e.push("highlight-"+r.highlightMode.replaceAll("_","-")),ee.className=e.join(" "),W6(),rf(!0),r.showAllLines||$v(),E6(),hm(),Ed(),Qr(),Jn()||Np()}function _6(){if(ee.innerHTML="",r.mode==="zen")Tv();else{let e="";for(let t=0;t<F.length;t++)e+=sf(F.get(t),t);ee.innerHTML=e}kv({initial:!0}),xv(),Kx()}function Tv(e=A.getHistory().length){ee.insertAdjacentHTML("beforeend",`<div class='word' data-wordindex='${e}'><letter class='invisible'>_</letter></div>`)}function hm(){if(pe()!=="test")return;const e=fi?!ia:ia,t=mi();if(t===null)return;const a=sn();if(!a){t.style.top="0px",t.style.left="0px";return}const o=pr(r.fontSize),i=a.offsetTop+o/2-t.offsetHeight/2+1;r.tapeMode!=="off"?t.style.maxWidth=`${100-r.tapeMargin}%`:t.style.maxWidth="",a.offsetWidth<o?t.style.width=o+"px":t.style.width=a.offsetWidth+"px",t.style.top=i+"px",r.tapeMode!=="off"?t.style.left=`${st.offsetWidth*(r.tapeMargin/100)}px`:a.offsetWidth<o&&e?t.style.left=a.offsetLeft-o+"px":t.style.left=Math.max(0,a.offsetLeft)+"px",Cv()}let Lv=Promise.resolve();async function $v(){if(r.showAllLines)return;const{resolve:e,promise:t}=ci();Lv=t;const a=sn();if(!a){e();return}const o=a.offsetTop;let i=o;for(let n=ne-1;n>=0;n--)if(i=Es(n)?.offsetTop??o,i<o){await bm(i,!0),e();return}e()}function rf(e=!1){if(pe()!=="test"||Ie||!e&&r.mode!=="custom")return;const t=document.querySelector(".outOfFocusWarning"),a=sn();if(!a)return;st.classList.remove("hidden");const o=window.getComputedStyle(a),i=parseInt(o.marginTop)+parseInt(o.marginBottom),n=a.offsetHeight+i,l=r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&we()===0;if(r.showAllLines&&!l)st.style.height="";else if(r.mode==="zen")st.style.height=n*2+"px";else if(r.tapeMode==="off"){const d=ee.querySelectorAll(".word");let u=0,m=0,p=0,g=0;for(;u<3;){const h=d[p];if(!h)break;const y=h.offsetTop;y>m&&(u++,g+=h.offsetHeight+i,m=y),p++}u<3&&(g=g*(3/u)),st.style.height=g+"px"}else if(Xn)st.style.height=n*3+"px";else{const d=ee.offsetHeight??n;st.style.height=d+"px"}t.style.maxHeight=n*3+"px"}function E6(){if(r.tapeMode!=="off")ee.style.marginLeft="0",qd(!0);else{const e=ee.querySelectorAll(".afterNewline");ee.style.marginLeft="0",ee.style.marginTop="0";for(const t of e)t.style.marginLeft="0"}}function Th(e,t=F.length-1){ne===t-1?ee.insertAdjacentHTML("beforeend",sf(e,t)):requestAnimationFrame(async()=>{ee.insertAdjacentHTML("beforeend",sf(e,t))})}let lf=new Map;async function sl({wordIndex:e,input:t,compositionData:a}){lf.set(e,t),Ae(`test-ui.updateWordLetters.${e}`,async()=>{lf.delete(e);const o=F.get(e);if(!o&&r.mode!=="zen")return;let i="";const n=Es(e);if(!n)return;const l=[];let c=!1;if(r.mode==="zen"){for(const d of t)d==="	"?i+=`<letter class='tabChar correct' style="opacity: 0"><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:d===`
`?(c=!0,i+=`<letter class='nlChar correct' style="opacity: 0"><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`):i+=`<letter class="correct">${d}</letter>`;t===""&&a===""&&(i+="<letter class='invisible'>_</letter>");for(const d of a)i+=`<letter class="dead">${d}</letter>`}else{const d=Eo("getWordHtml"),u=Vo(t),m=Vo(o);for(let p=0;p<u.length;p++){const g=m[p]===u[p];let h=m[p],y="",k="";if(d){const x=d.functions.getWordHtml(h);x!==""&&(h=x)}else h==="	"?(y="tabChar",h='<i class="fas fa-long-arrow-alt-right fa-fw"></i>'):h===`
`&&(k="nlChar",h='<i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i>');if(g)i+=`<letter class="correct ${y}${k}">${h}</letter>`;else if(h===void 0){let x=u[p];x===" "?x="_":x==="	"?x="<i class='fas fa-long-arrow-alt-right fa-fw'></i>":x===`
`&&(x="<i class='fas fa-level-down-alt fa-rotate-90 fa-fw'></i>"),i+=`<letter class="incorrect extra ${y}${k}">${x}</letter>`}else if(i+=`<letter class="incorrect ${y}${k}">`+(r.indicateTypos==="replace"||r.indicateTypos==="both"?u[p]===" "||u[p]==="	"?"_":u[p]:h)+"</letter>",r.indicateTypos==="below"||r.indicateTypos==="both"){const x=l[l.length-1];x&&x[x.length-1]===p-1?x.push(p):l.push([p])}}for(let p=0;p<a.length;p++){const g=a[p];let h=m[t.length+p]??g;r.compositionDisplay==="replace"&&(h=g===" "?"_":g);let y="";g===m[t.length+p]&&(y="correct"),i+=`<letter class="dead ${y}">${h}</letter>`}for(let p=u.length+a.length;p<m.length;p++){const g=m[p];d?.functions?.getWordHtml?i+=d.functions.getWordHtml(g,!0):g==="	"?i+=`<letter class='tabChar'><i class="fas fa-long-arrow-alt-right fa-fw"></i></letter>`:g===`
`?i+=`<letter class='nlChar'><i class="fas fa-level-down-alt fa-rotate-90 fa-fw"></i></letter>`:i+="<letter>"+g+"</letter>"}}if(n.innerHTML=i,l?.length){const d=n.querySelectorAll("letter");let u;r.indicateTypos==="both"?u=nf(l,d,o):u=nf(l,d,t),n.insertAdjacentHTML("beforeend",u);const m=n.getElementsByTagName("hint");await Sv(l,d,m)}c&&n.insertAdjacentHTML("afterend","<div class='beforeNewline'></div><div class='newline'></div><div class='afterNewline'></div>"),r.tapeMode!=="off"&&qd(),(r.mode==="zen"||Sd())&&(r.showAllLines||n.offsetTop>Tr&&await bm(Tr,!0))})}function q6(e,t=!0){let a;if(e?a=e.querySelector("letter.nlChar"):a=document.querySelector("#words > .word > letter.nlChar"),!a||t&&a.classList.contains("incorrect"))return 0;const o=window.getComputedStyle(a),i=parseFloat(o.marginLeft)+parseFloat(o.marginRight);return a.offsetWidth+i}async function qd(e=!1){if(pe()!=="test"||Ie)return;await Lv;const t=fi?!ia:ia,a=st.offsetWidth,o=[...ee.children],i=sn();if(!i)return;const n=ee.getElementsByClassName("afterNewline");let l=0,c=0,d=!1,u,m=0;const p=[],g=[],h=[];for(const N of o)if(N.classList.contains("word")){u&&(m+=parseFloat(u.style.marginLeft));break}else N.classList.contains("afterNewline")&&(h.push(N),d=!0,u=N);let y;const k=o.indexOf(i),x=o.slice(0,k).filter(N=>N.classList.contains("afterNewline")).length;let C=n[x+1];C?y=o.indexOf(C):(C=n[x],C?y=o.indexOf(C):y=k-1);const D=parseFloat(window.getComputedStyle(i).marginRight);for(let N=0;N<=y;N++){const re=o[N];if(re.classList.contains("word")){d=!1;const vt=window.getComputedStyle(re),Rt=re.offsetWidth+parseFloat(vt.marginRight)+parseFloat(vt.marginLeft),ra=Math.floor(re.offsetLeft),Sa=Math.floor(re.offsetWidth);!t&&ra<0-Sa||t&&ra>a?(h.push(re),m+=Rt):(c+=Rt,N<k&&(l=c))}else if(re.classList.contains("afterNewline")){if(d)continue;const vt=q6(o[N-3]);c-=vt+D,N<k&&(l=c);const Rt=3*ee.offsetWidth;if(c<Rt)g.push(c),p.push(m);else{g.push(Rt),p.push(m),N<y&&(g.push(Rt),p.push(m));break}}}if(h.length>0){for(const re of h)re.remove();for(let re=0;re<p.length;re++){const vt=n[re],Rt=parseFloat(vt.style.marginLeft)||0;vt.style.marginLeft=`${Rt-(p[re]??0)}px`}t&&(m*=-1);const N=parseFloat(ee.style.marginLeft)||0;ee.style.marginLeft=`${N+m}px`,oa.handleTapeWordsRemoved(m),Kt.handleTapeWordsRemoved(m)}let E=0;const B=A.current.length;if(r.tapeMode==="letter"&&B>0){const N=i.querySelectorAll("letter");let re=0;for(let vt=0;vt<B;vt++){const Rt=N[vt];if((r.blindMode||r.hideExtraLetters)&&Rt?.classList.contains("extra"))continue;const ra=Rt?.offsetWidth??0;E+=ra,ra>0&&(re=ra)}N[B]?.offsetWidth===0&&(E-=re)}const z=a*(r.tapeMargin/100);let H=l+E,ae=z-H;t&&(H*=-1,ae=D-ae);const xe=e?0:125,Fe="inOut(1.25)",ze={newValue:H*-1,duration:r.smoothLineScroll?xe:0,ease:Fe};if(oa.handleTapeScroll(ze),Kt.handleTapeScroll(ze),r.smoothLineScroll){O(ee,{marginLeft:ae,duration:xe,ease:Fe});for(let N=0;N<g.length;N++){const re=g[N]??0;O(n[N],{marginLeft:re,duration:xe,ease:Fe})}}else{ee.style.marginLeft=`${ae}px`;for(let N=0;N<g.length;N++){const re=g[N]??0;n[N].style.marginLeft=`${re}px`}}}function I6(){const e=di(r,be);let t="";r.funbox.length>0&&(t=" "+r.funbox.join(" ")),s(".pageTest #premidTestMode").text(`${r.mode} ${e} ${Ra(r.language)}${t}`),s(".pageTest #premidSecondsLeft").text(r.time)}function Lh(e){const t=ee.children;if(t!==void 0)for(let a=e;a>=0;a--){const o=t[a];!o||!o.isConnected||o.remove()}}let El=0;async function bm(e,t=!1){if(Xl>0||t){const a=e,o=sn();if(!o)return;const i=[...ee.children],n=i.indexOf(o);let l;for(let p=n-1;p>=0;p--){const g=i[p];if(!g.classList.contains("hidden")&&Math.floor(g.offsetTop)<a){if(g.classList.contains("word")){l=p;break}else if(g.classList.contains("beforeNewline")){l=p+1;break}}}if(l===void 0){Xl++,rf();return}El++;const d=-1*s(o).outerHeight(!0)*El,u=125,m={newMarginTop:d,duration:r.smoothLineScroll?u:0};oa.handleLineJump(m),Kt.handleLineJump(m),r.smoothLineScroll?(await gt(ee,{marginTop:d,duration:u}),El=0,Tr=o.offsetTop,gm=o.offsetHeight,Lh(l),ee.style.marginTop="0"):(El=0,Lh(l))}Xl++,rf()}function D6(e){e||r.mode==="custom"||r.mode==="zen"?(ee.classList.add("withLigatures"),s("#resultWordsHistory .words").addClass("withLigatures"),s("#resultReplay .words").addClass("withLigatures")):(ee.classList.remove("withLigatures"),s("#resultWordsHistory .words").removeClass("withLigatures"),s("#resultReplay .words").removeClass("withLigatures"))}function F6(e,t,a,o,i,n,l){let c="";for(let d=0;d<e;d++){let u;try{u=l?vc.assemble(a.split(""))[d]:n[d]}catch{u=void 0}let m="";const p=l?vc.assemble(a.split("")):a;d+1===e&&p!==void 0&&p.length>t.length&&(m="extraCorrected"),r.mode==="zen"||i[d]!==void 0?r.mode==="zen"||o[d]===i[d]?u===o[d]||u===void 0?c+=`<letter class="correct ${m}">${o[d]}</letter>`:c+=`<letter class="corrected ${m}">`+o[d]+"</letter>":o[d]===A.current?c+=`<letter class='correct ${m}'>`+i[d]+"</letter>":o[d]===void 0?c+="<letter>"+i[d]+"</letter>":c+=`<letter class="incorrect ${m}">`+i[d]+"</letter>":c+='<letter class="incorrect extra">'+o[d]+"</letter>"}return c}async function P6(){s("#resultWordsHistory .words").empty();let e="";const t=A.getHistory().length;for(let a=0;a<t+2;a++){const o=A.getHistory(a),i=on.getHistory(a),n=F.get(a),l=o?.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)!==null||n?.match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)!==null;let c="";try{if(o===void 0||o==="")throw new Error("empty input word");const d=o!==n,u=a===t-1,m=r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&we()===0,p=n.substring(0,o.length)===o,g=r.mode!=="zen"&&!(u&&m&&p),h=d&&g?"error":"";if(i!==void 0&&i!==""){const D=l?vc.assemble(i.split("")):i;c=`<div class='word nocursor ${h}' burst="${aa[a]}" input="${D.replace(/"/g,"&quot;").replace(/ /g,"_")}">`}else c=`<div class='word nocursor ${h}' burst="${aa[a]}" input="${o.replace(/"/g,"&quot;").replace(/ /g,"_")}">`;const y=Vo(o),k=Vo(n??""),x=Vo(i??"");let C;if(r.mode==="zen"||o.length>n.length?C=y.length:C=k.length,i===void 0)throw new Error("empty corrected word");c+=F6(C,o,i,y,k,x,l),c+="</div>"}catch{try{c="<div class='word'>";for(const u of n)c+="<letter>"+u+"</letter>";c+="</div>"}catch{c+="</div>"}}e+=c}return s("#resultWordsHistory .words").html(e),s("#showWordHistoryButton").addClass("loaded"),!0}function ym(e=!1){Ie&&(U3(),s("#resultWordsHistory").stop(!0,!0).hasClass("hidden")?s("#resultWordsHistory .words .word").length===0?P6().then(()=>{r.burstHeatmap&&ir(),s("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250,()=>{r.burstHeatmap&&ir()})}):(r.burstHeatmap&&ir(),s("#resultWordsHistory").removeClass("hidden").css("display","none").slideDown(e?0:250)):s("#resultWordsHistory").slideUp(250,()=>{s("#resultWordsHistory").addClass("hidden")}))}async function ir(){if(r.burstHeatmap){s("#resultWordsHistory .heatmapLegend").removeClass("hidden");let e=[...aa];e=e.filter(d=>d!==1/0),e=e.filter(d=>d<500);const t=bt(r.typingSpeedUnit);e.forEach((d,u)=>{e[u]=Math.round(t.fromWpm(d))});const a=await pi();let o=[a.colorfulError,fa(a.colorfulError,a.text,.5),a.text,fa(a.main,a.text,.5),a.main],i=a.sub;a.main===a.text&&(o=[a.colorfulError,fa(a.colorfulError,a.text,.5),a.sub,fa(a.sub,a.text,.5),a.main],i=a.subAlt);const n=e.sort((d,u)=>d-u),l=e.length,c=[{val:0,colorId:0},{val:n[l*.15|0],colorId:1},{val:n[l*.35|0],colorId:2},{val:n[l*.65|0],colorId:3},{val:n[l*.85|0],colorId:4}];c.forEach((d,u)=>{const m=c[u+1];let p="";u===0&&m?p=`<${Math.round(m.val)}`:u===4?p=`${Math.round(d.val)}+`:m&&(d.val!==m.val?p=`${Math.round(d.val)}-${Math.round(m.val)-1}`:p=`${Math.round(d.val)}-${Math.round(d.val)}`),s("#resultWordsHistory .heatmapLegend .box"+u).html(`<div>${p}</div>`)}),s("#resultWordsHistory .words .word").each((d,u)=>{const m=s(u).attr("burst");if(m===void 0)s(u).css("color",i);else{let p=parseInt(m);p=Math.round(bt(r.typingSpeedUnit).fromWpm(p)),c.forEach(g=>{p>=g.val&&(s(u).addClass("heatmapInherit"),s(u).css("color",o[g.colorId]))})}}),s("#resultWordsHistory .heatmapLegend .boxes .box").each((d,u)=>{s(u).css("background",o[d])})}else s("#resultWordsHistory .heatmapLegend").addClass("hidden"),s("#resultWordsHistory .words .word").removeClass("heatmapInherit"),s("#resultWordsHistory .words .word").css("color",""),s("#resultWordsHistory .heatmapLegend .boxes .box").css("color","")}function B6(e){Ae(`test-ui.highlightBadWord.${e}`,()=>{Es(e)?.classList.add("error")})}function R6(e){Ae(`test-ui.highlightAllLettersAsCorrect.${e}`,()=>{const t=Es(e)?.children;for(const a of t??[])a.classList.add("correct")})}function W6(){let e={};r.tapeMode==="off"?r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":r.maxLineWidth+"ch"}:r.maxLineWidth===0?e={"max-width":"100%"}:e={"max-width":"100%"};const t=s("#typingTest");t.css(e),r.maxLineWidth===0?t.removeClass("full-width-padding").addClass("content"):t.removeClass("content").addClass("full-width-padding")}function z6(){r.tapeMode==="off"?s("#liveStatsMini").css({"justify-content":"start","margin-left":"0.25em"}):s("#liveStatsMini").css({"justify-content":"center","margin-left":r.tapeMargin+"%"})}function H6(e){s("#barTimerProgress").css("opacity",parseFloat(e)),s("#liveStatsTextTop").css("opacity",parseFloat(e)),s("#liveStatsTextBottom").css("opacity",parseFloat(e)),s("#liveStatsMini").css("opacity",parseFloat(e))}function O6(e){s("#barTimerProgress").removeClass("timerSub"),s("#barTimerProgress").removeClass("timerText"),s("#barTimerProgress").removeClass("timerMain"),s("#liveStatsTextTop").removeClass("timerSub"),s("#liveStatsTextTop").removeClass("timerText"),s("#liveStatsTextTop").removeClass("timerMain"),s("#liveStatsTextBottom").removeClass("timerSub"),s("#liveStatsTextBottom").removeClass("timerText"),s("#liveStatsTextBottom").removeClass("timerMain"),s("#liveStatsMini").removeClass("timerSub"),s("#liveStatsMini").removeClass("timerText"),s("#liveStatsMini").removeClass("timerMain"),e==="main"?(s("#barTimerProgress").addClass("timerMain"),s("#liveStatsTextTop").addClass("timerMain"),s("#liveStatsTextBottom").addClass("timerMain"),s("#liveStatsMini").addClass("timerMain")):e==="sub"?(s("#barTimerProgress").addClass("timerSub"),s("#liveStatsTextTop").addClass("timerSub"),s("#liveStatsTextBottom").addClass("timerSub"),s("#liveStatsMini").addClass("timerSub")):e==="text"&&(s("#barTimerProgress").addClass("timerText"),s("#liveStatsTextTop").addClass("timerText"),s("#liveStatsTextBottom").addClass("timerText"),s("#liveStatsMini").addClass("timerText"))}function N6(e){e?s(".pageTest #restartTestButton").removeClass("hidden"):s(".pageTest #restartTestButton").addClass("hidden")}function U6(e){const t=sn();if(!t)throw new Error("No active word element found");const a=[];for(let n=t.children.length;n<e.length;n++){const l=document.createElement("letter"),c=e[n]===" "?"_":e[n];l.textContent=c,a.push(l)}t.append(...a);const o=t.offsetTop,i=t.offsetHeight;for(const n of a)n.remove();return{top:o,height:i}}function vm(e,t){e==="textInput"||e==="compositionUpdate"?t===!0||r.playSoundOnError==="off"||r.blindMode?Ki():kd():e==="delete"&&Ki();const a=K(tl());isNaN(a)||x3(a),r.mode!=="time"&&bd(),r.keymapMode==="next"&&vr(F.getCurrent().charAt(A.current.length)),eo(!0),a0(),Qr()}function V6(e,t,a){q4(e),t||sl({input:a??A.current,wordIndex:ne,compositionData:nn()}),vm("textInput",e)}function K6(){sl({input:A.current,wordIndex:ne,compositionData:nn()}),vm("compositionUpdate",!0)}function j6(){sl({input:A.current,wordIndex:ne,compositionData:nn()}),vm("delete",null)}function Mv(e,t,a){const o=_o("nospace");(r.stopOnError==="letter"&&(t||t===null)||o||a)&&sl({input:A.current,wordIndex:ne,compositionData:nn()}),e==="forward"&&(r.blindMode?R6(ne):t===!1&&B6(ne))}async function Av(e){kv({direction:e}),Qr();const t=aa[aa.length-1];if(ge(t)&&k3(Math.round(t)),e!=="forward"){if(e==="back"&&r.mode==="zen"){const a=[...ee.children??[]];let o=!1;for(const i of a){if(!o&&parseInt(i.getAttribute("data-wordindex")??"-1",10)===ne){o=!0;continue}o&&i.remove()}}}}function G6(){eo(!0),y4(),Hp(),qp(),Pp(),Dp(),bd()}function Q6(e){s("#result").addClass("hidden"),s("#typingTest").css("opacity",0).removeClass("hidden"),mi().style.left="0",I4(),eo(!1),w3(),y3(),S3(),C3(),L3(),T3(),I3(),q3(),w4(),ox(),I6(),nl(!0),Hc(),Kp(),K0(),ns(),r.showAverage!=="off"?L6().then(()=>{sa()}):sa(),e==="resultPage"&&(r.randomTheme!=="off"&&mv(),_5()),Xl=0,pe()==="test"&&zc(!1),e6(),r.compositionDisplay==="below"?(xd(" "),Q0()):G0(),n4(),x2("test-ui"),_6()}function Y6(){Gr(),Ip(),Bp(),Fp(),Op(),Jr(),v4()}s(".pageTest #copyWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=A.getHistory().join(" "):e=F.get().slice(0,A.getHistory().length).join(" "),await _v(e)});s(".pageTest #copyMissedWordsListButton").on("click",async()=>{let e;r.mode==="zen"?e=A.getHistory().join(" "):e=Object.keys(yo??{}).join(" "),await _v(e)});async function _v(e){try{await navigator.clipboard.writeText(e),f("Copied to clipboard",0,{duration:2})}catch(t){const a=se(t,"Could not copy to clipboard");f(a,-1)}}s(".pageTest #toggleBurstHeatmap").on("click",async()=>{v("burstHeatmap",!r.burstHeatmap),Kp()});s(".pageTest #resultWordsHistory").on("mouseleave",".words .word",()=>{s(".wordInputHighlight").remove()});s(".pageTest #result #wpmChart").on("mouseleave",()=>{h0(!1),z3()});s(".pageTest #result #wpmChart").on("mouseenter",()=>{h0(!0)});s(".pageTest #resultWordsHistory").on("mouseenter",".words .word",e=>{if(Ie){const t=s(e.currentTarget).attr("input"),a=parseInt(s(e.currentTarget).attr("burst"));t!==void 0&&s(e.currentTarget).append(`<div class="wordInputHighlight withSpeed">
          <div class="text">
          ${t.replace(/\t/g,"_").replace(/\n/g,"_").replace(/</g,"&lt").replace(/>/g,"&gt")}
          </div>
          <div class="speed">
          ${W.typingSpeed(a,{showDecimalPlaces:!1})}
          ${r.typingSpeedUnit}
          </div>
          </div>`)}});addEventListener("resize",()=>{Kp()});s("#wordsInput").on("focus",e=>{Jn()&&(!Ie&&r.showOutOfFocusWarning&&Jr(),i0(!0))});s("#wordsInput").on("focusout",()=>{Jn()||Np(),Gr()});s(".pageTest").on("click","#showWordHistoryButton",()=>{ym()});s("#wordsWrapper").on("click",()=>{nl()});Ce(({key:e,newValue:t})=>{e==="quickRestart"&&N6(t==="off"),e==="timerOpacity"&&H6(t),e==="timerColor"&&O6(t),e==="showOutOfFocusWarning"&&!t&&Jr(),e==="compositionDisplay"&&(t==="below"?(xd(" "),Q0()):G0()),["fontSize","fontFamily","blindMode","hideExtraLetters"].includes(e??"")&&Ed(),(e==="theme"||e==="burstHeatmap")&&Ie&&ir(),e==="highlightMode"&&pe()==="test"&&sl({input:A.current,wordIndex:ne,compositionData:nn()}),["highlightMode","blindMode","indicateTypos","tapeMode","hideExtraLetters","flipTestColors","colorfulMode","showAllLines","fontSize","maxLineWidth","tapeMargin"].includes(e)&&xv(),["tapeMode","tapeMargin"].includes(e)&&z6()});let wm=!1;function ie(){wm=!0}function $h(){wm=!1}function X6(){return wm}const Pe={mode:null,punctuation:null,numbers:null,customText:null};function Jl(e,t){if(r.mode==="zen")return!1;let a;e==="words"&&!t||e==="off"&&t?a=20:a=10;let o=[];e==="words"&&(Object.keys(yo).forEach(p=>{const g=yo[p];g!==void 0&&o.push([p,g])}),o.sort((p,g)=>g[1]-p[1]),o=o.slice(0,a));let i=[];if(e==="biwords"){for(let p=0;p<F.length;p++){const g=F.get(p),h=yo[g];h!==void 0&&(p===0?i.push([g,"",h]):i.push([g,F.get(p-1),h]))}i.sort((p,g)=>g[2]-p[2]),i=i.slice(0,a)}if((e==="words"&&o.length===0||e==="biwords"&&i.length===0)&&!t)return f("You haven't missed any words",0),!1;let n=[];if(t){const p=F.get().slice(0,A.getHistory().length-1);n=p.map((g,h)=>[g,aa[h]??0]),n.sort((g,h)=>g[1]-h[1]),n=n.slice(0,Math.min(a,Math.round(p.length*.2))),n.length===0&&f("Test too short to classify slow words.",0)}if(o.length===0&&i.length===0&&n.length===0)return f("Could not start a new custom test",0),!1;const l=[];o.forEach(p=>{for(let g=0;g<p[1];g++)l.push(p[0])}),i.forEach(p=>{for(let g=0;g<p[2];g++)p[1]!==""?l.push(p[1]+" "+p[0]):l.push(p[0])}),n.forEach((p,g)=>{for(let h=0;h<n.length-g;h++)l.push(p[0])});const c=Pe.mode??r.mode,d=Pe.punctuation??r.punctuation,u=Pe.numbers??r.numbers;let m=null;return r.mode==="custom"&&(m=xo()),v("mode","custom",{nosave:!0}),Ui(!0),So(l),_a("section"),os("shuffle"),ja((n.length+o.length+i.length)*5),ri("practise",void 0),Pe.mode=c,Pe.punctuation=d,Pe.numbers=u,Pe.customText=m,!0}function Cm(){Pe.mode=null,Pe.punctuation=null,Pe.numbers=null,Pe.customText=null}Ce(({key:e})=>{e==="mode"&&Cm()});function km(...e){if(r.funbox.length!==0)for(const t of $t("toggleScript"))t.functions.toggleScript(e)}function J6(e){if(e.length===0)for(const t of $t("clearGlobal"))t.functions.clearGlobal();return v0(),v("funbox",e),!0}function Ev(e){if(!Wr(na(),e)&&!r.funbox.includes(e)){f(`${Pt(e.replace(/_/g," "))} funbox is not compatible with the current funbox selection`,0);return}v0(),Bn(e,!1),na().includes(e)?Gu(e).functions?.applyGlobalCSS?.():Gu(e).functions?.clearGlobal?.()}async function _n(){return s("body").attr("class",s("body")?.attr("class")?.split(/\s+/)?.filter(e=>!e.startsWith("fb-"))?.join(" ")??""),s(".funBoxTheme").remove(),s("#wordsWrapper").removeClass("hidden"),ns(),ie(),!0}async function qv(e){if(e==null?e=r.funbox:r.funbox!==e&&(r.funbox=e),!Wr(na()))return f(se(void 0,`Failed to activate funbox: funboxes ${r.funbox.map(i=>i.replace(/_/g," ")).join(", ")} are not compatible`),-1),v("funbox",[],{nosave:!0}),await _n(),!1;ns(),await e8(),await t8(),s("#wordsWrapper").removeClass("hidden");const{data:t,error:a}=await jt(gx(r.language));if(a)return f(se(a,"Failed to activate funbox"),-1),v("funbox",[],{nosave:!0}),await _n(),!1;if(t.ligatures&&_o("noLigatures")){f("Current language does not support this funbox mode",0),v("funbox",[],{nosave:!0}),await _n();return}let o=!0;for(const[i,n]of Object.entries(r)){const l=Wu(i,n,no());if(!l.result&&!l.result)if(l.forcedConfigs&&l.forcedConfigs.length>0)i==="mode"&&v("mode",l.forcedConfigs[0]),i==="words"&&v("words",l.forcedConfigs[0]),i==="time"&&v("time",l.forcedConfigs[0]),i==="punctuation"&&v("punctuation",l.forcedConfigs[0]),i==="numbers"&&v("numbers",l.forcedConfigs[0]),i==="highlightMode"&&v("highlightMode",l.forcedConfigs[0]);else{o=!1;break}}if(!o){r.funbox.length>1?f(`Failed to activate funboxes ${r.funbox}: no intersecting forced configs. Disabling funbox`,-1):f(`Failed to activate funbox ${r.funbox}: no forced configs. Disabling funbox`,-1),v("funbox",[],{nosave:!0}),await _n();return}ie();for(const i of $t("applyConfig"))i.functions.applyConfig();return!0}async function Z6(){for(const e of $t("rememberSettings"))e.functions.rememberSettings()}async function e8(){const e=s("body"),t=na().map(o=>"fb-"+o.replaceAll("_","-")),a=e?.attr("class")?.split(/\s+/).filter(o=>!o.startsWith("fb-"))??[];return _o("ignoreReducedMotion")&&a.push("ignore-reduced-motion"),e.attr("class",[...new Set([...a,...t]).keys()].join(" ")),!0}async function t8(){s(".funBoxTheme").remove();for(const e of $0("hasCssFile")){const t=document.createElement("link");t.classList.add("funBoxTheme"),t.rel="stylesheet",t.href="funbox/"+e.name+".css",document.head.appendChild(t)}return!0}const Iv=[];function a8(e){Iv.push(e)}function Lr(e,t,a){Iv.forEach(o=>{try{o(e,t,a)}catch(i){console.error("Timer event subscriber threw an error"),console.error(i)}})}const Dv=I.number().int().min(15).max(1e3),ls=new ut({key:"fpsLimit",schema:Dv,fallback:1e3});function o8(e){const t=ls.set(e);return Fv(),t}function i8(){return ls.get()}function Fv(){Fi.pauseOnDocumentHidden=!1,Fi.fps=ls.get(),Fi.defaults.frameRate=ls.get()}function n8(){Fi.fps=30,Fi.defaults.frameRate=30}function s8(){Fi.fps=ls.get(),Fi.defaults.frameRate=ls.get()}let pu=0;const Pv=Ik({duration:1e3,loop:!0,autoplay:!1,onBegin:()=>{pu=performance.now()},onLoop:()=>{const e=Math.abs(1e3-(performance.now()-pu));pu=performance.now(),v8(e),y8()}});let cs=0,Ge=!1;function r8(){Ge=!0}function Sm(){s8(),Pv.reset()}function l8(){Ge&&console.time("premid");const e=document.querySelector("#premidSecondsLeft");e!==null&&(e.innerHTML=(r.time-Xr()).toString()),Ge&&console.timeEnd("premid")}function c8(){Ge&&console.time("calculate wpm and raw");const e=lm();return Ge&&console.timeEnd("calculate wpm and raw"),Ge&&console.time("push to history"),Jy(e.wpm),Zy(e.raw),Ge&&console.timeEnd("push to history"),e}function d8(e){Ge&&console.time("update monkey");const t=r.blindMode?e.raw:e.wpm;g4(t),Ge&&console.timeEnd("update monkey")}function u8(){Ge&&console.time("calculate acc");const e=K(tl());return Ge&&console.timeEnd("calculate acc"),e}function f8(){if(Ge&&console.time("layoutfluid"),r.funbox.includes("layoutfluid")&&r.mode==="time"){const e=r.customLayoutfluid,t=r.time/e.length,a=Xr(),o=Math.floor(a/t),i=e[o],n=[];for(let l=1;l<e.length;l++)n.push(Math.floor(t*l));n.includes(a+3)?(C0(),iu(3,e[o+1])):n.includes(a+2)?iu(2,e[o+1]):n.includes(a+1)&&iu(1,e[o+1]),r.layout!==i&&i!==void 0&&(Gl(),v("layout",i,{nosave:!0}),v("keymapLayout",i,{nosave:!0}))}Ge&&console.timeEnd("layoutfluid")}function p8(e,t){return Ge&&console.time("fail conditions"),ud(),pd(),fd(),r.minWpm==="custom"&&e.wpm<r.minWpmCustomSpeed&&ne>3?(Wc(),cs=0,Lr("fail","min speed"),!0):r.minAcc==="custom"&&t<r.minAccCustom?(Wc(),cs=0,Lr("fail","min accuracy"),!0):(Ge&&console.timeEnd("fail conditions"),!1)}function m8(){Ge&&console.time("times up check");let e;if(r.mode==="time"?e=r.time:r.mode==="custom"&&Se()==="time"&&(e=we()),e!==void 0&&e!==0&&Xr()>=e){Gr(),A.pushHistory(),on.pushHistory(),Wc(),cs=0,Lr("finish");return}Ge&&console.timeEnd("times up check")}function g8(){Ge&&console.time("play timer warning");let e;r.mode==="time"?e=r.time:r.mode==="custom"&&Se()==="time"&&(e=we()),e!==void 0&&Xr()===e-parseInt(r.playTimeWarning,10)&&Pc(),Ge&&console.timeEnd("play timer warning")}let h8=[];function b8(){return h8}function y8(){Ge&&console.time("timer step -----------------------------"),E3();const e=c8(),t=u8();Ae("test-timer.timerStep",()=>{l8(),d8(e)}),bd(),v3(e.wpm,e.raw),r.playTimeWarning!=="off"&&g8(),f8(),p8(e,t)||m8(),Ge&&console.timeEnd("timer step -----------------------------")}function v8(e){(r.mode==="time"&&r.time<130&&r.time>0||r.mode==="words"&&r.words<250&&r.words>0)&&(e>125&&(C4(),n8()),e>250&&cs++,(e>500||cs>5)&&(f('This could be caused by "efficiency mode" on Microsoft Edge.'),f("Stopping the test due to bad performance. This would cause test calculations to be incorrect. If this happens a lot, please report this.",-1),Lr("fail","slow timer")))}async function w8(){Wc(),cs=0,C8()}async function C8(){Pv.play()}let xm=[],Ga=[],Bv=0,Tm=!0,Va=0,Ct=0,Gi=0,rl=0,Oc=[],cf=[];const $a=document.getElementById("playpauseReplayButton")?.children[0];function df(e){xm=e}function Lm(){const e=document.getElementById("replayWords");if(e===null)return;e.innerHTML="";let t=0;Ga.forEach(a=>{a.action==="backWord"?t--:(a.action==="submitCorrectWord"||a.action==="submitErrorWord")&&t++}),xm.forEach((a,o)=>{if(o>t)return;const i=document.createElement("div");i.className="word";for(const n of a){const l=document.createElement("letter");l.innerHTML=n,i.appendChild(l)}e.appendChild(i)})}function ll(){Oc.forEach(e=>{clearTimeout(e)}),Oc=[],cf.forEach(e=>{clearTimeout(e)}),cf=[],rl=Ct,Gi=Va,$a!==void 0&&($a.className="fas fa-play",$a.parentNode?.setAttribute("aria-label","Resume replay"))}function hn(e=!1){e&&r.playSoundOnError!=="off"?kd():Ki()}function Rv(e,t=!1){let a=document.getElementById("replayWords")?.children[Va];if(a!==void 0){if(e.action==="correctLetter")t||hn(),a.children[Ct]?.classList.add("correct"),Ct++;else if(e.action==="incorrectLetter"){t||hn(!0);let o;Ct>=a.children.length&&(o=document.createElement("letter"),o?.classList.add("extra"),o.innerHTML=e.value?.toString()??"",a.appendChild(o)),o=a.children[Ct],o?.classList.add("incorrect"),Ct++}else if(e.action==="setLetterIndex"&&typeof e.value=="number"){t||hn(),Ct=e.value;for(const o of[...a.children].slice(Ct))o?.classList.contains("extra")?o.remove():o.className=""}else if(e.action==="submitCorrectWord")t||hn(),Va++,Ct=0;else if(e.action==="submitErrorWord")t||hn(!0),a?.classList.add("error"),Va++,Ct=0;else if(e.action==="backWord"){t||hn(),Va--;const o=document.getElementById("replayWords");for(o!==null&&(a=o.children[Va]),Ct=a.children.length;a.children[Ct-1]?.className==="";)Ct--;a?.classList.remove("error")}}}function $m(){let e=0;Ct=0,Va=0,Ga.forEach((o,i)=>{(Va<Gi||Va===Gi&&Ct<rl)&&(Rv(o,!0),e=i+1)});const t=Ga[e]?.time;if(t===void 0)throw new Error("Failed to load old replay: datatime is undefined");const a=Math.floor(t/1e3);return Wv(a),e}function k8(){s("#resultReplay").stop(!0,!0).hasClass("hidden")?(Lm(),$m(),s("#watchReplayButton").hasClass("loaded")?s("#resultReplay").removeClass("hidden").css("display","none").slideDown(250):(s("#words").html('<div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>'),s("#resultReplay").removeClass("hidden").css("display","none").slideDown(250))):($a?.parentNode?.getAttribute("aria-label")!=="Start replay"&&ll(),s("#resultReplay").slideUp(250,()=>{s("#resultReplay").addClass("hidden")}))}function S8(){Ga=[],Bv=performance.now(),Tm=!0,rl=0,Gi=0}function Mm(){Tm=!1}function $r(e,t){if(!Tm)return;const a=performance.now()-Bv;Ga.push({action:e,value:t,time:a})}function Wv(e){const a=`${Xo[e-1]??0}wpm	${e}s`;s("#replayStats").text(a)}function x8(){if(Ct=0,Va=0,$a===void 0)return;$a.className="fas fa-pause",$a.parentNode?.setAttribute("aria-label","Pause replay"),Lm();const e=$m(),t=Ga[e]?.time;if(t===void 0)throw new Error("Failed to play replay: lastTime is undefined");let a=Math.round(t/1e3);const o=Math.round(Nn(Ga).time/1e3);for(;a<=o;){const i=a;cf.push(setTimeout(()=>{Wv(i)},i*1e3-t)),a++}Ga.forEach((i,n)=>{n<e||Oc.push(setTimeout(()=>{Rv(i)},i.time-t))}),Oc.push(setTimeout(()=>{rl=0,Gi=0,$a.className="fas fa-play",$a.parentNode.setAttribute("aria-label","Start replay")},Nn(Ga).time-t))}function T8(){return JSON.stringify({replayData:Ga,wordsList:xm})}s(".pageTest #playpauseReplayButton").on("click",()=>{$a?.className==="fas fa-play"?x8():$a?.className==="fas fa-pause"&&ll()});s("#replayWords").on("click","letter",e=>{ll();const a=[...document.querySelector("#replayWords")?.children??[]];Gi=a.indexOf(e.target.parentNode),rl=[...a[Gi].children].indexOf(e.target),Lm(),$m()});s(".pageTest").on("click","#watchReplayButton",()=>{k8()});let Mr=0,Am=!1,zv;function L8(e){if(Am&&new Date().getDate()>zv){Mr=e;return}Mr+=e}function $8(){return Re(Math.round(Mr),!0,!0)+(Am?" today":" session")}function M8(){const e=new Date;e.setSeconds(0),e.setMinutes(0),e.setHours(0),e.setMilliseconds(0),zv=e.getDate();const t=e.getTime();Mr=0;const a=S();if(!a)return;a.results?.forEach(i=>{const n=new Date(i.timestamp);n.setSeconds(0),n.setMinutes(0),n.setHours(0),n.setMilliseconds(0),n.getTime()>=t&&(Mr+=i.testDuration+i.incompleteTestSeconds-i.afkDuration)}),Am=!0}let uf=!1;function Hv(){Ot&&!uf&&!Lt&&(f("Challenge cleared",0),Cy(null))}function A8(e,t,a){let o=!0,i=[];const n=e.afkDuration/e.testDuration*100;if(t[a]===void 0)throw new Error("Requirement value is undefined");if(a==="wpm"&&t.wpm){const l=t.wpm;"exact"in l?Math.round(e.wpm)!==l.exact&&(o=!1,i.push(`WPM not ${l.exact}`)):"min"in l&&e.wpm<l.min&&(o=!1,i.push(`WPM below ${l.min}`))}else if(a==="acc"&&t.acc){const l=t.acc;"exact"in l?e.acc!==l.exact&&(o=!1,i.push(`Accuracy not ${l.exact}`)):"min"in l&&e.acc<l.min&&(o=!1,i.push(`Accuracy below ${l.min}`))}else if(a==="afk"&&t.afk){const l=t.afk;l.max&&Math.round(n)>l.max&&(o=!1,i.push(`AFK percentage above ${l.max}`))}else if(a==="time"&&t.time){const l=t.time;l.min&&Math.round(e.testDuration)<l.min&&(o=!1,i.push(`Test time below ${l.min}`))}else if(a==="funbox"&&t.funbox){const l=t.funbox.exact;if(l===void 0)throw new Error("Funbox mode is undefined");if(!ui(l,e.funbox)){o=!1;for(const c of l)e.funbox?.includes(c)||i.push(`${c} funbox not active`);if(e.funbox!==void 0&&e.funbox.length>0)for(const c of e.funbox)l.includes(c)||i.push(`${c} funbox active`)}}else if(a==="raw"&&t.raw){const l=t.raw;l.exact&&Math.round(e.rawWpm)!==l.exact&&(o=!1,i.push(`Raw WPM not ${l.exact}`))}else if(a==="con"&&t.con){const l=t.con;l.exact&&Math.round(e.consistency)!==l.exact&&(o=!1,i.push(`Consistency not ${l.exact}`))}else if(a==="config"&&t.config){const l=t.config;for(const c of lt(l)){const d=l[c];r[c]!==d&&(o=!1,i.push(`${c} not set to ${d}`))}}return[o,i]}function _8(e){if(!Ot)return null;try{if(e.afkDuration/e.testDuration*100>10)return f("Challenge failed: AFK time is greater than 10%",0),null;if(Ot.requirements===void 0)return f(`${Ot.display} challenge passed!`,1),Ot.name;{let a=!0;const o=[];for(const i of lt(Ot.requirements)){const[n,l]=A8(e,Ot.requirements,i);n||(a=!1),o.push(...l)}return a?(Ot.autoRole&&f("You will receive a role shortly. Please don't post a screenshot in challenge submissions.",1,{duration:5}),f(`${Ot.display} challenge passed!`,1),Ot.name):(f(`${Ot.display} challenge failed: ${o.join(", ")}`,0),null)}}catch(t){return console.error(t),f(`Something went wrong when verifying challenge: ${t.message}`,0),null}}async function Ov(e){uf=!0,v("funbox",[]);const{data:t,error:a}=await jt(x0());if(a){const n=se(a,"Failed to setup challenge");return f(n,-1),ie(),setTimeout(()=>{L("header .config")?.removeClass("hidden"),L(".page.pageTest")?.removeClass("hidden")},250),!1}const o=t.find(n=>n.name.toLowerCase()===e.toLowerCase());let i;try{if(o===void 0)return f("Challenge not found",0),ie(),setTimeout(()=>{L("header .config")?.removeClass("hidden"),L(".page.pageTest")?.removeClass("hidden")},250),!1;if(o.type==="customTime")v("time",o.parameters[0],{nosave:!0}),v("mode","time",{nosave:!0}),v("difficulty","normal",{nosave:!0}),o.name==="englishMaster"&&(v("language","english_10k",{nosave:!0}),v("numbers",!0,{nosave:!0}),v("punctuation",!0,{nosave:!0}));else if(o.type==="customWords")v("words",o.parameters[0],{nosave:!0}),v("mode","words",{nosave:!0}),v("difficulty","normal",{nosave:!0});else if(o.type==="customText")So(o.parameters[0].split(" ")),os(o.parameters[1]),ja(o.parameters[2]),_a(o.parameters[3]),Ui(o.parameters[4]),v("mode","custom",{nosave:!0}),v("difficulty","normal",{nosave:!0});else if(o.type==="script"){oe();const n=await fetch("/challenges/"+o.parameters[0]);if(j(),n.status!==200)throw new Error(`${n.status} ${n.statusText}`);let c=(await n.text()).trim();c=c.replace(/[\n\r\t ]/gm," "),c=c.replace(/ +/gm," "),So(c.split(" ")),os("repeat"),_a("word"),Ui(!1),v("mode","custom",{nosave:!0}),v("difficulty","normal",{nosave:!0}),o.parameters[1]!==null&&v("theme",o.parameters[1]),o.parameters[2]!==null&&qv(o.parameters[2])}else o.type==="accuracy"?(v("time",0,{nosave:!0}),v("mode","time",{nosave:!0}),v("difficulty","master",{nosave:!0})):o.type==="funbox"?(v("funbox",o.parameters[0],{nosave:!0}),v("difficulty","normal",{nosave:!0}),o.parameters[1]==="words"?v("words",o.parameters[2],{nosave:!0}):o.parameters[1]==="time"&&v("time",o.parameters[2],{nosave:!0}),v("mode",o.parameters[1],{nosave:!0}),o.parameters[3]!==void 0&&v("difficulty",o.parameters[3],{nosave:!0})):o.type==="special"&&o.name==="semimak"&&(v("mode","time",{nosave:!0}),v("time",120,{nosave:!0}),v("language","english_10k",{nosave:!0}),v("punctuation",!0,{nosave:!0}),v("stopOnError","word",{nosave:!0}),v("layout","semimak",{nosave:!0}),v("keymapLayout","overrideSync",{nosave:!0}),v("keymapMode","static",{nosave:!0}));return ie(),i=o.message,L("header .config")?.removeClass("hidden"),L(".page.pageTest")?.removeClass("hidden"),f(i===void 0?`Challenge '${o.display}' loaded.`:"Challenge loaded. "+i,0),Cy(o),uf=!1,!0}catch(n){return f(se(n,"Failed to load challenge"),-1),!1}}Ce(({key:e})=>{["difficulty","numbers","punctuation","mode","funbox","paceCaret","showAllLines","showLiveWpm","highlightMode","time","words","keymapMode","keymapLayout","layout"].includes(e)&&Hv()});const Id=new Map;function Qt(e,t=!0){const a=document.getElementById(e)??void 0;if(a===void 0)throw new Error(`Element with id ${e} not found`);Id.set(e,a),t&&Tt(e)}function Tt(e){const t=Id.get(e);t?t.remove():Qt(e,!0)}const E8={popups:document.getElementById("popups"),main:document.querySelector("main")};function Gt(e,t){const a=Id.get(e);E8[t].append(a)}function q8(e){return Id.has(e)}const ql=125,Il=.75;class ue{constructor(t){this.open=!1,this.setupRan=!1,t.dialogId.startsWith("#")&&(t.dialogId=t.dialogId.slice(1)),this.skeletonAppendParent=t.appendTo??"popups",q8(t.dialogId)&&Gt(t.dialogId,this.skeletonAppendParent);const a=document.getElementById(t.dialogId),o=document.querySelector(`#${t.dialogId} > .modal`);if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(!(a instanceof HTMLDialogElement))throw new Error("Animated dialog must be an HTMLDialogElement");if(a===null)throw new Error(`Dialog element with id ${t.dialogId} not found`);if(o===null)throw new Error(`Div element inside #${t.dialogId} with class 'modal' not found`);this.dialogId=t.dialogId,this.wrapperEl=a,this.modalEl=o,this.customShowAnimations=t.customAnimations?.show,this.customHideAnimations=t.customAnimations?.hide,this.previousModalInChain=void 0,this.showOptionsWhenInChain=t.showOptionsWhenInChain,this.customEscapeHandler=t?.customEscapeHandler,this.customWrapperClickHandler=t?.customWrapperClickHandler,this.setup=t?.setup,this.cleanup=t?.cleanup,Qt(this.dialogId)}getPreviousModalInChain(){return this.previousModalInChain}async runSetup(){this.wrapperEl.addEventListener("keydown",async t=>{t.key==="Escape"&&Fn(this.dialogId)&&(t.preventDefault(),t.stopPropagation(),this.customEscapeHandler!==void 0?(this.customEscapeHandler(t),this.cleanup?.()):await this.hide())}),this.wrapperEl.addEventListener("mousedown",async t=>{t.target===this.wrapperEl&&(this.customWrapperClickHandler!==void 0?(this.customWrapperClickHandler(t),this.cleanup?.()):await this.hide())}),this.setup!==void 0&&await this.setup(this.modalEl)}getDialogId(){return this.dialogId}getWrapper(){return this.wrapperEl}getModal(){return this.modalEl}isOpen(){return this.open}focusFirstInput(t){const o=[...this.modalEl.querySelectorAll("input")].find(i=>!i.classList.contains("hidden"));o!=null?t===!0?o.focus():t==="focusAndSelect"?(o.focus(),o.select()):this.wrapperEl.focus():this.wrapperEl.focus()}async show(t){return new Promise(async a=>{if(this.open){a();return}if(Gt(this.dialogId,this.skeletonAppendParent),this.setupRan||(await this.runSetup(),this.setupRan=!0),Fn(this.dialogId)){a();return}const o=Y((t?.customAnimation?.modal?.duration??t?.animationDurationMs??this.customShowAnimations?.modal?.duration??ql)*(t?.modalChain!==void 0?Il:1));t?.modalChain!==void 0&&(this.previousModalInChain=t.modalChain,await this.previousModalInChain.hide({animationMode:"modalOnly",animationDurationMs:o,dontShowPreviousModalInchain:t.modalChain.previousModalInChain!==void 0})),this.open=!0,t?.mode==="dialog"?this.wrapperEl.show():(t?.mode==="modal"||t?.mode===void 0)&&this.wrapperEl.showModal(),await t?.beforeAnimation?.(this.modalEl,t?.modalChainData),setTimeout(async()=>{this.focusFirstInput(t?.focusFirstInput)},1);const i=(t?.customAnimation?.modal??this.customHideAnimations?.modal)!==void 0,n=t?.customAnimation?.modal??this.customShowAnimations?.modal??{opacity:[0,1],marginTop:["1rem",0]},l=t?.customAnimation?.wrapper??this.customShowAnimations?.wrapper??{opacity:[0,1]},c=Y(t?.customAnimation?.wrapper?.duration??this.customShowAnimations?.wrapper?.duration??ql),d=this.previousModalInChain!==void 0?"modalOnly":t?.animationMode??"both";d==="both"||d==="none"?(i?O(this.modalEl,{...n,duration:d==="none"?0:o}):this.modalEl.style.opacity="1",O(this.wrapperEl,{...l,duration:d==="none"?0:c,onBegin:()=>{this.wrapperEl.classList.remove("hidden")},onComplete:async()=>{this.focusFirstInput(t?.focusFirstInput),await t?.afterAnimation?.(this.modalEl,t?.modalChainData),a()}})):d==="modalOnly"&&(s(this.wrapperEl).removeClass("hidden").css("opacity","1"),O(this.modalEl,{...n,duration:o,onComplete:async()=>{this.focusFirstInput(t?.focusFirstInput),await t?.afterAnimation?.(this.modalEl,t?.modalChainData),a()}}))})}async hide(t){return new Promise(async a=>{if(!Fn(this.dialogId)){a();return}t?.clearModalChain&&(this.previousModalInChain=void 0),await t?.beforeAnimation?.(this.modalEl);const o=(t?.customAnimation?.modal??this.customHideAnimations?.modal)!==void 0,i=t?.customAnimation?.modal??this.customHideAnimations?.modal??{opacity:[1,0],marginTop:[0,"1rem"]},n=Y((t?.customAnimation?.modal?.duration??t?.animationDurationMs??this.customHideAnimations?.modal?.duration??ql)*(this.previousModalInChain!==void 0?Il:1)),l=t?.customAnimation?.wrapper??this.customHideAnimations?.wrapper??{opacity:[1,0]},c=Y(t?.customAnimation?.wrapper?.duration??this.customHideAnimations?.wrapper?.duration??ql),d=this.previousModalInChain!==void 0?"modalOnly":t?.animationMode??"both";d==="both"||d==="none"?(o?O(this.modalEl,{...i,duration:d==="none"?0:n}):this.modalEl.style.opacity="1",O(this.wrapperEl,{...l,duration:d==="none"?0:c,onComplete:async()=>{this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),Tt(this.dialogId),this.open=!1,await t?.afterAnimation?.(this.modalEl),this.cleanup?.(),this.previousModalInChain!==void 0&&!t?.dontShowPreviousModalInchain&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t?.modalChainData,animationDurationMs:n*Il,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()}})):d==="modalOnly"&&(s(this.wrapperEl).removeClass("hidden").css("opacity","1"),O(this.modalEl,{...i,duration:n,onComplete:async()=>{this.wrapperEl.close(),s(this.wrapperEl).addClass("hidden").css("opacity","0"),Tt(this.dialogId),this.open=!1,await t?.afterAnimation?.(this.modalEl),this.cleanup?.(),this.previousModalInChain!==void 0&&!t?.dontShowPreviousModalInchain&&(await this.previousModalInChain.show({animationMode:"modalOnly",modalChainData:t?.modalChainData,animationDurationMs:n*Il,...this.previousModalInChain.showOptionsWhenInChain}),this.previousModalInChain=void 0),a()}}))})}destroy(){this.wrapperEl.close(),this.wrapperEl.classList.add("hidden"),this.cleanup?.(),Tt(this.dialogId),this.open=!1}}let xa=0,He=null,ke=null;function I8(){He=null}function D8(){s("#quoteRateModal .quote .text").text("-"),s("#quoteRateModal .quote .source .val").text("-"),s("#quoteRateModal .quote .id .val").text("-"),s("#quoteRateModal .quote .length .val").text("-"),s("#quoteRateModal .ratingCount .val").text("-"),s("#quoteRateModal .ratingAverage .val").text("-")}function Nv(e){return ge(e.ratings)&&ge(e.totalRating)&&e.ratings>0&&e.totalRating>0?Math.round(e.totalRating/e.ratings*10)/10:0}async function Uv(e){if(!e)return;ke=e;const t=await $.quotes.getRating({query:{quoteId:ke.id,language:ke.language}});if(j(),t.status!==200){f("Failed to get quote ratings",-1,{response:t});return}return t.body.data===null?{}:(He=t.body.data,He!==void 0&&He.average===void 0&&(He.average=Nv(He)),He)}function Zl(e){const t=e??xa;s("#quoteRateModal .star").removeClass("active");for(let a=1;a<=t;a++)s(`#quoteRateModal .star[data-rating=${a}]`).addClass("active")}async function F8(){He||await Uv(),s("#quoteRateModal .ratingCount .val").text(He?.ratings??"0"),s("#quoteRateModal .ratingAverage .val").text(He?.average?.toFixed(1)??"-")}function P8(){if(!ke)return;let e;ke.group===0?e="short":ke.group===1?e="medium":ke.group===2?e="long":ke.group===3&&(e="thicc"),s("#quoteRateModal .quote .text").text(ke.text),s("#quoteRateModal .quote .source .val").text(ke.source),s("#quoteRateModal .quote .id .val").text(ke.id),s("#quoteRateModal .quote .length .val").text(e),F8()}function B8(e,t){Vv.show({...t,beforeAnimation:async()=>{D8(),ke=e,xa=0;const o=S()?.quoteRatings?.[ke.language]?.[ke.id];ge(o)&&(xa=o),Zl(),P8()}})}function R8(e=!1){Vv.hide({clearModalChain:e})}async function W8(){if(xa===0){f("Please select a rating");return}if(!ke)return;R8(!0);const e=await $.quotes.addRating({body:{quoteId:ke.id,language:ke.language,rating:xa}});if(j(),e.status!==200){f("Failed to submit quote rating",-1,{response:e});return}const t=S();if(!t)return;const a=t.quoteRatings??{},o=a?.[ke.language]??{};if(ge(o?.[ke.id])){const i=a[ke.language]?.[ke.id],n=xa-i;o[ke.id]=xa,He={ratings:He?.ratings,totalRating:isNaN(He?.totalRating)?0:He?.totalRating+n,quoteId:ke.id,language:ke.language},f("Rating updated",1)}else o[ke.id]=xa,ge(He?.ratings)&&ge(He.totalRating)?(He.ratings++,He.totalRating+=xa):He={ratings:1,totalRating:xa,quoteId:ke.id,language:ke.language},f("Rating submitted",1);t.quoteRatings=a,dt(t),He.average=Nv(He),s(".pageTest #result #rateQuoteButton .rating").text(He.average?.toFixed(1)),s(".pageTest #result #rateQuoteButton .icon").removeClass("far"),s(".pageTest #result #rateQuoteButton .icon").addClass("fas")}async function z8(e){e.querySelector(".submitButton")?.addEventListener("click",()=>{W8()});const t=e.querySelectorAll(".stars button.star");for(const a of t)a.addEventListener("click",o=>{xa=parseInt(o.currentTarget.getAttribute("data-rating")),Zl()}),a.addEventListener("mouseenter",o=>{const i=parseInt(o.currentTarget.getAttribute("data-rating"));Zl(i)}),a.addEventListener("mouseleave",()=>{Zl()})}const Vv=new ue({dialogId:"quoteRateModal",setup:z8}),mu={quotes:[],length:0,language:null,groups:[]};class H8{constructor(){this.quoteCollection=mu,this.quoteQueue=[],this.queueIndex=0}async getQuotes(t,a){const o=Ta(t);if(this.quoteCollection.language!==o){const{data:i,error:n}=await jt(gi(`quotes/${o}.json`));if(n){if(n instanceof Error&&(n?.message?.includes("404")||n?.message?.includes("Content is not JSON")))return mu;throw n}if(i.quotes===void 0||i.quotes.length===0)return mu;this.quoteCollection={quotes:[],length:i.quotes.length,groups:[],language:i.language},i.quotes.forEach(l=>{const c={text:l.text,britishText:l.britishText,source:l.source,length:l.length,id:l.id,language:i.language,group:0};this.quoteCollection.quotes.push(c)}),i.groups.forEach((l,c)=>{const d=l[0],u=l[1];this.quoteCollection.groups[c]=this.quoteCollection.quotes.filter(m=>m.length>=d&&m.length<=u?(m.group=c,!0):!1)}),a!==void 0&&this.updateQuoteQueue(a)}return this.quoteCollection}getQuoteById(t){return this.quoteCollection.quotes.find(o=>o.id===t)}updateQuoteQueue(t){this.quoteQueue=[],t.forEach(a=>{a<0||this.quoteCollection.groups[a]?.forEach(o=>{this.quoteQueue.push(o)})}),Un(this.quoteQueue),this.queueIndex=0}getRandomQuote(){if(this.quoteQueue.length===0)return null;this.queueIndex>=this.quoteQueue.length&&(this.queueIndex=0,Un(this.quoteQueue));const t=this.quoteQueue[this.queueIndex];return this.queueIndex+=1,t}getRandomFavoriteQuote(t){const a=S();if(!a)return null;const o=Ta(t),i=[],{favoriteQuotes:n}=a;if(n===void 0||(Object.keys(n).forEach(d=>{Ta(d)===o&&i.push(...n[d]??[])}),i.length===0))return null;const l=Ia(i);return this.getQuoteById(parseInt(l,10))??null}isQuoteFavorite({language:t,id:a}){const o=S();if(!o)return!1;const{favoriteQuotes:i}=o;if(i===void 0)return!1;const n=Ta(t);return Object.keys(i).find(c=>n!==Ta(c)?!1:(i[c]??[]).includes(a.toString()))!==void 0}async setQuoteFavorite(t,a){const o=S();if(!o)throw new Error("Snapshot is not available");if(a){const i=await $.users.addQuoteToFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(i.status===200)o.favoriteQuotes??={},o.favoriteQuotes[t.language]??=[],o.favoriteQuotes[t.language]?.push(`${t.id}`);else throw new Error(i.body.message)}else{const i=await $.users.removeQuoteFromFavorites({body:{language:t.language,quoteId:`${t.id}`}});if(i.status===200){const n=o.favoriteQuotes?.[t.language]?.indexOf(`${t.id}`);o.favoriteQuotes?.[t.language]?.splice(n,1)}else throw new Error(i.body.message)}}}const rt=new H8;Ce(({key:e,newValue:t})=>{e==="quoteLength"&&rt.updateQuoteQueue(t)});let Kv=!1;function Mh(){return Kv}function O8(){Kv=!0,console.log("Glarses Mode On - test result will be hidden. You can check the stats in the console (here)"),console.log("To disable Glarses Mode refresh the page.")}function N8(){ff=!1,s("#result .stats .wpm .crown").css("opacity",0).addClass("hidden")}let ff=!1,jv="normal";function U8(){return jv}function Gv(){if(ff)return;ff=!0;const e=document.querySelector("#result .stats .wpm .crown");O(e,{opacity:[0,1],duration:Y(125),onBegin:()=>{e.classList.remove("hidden")}})}function Qv(e){jv=e;const t=s("#result .stats .wpm .crown");t.removeClass("ineligible"),t.removeClass("pending"),t.removeClass("error"),t.removeClass("warning"),t.addClass(e)}function Dd(e,t,a,o,i){const n=e==="words"&&(t>=1e3||t===0),l=e==="time"&&(a>=900||a===0),c=e==="custom"&&i,d=e==="custom"&&(o.limit.mode==="word"||o.limit.mode==="section")&&(o.limit.value>=1e3||o.limit.value===0),u=e==="custom"&&o.limit.mode==="time"&&(o.limit.value>=900||o.limit.value===0);return!(n||l||c||d||u)}let M,Ua,ec=!0,Fo,xn="";function V8(){ec=!ec,f(ec?"on":"off",1),Ie&&_m().then(()=>{me.update("resize")})}let Lo=[];async function _m(){if(M.chartData==="toolong")return;const e=bt(r.typingSpeedUnit);me.getScale("wpm").title.text=e.fullUnitString;let t=[];for(let u=1;u<=Xo.length;u++)ji&&u===Xo.length?t.push(K(M.testDuration).toString()):t.push(u.toString());const a=[...M.chartData.wpm.map(u=>K(e.fromWpm(u)))],o=[...Vr.map(u=>K(e.fromWpm(u)))],i=Math.max(...M.chartData.burst)*.25,l=[...T2(M.chartData.burst,1,ec?i:0).map(u=>K(e.fromWpm(u)))];r.mode!=="time"&&ji&&M.testDuration%1<.5&&(t.pop(),a.pop(),o.pop()),Ua=Math.max(Math.max(...a),Math.max(...o),Math.max(...l));let c=0;r.startGraphsAtZero||(c=Math.min(Math.min(...a),Math.min(...o),Math.min(...l)),c=Math.floor(c/10)*10);const d=await Zt("sub");if(r.funbox.length>0){let u="";for(const m of no())u+=m.name,m.functions?.getResultContent&&(u+="("+m.functions.getResultContent()+")"),u+=" ";u=u.trimEnd(),Lo.push({display:!0,id:"funbox-label",type:"line",scaleID:"wpm",value:me.getScale("wpm").min,borderColor:"transparent",borderWidth:1,borderDash:[2,2],label:{backgroundColor:"transparent",font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:wa.defaults.font.weight,lineHeight:wa.defaults.font.lineHeight},color:d,padding:3,borderRadius:3,position:"start",display:!0,content:`${u}`}})}me.data.labels=t,me.getDataset("wpm").data=a,me.getDataset("wpm").label=r.typingSpeedUnit,me.getScale("wpm").min=c,me.getScale("wpm").max=Ua,me.getDataset("raw").data=o,me.getScale("raw").min=c,me.getScale("raw").max=Ua,me.getDataset("burst").data=l,me.getScale("burst").min=c,me.getScale("burst").max=Ua,me.getDataset("error").data=M.chartData.err,me.getScale("error").max=Math.max(...M.chartData.err)}async function Yv(){const e=await pi(),a=(await Gn(M.mode,M.mode2,M.punctuation??!1,M.numbers??!1,M.language,M.difficulty,M.lazyMode??!1,fr(M.funbox)))?.wpm??0;if(a===0)return;const o=bt(r.typingSpeedUnit),i=K(o.fromWpm(a)).toFixed(2);Lo.push({display:!0,type:"line",id:"lpb",scaleID:"wpm",value:i,borderColor:e.sub+"55",borderWidth:1,label:{backgroundColor:e.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:wa.defaults.font.weight,lineHeight:wa.defaults.font.lineHeight},color:e.bg,padding:3,borderRadius:3,position:"center",content:` PB: ${i} `,display:!0}});const n=o.fromWpm(20);Ua>=parseFloat(i)-n&&Ua<=parseFloat(i)+n&&(Ua=Math.round(parseFloat(i)+n)),me.getScale("wpm").max=Ua,me.getScale("raw").max=Ua,me.getScale("burst").max=Ua}function Xv(){let e=!1;if(M.wpm>=1e3&&(e=!0),s("#result .stats .wpm .top .text").text(r.typingSpeedUnit),e?s("#result .stats .wpm .bottom").text("Infinite"):s("#result .stats .wpm .bottom").text(W.typingSpeed(M.wpm)),s("#result .stats .raw .bottom").text(W.typingSpeed(M.rawWpm)),s("#result .stats .acc .bottom").text(M.acc===100?"100%":W.accuracy(M.acc)),r.alwaysShowDecimalPlaces){r.typingSpeedUnit!=="wpm"?(s("#result .stats .wpm .bottom").attr("aria-label",M.wpm.toFixed(2)+" wpm"),s("#result .stats .raw .bottom").attr("aria-label",M.rawWpm.toFixed(2)+" wpm")):(s("#result .stats .wpm .bottom").removeAttr("aria-label"),s("#result .stats .raw .bottom").removeAttr("aria-label"));let t=K(M.testDuration).toFixed(2)+"s";M.testDuration>61&&(t=Re(K(M.testDuration))),s("#result .stats .time .bottom .text").text(t),s("#result .stats .acc .bottom").attr("aria-label",`${ha.correct} correct
${ha.incorrect} incorrect`)}else{const t={showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`};let a=W.typingSpeed(M.wpm,t),o=W.typingSpeed(M.rawWpm,t);r.typingSpeedUnit!=="wpm"&&(a+=" ("+M.wpm.toFixed(2)+" wpm)",o+=" ("+M.rawWpm.toFixed(2)+" wpm)"),s("#result .stats .wpm .bottom").attr("aria-label",a),s("#result .stats .raw .bottom").attr("aria-label",o),s("#result .stats .acc .bottom").attr("aria-label",`${M.acc===100?"100%":W.percentage(M.acc,{showDecimalPlaces:!0})}
${ha.correct} correct
${ha.incorrect} incorrect`).attr("data-balloon-break","")}}function K8(){s("#result .stats .consistency .bottom").text(W.percentage(M.consistency)),r.alwaysShowDecimalPlaces?s("#result .stats .consistency .bottom").attr("aria-label",W.percentage(M.keyConsistency,{showDecimalPlaces:!0,suffix:" key"})):s("#result .stats .consistency .bottom").attr("aria-label",`${M.consistency}% (${M.keyConsistency}% key)`)}function j8(){const e=K(M.afkDuration/M.testDuration*100);if(s("#result .stats .time .bottom .afk").text(""),e>0&&s("#result .stats .time .bottom .afk").text(e+"% afk"),s("#result .stats .time .bottom").attr("aria-label",`${M.afkDuration}s afk ${e}%`),r.alwaysShowDecimalPlaces){let t=K(M.testDuration).toFixed(2)+"s";M.testDuration>61&&(t=Re(K(M.testDuration))),s("#result .stats .time .bottom .text").text(t)}else{let t=Math.round(M.testDuration)+"s";M.testDuration>61&&(t=Re(Math.round(M.testDuration))),s("#result .stats .time .bottom .text").text(t),s("#result .stats .time .bottom").attr("aria-label",`${K(M.testDuration)}s (${M.afkDuration}s afk ${e}%)`)}}function G8(){s("#result .stats .time .bottom .timeToday").text($8())}function Q8(){s("#result .stats .key .bottom").text(M.charStats[0]+"/"+M.charStats[1]+"/"+M.charStats[2]+"/"+M.charStats[3])}function tc(e){Gv(),Qv(e)}function nr(e,t=!1){s("#result .stats .wpm .crown").attr("aria-label",e),s("#result .stats .wpm .crown").attr("data-balloon-length",t?"medium":"")}async function Y8(e){if(r.mode==="quote"||e){pf();return}let t=0;const a=await Jv();if(console.debug("Result can get PB:",a.value,a.reason??""),a.value){const o=await Gn(r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,no()),i=o?.wpm??0;t=M.wpm-i,console.debug("Local PB",o,"diff",t),t<=0?(pf(),console.debug("Hiding crown")):(console.debug("Showing pending crown"),tc("pending"),nr("+"+W.typingSpeed(t,{showDecimalPlaces:!0})))}else{const o=await Gn(r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,[]),i=o?.wpm??0;t=M.wpm-i,console.debug("Local PB",o,"diff",t),t<=0?(console.debug("Showing warning crown"),tc("warning"),nr(`This result is not eligible for a new PB (${a.reason})`,!0)):(console.debug("Showing ineligible crown"),tc("ineligible"),nr(`You could've gotten a new PB (+${W.typingSpeed(t,{showDecimalPlaces:!0})}), but your config does not allow it (${a.reason})`,!0))}}function pf(){N8(),nr("")}function X8(){U8()==="pending"&&(Gv(),Qv("error"),nr("Local PB data is out of sync with the server - please refresh (pb mismatch)",!0))}async function Jv(){const e=M.funbox,a=fr(M.funbox).every(l=>l?.canGetPb),o=e.length===0||a,i=r.stopOnError==="letter"&&M.acc<100,n=!M.bailedOut;return o&&!i&&n?{value:!0}:o?i?{value:!1,reason:"stop on letter"}:n?{value:!1,reason:"unknown"}:{value:!1,reason:"bailed out"}:{value:!1,reason:"funbox"}}function Zv(){if(Sd())return;const e=getComputedStyle(document.body),t=[e.getPropertyValue("--main-color"),e.getPropertyValue("--text-color"),e.getPropertyValue("--sub-color")],a=Date.now()+125;(function o(){Pg({particleCount:5,angle:60,spread:75,origin:{x:0},colors:t}),Pg({particleCount:5,angle:120,spread:75,origin:{x:1},colors:t}),Date.now()<a&&requestAnimationFrame(o)})()}async function J8(e){const t=[],a=S()?.tags?.length??0;try{S()?.tags?.forEach(n=>{n.active===!0&&t.push(n)})}catch{}a===0?s("#result .stats .tags").addClass("hidden"):s("#result .stats .tags").removeClass("hidden"),t.length===0?s("#result .stats .tags .bottom").html("<div class='noTags'>no tags</div>"):s("#result .stats .tags .bottom").text(""),s("#result .stats .tags .editTagsButton").attr("data-result-id",""),s("#result .stats .tags .editTagsButton").attr("data-active-tag-ids",t.map(n=>n._id).join(",")),s("#result .stats .tags .editTagsButton").addClass("invisible");let o="start",i=15;for(const n of t){const l=await My(n._id,r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode);s("#result .stats .tags .bottom").append(`
      <div tagid="${n._id}" aria-label="PB: ${l}" data-balloon-pos="up">${n.display}<i class="fas fa-crown hidden"></i></div>
    `);const c=bt(r.typingSpeedUnit);if(r.mode!=="quote"&&!e&&(await Jv()).value)if(l<M.wpm)await d5(n._id,r.mode,M.mode2,r.punctuation,r.numbers,r.language,r.difficulty,r.lazyMode,M.wpm,M.acc,M.rawWpm,M.consistency),s(`#result .stats .tags .bottom div[tagid="${n._id}"] .fas`).removeClass("hidden"),s(`#result .stats .tags .bottom div[tagid="${n._id}"]`).attr("aria-label","+"+K(M.wpm-l));else{const d=await pi();Lo.push({display:!0,type:"line",id:"tpb",scaleID:"wpm",value:c.fromWpm(l),borderColor:d.sub+"55",borderWidth:1,label:{backgroundColor:d.sub,font:{family:r.fontFamily.replace(/_/g," "),size:11,style:"normal",weight:wa.defaults.font.weight,lineHeight:wa.defaults.font.lineHeight},color:d.bg,padding:3,borderRadius:3,position:o,xAdjust:i,display:!0,content:`${n.display} PB: ${K(c.fromWpm(l)).toFixed(2)}`}}),o==="start"?(o="end",i=-15):(o="start",i=15)}}}function Z8(e){let t="";t+=r.mode,r.mode==="time"?t+=" "+r.time:r.mode==="words"?t+=" "+r.words:r.mode==="quote"&&e?.group!==void 0&&(t+=" "+["short","medium","long","thicc"][e.group]);const a=_o("ignoresLanguage");r.mode!=="custom"&&!a&&(t+="<br>"+Ra(M.language)),r.punctuation&&(t+="<br>punctuation"),r.numbers&&(t+="<br>numbers"),r.blindMode&&(t+="<br>blind"),r.lazyMode&&(t+="<br>lazy"),r.funbox.length>0&&(t+="<br>"+r.funbox.map(o=>o.replace(/_/g," ")).join(", ")),r.difficulty==="expert"?t+="<br>expert":r.difficulty==="master"&&(t+="<br>master"),r.stopOnError!=="off"&&(t+=`<br>stop on ${r.stopOnError}`),s("#result .stats .testType .bottom").html(t)}function e9(e,t,a,o,i){let n="";if(e&&(n+=`<br>failed (${t})`),a&&(n+="<br>afk detected"),am){n+="<br>invalid";const l=[];(M.wpm<0||M.wpm>350&&M.mode!=="words"&&M.mode2!=="10"||M.wpm>420&&M.mode==="words"&&M.mode2==="10")&&l.push("wpm"),(M.rawWpm<0||M.rawWpm>350&&M.mode!=="words"&&M.mode2!=="10"||M.rawWpm>420&&M.mode==="words"&&M.mode2==="10")&&l.push("raw"),(M.acc<75||M.acc>100)&&l.push("accuracy"),l.length>0&&(n+=` (${l.join(",")})`)}o&&(n+="<br>repeated"),M.bailedOut&&(n+="<br>bailed out"),i&&(n+="<br>too short"),n===""?s("#result .stats .info").addClass("hidden"):(s("#result .stats .info").removeClass("hidden"),n=n.substring(4),s("#result .stats .info .bottom").html(n))}function t9(e){if(r.mode==="quote"){if(e===null){console.error("Failed to update quote rating button: randomQuote is null");return}const t=S()?.quoteRatings?.[e.language]?.[e.id];ge(t)&&s(".pageTest #result #rateQuoteButton .icon").removeClass("far").addClass("fas"),Uv(e).then(a=>{s(".pageTest #result #rateQuoteButton .rating").text(a?.average?.toFixed(1)??"")}).catch(a=>{s(".pageTest #result #rateQuoteButton .rating").text("?")}),s(".pageTest #result #rateQuoteButton").css({opacity:0}).removeClass("hidden").css({opacity:1})}}function a9(e){const t=s(".pageTest #result #favoriteQuoteButton .icon");if(r.mode!=="quote"||!_()){t.parent().addClass("hidden");return}if(e===null){console.error("Failed to update quote favorite button: randomQuote is null");return}Fo=r.mode==="quote"?e.language:void 0,xn=r.mode==="quote"?e.id.toString():"";const a=rt.isQuoteFavorite(e);t.removeClass(a?"far":"fas").addClass(a?"fas":"far"),t.parent().removeClass("hidden")}function o9(e){r.mode==="quote"?(s("#result .stats .source").removeClass("hidden"),s("#result .stats .source .bottom").html(e?.source??"Error: Source unknown")):s("#result .stats .source").addClass("hidden")}async function i9(e,t,a,o,i,n,l,c){Lo=[],M=structuredClone(e),pf(),s("#resultWordsHistory .words").empty(),s("#result #resultWordsHistory").addClass("hidden"),s("#result #replayStats").text(""),s("#result #resultReplay").addClass("hidden"),s("#result #replayWords").empty(),s("#retrySavingResultButton").addClass("hidden"),s(".pageTest #result #rateQuoteButton .icon").removeClass("fas").addClass("far"),s(".pageTest #result #rateQuoteButton .rating").text(""),s(".pageTest #result #rateQuoteButton").addClass("hidden"),s("#words").removeClass("blurred"),Ap(),s("#result .stats .time .bottom .afk").text(""),_()?s("#result .loginTip").addClass("hidden"):s("#result .loginTip").removeClass("hidden"),r.ads==="off"||r.ads==="result"?s("#result #watchVideoAdButton").addClass("hidden"):s("#result #watchVideoAdButton").removeClass("hidden"),Xv(),K8(),j8(),Q8(),Z8(l),o9(l),a9(l),await Y8(c),await _m(),await Yv(),await J8(c),ew(),e9(t,a,o,i,n),me.options.plugins.annotation.annotations=Lo,me.updateColors(),me.resize(),s("#result .stats .tags").hasClass("hidden")&&s("#result .stats .info").hasClass("hidden")?s("#result .stats .infoAndTags").addClass("hidden"):s("#result .stats .infoAndTags").removeClass("hidden"),Mh()?(s("main #result .noStressMessage").remove(),s("main #result").prepend(`

      <div class='noStressMessage' style="
        text-align: center;
        grid-column: 1/3;
        font-size: 2rem;
        padding-bottom: 2rem;
      ">
      <i class="fas fa-check"></i>
      </div>

    `),s("main #result .stats").addClass("hidden"),s("main #result .chart").addClass("hidden"),s("main #result #resultWordsHistory").addClass("hidden"),s("main #result #resultReplay").addClass("hidden"),s("main #result .loginTip").addClass("hidden"),s("main #result #showWordHistoryButton").addClass("hidden"),s("main #result #watchReplayButton").addClass("hidden"),s("main #result #saveScreenshotButton").addClass("hidden"),console.log(`Test Completed: ${M.wpm} wpm ${M.acc}% acc ${M.rawWpm} raw ${M.consistency}% consistency`)):(s("main #result .stats").removeClass("hidden"),s("main #result .chart").removeClass("hidden"),_()||s("main #result .loginTip").removeClass("hidden"),s("main #result #showWordHistoryButton").removeClass("hidden"),s("main #result #watchReplayButton").removeClass("hidden"),s("main #result #saveScreenshotButton").removeClass("hidden")),D4(),eo(!1);const d=Dd(r.mode,r.words,r.time,xo(),to()??!1);r.alwaysShowWordsHistory&&d&&!Mh()&&ym(!0),zc(!0),_n(),s(".pageTest .loading").addClass("hidden"),s("#result").removeClass("hidden");const u=document.querySelector("#result");u?.focus({preventScroll:!0}),await gt("#result",{opacity:[0,1],duration:Y(125)}),Nb(u),J4(),wv(!1),s("#words").empty(),me.resize()}const mf=new ut({key:"resultChartDataVisibility",schema:I.object({raw:I.boolean(),burst:I.boolean(),errors:I.boolean(),pbLine:I.boolean(),tagPbLine:I.boolean()}).strict(),fallback:{raw:!0,burst:!0,errors:!0,pbLine:!0,tagPbLine:!0}});function ew(e=!1){const t=mf.get();me.getDataset("raw").hidden=!t.raw,me.getDataset("burst").hidden=!t.burst,me.getDataset("error").hidden=!t.errors;for(const i of Lo)i.id==="lpb"?i.display=t.pbLine:i.id==="tpb"&&(i.display=t.tagPbLine);e&&me.update();const a=s(".pageTest #result .chart .chartLegend button"),o=Lo.some(i=>i.id==="tpb");for(const i of a){const n=s(i).data("id");if(n!=="raw"&&n!=="burst"&&n!=="errors"&&n!=="pbLine"&&n!=="tagPbLine")return;s(i).toggleClass("active",t[n]),n==="pbLine"?s(i).toggleClass("hidden",!_()):n==="tagPbLine"&&s(i).toggleClass("hidden",!_()||!o)}}function n9(e,t){const a=[];if(e.length>0)for(const o of e)S()?.tags?.forEach(i=>{o===i._id&&a.push(i.display)});if(e.length===0)s(".pageTest #result .tags .bottom").html("<div class='noTags'>no tags</div>");else{s(".pageTest #result .tags .bottom div.noTags").remove();const o=s(".pageTest #result .tags .bottom div[tagid]"),i=[];o.each((l,c)=>{const d=s(c).attr("tagid");e.includes(d)?i.push(d):s(c).remove()});let n="";e.forEach((l,c)=>{i.includes(l)||(t.includes(l)?n+=`<div tagid="${l}" data-balloon-pos="up">${a[c]}<i class="fas fa-crown"></i></div>`:n+=`<div tagid="${l}">${a[c]}</div>`)}),s(".pageTest #result .tags .bottom").append(n),s(".pageTest #result .tags .top .editTagsButton").attr("active-tag-ids",e.join(","))}}s(".pageTest #result .chart .chartLegend button").on("click",e=>{const a=s(e.target).data("id");if(a!=="raw"&&a!=="burst"&&a!=="errors"&&a!=="pbLine"&&a!=="tagPbLine")return;const o=mf.get();o[a]=!o[a],mf.set(o),ew(!0)});s(".pageTest #favoriteQuoteButton").on("click",async()=>{if(Fo===void 0||xn===""){f("Could not get quote stats!",-1);return}const e=s(".pageTest #favoriteQuoteButton .icon"),t=S();if(t)if(e.hasClass("fas")){oe();const a=await $.users.removeQuoteFromFavorites({body:{language:Fo,quoteId:xn}});if(j(),f(a.body.message,a.status===200?1:-1),a.status===200){e.removeClass("fas").addClass("far");const o=t.favoriteQuotes?.[Fo]?.indexOf(xn);t.favoriteQuotes?.[Fo]?.splice(o,1)}}else{oe();const a=await $.users.addQuoteToFavorites({body:{language:Fo,quoteId:xn}});j(),f(a.body.message,a.status===200?1:-1),a.status===200&&(e.removeClass("far").addClass("fas"),t.favoriteQuotes??={},t.favoriteQuotes[Fo]??=[],t.favoriteQuotes[Fo]?.push(xn))}});Ce(async({key:e})=>{["typingSpeedUnit","startGraphsAtZero"].includes(e)&&Ie&&(Lo=[],Xv(),await _m(),await Yv(),ir(),me.options.plugins.annotation.annotations=Lo,me.updateColors(),me.resize())});const s9={laborers:"labourers",industrialized:"industrialised",acclimatizing:"acclimatising",acclimatized:"acclimatised",behoove:"behove",reorganization:"reorganisation",galvanize:"galvanise",demagogism:"demagoguism",canceled:"cancelled",baptize:"baptise",revitalize:"revitalise",skeptical:"sceptical",piscine:"piscinae",ionization:"ionisation",chili:"chilli",dexterous:"dextrous",likable:"likeable",neutralize:"neutralise",meter:"metre",meters:"metres",centimeter:"centimetre",hurrah:"hooray",multicolor:"multicolour",actualization:"actualisation",fertilizing:"fertilising",enamor:"enamour",skepticism:"scepticism",authorize:"authorise",minimize:"minimise",bandoleer:"bandolier",rigor:"rigour",fledgling:"fledgeling",mesquite:"mesquit",fogy:"fogey",characterize:"characterise",wagonette:"waggonette",plagiarize:"plagiarise",kilometers:"kilometres",molt:"moult",leveler:"leveller",checkered:"chequered",vendor:"vender",candor:"candour",moralize:"moralise",denationalization:"denationalisation",anemia:"anaemia",caiman:"cayman",chitterlings:"chitlins",acclimated:"acclimatised",acclimate:"acclimatise",skillful:"skilful",enamored:"enamoured",watercolor:"watercolour",extemporization:"extemporisation",lackluster:"lacklustre",equalizer:"equaliser",cipher:"cypher",polarization:"polarisation",polymerization:"polymerisation",ionize:"ionise",anesthetic:"anaesthetic",aerie:"eyrie",lachrymal:"lacrimal",decimeter:"decimetre",rajah:"raja",modernize:"modernise",gasoline:"petrol",alphabetized:"alphabetised",saber:"sabre",burglarize:"burglarise",terrorize:"terrorise",enthrall:"enthral",mustachioed:"moustachioed",anesthesia:"anaesthesia",sepulcher:"sepulchre",caftan:"kaftan",organize:"organise",manikin:"mannikin",dexterously:"dextrously",artifact:"artefact",kilometer:"kilometre",mommy:"mummy",brant:"brent",hyena:"hyaena",fuze:"fuse",victimize:"victimise",jihad:"jehad",airplane:"aeroplane",laborer:"labourer",vaporware:"vapourware",worshiped:"worshipped",taboret:"tabouret",rationalize:"rationalise",whimsy:"whimsey",scandalize:"scandalise",categorization:"categorisation",centered:"centred",kerosene:"kerosine",specialize:"specialise",specialized:"specialised",cicatrix:"cicatrice",jailer:"jailor",unfavorable:"unfavourable",guerrilla:"guerilla",emphasize:"emphasise",wacky:"whacky",ionizing:"ionising",czarina:"tzarina",ratline:"ratlin",abolitionize:"abolitionise",subsidize:"subsidise",plowing:"ploughing",untrammeled:"untrammelled",worshiping:"worshipping",memorization:"memorisation",anglicize:"anglicise",finalize:"finalise",gases:"gasses",fertilization:"fertilisation",libeling:"libelling",kinesthetic:"kinaesthetic",immunization:"immunisation",coloration:"colouration",overdraft:"overdraught",lambaste:"lambast",unpasteurized:"unpasteurised",ascendance:"ascendence",jeweler:"jeweller",fervor:"fervour",jeopardize:"jeopardise",abridgment:"abridgement",monopolize:"monopolise",colorless:"colourless",colorlessness:"colourlessness",tumors:"tumours",jinni:"jinn",aluminum:"aluminium",salable:"saleable",bronco:"broncho",lupine:"lupin",linchpin:"lynchpin",mesmerize:"mesmerise",internationalization:"internationalisation",anapestic:"anapaestic",supersede:"supercede",europeanize:"europeanise",optimized:"optimised",botanize:"botanise",organizational:"organisational",heme:"haem",estivation:"aestivation",edema:"oedema",penalize:"penalise",peddler:"pedlar",biased:"biassed",aggrandize:"aggrandise",rationalizing:"rationalising",deputize:"deputise",centers:"centres",unicolor:"unicolour",hypnotized:"hypnotised",anglicized:"anglicised",initialization:"initialisation",topee:"topi",nightie:"nighty",tricolor:"tricolour",reorganize:"reorganise",barbecue:"barbeque",fertilized:"fertilised",synthesize:"synthesise",economize:"economise",colter:"coulter",paleontologist:"palaeontologist",acclimatize:"acclimatise",idealize:"idealise",fossilization:"fossilisation",lionize:"lionise",acclimating:"acclimatising",luster:"lustre",demeanor:"demeanour",unauthorized:"unauthorised",smolder:"smoulder",abettor:"abetter",jewelry:"jewellery",demoralization:"demoralisation",fullness:"fulness",neighbored:"neighboured",neighbor:"neighbour",neighbors:"neighbours",neighboring:"neighbouring",neighborly:"neighbourly",neighborhood:"neighbourhood",neighborhoods:"neighbourhoods",magnetizer:"magnetiser",appetizer:"appetiser",hebraizing:"hebraising",carbonization:"carbonisation",favorably:"favourably",favorite:"favourite",behavioral:"behavioural",cognizant:"cognisant",skeptic:"sceptic",fiber:"fibre",fibers:"fibres",labeled:"labelled",analyze:"analyse",disorganization:"disorganisation",concenter:"concentre",categorize:"categorise",novelization:"novelisation",proselytize:"proselytise",draftsman:"draughtsman",paralyze:"paralyse",ostracize:"ostracise",italicize:"italicise",micrometer:"micrometre",cognizance:"cognisance",saltpeter:"saltpetre",conceptualization:"conceptualisation",containerization:"containerisation",anapest:"anapaest",leukemia:"leukaemia",omelet:"omelette",industrialize:"industrialise",characterization:"characterisation",amortize:"amortise",mazurka:"mazourka",macadamize:"macadamise",stymie:"stymy",analog:"analogue",prizer:"priser",cauterize:"cauterise",dysmenorrhea:"dysmenorrhoea",hippie:"hippy",mechanization:"mechanisation",commercialize:"commercialise",unsavory:"unsavoury",somber:"sombre",esophageal:"oesophageal",iodized:"iodised",tyrannize:"tyrannise",liberalize:"liberalise",computerization:"computerisation",synthesizer:"synthesiser",fertilizes:"fertilises",airdrome:"aerodrome",uncivilized:"uncivilised",mold:"mould",nitrogenized:"nitrogenised",legalize:"legalise",tantalize:"tantalise",eulogize:"eulogise",depolarization:"depolarisation",fecal:"faecal",bastardize:"bastardise",summarize:"summarise",cony:"coney",authorization:"authorisation",colorful:"colourful",temporized:"temporised",adviser:"advisor",tendinitis:"tendonitis",crystallization:"crystallisation",humor:"humour",humorous:"humourous",chanty:"shanty",dyspnea:"dyspnoea",aging:"ageing",mousy:"mousey",succor:"succour",distill:"distil",decentralization:"decentralisation",cauterization:"cauterisation",specter:"spectre",snowplow:"snowplough",pediatrics:"paediatrics",discoloration:"discolouration",tumor:"tumour",empathize:"empathise",pawpaw:"papaya",aggrandizement:"aggrandisement",fontanel:"fontanelle",brunet:"brunette",rumor:"rumour",epaulet:"epaulette",glycerin:"glycerine",fraternize:"fraternise",latinize:"latinise",sniveling:"snivelling",pasteurize:"pasteurise",modernization:"modernisation",patronize:"patronise",totaled:"totalled",normalization:"normalisation",niter:"nitre",shoveler:"shoveller",flier:"flyer",equalization:"equalisation",meagerly:"meagrely",favoritism:"favouritism",libelous:"libellous",popularized:"popularised",armory:"armoury",humanization:"humanisation",minuscule:"miniscule",collectible:"collectable",tepee:"teepee",stabilization:"stabilisation",moldy:"mouldy",colonize:"colonise",idealized:"idealised",meager:"meagre",armorer:"armourer",vitalize:"vitalise",fossilized:"fossilised",antagonize:"antagonise",criticize:"criticise",liter:"litre",stigmatize:"stigmatise",theorize:"theorise",combated:"combatted",desalination:"desalinisation",evangelize:"evangelise",idolization:"idolisation",smoldering:"smouldering",commercialization:"commercialisation",laureled:"laurelled",hematology:"haematology",fulfill:"fulfil",disorganized:"disorganised",accouterments:"accoutrements",busses:"buses",utilize:"utilise",enroll:"enrol",goiter:"goitre",stylized:"stylised",diarrhea:"diarrhoea",hypothesize:"hypothesise",esthetic:"aesthetic",dishonor:"dishonour",victualer:"victualler",paleolithic:"palaeolithic",sanatorium:"sanitarium",feminization:"feminisation",flotation:"floatation",teetotaler:"teetotaller",feudalization:"feudalisation",visualize:"visualise",fertilize:"fertilise",czar:"tzar",nationalization:"nationalisation",septicemia:"septicaemia",organizer:"organiser",recrystallization:"recrystallisation",dolor:"dolour",agonizing:"agonising",romanization:"romanisation",synchronize:"synchronise",amorist:"amourist",agonized:"agonised",belabor:"belabour",caster:"castor",softy:"softie",apothegm:"apophthegm",demobilization:"demobilisation",agonizes:"agonises",misdemeanor:"misdemeanour",recognizable:"recognisable",asshole:"arsehole",brutalization:"brutalisation",chamois:"shammy",clamor:"clamour",fertilizer:"fertiliser",deodorization:"deodorisation",privatization:"privatisation",tidbit:"titbit",molding:"moulding",alleluia:"halleluiah",canonization:"canonisation",customize:"customise",customization:"customisations",customizer:"customiser",customizers:"customisers",customizes:"customises",customizing:"customising",popularize:"popularise",specialty:"speciality",meagerness:"meagreness",esophagus:"oesophagus",millimeter:"millimetre",harmonization:"harmonisation",atomizer:"atomiser",dieresis:"diaeresis",maneuver:"manoeuvre",capitalize:"capitalise",gynecologist:"gynaecologist",acclimation:"acclimatisation",generalize:"generalise",temporize:"temporise",premunire:"praemunire",estival:"aestival",selvage:"selvedge",brier:"briar",hyperesthesia:"hyperaesthesia",maximize:"maximise",draftsmen:"draughtsmen",colonization:"colonisation",capitalization:"capitalisation",tenia:"taenia",paleontology:"palaeontology",libeler:"libeller",arytenoid:"arytaenoid",wainscoting:"wainscotting",globalization:"globalisation",legalization:"legalisation",magnetization:"magnetisation",stabilize:"stabilise",mesmerized:"mesmerised",savory:"savoury",reconnoiter:"reconnoitre",bastardized:"bastardised",rancor:"rancour",checker:"chequer",industrialization:"industrialisation",epitomize:"epitomise",socialize:"socialise",externalization:"externalisation",chivy:"chivvy",optimize:"optimise",romanize:"romanise",vulcanize:"vulcanise",plow:"plough",memorize:"memorise",sterilization:"sterilisation",routing:"routeing",raveling:"ravelling",savor:"savour",harmonize:"harmonise",cannibalize:"cannibalise",vaporize:"vaporise",utilization:"utilisation",hybridization:"hybridisation",mechanize:"mechanise",arbor:"arbour",arbors:"arbours",licorice:"liquorice",counselor:"counsellor",orthopedic:"orthopaedic",lusterless:"lustreless",numskull:"numbskull",paleozoic:"palaeozoic",malodor:"malodour",amenorrhea:"amenorrhoea",criticized:"criticised",gonorrhea:"gonorrhoea",fossilize:"fossilise",revolutionize:"revolutionise",woolen:"woollen",dishabille:"deshabille",organdy:"organdie",asses:"arses",furor:"furore",paycheck:"paycheque",pulverize:"pulverise",dramatization:"dramatisation",yodeler:"yodeller",apologize:"apologise",apologized:"apologised",blond:"blonde",oxidize:"oxidise",extemporize:"extemporise",whiz:"whizz",edile:"aedile",appall:"appal",legitimize:"legitimise",urbanization:"urbanisation",magnetize:"magnetise",womanize:"womanise",orthopedics:"orthopaedics",cognize:"cognise",christianization:"christianisation",vocalize:"vocalise",individualization:"individualisation",hemoglobin:"haemoglobin",racket:"racquet",agonize:"agonise",aggrandizes:"aggrandises",accouter:"accoutre",mollusk:"mollusc",publicize:"publicise",fraternization:"fraternisation",odorless:"odourless",odor:"odour",odorous:"odourous",rationalization:"rationalisation",pretense:"pretence",louver:"louvre",kopeck:"kopek",lissome:"lissom",idealization:"idealisation",nosy:"nosey",stogie:"stogy",althea:"althaea",immobilization:"immobilisation",majolica:"maiolica",savior:"saviour",civilize:"civilise",granddad:"grandad",centralization:"centralisation",localization:"localisation",evangelization:"evangelisation",ruble:"rouble",pajamas:"pyjamas",sterilize:"sterilise",math:"maths",localize:"localise",hospitalization:"hospitalisation",scrutinize:"scrutinise",acclimatization:"acclimatisation",misbehavior:"misbehaviour",behavior:"behaviour",color:"colour",tire:{britishWord:"tyre",exceptPreviousWords:["will"]},gray:"grey",grays:"greys",theater:"theatre",amphitheater:"amphitheatre",center:"centre",realize:"realise",realizing:"realising",realization:"realisation",license:"licence",mom:"mum","mom'l":"mum'll",favor:"favour",favors:"favours",favorites:"favourites",analyzed:"analysed",characterized:"characterised",colored:"coloured",colors:"colours",counseling:"counselling",customized:"customised",defense:"defence",offense:"offence",enrollment:"enrolment",flavor:"flavour",flavors:"flavours",flavoring:"flavouring",harbor:"harbour",harbored:"harboured",honor:"honour",honors:"honours",labor:"labour",licensed:"licenced",licenses:"licences",licensing:"licencing",modeling:"modelling",optimization:"optimisation",organization:"organisation",organizations:"organisations",organized:"organised",organizing:"organising",pediatric:"paediatric",personalized:"personalised",practice:"practise",realized:"realised",recognize:"recognise",recognized:"recognised",specialties:"specialities",specializing:"specialising",theaters:"theatres",travelers:"travellers",traveler:"traveller",traveling:"travelling",authorized:"authorised",behaviors:"behaviours",traveled:"travelled",utilizing:"utilising",utilized:"utilised",honored:"honoured",specializes:"specialises",practicing:"practising",signaling:"signalling",analyzing:"analysing",recognizes:"recognises",organizers:"organisers",visualization:"visualisation",standardized:"standardised",favorable:"favourable",analyzer:"analyser",recognizing:"recognising",uncategorized:"uncategorised",categorized:"categorised",vapor:"vapour",synchronization:"synchronisation",synchronized:"synchronised",rumors:"rumours",coloring:"colouring",honorable:"honourable",generalized:"generalised",generalization:"generalisation",mobilize:"mobilise",armor:"armour",armored:"armoured",labeling:"labelling",endeavor:"endeavour",civilized:"civilised",civilization:"civilisation",parlor:"parlour",tranquilize:"tranquilise",tranquillized:"tranquillised",tranquillization:"tranquillisation",catalog:"catalogue",cataloger:"cataloguer",cataloging:"cataloguing",catalogs:"catalogues",cataloged:"catalogued",uncataloged:"uncatalogued",catalogers:"cataloguers",discolored:"discoloured",discolor:"discolour",encyclopedias:"encyclopaedias",endeavored:"endeavoured",endeavors:"endeavours",endeavoring:"endeavouring",judgments:"judgements",judgment:"judgement",paneling:"panelling",defenses:"defences",criticizing:"criticising",mustache:"moustache",emphasized:"emphasised",emphasizes:"emphasises",emphasizing:"emphasising",fetus:"foetus",programs:"programmes",yogurt:"yoghurt",valor:"valour",moisturize:"moisturise",moisturized:"moisturised",moisturizes:"moisturises",moisturizing:"moisturising",favoring:"favouring",marvelous:"marvellous"};async function tw(e,t){if(e.includes('"')&&(e=e.replace(/"/g,"'")),e.includes("-"))return(await Promise.all(e.split("-").map(async a=>tw(a,t)))).join("-");{const a=e.replace(/^[\W]+|[\W]+$/g,"").toLowerCase(),o=s9[a];if(o===void 0)return e;const[i,n]=typeof o=="string"?[o,[]]:[o.britishWord,o.exceptPreviousWords];return r.mode==="quote"&&n.includes(t)?e:e.replace(RegExp(`^(?:([\\W]*)(${a})([\\W]*))$`,"gi"),(l,c,d,u)=>c+(d.charAt(0)===d.charAt(0).toUpperCase()?d===d.toUpperCase()?i.toUpperCase():an(i):i)+u)}}const r9=[["áàâäåãąą́āą̄ă","a"],["éèêëẽęę́ēę̄ėě","e"],["íìîïĩįį́īį̄ı","i"],["óòôöøõóōǫǫ́ǭő","o"],["úùûüŭũúūůű","u"],["ńň","n"],["çĉčć","c"],["řŕṛ","r"],["ďđḍ","d"],["ťțṭ","t"],["ṃ","m"],["æ","ae"],["œ","oe"],["ẅŵ","w"],["ĝğg̃","g"],["ĥ","h"],["ĵ","j"],["ńṇṅ","n"],["ŝśšșşṣ","s"],["ß","ss"],["żźž","z"],["ÿỹýÿŷ","y"],["łľĺ","l"],["أإآ","ا"],["َ",""],["ُ",""],["ِ",""],["ْ",""],["ً",""],["ٌ",""],["ٍ",""],["ّ",""],["ё","е"],["ά","α"],["έ","ε"],["ί","ι"],["ύ","υ"],["ό","ο"],["ή","η"],["ώ","ω"],["þ","th"]],l9=new Map(r9.flatMap(e=>[...e[0]].map(t=>[t,e[1]])));function c9(e,t){const a=e.toLowerCase(),o=new Map(t?.flatMap(d=>[...d[0]].map(u=>[u,d[1]]))??[]),i=l9.get(a[0]),n=o.get(a[0]),l=i!==void 0?[a[0],i]:void 0;return(n!==void 0?[a[0],n]:void 0)??l}function Ah(e,t){if(!e)return e;const a=e.toUpperCase(),o=[...e].map((l,c)=>l===a[c]),i=[];let n=0;for(let l=0;l<e.length;l++){const c=l+n;if(c>=e.length)break;const d=e.slice(c),u=o.slice(c),m=c9(d,t);if(m!==void 0){for(let p=0;p<m[1].length;p++){const g=m[1][p],h=u[p]??!1;i.push(h?g.toUpperCase():g)}n+=m[0].length-1}else{const p=e[c],g=o[c];i.push(g?p.toUpperCase():p)}}return i.join("")}const aw=[["are",["aren't"]],["can",["can't"]],["could",["couldn't"]],["did",["didn't"]],["does",["doesn't"]],["do",["don't"]],["had",["hadn't"]],["has",["hasn't"]],["have",["haven't"]],["is",["isn't"]],["it",["it's","it'll"]],["i",["i'm","i'll","i've","i'd"]],["you",["you'll","you're","you've","you'd"]],["that",["that's","that'll","that'd"]],["must",["mustn't","must've"]],["there",["there's","there'll","there'd"]],["he",["he's","he'll","he'd"]],["she",["she's","she'll","she'd"]],["we",["we're","we'll","we'd"]],["they",["they're","they'll","they'd"]],["should",["shouldn't","should've"]],["was",["wasn't"]],["were",["weren't"]],["will",["won't"]],["would",["wouldn't","would've"]],["going",["goin'"]]];async function d9(e){return aw.find(t=>e.match(RegExp(`^([\\W]*${t[0]}[\\W]*)$`,"gi")))!==void 0}async function u9(e){const t=aw.find(o=>e.match(RegExp(`^([\\W]*${o[0]}[\\W]*)$`,"gi")));if(t===void 0)return e;const a=Ia(t[1]);return e.replace(RegExp(`^(?:([\\W]*)(${t[0]})([\\W]*))$`,"gi"),(o,i,n,l)=>i+(n.charAt(0)===n.charAt(0).toUpperCase()?f9(n)?a.toUpperCase():an(a):a)+l)}function f9(e){return e==="I"?!1:e===e.toUpperCase()}const Ht=Math.random;function p9(e){return/[?!.؟]/.test(e)}let bn="";async function m9(e,t,a,o){let i=t;const n=r.language.split("_")[0],l=Wy(e),c=Eo("punctuateWord");if(c)return c.functions.punctuateWord(i);if(n!=="code"&&n!=="georgian"&&(a===0||p9(l))){if(i=an(i),n==="turkish"&&(i=i.replace(/I/g,"İ")),n==="spanish"){const d=Ht();d>.9?(i="¿"+i,bn="?"):d>.8&&(i="¡"+i,bn="!")}}else if(Ht()<.1&&l!=="."&&l!==","&&a!==o-2||a===o-1)if(n==="spanish")(bn==="?"||bn==="!")&&(i+=bn,bn="");else{const d=Ht();d<=.8?n==="kurdish"?i+=".":n==="nepali"||n==="bangla"||n==="hindi"?i+="।":n==="japanese"||n==="chinese"?i+="。":i+=".":d>.8&&d<.9?n==="french"?i="?":n==="arabic"||n==="persian"||n==="urdu"||n==="kurdish"?i+="؟":n==="greek"?i+=";":n==="japanese"||n==="chinese"?i+="？":i+="?":n==="french"?i="!":n==="japanese"||n==="chinese"?i+="！":i+="!"}else if(Ht()<.01&&l!==","&&l!=="."&&n!=="russian")i=`"${i}"`;else if(Ht()<.011&&l!==","&&l!=="."&&n!=="russian"&&n!=="ukrainian"&&n!=="slovak")i=`'${i}'`;else if(Ht()<.012&&l!==","&&l!==".")if(n==="code"){const d=Ht(),u=["()","{}","[]","<>"];r.language.startsWith("code_javascript")&&u.push("``");const m=Math.floor(d*u.length),p=u[m];i=`${p[0]}${i}${p[1]}`}else n==="japanese"||n==="chinese"?i=`（${i}）`:i=`(${i})`;else if(Ht()<.013&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!==":"&&l!=="；"&&l!=="：")n==="french"?i=":":n==="chinese"?i+="：":i+=":";else if(Ht()<.014&&l!==","&&l!=="."&&e!=="-")i="-";else if(Ht()<.015&&l!==","&&l!=="."&&l!==";"&&l!=="؛"&&l!=="；"&&l!=="：")n==="french"?i=";":n==="greek"?i=".":n==="arabic"||n==="kurdish"?i+="؛":n==="chinese"?i+="；":i+=";";else if(Ht()<.2&&l!==",")n==="arabic"||n==="urdu"||n==="persian"||n==="kurdish"?i+="،":n==="japanese"?i+="、":n==="chinese"?i+="，":i+=",";else if(Ht()<.25&&n==="code"){const d=["{","}","[","]","(",")",";","=","+","%","/"],u=["{","}","[","]","(",")",";","=","+","%","/","/*","*/","//","!=","==","<=",">=","||","&&","<<",">>","%=","&=","*=","++","+=","--","-=","/=","^=","|="];r.language.startsWith("code_c")&&!r.language.startsWith("code_css")||r.language.startsWith("code_arduino")?i=Ia(u):r.language.startsWith("code_javascript")?i=Ia([...d,"`"]):i=Ia(d)}else Ht()<.5&&n==="english"&&await d9(i)&&(i=await g9(i));return i.includes("	")&&(i=i.replace(/\t/g,""),i+="	"),i.includes(`
`)&&(i=i.replace(/\n/g,""),i+=`
`),i}async function g9(e){return u9(e)}function h9(){const e=Eo("getWordsFrequencyMode");if(e)return e.functions.getWordsFrequencyMode()}async function b9(){const e=[],t=Eo("pullSection");if(t){const a=await t.functions.pullSection(r.language);if(a===!1||a===void 0)throw Bn(t.name),new Error("Failed to pull section");for(const o of a.words){if(e.length>=r.words&&r.mode==="words")break;e.push(o)}}return e}function y9(e,t,a){const o=Eo("getWord");return o&&(e=o.functions.getWord(a,t)),e}function v9(e,t,a){for(const o of $t("alterText"))e=o.functions.alterText(e,t,a);return e}async function w9(e,t){return!r.britishEnglish||!r.language.includes("english")||r.mode==="quote"&&be?.britishText!==void 0&&be?.britishText!==""?e:await tw(e,t)}function gu(e,t){if(qe&&qe instanceof Xp){const o=qe.wordsWithLanguage.get(e),i=o?qe.languageProperties.get(o):void 0,n=(i&&!i.noLazyMode)===!0||r.mode==="custom";return r.lazyMode&&n&&i&&(e=Ah(e,i.additionalAccents)),e}const a=!t.noLazyMode||r.mode==="custom";return r.lazyMode&&a&&(e=Ah(e,t.additionalAccents)),e}function C9(){return no().flatMap(t=>t.properties??[]).find(t=>t.startsWith("wordOrder:"))?.split(":")[1]??"normal"}function k9(){if(r.mode==="zen")return 0;let e=100;const t=be;if(r.mode==="quote"&&t===null)throw new tt("Random quote is null");const a=no().flatMap(o=>o.properties??[]).find(o=>o.startsWith("toPush:"))??"";return r.showAllLines&&(r.mode==="custom"&&(e=we()),r.mode==="words"&&(e=r.words),r.mode==="quote"&&(e=t.textSplit.length)),r.mode==="words"&&r.words===0&&(e=100),r.mode==="custom"&&(we()===0||Se()==="time"?e=100:e=we()>100?100:we()),a&&(e=+a.split(":")[1]),r.mode==="words"&&r.words!==0&&r.words<e&&(e=r.words),r.mode==="quote"&&t.textSplit.length<e&&(e=t.textSplit.length),r.mode==="custom"&&Se()==="word"&&we()<e&&we()!==0&&(e=we()),e}async function S9(e,t){if(Aa){if(qe===null)throw new tt("Current wordset is null");return zu(ow),t==="reverse"?qe.words.reverse():qe.words}const a=e.name.startsWith("swiss_german")?"german":e.name;oe();const o=await rt.getQuotes(a,r.quoteLength);if(j(),o.length===0)throw v("mode","words"),new tt(`No ${r.language.replace(/_\d*k$/g,"").replace(/_/g," ")} quotes found`);let i;if(r.quoteLength.includes(-2)&&r.quoteLength.length===1){const n=rt.getQuoteById(Iu);if(n===void 0)throw Rn(),new tt(`Quote ${Iu} does not exist`);i=n}else if(r.quoteLength.includes(-3)){const n=rt.getRandomFavoriteQuote(r.language);if(n===null)throw Rn(),new tt("No favorite quotes found");i=n}else{const n=rt.getRandomQuote();if(n===null)throw Rn(),new tt("No quotes found for selected quote length");i=n}if(i.language=Ta(r.language),i.text=i.text.replace(/ +/gm," "),i.text=i.text.replace(/( *(\r\n|\r|\n) *)/g,`
 `),i.text=i.text.replace(/…/g,"..."),i.text=i.text.trim(),i.britishText!==void 0&&i.britishText!==""&&r.britishEnglish?i.textSplit=i.britishText.split(" "):i.textSplit=i.text.split(" "),zu(i),be===null)throw new tt("Random quote is null");if(be.textSplit===void 0)throw new tt("Random quote textSplit is undefined");return be.textSplit}let qe=null,xi=null,ac=!1,ow=null;async function x9(e){Aa||(gf=[]),ow=be,zu(null),Ei=[],_i=0,sr=[],xi=e;const t={words:[],sectionIndexes:[],hasTab:!1,hasNewline:!1,allRightToLeft:e.rightToLeft,allLigatures:e.ligatures??!1};ac=A0("pullSection");const a=C9();console.debug("Word order",a);let o=e.words;r.mode==="custom"?o=Yr():r.mode==="quote"?o=await S9(e,a):r.mode==="zen"&&(o=[]);const i=r.mode==="custom"&&Ls(),n=k9();console.debug(`${i?"Section":"Word"} limit ${n}`),a==="reverse"&&(o=o.reverse());const l=Eo("withWords");if(l){const m=await l.functions.withWords(o);if(m instanceof Xp){const p=m;qe=p,t.allLigatures=Array.from(p.languageProperties.values()).some(g=>!!g.ligatures)}else qe=m}else qe=await V3(o);if(console.debug("Wordset",qe),n===0)return t;let c=!1,d=0;for(;!c;){const m=await iw(d,n,Vn(t.words,-1)??"",Vn(t.words,-2)??"");if(t.words.push(m.word),t.sectionIndexes.push(m.sectionIndex),i){const p=Ei.length===0&&_i>=n,g=t.words.length>=100;(p||g)&&(c=!0)}else t.words.length>=n&&(c=!0);d++}const u=be;if(r.mode==="quote"&&u===null)throw new tt("Random quote is null");return t.hasTab=t.words.some(m=>m.includes("	"))||qe.words.some(m=>m.includes("	"))||r.mode==="quote"&&u.textSplit.some(m=>m.includes("	")),t.hasNewline=t.words.some(m=>m.includes(`
`))||qe.words.some(m=>m.includes(`
`))||r.mode==="quote"&&u.textSplit.some(m=>m.includes(`
`)),sr=[],t}let _i=0,Ei=[],sr=[],gf=[];async function iw(e,t,a,o){if(console.debug("Getting next word",{isRepeated:Aa,currentWordset:qe,wordIndex:e,language:xi,wordsBound:t,previousWord:a,previousWord2:o}),qe===null)throw new tt("Current wordset is null");if(xi===null)throw new tt("Current language is null");if(Aa&&r.mode!=="quote"){const m=gf[e];if(m===void 0){let p=!1;if((r.mode==="time"||r.mode==="custom"&&Se()==="time"||r.mode==="custom"&&Se()==="word"&&e<we()||r.mode==="custom"&&Se()==="section"&&_i<we()||r.mode==="words"&&e<r.words)&&(p=!0),p)console.debug("Repeated word is undefined but random generation is allowed - getting random word");else throw new tt("Repeated word is undefined")}else return console.debug("Repeated word: ",m),_i++,m}const i=h9()??"normal";let n=qe.randomWord(i);const l=a.replace(/[.?!":\-,]/g,"").toLowerCase(),c=o?.replace(/[.?!":\-,']/g,"").toLowerCase();if(Ei.length===0){const m=await b9();if(r.mode==="quote")n=qe.nextWord();else if(r.mode==="custom"&&Kl()==="repeat")n=qe.nextWord();else if(r.mode==="custom"&&Kl()==="random"&&(qe.length<4||Pe.mode!==null))n=qe.randomWord(i);else if(r.mode==="custom"&&Kl()==="shuffle")n=qe.shuffledWord();else if(r.mode==="custom"&&Se()==="section"){n=qe.randomWord(i);const p=Vn(sr,-1),g=Vn(sr,-2);let h=0;for(;h<100&&(p===n||g===n);)h++,n=qe.randomWord(i)}else if(ac)n=m.join(" ");else{let p=0,g=n.split(" ")[0].toLowerCase(),h=gu(g,xi);for(;p<100&&(l===h||c===h||r.mode!=="custom"&&!r.punctuation&&n==="I"||r.mode!=="custom"&&!r.punctuation&&!r.language.startsWith("code")&&/[-=_+[\]{};'\\:"|,./<>?]/i.test(n)||r.mode!=="custom"&&!r.numbers&&/[0-9]/i.test(n));)p++,n=qe.randomWord(i),g=n.split(" ")[0],h=gu(g,xi)}n=n.replace(/ +/g," "),n=n.replace(/(^ )|( $)/g,""),n=y9(n,e,qe),Ei=[...n.split(" ")],sr.push(n),n=Ei.shift(),_i++}else n=Ei.shift();if(n===void 0)throw new tt("Random word is undefined");if(n==="")throw new tt("Random word is empty");if(/ /g.test(n))throw new tt("Random word contains spaces");const d=A0("getWord");r.mode!=="custom"&&r.mode!=="quote"&&/[A-Z]/.test(n)&&!r.punctuation&&!r.language.startsWith("german")&&!r.language.startsWith("swiss_german")&&!r.language.startsWith("code")&&!r.language.startsWith("klingon")&&!ac&&!d&&(n=n.toLowerCase()),n=n.replace(/ +/gm," "),n=n.replace(/(^ )|( $)/gm,""),n=gu(n,xi),r.language.startsWith("swiss_german")&&(n=n.replace(/ß/g,"ss")),r.punctuation&&!xi.originalPunctuation&&!ac&&(n=await m9(a,n,e,t)),n=await w9(n,l),r.numbers&&Ht()<.1&&(n=y0(4),r.language.startsWith("kurdish")?n=zb(n):r.language.startsWith("nepali")?n=Hb(n):r.language.startsWith("bangla")?n=L2(n):r.language.startsWith("hindi")&&(n=$2(n))),n=v9(n,e,t),console.debug("Word:",n);const u={word:n,sectionIndex:_i};return gf.push(u),u}let oc;async function Qi(e,t){try{oS(oc,e,t)}catch{console.log("Analytics unavailable")}}function T9(){if(oc!==void 0){console.warn("Analytics already activated");return}console.log("Activating Analytics");try{oc=MS(),iS(oc,!0),L("body")?.appendHtml(`
    <script
    async
    src="https://www.googletagmanager.com/gtag/js?id=UA-165993088-1"
  ><\/script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
      dataLayer.push(arguments);
    }
    gtag("js", new Date());

    gtag("config", "UA-165993088-1");
  <\/script>`)}catch(e){console.error(se(e,"Failed to activate analytics"))}}const nw=new ut({key:"rememberLazyMode",schema:I.boolean(),fallback:!1}),sw=new ut({key:"prefersArabicLazyMode",schema:I.boolean(),fallback:!0});function _h(){return nw.get()}function zs(e){nw.set(e)}function L9(){return sw.get()}function $9(e){sw.set(e)}const Nc=document.querySelector(".pageTest #testInitFailed"),Uc=document.querySelector(".pageTest #typingTest"),rr=document.querySelector(".pageTest #testInitFailed .error");function M9(){Nc&&Uc&&(Nc.classList.remove("hidden"),Uc.classList.add("hidden"))}function A9(){rr&&rr.classList.add("hidden")}function _9(e){rr&&(rr.classList.remove("hidden"),rr.innerText=e)}function E9(){Nc&&Uc&&(A9(),Nc.classList.add("hidden"),Uc.classList.remove("hidden"))}let Ar="",Ma=null;function rw(){Ma=null}function q9(e){Ma!==null&&(Ma.uid=e,delete Ma.hash,Ma.hash=Zb(Ma))}function lw(e){if(Kn())return!1;_()?Qi("testStarted"):Qi("testStartedNoLogin"),bp(!0),S8(),df(F.list),d3(),_3(0),Sm();for(const t of $t("start"))t.functions.start();try{(r.paceCaret!=="off"||r.repeatedPace&&Oi)&&Yx()}catch{}return c4(e),w8(),G6(),!0}function R(e={}){e={...{withSameWordset:!1,practiseMissed:!1,noAnim:!1,nosave:!1},...e},W5();const a=e.noAnim?0:Y(125),o=M0("no_quit");if(Me&&o){f("No quit funbox is active. Please finish the test.",0,{important:!0}),e.event?.preventDefault();return}if(Lt||ao){e.event?.preventDefault();return}if(pe()==="test"&&!X6()&&(r.mode!=="zen"&&e.event?.preventDefault(),!Dd(r.mode,r.words,r.time,xo(),to()??!1))){let l="Use your mouse to confirm.";r.quickRestart==="tab"?l="Press shift + tab or use your mouse to confirm.":r.quickRestart==="esc"?l="Press shift + escape or use your mouse to confirm.":r.quickRestart==="enter"&&(l="Press shift + enter or use your mouse to confirm."),f(`Quick restart disabled in long tests. ${l}`,0,{duration:4,important:!0});return}if(Me&&(Aa&&(e.withSameWordset=!0),Or)){ud(),pd(),fd();const l=el(performance.now()),c=cm(l);let d=K(l-c);d<0&&(d=0),sm(d),nm();const u=K(tl());rm(u,d)}r.mode==="quote"&&be!==null&&r.language.startsWith(be.language)&&r.repeatQuotes==="typing"&&(Me||Ar!=="")&&(e.withSameWordset=!0),Pe.mode!==null&&!e.withSameWordset&&!e.practiseMissed&&(f("Reverting to previous settings.",0),Pe.punctuation!==null&&v("punctuation",Pe.punctuation),Pe.numbers!==null&&v("numbers",Pe.numbers),Pe.customText&&(So(Pe.customText.text),_a(Pe.customText.limit.mode),ja(Pe.customText.limit.value),Ui(Pe.customText.pipeDelimiter)),v("mode",Pe.mode),Cm()),$h(),Sm(),l4(),f3(),on.reset(),Zx(),i6(),Gr(),bp(!1),Mm(),ll(),yp(!1),g3(),jx(),A.setKoreanStatus(!1),I8(),Ep(!1),gd(""),nt()||sd();let i,n;Ie?(n=document.querySelector("#result"),i="resultPage"):(n=document.querySelector("#typingTest"),i="testPage"),ky(!1),Ol(!0),O(n,{opacity:0,duration:a,onComplete:async()=>{La(""),await Z6(),hf=0,Ar="";let l=!1;if(r.repeatedPace&&e.withSameWordset&&(l=!0),wy(e.withSameWordset??!1),WS(l),E9(),!await bf()){Ol(!1);return}await Ic();for(const u of $t("restart"))u.functions.restart();Q6(i);const d=document.querySelector("#typingTest");O(d,{opacity:[0,1],onBegin:()=>{d.classList.remove("hidden")},duration:a,onComplete:()=>{$h(),Ol(!1)}})}})}let Hs=null,yn=!1,hf=0;async function bf(){if(console.debug("Initializing test"),hf++,hf>3)return Hs&&(xp(Hs),_9(`${Hs.name}: ${Hs.message}`)),M9(),Ol(!1),!1;Mm(),F.reset(),zS(0),A.resetHistory(),A.current="",oe();const{data:e,error:t}=await jt(ii(r.language));if(j(),t&&f(se(t,"Failed to load language"),-1),!e||e.name!==r.language)return await bf();pe()==="test"&&await qv(),r.mode==="quote"&&r.quoteLength.includes(-3)&&!_()&&Rn();const a=!e.noLazyMode||r.mode==="custom";if(na().includes("polyglot")){const g=r.customPolyglot.map(async y=>{const{data:k,error:x}=await jt(ii(y));return x&&f(se(x,`Failed to load language: ${y}`),-1),k}),h=(await Promise.all(g)).filter(y=>y!==null).some(y=>!y.noLazyMode);r.lazyMode&&!h?(zs(!0),yn||(f("None of the selected polyglot languages support lazy mode.",0,{important:!0}),yn=!0),v("lazyMode",!1)):_h()&&h&&(v("lazyMode",!0),zs(!1),yn=!1)}else r.lazyMode&&!a?(zs(!0),yn||(f("This language does not support lazy mode.",0,{important:!0}),yn=!0),v("lazyMode",!1)):_h()&&a&&(v("lazyMode",!0),zs(!1),yn=!1);!r.lazyMode&&!e.noLazyMode&&zs(!1),r.mode==="custom"&&console.debug("Custom text",xo()),console.log("Inializing test",{language:{...e,words:`${e.words.length} words`},customText:{...xo(),text:`${Yr().length} words`},mode:r.mode,mode2:di(r,null),funbox:r.funbox,currentQuote:be});let o=!1,i=!1,n,l,c=[],d=[];try{const p=await x9(e);c=p.words,d=p.sectionIndexes,o=p.hasTab,i=p.hasNewline,{allRightToLeft:n,allLigatures:l}=p}catch(p){return j(),(p instanceof tt||p instanceof Error)&&(Hs=p),console.error(p),p instanceof tt?p.message.length>0&&f(p.message,0,{important:!0}):f(se(p,"Failed to generate words"),-1,{important:!0}),await bf()}let u=!1;for(const p of c)/\d/g.test(p)&&!u&&(u=!0);X5(u),Q5(o),Y5(i),c.join().normalize().match(/[\uac00-\ud7af]|[\u1100-\u11ff]|[\u3130-\u318f]|[\ua960-\ua97f]|[\ud7b0-\ud7ff]/g)&&A.setKoreanStatus(!0);for(let p=0;p<c.length;p++)F.push(c[p],d[p]);r.keymapMode==="next"&&r.mode!=="zen"&&vr(Vn([...F.getCurrent()],0)),km(F.getCurrent()),D6(l??e.ligatures??!1);const m=n??e.rightToLeft??!1;return NS(m),US(_o("reverseDirection")),console.debug("Test initialized with words",c),console.debug("Test initialized with section indexes",d),!0}function Em(){return r.mode==="words"&&F.length>=r.words&&r.words>0||r.mode==="custom"&&Se()==="word"&&F.length>=we()&&we()!==0||r.mode==="quote"&&F.length>=(be?.textSplit?.length??0)||r.mode==="custom"&&Se()==="section"&&_i>=we()&&Ei.length===0&&we()!==0}async function Eh(){if(r.mode==="zen"){Tv();return}let e=100;const a=(no().flatMap(i=>i.properties??[]).find(i=>i.startsWith("toPush:"))??"")?.split(":")[1];if(a!==void 0&&(e=+a-1),F.length-A.getHistory().length>e){console.debug("Not adding word, enough words already");return}if(Em()){console.debug("Not adding word, all words generated");return}const o=Eo("pullSection");if(o&&F.length-ne<20){const i=await o.functions.pullSection(r.language);if(i===!1){f("Error while getting section. Please try again later",-1),Bn(o.name),R();return}if(i===void 0)return;let n=0;for(let l=0;l<i.words.length;l++){const c=i.words[l];if(n>=r.words&&r.mode==="words")break;n++,F.push(c,l),Th(c)}}try{const i=await iw(F.length,e,F.get(F.length-1),F.get(F.length-2));F.push(i.word,i.sectionIndex),Th(i.word)}catch(i){Lr("fail","word generation error"),f(se(i,"Error while getting next word. Please try again later"),-1,{important:!0})}}const qi={completedEvent:null,canRetry:!1};async function I9(){const{completedEvent:e}=qi;if(e===null){f("Could not retry saving the result as the result no longer exists.",0,{duration:5,important:!0});return}qi.canRetry&&(qi.canRetry=!1,s("#retrySavingResultButton").addClass("hidden"),f("Retrying to save..."),await cw(e,!0))}function D9(e,t){let a=K(ve.spacing.first-ss);(a<0||r.mode==="zen")&&(a=0);let o=K(Ms-ve.spacing.last);(o<0||r.mode==="zen")&&(o=0);const i=Zs(t),n=zl(t);let l=K(Yd(i/n)),c=ve.spacing.array.slice();c.length>0&&(c=c.slice(0,c.length-1));let d=K(Yd(Zs(c)/zl(c)));(!l||isNaN(l))&&(l=0),(!d||isNaN(d))&&(d=0);const u=[];for(const H of Kr)u.push(H.count??0);const m={wpm:Xo,burst:t,err:u},p=Zs(m.wpm??[]),g=zl(m.wpm??[]),h=K(Yd(p/g)),y=isNaN(h)?0:h;let k;if(r.mode==="custom"){const H=xo();k={textLen:H.text.length,mode:H.mode,pipeDelimiter:H.pipeDelimiter,limit:H.limit}}const x=[];for(const H of S()?.tags??[])H.active===!0&&x.push(H._id);const C=parseFloat(e.time.toString()),D=cm(C);let E=r.language;r.mode==="quote"&&(E=Ta(r.language));const B=be?.group??-1,z={wpm:e.wpm,rawWpm:e.wpmRaw,charStats:[e.correctChars+e.correctSpaces,e.incorrectChars,e.extraChars,e.missedChars],charTotal:e.allChars,acc:e.acc,mode:r.mode,mode2:di(r,be),quoteLength:B,punctuation:r.punctuation,numbers:r.numbers,lazyMode:r.lazyMode,timestamp:Date.now(),language:E,restartCount:om,incompleteTests:im,incompleteTestSeconds:Bc<0?0:K(Bc),difficulty:r.difficulty,blindMode:r.blindMode,tags:x,keySpacing:ve.spacing.array,keyDuration:ve.duration.array,keyOverlap:K(co.total),lastKeyToEnd:o,startToFirstKey:a,consistency:l,wpmConsistency:y,keyConsistency:d,funbox:r.funbox,bailedOut:$i,chartData:m,customText:k,testDuration:C,afkDuration:D,stopOnLetter:r.stopOnError==="letter"};return z.mode!=="custom"&&delete z.customText,z.mode!=="quote"&&delete z.quoteLength,z}async function ds(e=!1){if(!Me)return;wv(!0);const t=performance.now();Sm(),Ch(t),await gt("#typingTest",{opacity:0,duration:Y(125)}),s(".pageTest #typingTest").addClass("hidden"),s(".pageTest .loading").removeClass("hidden"),await Ee(0),Y6(),Aa&&r.mode==="quote"&&wy(!1),A.current.length!==0&&(A.pushHistory(),on.pushHistory(),df(A.getHistory())),r.mode==="zen"&&df(A.getHistory()),r3(t);const a=(t-ve.spacing.last)/1e3;if((r.mode==="zen"||$i)&&a<7&&Ch(ve.spacing.last),ky(!0),bp(!1),Mm(),aa.length!==A.getHistory()?.length){const C=H0();e0(C)}(r.mode==="zen"||$i)&&u4();const o=m4();if(o.time%1!==0&&r.mode!=="time"&&d4(),Vx(o.wpm),ji&&!e){const C=lm();Jy(C.wpm),Zy(C.raw),ud(),pd(),fd()}const i=Ni.map(C=>Math.round(C/5*60));if(r.mode!=="time"&&ji&&o.time%1>=.5){const C=1/(o.time%1);i[i.length-1]=Math.round(i[i.length-1]*C)}const n=D9(o,i);console.debug("Completed event object",n);function l(C){return typeof C=="number"?isNaN(C)?1:0:typeof C>"u"?1:typeof C=="object"&&C!==null?Object.values(C).reduce((D,E)=>D+l(E),0):0}let c=!1;l(n)>0&&(console.log(n),f("Failed to build result object: One of the fields is undefined or NaN",-1),c=!0);const d=structuredClone(n);let m=jr.slice(-5).every(C=>C);$i&&(m=!1);const p=parseInt(d.mode2);let g=!1;const h=(Cr-wr)/1e3;if(r.mode==="time"&&!$i&&(n.testDuration<h-.1||n.testDuration>h+.1)&&n.testDuration<=120?(f("Test invalid - inconsistent test duration",0),console.error("Test duration inconsistent",n.testDuration,h),Ll(),c=!0):e?(f(`Test failed - ${Ar}`,0,{duration:1}),c=!0):m?(f("Test invalid - AFK detected",0),c=!0):Aa?(f("Test invalid - repeated",0),c=!0):d.testDuration<1||r.mode==="time"&&p<15&&p>0||r.mode==="time"&&p===0&&d.testDuration<15||r.mode==="words"&&p<10&&p>0||r.mode==="words"&&p===0&&d.testDuration<15||r.mode==="custom"&&(Se()==="word"||Se()==="section")&&we()<10||r.mode==="custom"&&Se()==="time"&&we()<15||r.mode==="zen"&&d.testDuration<15?(f("Test invalid - too short",0),g=!0,c=!0):d.wpm<0||d.wpm>350&&d.mode!=="words"&&d.mode2!=="10"||d.wpm>420&&d.mode==="words"&&d.mode2==="10"?(f("Test invalid - wpm",0),Ll(),c=!0):d.rawWpm<0||d.rawWpm>350&&d.mode!=="words"&&d.mode2!=="10"||d.rawWpm>420&&d.mode==="words"&&d.mode2==="10"?(f("Test invalid - raw",0),Ll(),c=!0):(!S()?.lbOptOut&&(d.acc<75||d.acc>100)||S()?.lbOptOut===!0&&(d.acc<50||d.acc>100))&&(f("Test invalid - accuracy",0),Ll(),c=!0),Aa){const C=d.testDuration,D=d.afkDuration;let E=K(C-D);E<0&&(E=0);const B=d.acc;sm(E),nm(),rm(B,E)}const y=mm(),k=to();if(r.mode==="custom"&&y!==""&&k)if($i||A.getHistory().length<F.length){const C=A.getHistory();let D=C?.length;const E=D-1;(C[E]?.length??0)<F.get(E).length&&D--;const z=Rp(y)+D;Ou(y,z),f("Long custom text progress saved",1,{duration:5,important:!0});let H=Mc(y,!0);H=H.slice(z),So(H)}else{Ou(y,0);const C=Mc(y,!0);So(C),f("Long custom text completed",1,{duration:5,important:!0})}if(L8(d.testDuration-d.afkDuration),G8(),_()?s(".pageTest #result #reportQuoteButton").removeClass("hidden"):(s(".pageTest #result #rateQuoteButton").addClass("hidden"),s(".pageTest #result #reportQuoteButton").addClass("hidden"),Qi("testCompletedNoLogin"),c||(Ma=d),c=!0),s("#result .stats .dailyLeaderboard").addClass("hidden"),r4(structuredClone(d)),nt()||sd(),await i9(d,e,Ar,m,Aa,g,be,c),d.chartData!=="toolong"&&delete d.chartData.unsmoothedRaw,d.testDuration>122&&(d.chartData="toolong",d.keySpacing="toolong",d.keyDuration="toolong"),d.wpm===0&&!e&&d.testDuration>=5){const C=Math.round(d.testDuration),D=[`Congratulations. You just wasted ${C} seconds of your life by typing nothing. Be proud of yourself.`,`Bravo! You've managed to waste ${C} seconds and accomplish exactly zero. A true productivity icon.`,`That was ${C} seconds of absolutely legendary idleness. History will remember this moment.`,`Wow, ${C} seconds of typing... nothing. Bold. Mysterious. Completely useless.`,`Thank you for those ${C} seconds of utter nothingness. The keyboard needed the break.`,`A breathtaking display of inactivity. ${C} seconds of absolutely nothing. Powerful.`,`You just gave ${C} seconds of your life to the void. And the void says thanks.`,`Stunning. ${C} seconds of intense... whatever that wasn't. Keep it up, champ.`,`Is it performance art? A protest? Or just ${C} seconds of glorious nothing? We may never know.`,`You typed nothing for ${C} seconds. And in that moment, you became legend.`];Zv(),f(Ia(D),0,{customTitle:"Nice",duration:15,important:!0})}if(c){Qi("testCompletedInvalid");return}const x=ct();if(x){if(z0(),d.uid=x.uid,t9(be),!d.bailedOut){const C=_8(d);C!==null&&(d.challenge=C)}d.hash=Zb(d),await cw(d,!1)}}async function cw(e,t){if(ho(!0),!Or){f("Result not saved: disabled by user",-1,{duration:3,customTitle:"Notice",important:!0}),ho(!1);return}if(!nt()){f("Result not saved: offline",-1,{duration:2,customTitle:"Notice",important:!0}),ho(!1),qi.canRetry=!0,s("#retrySavingResultButton").removeClass("hidden"),t||(qi.completedEvent=e);return}const a=await $.results.add({body:{result:e}});if(ho(!1),a.status!==200){[460,461,463,464,465,466].includes(a.status)||(qi.canRetry=!0,s("#retrySavingResultButton").removeClass("hidden"),t||(qi.completedEvent=e)),console.log("Error saving result",e),a.body.message==="Old key data format"&&(a.body.message="Old key data format. Please refresh the page to download the new update. If the problem persists, please contact support."),/"result\..+" is (not allowed|required)/gi.test(a.body.message)&&(a.body.message="Looks like your result data is using an incorrect schema. Please refresh the page to download the new update. If the problem persists, please contact support."),f("Failed to save result",-1,{response:a});return}const o=a.body.data;s("#result .stats .tags .editTagsButton").attr("data-result-id",o.insertedId),s("#result .stats .tags .editTagsButton").removeClass("invisible");const i={};if(o.xp!==void 0){const l=S()?.xp??0;Fy(l,o.xp,Ie?o.xpBreakdown:void 0),i.xp=o.xp}if(o.streak!==void 0&&(i.streak=o.streak),o.insertedId!==void 0){const l=structuredClone(e);l._id=o.insertedId,o.isPb!==void 0&&o.isPb&&(l.isPb=!0),i.result=l}Qi("testCompleted"),o.isPb!==void 0&&o.isPb?(await Gn(e.mode,e.mode2,e.punctuation,e.numbers,e.language,e.difficulty,e.lazyMode,fr(e.funbox))!==void 0&&Zv(),tc("normal"),i.isPb=!0):X8();const n=document.querySelector("#result .stats .dailyLeaderboard");o.dailyLeaderboardRank===void 0?n.classList.add("hidden"):(n.classList.remove("hidden"),n.style.maxWidth="13rem",O(n,{opacity:[0,1],duration:Y(250)}),s("#result .stats .dailyLeaderboard .bottom").html(W.rank(o.dailyLeaderboardRank,{fallback:""}))),s("#retrySavingResultButton").addClass("hidden"),t&&f("Result saved",1,{important:!0}),_y(i)}function yf(e){if(Ar=e,ud(),pd(),fd(),ds(!0),!Or)return;const t=el(performance.now()),a=cm(t);let o=K(t-a);o<0&&(o=0),sm(o),nm();const i=K(tl());rm(i,o)}const F9=Bt(250,async()=>{const e=await mx(r.language);e==="no"&&f(`${Pt(Ra(r.language))} does not support Zipf funbox, because the list is not ordered by frequency. Please try another word list.`,0,{duration:7}),e==="unknown"&&f(`${Pt(Ra(r.language))} may not support Zipf funbox, because we don't know if it's ordered by frequency or not. If you would like to add this label, please contact us.`,0,{duration:7})});s(".pageTest").on("click","#testModesNotice .textButton.restart",()=>{R()});s(".pageTest").on("click","#testInitFailed button.restart",()=>{R()});s(".pageTest").on("click","#restartTestButton",()=>{ie(),!ao&&(Me&&r.repeatQuotes==="typing"&&r.mode==="quote"?R({withSameWordset:!0}):R())});s(".pageTest").on("click","#retrySavingResultButton",I9);s(".pageTest").on("click","#nextTestButton",()=>{ie(),R()});s(".pageTest").on("click","#restartTestButtonWithSameWordset",()=>{if(r.mode==="zen"){f("Repeat test disabled in zen mode");return}ie(),R({withSameWordset:!0})});s(".pageTest").on("click","#testConfig .mode .textButton",e=>{if(Lt||s(e.currentTarget).hasClass("active"))return;const t=s(e.currentTarget).attr("mode")??"time";t!==void 0&&v("mode",t)&&(ie(),R())});s(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{if(Lt)return;const t=s(e.currentTarget).attr("wordCount")??"15";t!=="custom"&&v("words",parseInt(t))&&(ie(),R())});s(".pageTest").on("click","#testConfig .time .textButton",e=>{if(Lt)return;const t=s(e.currentTarget).attr("timeConfig")??"10";t!=="custom"&&v("time",parseInt(t))&&(ie(),R())});s(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{if(Lt)return;const t=s(e.currentTarget).attr("quoteLength");if(t==="all")Rn()&&(ie(),R());else{const a=parseInt(t??"1");if(a!==-2){let o=[];e.shiftKey?o=[...r.quoteLength,a]:o=[a],v("quoteLength",o)&&(ie(),R())}}});s(".pageTest").on("click","#testConfig .punctuationMode.textButton",()=>{Lt||v("punctuation",!r.punctuation)&&(ie(),R())});s(".pageTest").on("click","#testConfig .numbersMode.textButton",()=>{Lt||v("numbers",!r.numbers)&&(ie(),R())});s("header").on("click","nav #startTestButton, #logo",()=>{pe()==="test"&&R()});Ce(({key:e,newValue:t,nosave:a})=>{pe()==="test"&&(e==="language"&&(t?.startsWith("arabic")&&L9()&&v("lazyMode",!0,{nosave:!0}),R()),e==="difficulty"&&!a&&R(),e==="customLayoutfluid"&&r.funbox.includes("layoutfluid")&&R(),e==="keymapMode"&&t==="next"&&r.mode!=="zen"&&setTimeout(()=>{vr(Vn([...F.getCurrent()],0))},0),(e==="language"||e==="funbox")&&r.funbox.includes("zipf")&&F9()),e==="lazyMode"&&!a&&r.language.startsWith("arabic")&&$9(t)});a8((e,t)=>{e==="fail"&&t!==void 0&&yf(t),e==="finish"&&ds()});function vf(){return r.mode==="custom"&&to()===!0||r.mode==="custom"&&(Se()==="word"||Se()==="section")&&(Hu().value>=5e3||Hu().value===0)||r.mode==="custom"&&Se()==="time"&&(we()>=3600||we()===0)||r.mode==="words"&&r.words>=5e3||r.words===0||r.mode==="time"&&(r.time>=3600||r.time===0)||r.mode==="zen"}const P9={title:"Are you sure...",list:[{id:"bailOutNo",display:"Nevermind",available:()=>vf()},{id:"bailOutForSure",display:"Yes, I am sure",exec:()=>{yp(!0),ds()},available:()=>vf()}]},B9=[{id:"bailOut",display:"Bail out...",icon:"fa-running",subgroup:P9,visible:!1,available:()=>vf()}],R9=[{id:"addQuoteToFavorite",display:"Add current quote to favorite",icon:"fa-heart",available:()=>{const e=be;return _()&&e!==null&&r.mode==="quote"&&!rt.isQuoteFavorite(e)},exec:async()=>{try{oe(),await rt.setQuoteFavorite(be,!0),j(),f("Quote added to favorites",1)}catch(e){j();const t=se(e,"Failed to add quote to favorites");f(t,-1)}}},{id:"removeQuoteFromFavorite",display:"Remove current quote from favorite",icon:"fa-heart-broken",available:()=>{const e=be;return _()&&e!==null&&r.mode==="quote"&&rt.isQuoteFavorite(e)},exec:async()=>{try{oe(),await rt.setQuoteFavorite(be,!1),j(),f("Quote removed from favorites",1)}catch(e){j();const t=se(e,"Failed to remove quote from favorites");f(t,-1)}}}],W9={title:"Result saving...",list:[{id:"setResultSavingOff",display:"off",alias:"disabled incognito",exec:()=>{Kg(!1),sa()}},{id:"setResultSavingOn",display:"on",alias:"enabled incognito",exec:()=>{Kg(!0),sa()}}]},dw=[{id:"setResultSaving",display:"Result saving...",icon:"fa-save",alias:"results",subgroup:W9}];class uw{constructor(t,a){this.inputElement=t;const o=this.inputElement.wrapWith('<div class="inputAndIndicator"></div>');this.parentElement=o,this.options=a,this.currentStatus=null;let i='<div class="statusIndicator">';for(const[n,l]of Object.entries(a))i+=`
      <div
        class="indicator level${l.level} hidden"
        data-option-id="${n}"
        
        ${(l.message?.length??0)>27?'data-balloon-length="large"':""}
        data-balloon-pos="left"
        ${l.message??""?`aria-label="${l.message}"`:""}
      >
        <i class="fas fa-fw ${l.icon} ${l.spinIcon?"fa-spin":""}"></i>
      </div>
      `;i+="</div>",this.parentElement.appendHtml(i)}hide(){this.parentElement.qsa(".statusIndicator div")?.hide(),this.currentStatus=null,this.inputElement.setStyle({paddingRight:"0.5em"})}show(t,a){this.hide(),this.currentStatus=t;const o=this.parentElement.qs(`[data-option-id="${t}"]`);o?.show(),a!==void 0&&a!==""&&(a.length>20?o?.setAttribute("data-balloon-length","large"):o?.removeAttribute("data-balloon-length"),o?.setAttribute("aria-label",a)),this.inputElement.setStyle({paddingRight:"2.1em"}),this.parentElement.setAttribute("data-indicator-status",t)}get(){return this.currentStatus}}function z9(e,t){return e<=0?t:Bt(e,t)}function fw(e,t,a){let o=t.isValid!==void 0?z9(t.debounceDelay??250,async(i,n,l)=>{const c=await t.isValid?.(l);i.value===n&&(c===!0?e({status:"success"}):typeof c=="object"&&"warning"in c?e({status:"warning",errorMessage:c.warning}):e({status:"failed",errorMessage:c}))}):void 0;return async i=>{const n=i.target,l=n.value;let c=l;if(a!==void 0&&(c=a(l)),e({status:"checking"}),t.schema!==void 0){const d=t.schema.safeParse(c);if(!d.success){e({status:"failed",errorMessage:d.error.errors.map(u=>u.message).join(", ")});return}}if(o===void 0){e({status:"success"}),n.oninput?.(i);return}await o(n,l,c),n.oninput?.(i)}}class Ca extends Ag{constructor(t,a){super(t instanceof Ag?t.native:t),this.currentStatus={status:"checking"},this.indicator=new uw(this,{success:{icon:"fa-check",level:1},failed:{icon:"fa-times",level:-1},warning:{icon:"fa-exclamation-triangle",level:1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});const i=fw(n=>{this.currentStatus=n,n.status==="failed"||n.status==="warning"?this.indicator.show(n.status,n.errorMessage):this.indicator.show(n.status),a.callback?.(n)},a,"inputValueConvert"in a?a.inputValueConvert:void 0);this.on("input",i)}getValidationResult(){return this.currentStatus}setValue(t){return t===null?(this.indicator.hide(),this.currentStatus={status:"checking"}):(super.setValue(t),this.dispatch("input")),this}triggerValidation(){this.dispatch("input")}}function Tn({input:e,configName:t,validation:a}){const o=a!==void 0&&"inputValueConvert"in a?a.inputValueConvert:void 0;let i="checking";if(a!==void 0){const c=zr.shape[t];new Ca(e,{schema:a.schema?c:void 0,isValid:a.isValid,inputValueConvert:o,callback:d=>{i=d.status}})}let n;const l=()=>{if(e.getValue()===""&&(a?.resetIfEmpty??!0)&&(e.setValue(new String(r[t]).toString()),e.dispatch("input")),i==="failed"){e.getParent()?.addClass("hasError"),n!==null&&clearTimeout(n),n=setTimeout(()=>{e.getParent()?.removeClass("hasError")},500);return}const c=o?.(e.getValue()??"")??e.getValue();if(r[t]===c)return;v(t,c)&&f("Saved",1,{duration:1})};e.on("keypress",c=>{c.key==="Enter"&&l()}),e.on("focusout",c=>l())}class P{constructor(t,a,o){this.configName=t,this.mode=a,this.configFunction=(n,l)=>v(t,n,{nosave:l??!1}),this.setCallback=o?.setCallback,this.updateCallback=o?.updateCallback,this.validation=o?.validation;const i=n=>{let l=n;return this.validation!==void 0&&"inputValueConvert"in this.validation&&(l=this.validation.inputValueConvert(n)),l==="true"&&(l=!0),l==="false"&&(l=!1),l};if(this.mode==="select"){const n=L(`.pageSettings .section[data-config-name=${this.configName}] select`);if(n===null)throw new Error(`Failed to find select element for ${t}`);if(n.hasAttribute("multiple"))throw new Error("multi-select dropdowns not supported. Config: "+this.configName);n.on("change",l=>{l.target instanceof HTMLElement&&(l.target?.classList?.contains("disabled")||l.target?.classList?.contains("no-auto-handle"))||this.setValue(n.getValue())}),this.elements=[n]}else if(this.mode==="button"){const n=Za(`
        .pageSettings .section[data-config-name=${this.configName}] .buttons button, .pageSettings .section[data-config-name=${this.configName}] .inputs button`);if(n.length===0)throw new Error(`Failed to find a button element for ${t}`);for(const l of n)l.on("click",c=>{if(l.hasClass("disabled")||l.hasClass("no-auto-handle"))return;let d=l.getAttribute("data-config-value");if(d===null||d===""){console.error(`Failed to handle settings button click for ${t}: data-${t} is missing or empty.`),f("Button is missing data property. Please report this.",-1);return}let u=i(d);this.setValue(u)});this.elements=Array.from(n)}else if(this.mode==="input"){const n=L(`
        .pageSettings .section[data-config-name=${this.configName}] .inputs .inputAndButton input`);if(n===null)throw new Error(`Failed to find input element for ${t}`);let l;this.validation!==void 0&&(l={schema:this.validation.schema??!1,isValid:this.validation.isValid,inputValueConvert:"inputValueConvert"in this.validation?this.validation.inputValueConvert:void 0}),Tn({input:n,configName:this.configName,validation:l}),this.elements=[n]}else if(this.mode==="range"){const n=L(`.pageSettings .section[data-config-name=${this.configName}] input[type=range]`);if(n===null)throw new Error(`Failed to find range element for ${t}`);const l=Bt(250,c=>{this.setValue(c)});n.on("input",c=>{if(n.hasClass("disabled")||n.hasClass("no-auto-handle"))return;const d=parseFloat(n.getValue()??"");this.updateUI(d),l(d)}),this.elements=[n]}else this.elements=[];if(this.elements.length===0||this.elements===void 0)throw new Error(`Failed to find elements for ${t} with mode ${a}`);this.updateUI()}setValue(t){if(r[this.configName]===t)return!1;const a=this.configFunction(t);return this.updateUI(),this.setCallback&&this.setCallback(),a}updateUI(t){const a=t??r[this.configName];if(this.mode==="select"){const o=this.elements?.[0];if(!o)return;const i=o.slim;if(i!==void 0){const n=i.getSelected()[0]??null;a!==n&&i.setSelected(a)}else o.value!==a&&(o.value=a)}else if(this.mode==="button")for(const o of this.elements){let n=o.getAttribute("data-config-value");n==="true"&&(n=!0),n==="false"&&(n=!1),n!==a?o.removeClass("active"):o.addClass("active")}else if(this.mode==="range"){const o=this.elements?.[0],i=document.querySelector(`.pageSettings .section[data-config-name='${this.configName}'] .value`);if(o==null||i===null)return;o.value=a,i.textContent=`${a.toFixed(1)}`}this.updateCallback&&this.updateCallback()}}const pw=new ut({key:"activeTags",schema:I.array(Yb),fallback:[]});function qs(){const e=[];S()?.tags?.forEach(t=>{t.active===!0&&e.push(t._id)}),pw.set(e)}function H9(e=!1){const t=S();t&&(t.tags=t.tags?.map(a=>(a.active=!1,a)),dt(t),sa(),e||qs())}function O9(e,t,a=!1){const o=S();o&&(o.tags=o.tags?.map(i=>(i._id===e&&(i.active=t),i)),dt(o),sa(),a||qs())}function qm(e,t=!1){S()?.tags?.forEach(a=>{a._id===e&&(a.active===void 0?a.active=!0:a.active=!a.active)}),sa(),t||qs()}function N9(){const e=pw.get();for(const t of e)qm(t,!0);qs()}Wa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&N9()});async function mw(e){const t=S();if(!t)return;const a=t.presets?.find(o=>o._id===e);if(a!==void 0){if(qh(a)?await Yn({...structuredClone(r),...a.config}):await Yn(a.config),(!qh(a)||a.settingGroups?.includes("behavior"))&&(H9(!0),a.config.tags)){for(const o of a.config.tags)O9(o,!0,!1);qs()}R(),f("Preset applied",1,{duration:2}),xs()}}function qh(e){return e.settingGroups!==void 0&&e.settingGroups!==null}async function U9(e){const t=S();if(!t)return;const a=t.presets?.find(o=>o._id===e);if(a===void 0){f("Preset not found",0);return}return a}function gw(){let e=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&je!==null&&(e=je),document.querySelectorAll(".pageSettings .section.themes .theme").forEach(t=>{t.classList.remove("active")}),document.querySelector(`.pageSettings .section.themes .theme[theme='${e}']`)?.classList.add("active")}function us(e,t,a=!1,o=!1){if(a){const d=e.find("input.color").attr("id");d===void 0&&console.error("Could not find color ID!"),!o&&d!==void 0&&document.documentElement.style.setProperty(d,t);const u=e.find("label");u.val(t),u.attr("value",t),u.attr("for")!=="--bg-color"&&u.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t);return}const i=[{rule:/\b[0-9]{1,3},\s?[0-9]{1,3},\s?[0-9]{1,3}\s*\b/,start:"rgb(",end:")"},{rule:/\b[A-Z, a-z, 0-9]{6}\b/,start:"#",end:""},{rule:/\b[0-9]{1,3},\s?[0-9]{1,3}%,\s?[0-9]{1,3}%?\s*\b/,start:"hsl(",end:")"}];t=t.replace("°","");for(const d of i)if(t.match(d.rule)){t=d.start+t+d.end;break}t=t.replace("##","#"),s(".colorConverter").css("color",t);const n=B3(s(".colorConverter").css("color"));if(n===void 0)return;t=n;const l=e.find("input.color").attr("id");l===void 0&&console.error("Could not find color ID!"),!o&&l!==void 0&&document.documentElement.style.setProperty(l,t);const c=e.find("label");c.val(t),c.attr("value",t),c.attr("for")!=="--bg-color"&&c.css("background-color",t),e.find("input.input").val(t),e.find("input.color").attr("value",t),e.find("input.color").val(t)}async function hw(){const e=document.querySelector(".pageSettings .section.themes .favThemes.buttons"),t=document.querySelector(".pageSettings .section.themes .allThemes.buttons");if(e===null||t===null){const l="Failed to fill preset theme buttons: favThemes or allThemes element not found";f(l,-1),xp(new Error(l)),console.error(l,{favThemesEl:e,themesEl:t});return}e.innerHTML="",t.innerHTML="";let a="",o="",i=r.theme;r.randomTheme!=="off"&&r.randomTheme!=="custom"&&je!==null&&(i=je);const n=C6;if(r.favThemes.length>0){e.style.marginBottom="1rem";for(const l of n)if(r.favThemes.includes(l.name)){const c=i===l.name?"active":"";a+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
          <div class="favButton active"><i class="fas fa-star"></i></div>
          <div class="text">${l.name.replace(/_/g," ")}</div>
          <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
            <div class="themeBubble" style="background: ${l.mainColor}"></div>
            <div class="themeBubble" style="background: ${l.subColor}"></div>
            <div class="themeBubble" style="background: ${l.textColor}"></div>
          </div>
          </div>
          `}e.innerHTML=a}else e.style.marginBottom="0";for(const l of n){if(r.favThemes.includes(l.name))continue;const c=i===l.name?"active":"";o+=`<div class="theme button ${c}" theme='${l.name}' style="background: ${l.bgColor}; color: ${l.mainColor};outline: 0 solid ${l.mainColor};">
      <div class="favButton"><i class="far fa-star"></i></div>
      <div class="text">${l.name.replace(/_/g," ")}</div>
      <div class="themeBubbles" style="background: ${l.bgColor};outline: 0.25rem solid ${l.bgColor};">
        <div class="themeBubble" style="background: ${l.mainColor}"></div>
        <div class="themeBubble" style="background: ${l.subColor}"></div>
        <div class="themeBubble" style="background: ${l.textColor}"></div>
      </div>
      </div>
      `}t.innerHTML=o}async function Fd(){const e=s(".pageSettings .section.themes .allCustomThemes.buttons").empty(),t=s(".pageSettings .section.themes .addCustomThemeButton"),a=s(".pageSettings .section.themes .tabContent.customTheme #saveCustomThemeButton");if(!_()){a.text("save"),t.addClass("hidden"),e.css("margin-bottom","0");return}a.text("save as new"),t.removeClass("hidden");const o=S()?.customThemes??[];o.length===0?e.css("margin-bottom","0"):e.css("margin-bottom","1rem");for(const i of o){const n=i.colors[0],l=i.colors[1];e.append(`<div class="customTheme button" customThemeId='${i._id}' 
      style="color:${l};background:${n}">
      <div class="editButton"><i class="fas fa-pen"></i></div>
      <div class="text">${i.name.replace(/_/g," ")}</div>
      <div class="delButton"><i class="fas fa-trash fa-fw"></i></div>
      </div>`)}}function V9(e=!1){s(".pageSettings .section.themes .tabContainer .customTheme .colorPicker").each((t,a)=>{const o=r.customThemeColors[To.indexOf(s(a).find("input.color").attr("id"))];us(s(a),o,!1,e)})}function K9(e){if(r.favThemes.includes(e))v("favThemes",r.favThemes.filter(t=>t!==e));else{const t=r.favThemes;t.push(e),v("favThemes",t)}xs()}function j9(){const e=[];for(const t of To)e.push(s(`.pageSettings .tabContent.customTheme #${t}[type='color']`).attr("value"));v("customThemeColors",e),f("Custom theme saved",1)}function G9(){s(".pageSettings .section.themes .tabs button").removeClass("active"),s(`.pageSettings .section.themes .tabs button[data-tab="${r.customTheme?"custom":"preset"}"]`).addClass("active"),r.customTheme?dr(L('.pageSettings [tabContent="preset"]'),L('.pageSettings [tabContent="custom"]'),250):dr(L('.pageSettings [tabContent="custom"]'),L('.pageSettings [tabContent="preset"]'),250)}async function Q9(){await hw(),gw()}s(".pageSettings .section.themes .tabs button").on("click",e=>{s(".pageSettings .section.themes .tabs button").removeClass("active");const t=s(e.currentTarget);t.addClass("active"),t.attr("data-tab")==="preset"?v("customTheme",!1):v("customTheme",!0)});s(".pageSettings").on("click"," .section.themes .customTheme.button",e=>{if(s(e.target).hasClass("delButton")||s(e.target).hasClass("editButton"))return;const t=s(e.currentTarget).attr("customThemeId")??"",a=S()?.customThemes?.find(o=>o._id===t);if(a===void 0){console.error("Could not find custom theme in snapshot for id ",t);return}v("customThemeColors",a.colors)});s(".pageSettings").on("click",".section.themes .theme .favButton",e=>{const t=s(e.currentTarget).parents(".theme.button").attr("theme");t!==void 0?K9(t):console.error("Could not find the theme attribute attached to the button clicked!")});s(".pageSettings").on("click",".section.themes .theme.button",e=>{const t=s(e.currentTarget).attr("theme");!s(e.target).hasClass("favButton")&&t!==void 0&&v("theme",t)});s(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("input",e=>{const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();us(s(".colorPicker #"+t).parent(),a,!0)});s(".pageSettings .section.themes .tabContainer .customTheme input[type=color]").on("change",e=>{const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();us(s(".colorPicker #"+t).parent(),a)});s(".pageSettings .section.themes .tabContainer .customTheme input.input").on("blur",e=>{if(e.target.id==="name")return;const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();us(s(".colorPicker #"+t).parent(),a)}).on("keypress",function(e){if(e.target.id!=="name"&&e.code==="Enter"){s(this).attr("disabled","disabled");const t=s(e.currentTarget).attr("id"),a=s(e.currentTarget).val();us(s(".colorPicker #"+t).parent(),a),s(this).removeAttr("disabled")}});s(".pageSettings #loadCustomColorsFromPreset").on("click",async()=>{await uv(r.theme),To.forEach(t=>{document.documentElement.style.setProperty(t,"")}),cv();const e=await pi();To.forEach(t=>{let a;t==="--bg-color"?a=e.bg:t==="--main-color"?a=e.main:t==="--sub-color"?a=e.sub:t==="--sub-alt-color"?a=e.subAlt:t==="--caret-color"?a=e.caret:t==="--text-color"?a=e.text:t==="--error-color"?a=e.error:t==="--error-extra-color"?a=e.errorExtra:t==="--colorful-error-color"?a=e.colorfulError:t==="--colorful-error-extra-color"&&(a=e.colorfulErrorExtra),us(s(".colorPicker #"+t).parent(),a)})});s(".pageSettings #saveCustomThemeButton").on("click",async()=>{if(j9(),_()){const e={name:"custom",colors:r.customThemeColors};oe(),await i5(e),j()}Fd()});Ce(({key:e})=>{e==="theme"&&pe()==="settings"&&gw(),e==="favThemes"&&pe()==="settings"&&hw()});const po={mode:"import",value:""};function bw(e,t){po.mode=e,po.value="",wf.show({focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{a.querySelector("input").value=po.value,po.mode==="export"?(a.querySelector("button")?.classList.add("hidden"),a.querySelector("input")?.setAttribute("readonly","true")):po.mode==="import"&&(a.querySelector("button")?.classList.remove("hidden"),a.querySelector("input")?.removeAttribute("readonly"))}})}const wf=new ue({dialogId:"importExportSettingsModal",setup:async e=>{e.querySelector("input")?.addEventListener("input",t=>{po.value=t.target.value}),e?.addEventListener("submit",async t=>{if(t.preventDefault(),po.mode==="import"){if(po.value===""){wf.hide();return}await Uy(po.value),wf.hide()}})}});async function Ks(){}class so{constructor(t){this.id=t.id,this.display=t.display,this.element=t.element,this.pathname=t.path,this.loadingOptions=t.loadingOptions,this.beforeHide=t.beforeHide??Ks,this.afterHide=t.afterHide??Ks,this._beforeShow=t.beforeShow??Ks,this.afterShow=t.afterShow??Ks}async beforeShow(t){await this._beforeShow?.(t)}}class Im extends so{constructor(t){super(t),this.urlSchema=t.urlParamsSchema,this._beforeShow=t.beforeShow??Ks}readUrlParams(){const t=new URLSearchParams(window.location.search),a=Dk({schema:this.urlSchema,input:t});if(a.success)return a.data}setUrlParams(t){const a=Fk({schema:this.urlSchema,data:t}),o=`${window.location.pathname}?${a.toString()}`;window.history.replaceState({},"",o)}async beforeShow(t){const a=this.readUrlParams();await this._beforeShow?.({...t,urlParams:a})}}const Vc=N2._def.values,mo={Roboto_Mono:{fileName:"RobotoMono-Regular.woff2"},Noto_Naskh_Arabic:{fileName:"NotoNaskhArabic-Regular.woff2"},Source_Code_Pro:{fileName:"SourceCodePro-Regular.woff2"},IBM_Plex_Sans:{fileName:"IBMPlexSans-SemiBold.woff2",weight:600},Inconsolata:{fileName:"Inconsolata-Regular.woff2"},Fira_Code:{fileName:"FiraCode-Regular.woff2"},JetBrains_Mono:{fileName:"JetBrainsMono-Regular.woff2"},Roboto:{fileName:"Roboto-Regular.woff2"},Montserrat:{fileName:"Montserrat-Regular.woff2"},Titillium_Web:{fileName:"TitilliumWeb-Regular.woff2"},Lexend_Deca:{fileName:"LexendDeca-Regular.woff2"},Comic_Sans_MS:{display:"Helvetica",systemFont:!0},Oxygen:{fileName:"Oxygen-Regular.woff2"},Nunito:{fileName:"Nunito-Bold.woff2",weight:700},Itim:{fileName:"Itim-Regular.woff2"},Courier:{systemFont:!0},Comfortaa:{fileName:"Comfortaa-Regular.woff2"},Coming_Soon:{fileName:"ComingSoon-Regular.woff2"},Atkinson_Hyperlegible:{fileName:"AtkinsonHyperlegible-Regular.woff2"},Lato:{fileName:"Lato-Regular.woff2"},Lalezar:{fileName:"Lalezar-Regular.woff2"},Boon:{display:"Boon (ไทย)",fileName:"Boon-Regular.woff2"},Open_Dyslexic:{fileName:"OpenDyslexic-Regular.woff2"},Ubuntu:{fileName:"Ubuntu-Regular.woff2"},Ubuntu_Mono:{fileName:"UbuntuMono-Regular.woff2"},Georgia:{systemFont:!0},Cascadia_Mono:{fileName:"CascadiaMono-Regular.woff2"},IBM_Plex_Mono:{fileName:"IBMPlexMono-Regular.woff2"},Overpass_Mono:{fileName:"OverpassMono-Regular.woff2"},Hack:{fileName:"Hack-Regular.woff2"},CommitMono:{fileName:"CommitMono-Regular.woff2"},Mononoki:{fileName:"Mononoki-Regular.woff2"},Parkinsans:{fileName:"Parkinsans-Regular.woff2"},Geist:{fileName:"Geist-Medium.woff2"},Sarabun:{fileName:"Sarabun-Bold.woff2"},Kanit:{fileName:"Kanit-Regular.woff2"},Geist_Mono:{fileName:"GeistMono-Medium.woff2"},Iosevka:{fileName:"Iosevka-Regular.woff2"},Proto:{display:"0xProto",fileName:"0xProto-Regular.woff2"}},Pd=document.querySelector(".pageSettings .section[data-config-name='customBackgroundSize']"),Cf=Pd?.querySelector(".usingLocalImage"),Ih=Pd?.querySelector(".separator"),kf=Pd?.querySelector(".uploadContainer"),Dh=Pd?.querySelector(".inputAndButton");async function Y9(e){return new Promise((t,a)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=a,o.readAsDataURL(e)})}async function _r(){await it.hasFile("LocalBackgroundFile")?(Cf?.classList.remove("hidden"),Ih?.classList.add("hidden"),kf?.classList.add("hidden"),Dh?.classList.add("hidden")):(Cf?.classList.add("hidden"),Ih?.classList.remove("hidden"),kf?.classList.remove("hidden"),Dh?.classList.remove("hidden"))}Cf?.querySelector("button")?.addEventListener("click",async()=>{await it.deleteFile("LocalBackgroundFile"),await _r(),await rs()});kf?.querySelector("input[type='file']")?.addEventListener("change",async e=>{const t=e.target,a=t.files?.[0];if(!a)return;if(!a.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){f("Unsupported image format",0),t.value="";return}const o=await Y9(a);await it.storeFile("LocalBackgroundFile",o),await _r(),await rs(),t.value=""});const Bd=document.querySelector(".pageSettings .section[data-config-name='fontFamily']"),Sf=Bd?.querySelector(".usingLocalFont"),Fh=Bd?.querySelector(".separator"),xf=Bd?.querySelector(".uploadContainer"),Ph=Bd?.querySelector(".buttons");async function X9(e){return new Promise((t,a)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=a,o.readAsDataURL(e)})}async function Er(){await it.hasFile("LocalFontFamilyFile")?(Sf?.classList.remove("hidden"),Fh?.classList.add("hidden"),xf?.classList.add("hidden"),Ph?.classList.add("hidden")):(Sf?.classList.add("hidden"),Fh?.classList.remove("hidden"),xf?.classList.remove("hidden"),Ph?.classList.remove("hidden"))}Sf?.querySelector("button")?.addEventListener("click",async()=>{await it.deleteFile("LocalFontFamilyFile"),await Er(),await xr()});xf?.querySelector("input[type='file']")?.addEventListener("change",async e=>{const t=e.target,a=t.files?.[0];if(!a)return;if(!a.type.match(/font\/(woff|woff2|ttf|otf)/)&&!a.name.match(/\.(woff|woff2|ttf|otf)$/i)){f("Unsupported font format, must be woff, woff2, ttf or otf.",0),t.value="";return}const o=await X9(a);await it.storeFile("LocalFontFamilyFile",o),await Er(),await xr(),t.value=""});const yw=V("#pageSettings .section.fpsLimit"),Tf=yw?.qs("button[data-fpsLimit='native']"),fs=new Ca(yw.qsr('input[type="number"]'),{schema:Dv,inputValueConvert:e=>parseInt(e,10)});function Dm(){const e=i8();e>=1e3?(fs.setValue(null),Tf?.addClass("active")):(fs.setValue(e.toString()),Tf?.removeClass("active"))}function vw(e){o8(e)&&f("FPS limit updated",0),Dm()}function ww(){if(fs.getValidationResult().status!=="success")return;const e=parseInt(fs.getValue()??"",10);vw(e)}Tf?.on("click",()=>{vw(1e3),Dm()});fs.on("keypress",e=>{e.key==="Enter"&&ww()});fs.on("focusout",e=>ww());let Bh=!1,ic,nc;const q={},J9=U2.or(I.enum(["resetSettings","updateCookiePreferences","importexportSettings","theme","presets","tags"])),Z9=I.object({highlight:J9}).partial();async function e7(){q.smoothCaret=new P("smoothCaret","button"),q.codeUnindentOnBackspace=new P("codeUnindentOnBackspace","button"),q.difficulty=new P("difficulty","button"),q.quickRestart=new P("quickRestart","button"),q.showAverage=new P("showAverage","button"),q.keymapMode=new P("keymapMode","button",{updateCallback:()=>{r.keymapMode==="off"?(s(".pageSettings .section[data-config-name='keymapStyle']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapLayout']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapLegendStyle']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapShowTopRow']").addClass("hidden"),s(".pageSettings .section[data-config-name='keymapSize']").addClass("hidden")):(s(".pageSettings .section[data-config-name='keymapStyle']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapLayout']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapLegendStyle']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapShowTopRow']").removeClass("hidden"),s(".pageSettings .section[data-config-name='keymapSize']").removeClass("hidden"))}}),q.keymapStyle=new P("keymapStyle","button"),q.keymapLayout=new P("keymapLayout","select"),q.keymapLegendStyle=new P("keymapLegendStyle","button"),q.keymapShowTopRow=new P("keymapShowTopRow","button"),q.keymapSize=new P("keymapSize","range"),q.showKeyTips=new P("showKeyTips","button"),q.freedomMode=new P("freedomMode","button",{setCallback:()=>{q.confidenceMode?.updateUI()}}),q.strictSpace=new P("strictSpace","button"),q.oppositeShiftMode=new P("oppositeShiftMode","button"),q.confidenceMode=new P("confidenceMode","button",{setCallback:()=>{q.freedomMode?.updateUI(),q.stopOnError?.updateUI()}}),q.indicateTypos=new P("indicateTypos","button"),q.compositionDisplay=new P("compositionDisplay","button"),q.hideExtraLetters=new P("hideExtraLetters","button"),q.blindMode=new P("blindMode","button"),q.quickEnd=new P("quickEnd","button"),q.repeatQuotes=new P("repeatQuotes","button"),q.ads=new P("ads","button"),q.alwaysShowWordsHistory=new P("alwaysShowWordsHistory","button"),q.britishEnglish=new P("britishEnglish","button"),q.singleListCommandLine=new P("singleListCommandLine","button"),q.capsLockWarning=new P("capsLockWarning","button"),q.flipTestColors=new P("flipTestColors","button"),q.showOutOfFocusWarning=new P("showOutOfFocusWarning","button"),q.colorfulMode=new P("colorfulMode","button"),q.startGraphsAtZero=new P("startGraphsAtZero","button"),q.autoSwitchTheme=new P("autoSwitchTheme","button"),q.randomTheme=new P("randomTheme","button"),q.stopOnError=new P("stopOnError","button",{setCallback:()=>{q.confidenceMode?.updateUI()}}),q.soundVolume=new P("soundVolume","range"),q.playTimeWarning=new P("playTimeWarning","button",{setCallback:()=>{r.playTimeWarning!=="off"&&Pc()}}),q.playSoundOnError=new P("playSoundOnError","button",{setCallback:()=>{r.playSoundOnError!=="off"&&kd()}}),q.playSoundOnClick=new P("playSoundOnClick","button",{setCallback:()=>{r.playSoundOnClick!=="off"&&Ki("KeyQ")}}),q.showAllLines=new P("showAllLines","button"),q.paceCaret=new P("paceCaret","button"),q.repeatedPace=new P("repeatedPace","button"),q.minWpm=new P("minWpm","button"),q.minAcc=new P("minAcc","button"),q.minBurst=new P("minBurst","button"),q.smoothLineScroll=new P("smoothLineScroll","button"),q.lazyMode=new P("lazyMode","button"),q.layout=new P("layout","select"),q.language=new P("language","select"),q.fontSize=new P("fontSize","input",{validation:{schema:!0,inputValueConvert:Number}}),q.maxLineWidth=new P("maxLineWidth","input",{validation:{schema:!0,inputValueConvert:Number}}),q.caretStyle=new P("caretStyle","button"),q.paceCaretStyle=new P("paceCaretStyle","button"),q.timerStyle=new P("timerStyle","button"),q.liveSpeedStyle=new P("liveSpeedStyle","button"),q.liveAccStyle=new P("liveAccStyle","button"),q.liveBurstStyle=new P("liveBurstStyle","button"),q.highlightMode=new P("highlightMode","button"),q.tapeMode=new P("tapeMode","button"),q.tapeMargin=new P("tapeMargin","input",{validation:{schema:!0,inputValueConvert:Number}}),q.timerOpacity=new P("timerOpacity","button"),q.timerColor=new P("timerColor","button"),q.fontFamily=new P("fontFamily","button",{updateCallback:()=>{const e=s(".pageSettings .section[data-config-name='fontFamily'] .buttons button[data-config-value='custom']");s(".pageSettings .section[data-config-name='fontFamily'] .buttons .active").length===0?(e.addClass("active"),e.text(`Custom (${r.fontFamily.replace(/_/g," ")})`)):e.text("Custom")}}),q.alwaysShowDecimalPlaces=new P("alwaysShowDecimalPlaces","button"),q.typingSpeedUnit=new P("typingSpeedUnit","button"),q.customBackgroundSize=new P("customBackgroundSize","button")}async function t7(){if(Bh)return;new et({select:".pageSettings .section[data-config-name='language'] select",data:Rh(i=>i===r.language),settings:{searchPlaceholder:"search"}});const e=i=>({value:i,text:i.replace(/_/g," ")});new et({select:".pageSettings .section[data-config-name='layout'] select",data:[{text:"off",value:"default"},...Vc.filter(i=>i!=="korean").map(e)]}),new et({select:".pageSettings .section[data-config-name='keymapLayout'] select",data:[{text:"emulator sync",value:"overrideSync"},...Vc.map(e)]}),new et({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light",data:Wh(i=>i.name===r.themeLight),events:{afterChange:i=>{v("themeLight",i[0]?.value)}}}),new et({select:".pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark",data:Wh(i=>i.name===r.themeDark),events:{afterChange:i=>{v("themeDark",i[0]?.value)}}});const t=document.querySelector(".pageSettings .section[data-config-name='funbox'] .buttons");let a="";for(const i of up())i.name==="mirror"?a+=`<button class="funbox" data-funbox-name="mirror" data-config-value='${i.name}' aria-label="${i.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1);">${i.name.replace(/_/g," ")}</button>`:i.name==="upside_down"?a+=`<button class="funbox" data-funbox-name="upside_down" data-config-value='${i.name}' aria-label="${i.description}" data-balloon-pos="up" data-balloon-length="fit" style="transform:scaleX(-1) scaleY(-1); z-index:1;">${i.name.replace(/_/g," ")}</button>`:i.name==="underscore_spaces"?a+=`<button class="funbox" data-funbox-name="underscore_spaces" data-config-value='${i.name}' aria-label="${i.description}" data-balloon-pos="up" data-balloon-length="fit">${i.name}</button>`:a+=`<button class="funbox" data-funbox-name="${i.name}" data-config-value='${i.name}' aria-label="${i.description}" data-balloon-pos="up" data-balloon-length="fit">${i.name.replace(/_/g," ")}</button>`;t.innerHTML=a;const o=document.querySelector(".pageSettings .section[data-config-name='fontFamily'] .buttons");if(o.innerHTML===""){let i="";for(const n of lt(mo).sort((l,c)=>(mo[l].display??l.replace(/_/g," ")).localeCompare(mo[c].display??c.replace(/_/g," ")))){const l=mo[n];let c=n.replace(/_/g," ");l.systemFont||(c+=" Preview");const d=r.fontFamily===n?" active":"",u=l.display??n.replace(/_/g," ");i+=`<button class="${d}" style="font-family:'${c}'" data-config-value="${n}">${u}</button>`}i+='<button class="no-auto-handle" data-config-value="custom"">Custom</button>',o.innerHTML=i}ic=new et({select:".pageSettings .section[data-config-name='customLayoutfluid'] select",settings:{keepOrder:!0,minSelected:2},events:{afterChange:i=>{const n=i.map(l=>l.value);ur(n,r.customLayoutfluid)||v("customLayoutfluid",n)}}}),nc=new et({select:".pageSettings .section[data-config-name='customPolyglot'] select",settings:{minSelected:2},data:Rh(i=>r.customPolyglot.includes(i)),events:{afterChange:i=>{const n=i.map(l=>l.value);ui(n,r.customPolyglot)||v("customPolyglot",n)}}}),Tn({input:V(".pageSettings .section[data-config-name='minWpm'] input"),configName:"minWpmCustomSpeed",validation:{schema:!0,inputValueConvert:i=>bt(r.typingSpeedUnit).toWpm(new Number(i).valueOf())}}),Tn({input:V(".pageSettings .section[data-config-name='minAcc'] input"),configName:"minAccCustom",validation:{schema:!0,inputValueConvert:Number}}),Tn({input:V(".pageSettings .section[data-config-name='minBurst'] input"),configName:"minBurstCustomSpeed",validation:{schema:!0,inputValueConvert:i=>bt(r.typingSpeedUnit).toWpm(new Number(i).valueOf())}}),Tn({input:V(".pageSettings .section[data-config-name='paceCaret'] input"),configName:"paceCaretCustomSpeed",validation:{schema:!0,inputValueConvert:Number}}),Tn({input:V(".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']"),configName:"customBackground",validation:{schema:!0,resetIfEmpty:!1}}),ps(!0),await e7(),await Fd(),ps(!1),Bh=!0}function Cw(){s(".pageSettings .section.needsAccount").addClass("hidden")}function kw(){s(".pageSettings .section.needsAccount").removeClass("hidden"),xw(),Tw()}function Sw(){const e=document.querySelectorAll(".pageSettings .section[data-config-name='funbox'] button");for(const t of e){t.classList.remove("active"),t.classList.remove("disabled");const a=t.getAttribute("data-config-value"),o=t.getAttribute("data-funbox-name");a===null||o===null||(r.funbox.includes(o)?t.classList.add("active"):Wr(na(),o)||t.classList.add("disabled"))}}function xw(){if(_()&&S()){const e=s(".pageSettings .section.tags .tagsList").empty();S()?.tags?.forEach(t=>{e.append(`

      <div class="buttons tag" data-id="${t._id}" data-name="${t.name}" data-display="${t.display}">
        <button class="tagButton ${t.active?"active":""}" active="${t.active}">
          ${t.display}
        </button>
        <button class="clearPbButton" aria-label="clear tags personal bests" data-balloon-pos="left" >
          <i class="fas fa-crown fa-fw"></i>
        </button>
        <button class="editButton" aria-label="rename tag" data-balloon-pos="left" >
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton" aria-label="remove tag"  data-balloon-pos="left" >
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>

      `)}),s(".pageSettings .section.tags").removeClass("hidden")}else s(".pageSettings .section.tags").addClass("hidden")}function Tw(){if(_()&&S()){const e=s(".pageSettings .section.presets .presetsList").empty();S()?.presets?.forEach(t=>{e.append(`
      <div class="buttons preset" data-id="${t._id}" data-name="${t.name}" data-display="${t.display}">
        <button class="presetButton">${t.display}</button>
        <button class="editButton">
          <i class="fas fa-pen fa-fw"></i>
        </button>
        <button class="removeButton">
          <i class="fas fa-trash fa-fw"></i>
        </button>
      </div>
      
      `)}),s(".pageSettings .section.presets").removeClass("hidden")}else s(".pageSettings .section.presets").addClass("hidden")}async function Lw(){const e=r.customBackground!==""||await it.hasFile("LocalBackgroundFile"),t=s(".customBackground img").is(":visible");e&&t?s(".pageSettings .section[data-config-name='customBackgroundFilter']").removeClass("hidden"):s(".pageSettings .section[data-config-name='customBackgroundFilter']").addClass("hidden")}async function bo(e={}){if(pe()!=="settings")return;r.showKeyTips?s(".pageSettings .tip").removeClass("hidden"):s(".pageSettings .tip").addClass("hidden");for(const n of Object.values(q))"updateUI"in n&&n.updateUI();xw(),Tw(),Sw(),await Ee(0),G9(),V9(!0),await _r(),await Lw(),await Er(),Dm();const t=(n,l,c)=>{if(e.eventKey===void 0||e.eventKey===n){const d=document.querySelector(l);if(d===null)throw new Error("Unknown input element "+l);d.value=new String(c).toString(),d.dispatchEvent(new Event("input"))}};t("paceCaret",".pageSettings .section[data-config-name='paceCaret'] input.customPaceCaretSpeed",bt(r.typingSpeedUnit).fromWpm(r.paceCaretCustomSpeed)),t("minWpmCustomSpeed",".pageSettings .section[data-config-name='minWpm'] input.customMinWpmSpeed",bt(r.typingSpeedUnit).fromWpm(r.minWpmCustomSpeed)),t("minAccCustom",".pageSettings .section[data-config-name='minAcc'] input.customMinAcc",r.minAccCustom),t("minBurstCustomSpeed",".pageSettings .section[data-config-name='minBurst'] input.customMinBurst",bt(r.typingSpeedUnit).fromWpm(r.minBurstCustomSpeed)),r.autoSwitchTheme?s(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").removeClass("hidden"):s(".pageSettings .section[data-config-name='autoSwitchThemeInputs']").addClass("hidden"),t("fontSize",".pageSettings .section[data-config-name='fontSize'] input",r.fontSize),t("maxLineWidth",".pageSettings .section[data-config-name='maxLineWidth'] input",r.maxLineWidth),t("keymapSize",".pageSettings .section[data-config-name='keymapSize'] input",r.keymapSize),t("tapeMargin",".pageSettings .section[data-config-name='tapeMargin'] input",r.tapeMargin),t("customBackground",".pageSettings .section[data-config-name='customBackgroundSize'] input[type='text']",r.customBackground),_()?kw():Cw(),dv();const a=window.navigator.userAgent.toLowerCase(),o=a.includes("mac")&&!a.includes("firefox")?"cmd":"ctrl",i=r.quickRestart==="esc"?"tab":"esc";s(".pageSettings .tip").html(`
    tip: You can also change all these settings quickly using the
    command line (<key>${i}</key> or <key>${o}</key> + <key>shift</key> + <key>p</key>)`),ic!==void 0&&!ur(ic.getSelected(),r.customLayoutfluid)&&ic.setData(a7()),nc!==void 0&&!ui(nc.getSelected(),r.customPolyglot)&&nc.setSelected(r.customPolyglot)}function $w(e){Aw(void 0);const t=L(`.pageSettings .settingsGroup.${e}`);if(!t?.hasClass("slideup"))t?.animate({height:0,duration:250,onComplete:()=>{t?.hide()}}),t?.addClass("slideup"),s(`.pageSettings .sectionGroupTitle[group=${e}]`).addClass("rotateIcon");else{t?.show(),t?.setStyle({height:""});const a=t.getOffsetHeight();t?.animate({height:[0,a],duration:250}),t?.removeClass("slideup"),s(`.pageSettings .sectionGroupTitle[group=${e}]`).removeClass("rotateIcon")}}s(".pageSettings .section[data-config-name='funbox'] .buttons").on("click","button",e=>{const t=s(e.currentTarget).attr("data-config-value");Ev(t),Sw()});s(".pageSettings .section.tags").on("click",".tagsList .tag .tagButton",e=>{const t=e.currentTarget,a=s(t).parent(".tag").attr("data-id");qm(a),s(t).toggleClass("active")});s(".pageSettings .section.presets").on("click",".presetsList .preset .presetButton",async e=>{const t=e.currentTarget,a=s(t).parent(".preset").attr("data-id");await mw(a),bo()});s("#importSettingsButton").on("click",()=>{bw("import")});s("#exportSettingsButton").on("click",()=>{const e=JSON.stringify(r);navigator.clipboard.writeText(e).then(function(){f("JSON Copied to clipboard",0)},function(){bw("export")})});s(".pageSettings .sectionGroupTitle").on("click",e=>{$w(s(e.currentTarget).attr("group"))});s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton button.save").on("click",()=>{v("keymapSize",parseFloat(s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&f("Saved",1,{duration:1})});s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("focusout",()=>{v("keymapSize",parseFloat(s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&f("Saved",1,{duration:1})});s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").on("keypress",e=>{e.key==="Enter"&&v("keymapSize",parseFloat(s(".pageSettings .section[data-config-name='keymapSize'] .inputAndButton input").val()))&&f("Saved",1,{duration:1})});s(".pageSettings .quickNav .links a").on("click",e=>{const t=e.target.innerText;s(`.pageSettings .settingsGroup.${t}`).hasClass("slideup")&&$w(t)});let Mw=!1;function ps(e){Mw=e}function Rh(e){return Yp.map(t=>({label:t,options:T0[t]?.map(a=>({text:Ra(a),value:a,selected:e(a)}))}))}function a7(){const e=r.customLayoutfluid;return[...e,...Vc.filter(t=>!e.includes(t))].map(t=>({text:t.replace(/_/g," "),value:t,selected:e.includes(t)}))}function Wh(e){return il.map(t=>({value:t.name,text:t.name.replace(/_/g," "),selected:e(t)}))}function Aw(e){if(e===void 0){const a=document.querySelector(".section.highlight");a!==null&&a.classList.remove("highlight");return}const t=document.querySelector(`[data-config-name="${e}"] .groupTitle,[data-section-id="${e}"] .groupTitle`);t!==null&&setTimeout(()=>{t.scrollIntoView({block:"center",behavior:"auto"}),t.parentElement?.classList.remove("highlight"),t.parentElement?.classList.add("highlight")},250)}s(".pageSettings .section .groupTitle button").on("click",e=>{const t=e.target.parentElement?.parentElement,a=t?.dataset?.configName??t?.dataset?.sectionId;a!==void 0&&(_w.setUrlParams({highlight:a}),navigator.clipboard.writeText(window.location.toString()).then(()=>{f("Link copied to clipboard",1)}).catch(o=>{const i=se(o,"Failed to copy to clipboard");f(i,-1)}))});Ce(({key:e,newValue:t})=>{e==="fullConfigChange"&&ps(!0),e==="fullConfigChangeFinished"&&ps(!1),e==="themeLight"?s(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.light option[value="${t}"]`).attr("selected","true"):e==="themeDark"&&s(`.pageSettings .section[data-config-name='autoSwitchThemeInputs'] select.dark option[value="${t}"]`).attr("selected","true"),!Mw&&pe()==="settings"&&e!=="theme"&&(e==="customBackground"?Lw():bo({eventKey:e}))});Wa(e=>{e.type==="authStateChanged"&&(e.data.isUserSignedIn?kw():Cw())});const _w=new Im({id:"settings",element:V(".page.pageSettings"),path:"/settings",urlParamsSchema:Z9,afterHide:async()=>{Tt("pageSettings")},beforeShow:async e=>{Gt("pageSettings","main"),await Vy,await t7(),await bo(),await Q9(),Aw(e.urlParams?.highlight)}});s(async()=>{Qt("pageSettings")});const o7={_id:"default",name:"defaults",pb:{no:!0,yes:!0},difficulty:{normal:!0,expert:!0,master:!0},mode:{words:!0,time:!0,quote:!0,zen:!0,custom:!0},words:{10:!0,25:!0,50:!0,100:!0,custom:!0},time:{15:!0,30:!0,60:!0,120:!0,custom:!0},quoteLength:{short:!0,medium:!0,long:!0,thicc:!0},punctuation:{on:!0,off:!0},numbers:{on:!0,off:!0},date:{last_day:!1,last_week:!1,last_month:!1,last_3months:!1,all:!0},tags:{none:!0},language:Object.fromEntries(Qp.map(e=>[e,!0])),funbox:{none:!0,...Object.fromEntries(V2().map(e=>[e,!0]))}},Dt=structuredClone(o7);function Fm(e){try{const t={};for(const a of lt(Dt))if(a==="_id"){let o=e[a]??Dt[a];(o==="default-result-filters-id"||o==="")&&(o="default"),t[a]=o}else a==="name"?t[a]=e[a]??Dt[a]:t[a]={...Dt[a],...e[a]};return t}catch{return Dt}}const Ew=new ut({key:"resultFilters",schema:hc,fallback:Dt,migrate:(e,t)=>Wb(e)?Fm(wp(hc.partial().strip(),e)):Dt}),i7=new Set(["language","funbox","tags"]),go={};let J=Dt;function $o(){Ew.set(J)}async function n7(){try{J=Fm(Ew.get());const e={none:!1};Object.keys(Dt.tags).forEach(t=>{J.tags[t]!==void 0?e[t]=J.tags[t]:e[t]=!0}),J.tags=e,$o()}catch{console.log("error in loading result filters"),J=Dt,$o()}}async function Pm(){const e=document.querySelector(".pageAccount .presetFilterButtons"),t=document.querySelector(".pageAccount .presetFilterButtons .filterBtns");if(!e||!t)return;t.innerHTML="";const a=S()?.filterPresets??[];if(a.length>0){let o="";for(const i of a)o+=`<div class="filterPresets">
      <div class="select-filter-preset button" data-id="${i._id}">${i.name.replace(/_/g," ")}</div>
      <div class="button delete-filter-preset" data-id="${i._id}">
        <i class="fas fa-fw fa-trash"></i>
      </div>
    </div>`;t.innerHTML=o,e.classList.remove("hidden")}else e.classList.add("hidden")}async function s7(e){const t=S()?.filterPresets.find(a=>a._id===e);t&&(J=h7(t),$o(),qo()),s(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active"),s(`.pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset[data-id=${e}]`).addClass("active")}function r7(e){const t=S();t&&dt({...t,filterPresets:[...t.filterPresets,structuredClone(e)]})}async function l7(e){e=e.replace(/ /g,"_"),oe();const t=await $.users.addResultFilterPreset({body:{...J,name:e}});return j(),t.status===200?(r7({...J,name:e,_id:t.body.data}),Pm(),1):(console.log("error creating filter preset: "+t.body.message),0)}function c7(e){const t=S();if(!t)return;const a=[...t.filterPresets],o=a.findIndex(i=>i._id===e);o>-1&&a.splice(o,1),dt({...t,filterPresets:a})}async function d7(e){oe();const t=await $.users.removeResultFilterPreset({params:{presetId:e}});j(),t.status===200?(c7(e),Pm(),Rm(),f("Filter preset deleted",1)):(f("Error deleting filter preset: "+t.body.message,-1),console.log("error deleting filter preset",t.body.message))}function Bm(){s(".pageAccount .group.presetFilterButtons .filterBtns .filterPresets .select-filter-preset").removeClass("active")}function ms(){return J}function Lf(e){return J[e]}function Ne(e,t){return J[e][t]}function qw(e,t,a){J[e][t]=a}function Qa(e,t){Object.keys(Lf(e)).forEach(a=>{J[e][a]=t})}function u7(){const e=S();e!==void 0&&e.tags.forEach(t=>{Dt.tags[t._id]=!0})}function Rm(){J=Dt,$o()}function qo(){const e={};for(const o of lt(ms()))if(!(o==="_id"||o==="name")){e[o]={all:!0,array:[]};for(const i of lt(Lf(o))){const n=e[o];if(n===void 0)continue;const l=Ne(o,i);if(l===!0?n.array?.push(i):n.all!==void 0&&(n.all=!1),i7.has(o)){const c=s(`.pageAccount .group.filterButtons .filterGroup[group="${o}"] option[value="${i}"]`);l===!0?c.prop("selected",!0):c.prop("selected",!1)}else{let c;o==="date"?c=s(`.pageAccount .group.topFilters .filterGroup[group="${o}"] button[filter="${i}"]`):c=s(`.pageAccount .group.filterButtons .filterGroup[group="${o}"] button[filter="${i}"]`),l===!0?c.addClass("active"):c.removeClass("active")}}}for(const[o,i]of Object.entries(go)){const n=i,l=Lf(o),c=Object.values(l).every(m=>m===!0),d=n.store.getData(),u=s(`.pageAccount .group.filterButtons .filterGroup[group="${o}"] option[value="all"]`);if(c){u.prop("selected",!0);for(const m of d)"value"in m&&(m.value==="all"?m.selected=!0:m.selected=!1);n.store.setData(d),n.render.renderValues()}else u.prop("selected",!1);for(const m of d)"value"in m&&(l[m.value]===!0?m.selected=!0:(!c||m.value!=="all")&&(m.selected=!1));setTimeout(()=>{n.store.setData(d),c||n.render.renderValues(),n.render.renderOptions(d)},0)}function t(o){let i="";return i+="<div class='group'>",o==="difficulty"?i+='<span aria-label="Difficulty" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i>':o==="mode"?i+='<span aria-label="Mode" data-balloon-pos="up"><i class="fas fa-fw fa-bars"></i>':o==="punctuation"?i+='<span aria-label="Punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i>':o==="numbers"?i+='<span aria-label="Numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i>':o==="words"?i+='<span aria-label="Words" data-balloon-pos="up"><i class="fas fa-fw fa-font"></i>':o==="time"?i+='<span aria-label="Time" data-balloon-pos="up"><i class="fas fa-fw fa-clock"></i>':o==="date"?i+='<span aria-label="Date" data-balloon-pos="up"><i class="fas fa-fw fa-calendar"></i>':o==="tags"?i+='<span aria-label="Tags" data-balloon-pos="up"><i class="fas fa-fw fa-tags"></i>':o==="language"?i+='<span aria-label="Language" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i>':o==="funbox"&&(i+='<span aria-label="Funbox" data-balloon-pos="up"><i class="fas fa-fw fa-gamepad"></i>'),e[o]?.all?i+="all":o==="tags"?i+=e.tags?.array?.map(n=>{if(n==="none")return n;const l=S();if(l===void 0)return n;const c=l.tags?.find(d=>d._id===n);return c!==void 0?l.tags?.find(d=>d._id===n)?.display:c}).join(", "):i+=e[o]?.array?.join(", ").replace(/_/g," "),i+="</span></div>",i}let a="";a+=t("date"),a+='<div class="spacer"></div>',a+=t("mode"),a+='<div class="spacer"></div>',e.mode?.array?.includes("time")&&(a+=t("time"),a+='<div class="spacer"></div>'),e.mode?.array?.includes("words")&&(a+=t("words"),a+='<div class="spacer"></div>'),a+=t("difficulty"),a+='<div class="spacer"></div>',a+=t("punctuation"),a+='<div class="spacer"></div>',a+=t("numbers"),a+='<div class="spacer"></div>',a+=t("language"),a+='<div class="spacer"></div>',a+=t("funbox"),a+='<div class="spacer"></div>',a+=t("tags"),setTimeout(()=>{s(".pageAccount .group.chart .above").html(a)},0)}function f7(e,t){Bm();try{e==="date"&&Qa("date",!1);const o=!J[e][t];J[e][t]=o,$o()}catch(a){f("Something went wrong toggling filter. Reverting to defaults.",0),console.log("toggling filter error"),console.error(a),Rm(),qo()}}s(".pageAccount .filterButtons .buttonsAndTitle .buttons, .pageAccount .group.topFilters .buttonsAndTitle.testDate .buttons").on("click","button",e=>{const t=s(e.target).parents(".buttons").attr("group"),a=s(e.target).attr("filter");s(e.target).hasClass("allFilters")?(lt(ms()).forEach(o=>{o==="_id"||o==="name"||Qa(o,!0)}),Qa("date",!1),J.date.all=!0):s(e.target).hasClass("noFilters")?lt(ms()).forEach(o=>{o==="_id"||o==="name"||o!=="date"&&Qa(o,!1)}):s(e.target).is("button")&&(e.shiftKey?(Qa(t,!1),J[t][a]=!0):f7(t,a)),qo(),$o()});s(".pageAccount .topFilters button.allFilters").on("click",()=>{Bm(),console.log(ms()),lt(ms()).forEach(e=>{e==="_id"||e==="name"||Qa(e,!0)}),Qa("date",!1),J.date.all=!0,qo(),$o()});s(".pageAccount .topFilters button.currentConfigFilter").on("click",()=>{if(Bm(),lt(ms()).forEach(e=>{e==="_id"||e==="name"||Qa(e,!1)}),J.pb.no=!0,J.pb.yes=!0,J.difficulty[r.difficulty]=!0,J.mode[r.mode]=!0,r.mode==="time")if([15,30,60,120].includes(r.time)){const e=`${r.time}`;J.time[e]=!0}else J.time.custom=!0;else if(r.mode==="words")if([10,25,50,100,200].includes(r.words)){const e=`${r.words}`;J.words[e]=!0}else J.words.custom=!0;else r.mode==="quote"&&["short","medium","long","thicc"].forEach((t,a)=>{r.quoteLength.includes(a)?J.quoteLength[t]=!0:J.quoteLength[t]=!1});if(r.punctuation?J.punctuation.on=!0:J.punctuation.off=!0,r.numbers?J.numbers.on=!0:J.numbers.off=!0,r.mode==="quote"&&/english.*/.test(r.language)?J.language.english=!0:J.language[r.language]=!0,r.funbox.length===0)J.funbox.none=!0;else for(const e of r.funbox)J.funbox[e]=!0;J.tags.none=!0,S()?.tags?.forEach(e=>{e.active===!0&&(J.tags.none=!1,J.tags[e._id]=!0)}),J.date.all=!0,qo(),$o()});s(".pageAccount .topFilters button.toggleAdvancedFilters").on("click",()=>{s(".pageAccount .filterButtons").slideToggle(250),s(".pageAccount .topFilters button.toggleAdvancedFilters").toggleClass("active")});function $f(e,t=0){const a=go[e];if(a===void 0)return;const o=a.render.content.list,i=o.children.item(t);o.scrollTop=i.offsetTop-o.offsetTop}function Mf(e,t,a){const o=t.some(n=>n.value==="all"),i=a.some(n=>n.value==="all");o?i?t.length<a.length&&(t=t.filter(n=>n.value!=="all")):t=t.filter(n=>n.value==="all"):i&&(t=[]),Qa(e,!1);for(const n of t){if(n.value==="all"){Qa(e,!0);break}qw(e,n.value,!0)}return qo(),$o(),Iw(),!1}let Iw=()=>{};function p7(){const e=S();if(e===void 0)return;const t=e.tags.filter(i=>Dt.tags[i._id]===void 0);if(t.length>0){const i=Object.values(J.tags).every(n=>n);Dt.tags={...Dt.tags,...Object.fromEntries(t.map(n=>[n._id,!0]))},J.tags={...J.tags,...Object.fromEntries(t.map(n=>[n._id,i]))}}const a=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select select");if(!(a instanceof HTMLElement))return;let o="";o+="<option value='all'>all</option>",o+="<option value='none'>no tag</option>";for(const i of e.tags)o+=`<option value="${i._id}" filter="${i.name}">${i.display}</option>`;a.innerHTML=o}let zh=!1;async function m7(e){const t=S();g7(t),!zh&&(Iw=e,go.language=new et({select:".pageAccount .content .filterButtons .buttonsAndTitle.languages .select .languageSelect",data:[{value:"all",text:"all"},...Qp.map(a=>({value:a,text:Ra(a),filter:a}))],settings:{showSearch:!0,placeholderText:"select a language",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,o)=>Mf("language",a,o),beforeOpen:()=>{$f("language")}}}),go.funbox=new et({select:".pageAccount .content .filterButtons .buttonsAndTitle.funbox .select .funboxSelect",data:[{value:"all",text:"all"},{value:"none",text:"no funbox"},...up().map(a=>({value:a.name,text:a.name.replace(/_/g," "),filter:a.name}))],settings:{showSearch:!0,placeholderText:"select a funbox",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(a,o)=>Mf("funbox",a,o),beforeOpen:()=>{$f("funbox")}}}),Pm(),zh=!0)}function g7(e){const t=s(".pageAccount .content .filterButtons .buttonsAndTitle.tags");if(e.tags.length===0)t.addClass("hidden"),go.tags&&(go.tags.destroy(),delete go.tags),qw("tags","none",!0);else if(t.removeClass("hidden"),p7(),!go.tags){const a=document.querySelector(".pageAccount .content .filterButtons .buttonsAndTitle.tags .select .tagsSelect");a&&(go.tags=new et({select:a,settings:{showSearch:!0,placeholderText:"select a tag",allowDeselect:!0,closeOnSelect:!1},events:{beforeChange:(o,i)=>Mf("tags",o,i),beforeOpen:()=>{$f("tags")}}}))}}s(".group.presetFilterButtons .filterBtns").on("click",".filterPresets .delete-filter-preset",e=>{d7(s(e.currentTarget).data("id"))});function h7(e){return Fm(wp(hc.partial().strip(),structuredClone(e)))}Wa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&(u7(),n7())});function b7(e){let t=[];for(let i=1;i<=e.wpm.length;i++)t.push(i.toString());e.wpm=e.wpm.slice(0,e.burst.length),e.err=e.err.slice(0,e.burst.length),t=t.slice(0,e.burst.length),Yt.data.labels=t,Yt.getDataset("wpm").data=e.wpm,Yt.getDataset("burst").data=e.burst,Yt.getDataset("error").data=e.err;const a=Math.max(Math.max(...e.wpm),Math.max(...e.burst)),o=Math.min(Math.min(...e.wpm),Math.min(...e.burst));Yt.getScale("wpm").max=Math.round(a),Yt.getScale("burst").max=Math.round(a),r.startGraphsAtZero?(Yt.getScale("wpm").min=0,Yt.getScale("burst").min=0):(Yt.getScale("wpm").min=Math.round(o),Yt.getScale("burst").min=Math.round(o)),Yt.updateColors()}function y7(e){b7(e),v7.show()}const v7=new ue({dialogId:"miniResultChartModal"});function w7(e){const t=e?"Profile":"Account",o=e?"":`<div class="buttonGroup"><button
  class="showAllButton"
  data-balloon-pos="left"
  aria-label="Show all personal bests"
>
  <i class="fas fa-ellipsis-v"></i>
</button></div>`;s(`.page${t} .profile .pbsWords`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">10 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">25 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">50 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">100 words</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${o}
  `),s(`.page${t} .profile .pbsTime`).html(`
      <div class="group">
      <div class="quick">
        <div class="test">15 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">30 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">60 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    <div class="group">
      <div class="quick">
        <div class="test">120 seconds</div>
        <div class="wpm">-</div>
        <div class="acc">-</div>
      </div>
    </div>
    ${o}
  `)}function Af(e,t=!1){if(w7(t),e===void 0)return;let a="";const o=t?"Profile":"Account";s(`.page${o} .profile .pbsTime`).html(""),s(`.page${o} .profile .pbsWords`).html("");const i=["15","30","60","120"],n=["10","25","50","100"];i.forEach(c=>{a+=Hh(e,"time",c)});const l=t?"":`<div class="buttonGroup"><button
      class="showAllButton"
      data-balloon-pos="left"
      aria-label="Show all personal bests"
    >
      <i class="fas fa-ellipsis-v"></i>
    </button></div>`;s(`.page${o} .profile .pbsTime`).append(a+l),a="",n.forEach(c=>{a+=Hh(e,"words",c)}),s(`.page${o} .profile .pbsWords`).append(a+l)}function Hh(e,t,a){let o="",i="";const n=`${a} ${t==="time"?"seconds":"words"}`,l=r.typingSpeedUnit;try{const c=(e[t][a]??[]).sort((u,m)=>m.wpm-u.wpm)[0];if(c===void 0)throw new Error("No PB data found");const d=new Date(c.timestamp);c.timestamp!==void 0&&c.timestamp>0&&(i=te(d,"dd MMM yyyy")),o=`<div class="quick">
      <div class="test">${n}</div>
      <div class="wpm">${W.typingSpeed(c.wpm,{showDecimalPlaces:!1})}</div>
      <div class="acc">${W.accuracy(c.acc,{showDecimalPlaces:!1})}</div>
    </div>
    <div class="fullTest">
      <div>${n}</div>
      <div>${W.typingSpeed(c.wpm,{suffix:` ${l}`})}</div>
      <div>${W.typingSpeed(c.raw,{suffix:" raw"})}</div>
      <div>${W.accuracy(c.acc,{suffix:" acc"})}</div>
      <div>${W.percentage(c.consistency,{suffix:" con"})}</div>
      <div>${i}</div>
    </div>`}catch{o=`<div class="quick">
    <div class="test">${n}</div>
    <div class="wpm">-</div>
    <div class="acc">-</div>
  </div>`}return`
  <div class="group">
  ${o}
  </div>
  `}const Dw={1:{id:1,name:"Developer",description:"I made this",icon:"fa-laptop",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},2:{id:2,name:"Collaborator",description:"I helped make this",icon:"fa-code",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},3:{id:3,name:"Server Mod",description:"Discord server moderator",icon:"fa-hammer",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},4:{id:4,name:"OG Account",description:"First 1000 users on the site",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},5:{id:5,name:"OG Discordian",description:"First 1000 Discord server members",icon:"fa-baby",color:"var(--bg-color)",background:"var(--main-color)"},6:{id:6,name:"Supporter",description:"Donated money",icon:"fa-heart",color:"var(--text-color)",background:"var(--sub-color)"},7:{id:7,name:"Sugar Daddy",description:"Donated a lot of money",icon:"fa-gem",color:"var(--bg-color)",background:"var(--main-color)"},8:{id:8,name:"Monkey Supporter",description:"Donated more money",icon:"fa-heart",color:"var(--bg-color)",background:"var(--main-color)"},9:{id:9,name:"White Hat",description:"Reported critical vulnerabilities on the site",icon:"fa-user-secret",color:"var(--bg-color)",background:"var(--main-color)"},10:{id:10,name:"Bug Hunter",description:"Reported or helped track down bugs on the site",icon:"fa-bug",color:"var(--text-color)",background:"var(--sub-color)"},11:{id:11,name:"Content Creator",description:"Verified content creator",icon:"fa-video",color:"var(--text-color)",background:"var(--sub-color)"},12:{id:12,name:"Contributor",description:"Contributed to the site",icon:"fa-hands-helping",color:"var(--text-color)",background:"var(--sub-color)"},13:{id:13,name:"Mythical",description:"Yes, I'm actually this fast",icon:"fa-rocket",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"},14:{id:14,name:"All Year Long",description:"Reached a streak of 365 days",icon:"fa-fire",color:"var(--bg-color)",background:"var(--main-color)"},15:{id:15,name:"Insane",description:"I typed for 69 hours straight",icon:"fa-bomb",color:"white",background:"#093d79",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, 0, 0.5, 1) infinite; background: linear-gradient(90deg, rgb(8 31 84) 0%, rgb(18 134 158) 100%); background-size: 200% 200%;"},16:{id:16,name:"Perfection",description:"Longest test with zero mistakes - 4 hours and 1 minute",icon:"fa-bullseye",color:"white",customStyle:"animation: gold-shimmer 10s cubic-bezier(0.5, -0.15, 0.5, 1.15) infinite; background: linear-gradient(45deg, #b8860b 0%, #daa520 25%, #ffd700 50%, #daa520 75%, #b8860b 100%); background-size: 200% 200%;"},17:{id:17,name:"Phineas",description:"Ferb, I know what we're gonna do today...",icon:"fa-sun",color:"white",customStyle:"animation: rgb-bg 10s linear infinite; background: linear-gradient(45deg in hsl longer hue, hsl(330, 90%, 30%) 0%, hsl(250, 90%, 30%) 100%);"}};function gs(e,t=!1,a=!1,o=!1){const i=Dw[e];if(!i&&!o)return"";let n="";i?.background!==void 0&&(n+=`background: ${i.background};`),i?.color!==void 0&&(n+=`color: ${i.color};`),i?.customStyle!==void 0&&(n+=i.customStyle);const l=i?.name??"Badge Name Missing",c=i?.description??"Badge Description Missing",d=(t?l+": ":"")+c;let u="";a||(u=`aria-label="${d}" data-balloon-pos="right"`);let m="";i?.icon!==void 0?m=`<i class="fas ${t?"fa-fw":""} ${i.icon}"></i>`:m='<i class="fas fa-question"></i>';const p=`<div class="text">${l}</div>`;return`<div class="badge" ${u} style="${n}">${m}${t?"":p}</div>`}function C7(e){return Dw[e]}async function Kc(e,t){const a=e.charAt(0).toUpperCase()+e.slice(1),o=s(`.page${a} .profile`),i=s(`.page${a} .profile .details`);o.attr("uid",t.uid??""),o.attr("name",t.name??"");const n=t.banned===!0;if(i===void 0||t===void 0||t.name===void 0||t.addedAt===void 0)return;if(i.find(".avatarAndName .avatar").replaceWith(Ur(t,{size:256})),t.inventory?.badges&&!n){let E="",B="";for(const z of t.inventory.badges)z.selected===!0?E=gs(z.id):B+=gs(z.id,!0);i.find(".badges").empty().append(E),i.find(".allBadges").empty().append(B)}i.find(".name").text(t.name),i.find(".userFlags").html(Ss({...t,isFriend:Sp(t.uid)})),t.lbOptOut===!0&&(e==="profile"?o.find(".lbOptOutReminder").removeClass("hidden").text("Note: This account has opted out of the leaderboards, meaning their results aren't verified by the anticheat system and may not be legitimate."):o.find(".lbOptOutReminder").addClass("hidden")),setTimeout(()=>{Wm(e)},10);const c="Joined "+te(t.addedAt??0,"dd MMM yyyy"),d=new Date(t.addedAt),u=Mn(new Date,d),m=`${u} day${u!==1?"s":""} ago`;i.find(".joined").text(c).attr("aria-label",m);let p="";if(t.streak&&t?.streak>1?(i.find(".streak").text(`Current streak: ${t.streak} ${t.streak===1?"day":"days"}`),p=`Longest streak: ${t.maxStreak} ${t.maxStreak===1?"day":"days"}`):(i.find(".streak").text(""),p=""),e==="account"){const B=S()?.results?.[0],z=t.streakHourOffset,H=1e3*60*60*24;let ae=vl(z)+H;ae<Date.now()&&(ae+=H);const xe=ty(ae);if(console.debug("Streak hour offset"),console.debug("date.now()",Date.now(),new Date(Date.now())),console.debug("dayInMilis",H),console.debug("difTarget",new Date(vl(z)+H)),console.debug("timeDif",xe),console.debug("DateTime.getCurrentDayTimestamp()",vl(),new Date(vl())),console.debug("profile.streakHourOffset",z),B!==void 0){const Fe=K2(B.timestamp,z),ze=j2(B.timestamp,z);console.debug("lastResult.timestamp",B.timestamp,new Date(B.timestamp)),console.debug("isToday",Fe),console.debug("isYesterday",ze);const N=ge(z)?`(${z>0?"+":""}${z} offset)`:"";Fe?(p+=`
Claimed today: yes`,p+=`
Come back in: ${xe} ${N}`):ze?(p+=`
Claimed today: no`,p+=`
Streak lost in: ${xe} ${N}`):(p+=`
Streak lost ${xe} ${N} ago`,p+=`
It will be removed from your profile on the next result save`),console.debug(p),z===void 0&&(p+=`

If the streak reset time doesn't line up with your timezone, you can change it in Account Settings > Account > Set streak hour offset.`)}}i.find(".streak").attr("aria-label",p).attr("data-balloon-break","");const{completedPercentage:g,restartRatio:h}=Ub(t.typingStats),y=i.find(".typingStats");y.find(".started .value").text(t.typingStats?.startedTests??0),y.find(".completed .value").text(t.typingStats?.completedTests??0).attr("data-balloon-pos","up").attr("aria-label",`${g}% (${h} restarts per completed test)`),y.find(".timeTyping .value").text(Re(Math.round(t.typingStats?.timeTyping??0),!0,!0));let k=!1,x=!1,C=!1;if(!n&&(k=!!(t.details?.bio??""),i.find(".bio .value").text(t.details?.bio??""),x=!!(t.details?.keyboard??""),i.find(".keyboard .value").text(t.details?.keyboard??""),t.details?.socialProfiles?.github!==void 0&&t.details?.socialProfiles?.github!==""||t.details?.socialProfiles?.twitter!==void 0&&t.details?.socialProfiles?.twitter!==""||t.details?.socialProfiles?.website!==void 0&&t.details?.socialProfiles?.website!=="")){C=!0;const E=i.find(".socials .value");E.empty();const B=t.details?.socialProfiles.github??"";B&&E.append(`<a href='https://github.com/${at(B)}/' target="_blank" rel="nofollow me" aria-label="${at(B)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-github"></i></a>`);const z=t.details?.socialProfiles.twitter??"";z&&E.append(`<a href='https://x.com/${at(z)}' target="_blank" rel="nofollow me" aria-label="${at(z)}" data-balloon-pos="up" class="textButton"><i class="fab fa-fw fa-twitter"></i></a>`);const H=t.details?.socialProfiles.website??"",ae=/^https?:\/\/(?:www\.)?([^/]+)/,xe=H?.match(ae)?.[1]??H;H&&E.append(`<a href='${at(H)}' target="_blank" rel="nofollow me" aria-label="${at(xe??"")}" data-balloon-pos="up" class="textButton"><i class="fas fa-fw fa-globe"></i></a>`)}if(Fw(e,t.xp??0),n)o.find(".leaderboardsPositions").addClass("hidden");else{o.find(".leaderboardsPositions").removeClass("hidden");const E=t.allTimeLbs?.time?.["15"]?.english??null,B=t.allTimeLbs?.time?.["60"]?.english??null;E===null&&B===null?o.find(".leaderboardsPositions").addClass("hidden"):(E!==null&&(o.find(".leaderboardsPositions .group.t15 .pos").text(W.rank(E?.rank)),o.find(".leaderboardsPositions .group.t15 .topPercentage").text(_g(E))),B!==null&&(o.find(".leaderboardsPositions .group.t60 .pos").text(W.rank(B?.rank)),o.find(".leaderboardsPositions .group.t60 .topPercentage").text(_g(B))))}t.uid===ct()?.uid?o.find(".userReportButton").addClass("hidden"):o.find(".userReportButton").removeClass("hidden");const D=k||x;k?i.find(".bio").removeClass("hidden"):i.find(".bio").addClass("hidden"),x?i.find(".keyboard").removeClass("hidden"):i.find(".keyboard").addClass("hidden"),D?(i.find(".bioAndKeyboard").removeClass("hidden"),i.find(".sep2").removeClass("hidden")):(i.find(".bioAndKeyboard").addClass("hidden"),i.find(".sep2").addClass("hidden")),C?(i.find(".socials").removeClass("hidden"),i.find(".sep3").removeClass("hidden")):(i.find(".socials").addClass("hidden"),i.find(".sep3").addClass("hidden")),i.removeClass("none"),i.removeClass("bioAndKey"),i.removeClass("soc"),i.removeClass("both"),!C&&!D?i.addClass("none"):C&&!D?i.addClass("soc"):!C&&D?i.addClass("bioAndKey"):C&&D&&i.addClass("both"),k7()}function Fw(e,t,a=!1){const o=e.charAt(0).toUpperCase()+e.slice(1),i=s(`.page${o} .profile`),n=s(`.page${o} .profile .details .levelAndBar`);if(n==null||a&&e==="profile"&&ct()?.uid!==i.attr("uid"))return;const l=Qn(t),c=l.levelMaxXp,d=l.levelCurrentXp;n.find(".level").text(l.level).attr("aria-label",`${Ns(t)} total xp`),n.find(".xp").text(`${Ns(d)}/${Ns(c)}`).attr("aria-label",`${Ns(c-d)} xp until next level`),n.find(".xpBar .bar").css("width",`${d/c*100}%`),n.find(".xpBar").attr("aria-label",`${(d/c*100).toFixed(2)}%`)}function Wm(e){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;let a;if(e==="account"?a=s(".pageAccount .profile .details"):e==="profile"&&(a=s(".pageProfile .profile .details")),!a)return;const o=a.find(".user"),i=o.parent()[0],n=o[0],l=pr(2);if(!n||!i)return;n.style.fontSize="10px";const c=i.clientWidth,d=n.clientWidth,m=c/d*10,p=Math.min(Math.max(m,10),l);n.style.fontSize=`${p}px`}function k7(){const e=ct()?.uid,t=document.querySelector(".profile")?.getAttribute("uid"),a=document.querySelector(".profile .addFriendButton"),o=e===t,i=S()?.connections[t]!==void 0;!Ba()?.connections.enabled||e===void 0||o?a?.classList.add("hidden"):i?a?.classList.add("disabled"):(a?.classList.remove("disabled"),a?.classList.remove("hidden"))}const S7=ey(1e3,()=>{const e=pe();e&&["account","profile"].includes(e)&&Wm(e)});s(window).on("resize",()=>{S7()});function _f(){s(".pageAccount .resultBatches").addClass("hidden")}function x7(){s(".pageAccount .resultBatches").removeClass("hidden")}async function T7(){const e=S()?.results;if(e===void 0){console.error("(Result batches) Results are missing but they should be available at the time of drawing the account page?"),_f();return}L7();const t=S()?.typingStats?.completedTests??0,a=Math.round(e.length/t*100),o=Ba()?.results.limits??{regularUser:0,premiumUser:0},i=S()?.isPremium?o.premiumUser:o.regularUser,n=Math.round(e?.length/i*100),l=s(".pageAccount .resultBatches .bars"),c={downloaded:{fill:l.find(".downloaded .fill"),rightText:l.find(".downloaded.rightText")},limit:{fill:l.find(".limit .fill"),rightText:l.find(".limit.rightText")}};c.downloaded.fill.css("width",Math.min(a,100)+"%"),c.downloaded.rightText.text(`${e?.length} / ${t} (${a}%)`);const d=await pi();c.limit.fill.css({width:Math.min(n,100)+"%",background:fa(d.sub,d.error,_u(n,50,100,0,1))}),c.limit.rightText.text(`${e?.length} / ${i} (${n}%)`),s(".pageAccount .resultBatches > .text").text(""),e.length>=t&&(Ef(),Oh("all results loaded")),e.length>=i&&(Ef(),Oh("limit reached"))}function Ef(){s(".pageAccount .resultBatches button").prop("disabled",!0)}function L7(){s(".pageAccount .resultBatches button").prop("disabled",!1)}function Oh(e){s(".pageAccount .resultBatches button").text(e)}function $7(){if(!(S()?.isPremium??!1)){_f();return}const t=S()?.typingStats?.completedTests??0,a=Ba()?.results.maxBatchSize??0;if(t<=a){_f();return}x7()}let Po;function Pw(e,t,a){if(t===void 0){zm(e);return}e.classList.remove("hidden"),e.querySelector(".yearSelect")!==null&&(Po=Ww(e),Rw(e,"current",Kb(a?.getFullYear())??2022)),A7(e,t.firstDayOfWeek),Bw(e,t)}function zm(e){e?.classList.add("hidden"),e?.querySelector(".activity")?.replaceChildren()}function Bw(e,t){const a=e.querySelector(".activity");if(a===null)return;if(a.innerHTML="",t===void 0){Nh([]),e.querySelector(".nodata")?.classList.remove("hidden");return}Nh(t.getMonths()),e.querySelector(".nodata")?.classList.add("hidden");const o=e.querySelector(".title");o!==null&&(o.innerHTML=t.getTotalTests()+" tests");for(const i of t.getDays()){const n=document.createElement("div");n.setAttribute("data-level",i.level),i.label!==void 0&&(n.setAttribute("aria-label",i.label),n.setAttribute("data-balloon-pos","up")),a.appendChild(n)}}function Rw(e,t,a){const o=new Date().getFullYear(),i=[{text:"last 12 months",value:"current",selected:t==="current"}];for(let l=o;l>=a;l--)(i.length<2||Ba()?.users.premium.enabled&&S()?.isPremium)&&i.push({text:l.toString(),value:l.toString(),selected:l===t});const n=Ww(e);n.setData(i),i.length>1?n.enable():n.disable()}function Nh(e){const t=document.querySelector(".testActivity .months");t!==null&&(t.innerHTML=e.map(a=>`<div style="grid-column: span ${a.weeks}">${a.text}</div>`).join(""))}function Ww(e){return Po!==void 0||(Po=new et({select:e.querySelector(".yearSelect"),settings:{showSearch:!1},events:{afterChange:async t=>{Po?.disable();const a=t[0]?.value,o=await h5(a);Bw(e,o),(Po?.getData()??[]).length>1&&Po?.enable()}}})),Po}const M7=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];function A7(e,t){const a=[];for(let i=0;i<7;i++)a.push(i%2!==t%2?M7[(t+i)%7]:void 0);const o=i=>{const n=i!==void 0?l=>l.substring(0,i):l=>l;return a.map(l=>l!==void 0?`<div><div class="text">${n(l)}</div></div>`:"<div></div>").join("")};e.querySelector(".daysFull").innerHTML=o(),e.querySelector(".days").innerHTML=o(3)}const _7=I.object({property:I.string(),descending:I.boolean()});class zw{constructor(t){if(this.data=[],this.table=s(t.table),this.table===void 0)throw new Error(`No element found for ${t.table}`);this.buildRow=t.buildRow,t.data!==void 0&&this.setData(t.data),"persistence"in t&&t.persistence!==void 0?(this.persistence=t.persistence,this.sort=this.persistence.get(),this.doSort()):"initialSort"in t&&t.initialSort!==void 0&&(this.sort=t.initialSort,this.doSort());for(const a of this.table.find("td[data-sort-property]"))a.classList.add("sortable"),a.setAttribute("type","button"),a.onclick=o=>{const i=o.currentTarget,n=i.dataset.sortProperty,l=i.dataset.sortDefaultDirection==="desc";if(n===void 0)return;let c=this.sort;c===void 0||n!==c.property?c={property:n,descending:l}:c.descending=!c?.descending,this.setSort(c),this.updateBody()}}setSort(t){this.sort={...this.sort,...t},this.persistence?.set(this.sort),this.doSort()}setData(t){this.data=t.map(a=>({source:a})),this.doSort()}doSort(){if(this.sort===void 0)return;const{property:t,descending:a}=this.sort;this.table.find("thead td").removeClass("headerSorted"),this.table.find("thead td").children("i").remove(),this.table.find(`thead td[data-sort-property="${t}"]`).addClass("headerSorted").append(`<i class="fas ${a?"fa-sort-down":"fa-sort-up"} aria-hidden="true"></i>`),this.data.sort((o,i)=>{const n=Uh(o.source,t),l=Uh(i.source,t);let c=0;return n===void 0&&l!==void 0?a?1:-1:n!==void 0&&l===void 0?a?-1:1:(typeof n=="string"&&typeof l=="string"&&(c=n.localeCompare(l)),typeof n=="number"&&typeof l=="number"&&(c=n-l),a?-c:c)})}updateBody(){const t=this.table.find("tbody");t.empty(),t.append(this.getData().map(a=>(a.element??=this.buildRow(a.source),a.element)))}getData(){return this.data}}function Uh(e,t){return t.split(".").reduce((a,o)=>a?.[o],e)}class E7 extends zw{constructor(t){super(t),this.limit=t.limit}getData(){return this.data.slice(0,this.limit)}setLimit(t){this.limit=t}}let wt=!1;function q7(){wt=!wt,wt&&console.log("filterDebug is on")}let ea=[],js=0,qf,hs;function Hm(e){if(ea===void 0||ea.length===0)return;let t;ge(e)&&e>js?t=Math.ceil(e/10)*10:t=js+10,js=t,js>=ea.length?s(".pageAccount .loadMoreButton").addClass("hidden"):s(".pageAccount .loadMoreButton").removeClass("hidden"),hs.setLimit(t),hs.updateBody()}function I7(e){let t=e.difficulty??"normal",a=`<span aria-label="${e.language?.replace("_"," ")}" data-balloon-pos="up"><i class="fas fa-fw fa-globe-americas"></i></span>`;t==="normal"?a+=`<span aria-label="${e.difficulty}" data-balloon-pos="up"><i class="far fa-fw fa-star"></i></span>`:t==="expert"?a+=`<span aria-label="${e.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star-half-alt"></i></span>`:t==="master"&&(a+=`<span aria-label="${e.difficulty}" data-balloon-pos="up"><i class="fas fa-fw fa-star"></i></span>`),e.punctuation&&(a+='<span aria-label="punctuation" data-balloon-pos="up"><i class="fas fa-fw fa-at"></i></span>'),e.numbers&&(a+='<span aria-label="numbers" data-balloon-pos="up"><i class="fas fa-fw fa-hashtag"></i></span>'),e.blindMode&&(a+='<span aria-label="blind mode" data-balloon-pos="up"><i class="fas fa-fw fa-eye-slash"></i></span>'),e.lazyMode&&(a+='<span aria-label="lazy mode" data-balloon-pos="up"><i class="fas fa-fw fa-couch"></i></span>'),e.funbox!==void 0&&e.funbox.length>0&&(a+=`<span aria-label="${e.funbox.map(h=>h.replace(/_/g," ")).join(", ")}" data-balloon-pos="up"><i class="fas fa-gamepad"></i></span>`),e.chartData==="toolong"||e.testDuration>122?a+='<span class="miniResultChartButton disabled" aria-label="Graph history is not available for long tests" data-balloon-pos="up"><i class="fas fa-fw fa-chart-line"></i></span>':a+='<span class="miniResultChartButton" aria-label="View graph" data-balloon-pos="up"><i class="fas fa-fw fa-chart-line"></i></span>';let o="no tags";e.tags!==void 0&&e.tags.length>0&&(o="",e.tags.forEach(h=>{S()?.tags?.forEach(y=>{h===y._id&&(o+=y.display+", ")})}),o=o.substring(0,o.length-2));let i;e.tags===void 0?i="[]":i=JSON.stringify(e.tags);const n=e.tags!==void 0&&e.tags.length>0,l=e.tags!==void 0&&e.tags.length>1?"fa-tags":"fa-tag",c=`<button class="textButton resultEditTagsButton ${n?"active":""}" data-result-id="${e._id}" data-tags='${i}' aria-label="${o}" data-balloon-pos="up"><i class="fas fa-fw ${l}"></i></button>`;let d="";e.isPb?d='<i class="fas fa-fw fa-crown"></i>':d="";const u=e.charStats.join("/"),m=e.mode==="custom"?"":e.mode2,p=new Date(e.timestamp),g=document.createElement("tr");return g.classList.add("resultRow"),g.dataset.id=e._id,g.innerHTML=`
    <td>${d}</td>
    <td>${W.typingSpeed(e.wpm,{showDecimalPlaces:!0})}</td>
    <td>${W.typingSpeed(e.rawWpm,{showDecimalPlaces:!0})}</td>
    <td>${W.percentage(e.acc,{showDecimalPlaces:!0})}</td>
    <td>${W.percentage(e.consistency,{showDecimalPlaces:!0})}</td>
    <td>${u}</td>
    <td>${e.mode} ${m}</td>
    <td class="infoIcons">${a}</td>
    <td>${c}</td>
    <td>${te(p,"dd MMM yyyy")}<br>
    ${te(p,"HH:mm")}
    </td>
    `,g}async function D7(){await U.updateColors(),await Ee(0),await Ho.updateColors(),await Ee(0),await Wn.updateColors(),await Ee(0)}function F7(){hs.setData([]),hs.updateBody(),Wn.getDataset("count").data=[],Ho.getDataset("count").data=[],Ho.getDataset("avgWpm").data=[],U.getDataset("wpm").data=[],U.getDataset("pb").data=[],U.getDataset("acc").data=[],U.getDataset("wpmAvgTen").data=[],U.getDataset("accAvgTen").data=[],U.getDataset("wpmAvgHundred").data=[],U.getDataset("accAvgHundred").data=[]}let Dl=0,zt=[],vn=[];async function Hw(){console.log("updating account page"),Nr();const e=S();if(!e)return;Af(e.personalBests),Kc("account",e),Pw(qf,e.testActivity,new Date(e.addedAt)),T7(),zt=[],vn=[];const t=[];js=0;let a=0,o="",i=0,n=0,l=0,c=0,d=0,u=0,m=0,p=0;const g={total:0,count:0,last10Total:0,last10Count:0,max:0};let h=0;Dl=0;let y=0,k=0,x=0,C=0;const D={},E=[],B=bt(r.typingSpeedUnit);ea=[],s(".pageAccount .history table tbody").empty(),S()?.results?.forEach(w=>{try{if(!Ne("pb",w.isPb?"yes":"no")){wt&&console.log("skipping result due to pb filter",w);return}let Mt=w.difficulty??"normal";if(!Ne("difficulty",Mt)){wt&&console.log("skipping result due to difficulty filter",w);return}if(!Ne("mode",w.mode)){wt&&console.log("skipping result due to mode filter",w);return}if(w.mode==="time"){let Qe="custom";if(["15","30","60","120"].includes(`${w.mode2}`)&&(Qe=`${w.mode2}`),!Ne("time",Qe)){wt&&console.log("skipping result due to time filter",w);return}}else if(w.mode==="words"){let Qe="custom";if(["10","25","50","100","200"].includes(`${w.mode2}`)&&(Qe=`${w.mode2}`),!Ne("words",Qe)){wt&&console.log("skipping result due to word filter",w);return}}if(w.quoteLength!==null){let Qe;if(w.quoteLength===0?Qe="short":w.quoteLength===1?Qe="medium":w.quoteLength===2?Qe="long":w.quoteLength===3&&(Qe="thicc"),Qe!==void 0&&!Ne("quoteLength",Qe)){wt&&console.log("skipping result due to quoteLength filter",w);return}}let yi=Ne("language",w.language);if(w.language==="english_expanded"&&Ne("language","english_1k")&&(yi=!0),!yi){wt&&console.log("skipping result due to language filter",w);return}let hl="off";if(w.punctuation&&(hl="on"),!Ne("punctuation",hl)){wt&&console.log("skipping result due to punctuation filter",w);return}let bl="off";if(w.numbers&&(bl="on"),!Ne("numbers",bl)){wt&&console.log("skipping result due to numbers filter",w);return}if(w.funbox===void 0||w.funbox.length===0){if(!Ne("funbox","none")){wt&&console.log("skipping result due to funbox filter",w);return}}else{let Qe=0;for(const Wt of w.funbox)if(Ne("funbox",Wt)){Qe++;break}if(Qe===0){wt&&console.log("skipping result due to funbox filter",w);return}}let lo=!0;if(w.tags===void 0||w.tags.length===0)(S()?.tags?.length??0)>0?Ne("tags","none")&&(lo=!1):lo=!1;else{const Qe=S()?.tags?.map(Wt=>Wt._id);if(Qe===void 0)return;w.tags.forEach(Wt=>{lo&&(Qe?.includes(Wt)?Ne("tags",Wt)&&(lo=!1):Ne("tags","none")&&(lo=!1))})}if(lo){wt&&console.log("skipping result due to tag filter",w);return}const vi=Math.abs(w.timestamp-Date.now())/1e3;let yl=!0;if((Ne("date","all")||Ne("date","last_day")&&vi<=86400||Ne("date","last_week")&&vi<=604800||Ne("date","last_month")&&vi<=2592e3||Ne("date","last_3months")&&vi<=7776e3)&&(yl=!1),yl){wt&&console.log("skipping result due to date filter",w);return}ea.push(w)}catch(Mt){f("Something went wrong when filtering. Resetting filters.",0),console.log(w),console.error(Mt),Rm(),qo(),bs();return}h+=Math.round(w.wpm/60*w.testDuration);const Ye=new Date(w.timestamp);Ye.setSeconds(0),Ye.setMinutes(0),Ye.setHours(0),Ye.setMilliseconds(0);const _e=Ye.getTime(),la=D[_e];la!==void 0?(la.amount++,la.restarts+=w.restartCount??0,la.time+=w.testDuration+(w.incompleteTestSeconds??0)-(w.afkDuration??0),w.wpm>la.maxWpm&&(la.maxWpm=w.wpm),la.totalWpm+=w.wpm,la.totalAcc+=w.acc,la.totalCon+=w.consistency??0):D[_e]={amount:1,restarts:w.restartCount??0,time:w.testDuration+(w.incompleteTestSeconds??0)-(w.afkDuration??0),maxWpm:w.wpm,totalWpm:w.wpm,totalAcc:w.acc,totalCon:w.consistency??0};const gl=B.histogramDataBucketSize,un=Math.floor(Math.round(B.fromWpm(w.wpm))/gl);if(E.length<=un)for(let Mt=E.length;Mt<=un;Mt++)E.push(0);E[un]++;let Te=0;if(w.testDuration===void 0&&w.mode2!=="custom"&&w.mode2!=="zen"?w.mode==="time"?Te=parseInt(w.mode2):w.mode==="words"&&(Te=parseInt(w.mode2)/w.wpm*60):Te=parseFloat(w.testDuration),w.incompleteTestSeconds!==void 0?Te+=w.incompleteTestSeconds:w.restartCount!==void 0&&w.restartCount>0&&(Te+=Te/4*w.restartCount),Dl+=Te,c<10&&(c++,d+=w.wpm,p+=w.acc,w.consistency!==void 0&&(x+=w.consistency)),l++,w.consistency!==void 0&&(C++,k+=w.consistency,w.consistency>y&&(y=w.consistency)),w.rawWpm!==null&&(g.last10Count<10&&(g.last10Count++,g.last10Total+=w.rawWpm),g.total+=w.rawWpm,g.count++,w.rawWpm>g.max&&(g.max=w.rawWpm)),w.acc>u&&(u=w.acc),m+=w.acc,w.restartCount!==void 0&&(i+=w.restartCount),zt.push({x:ea.length,y:K(B.fromWpm(w.wpm)),wpm:K(B.fromWpm(w.wpm)),acc:w.acc,mode:w.mode,mode2:w.mode2,punctuation:w.punctuation,language:w.language,timestamp:w.timestamp,difficulty:w.difficulty,raw:K(B.fromWpm(w.rawWpm)),isPb:w.isPb??!1}),t.push(w.wpm),vn.push({x:ea.length,y:w.acc,errorRate:100-w.acc}),w.wpm>a)if(a=w.wpm,w.mode==="custom")o=w.mode;else{const Mt=w.punctuation?",<br>with punctuation":"",yi=w.numbers?",<br>with numbers":"";o=w.mode+" "+w.mode2+Mt+yi}n+=w.wpm}),hs.setData(ea),s(".pageAccount .group.history table thead tr td:nth-child(2)").text(r.typingSpeedUnit),await Ee(0),Hm();const z=[],H=[],ae=B.historyStepSize;for(const w of Object.keys(D)){const Ye=parseInt(w),_e=D[Ye];_e!==void 0&&(z.push({x:Ye,y:_e.time/60,amount:_e.amount,restarts:_e.restarts,maxWpm:K(B.fromWpm(_e.maxWpm)),avgWpm:K(_e.totalWpm/_e.amount),avgAcc:K(_e.totalAcc/_e.amount),avgCon:K(_e.totalCon/_e.amount)}),H.push({x:Ye,y:K(B.fromWpm(_e.totalWpm)/_e.amount)}))}const Fe=Ho.options.scales.avgWpm;Fe.title.text="Average "+r.typingSpeedUnit,Fe.ticks.stepSize=ae,Ho.getDataset("count").data=z,Ho.getDataset("avgWpm").data=H;const ze=[],N=[],re=B.histogramDataBucketSize,vt=re-(re<=1?.01:1);E.forEach((w,Ye)=>{const _e=Ye*re;N.push(`${_e} - ${_e+vt}`),ze.push({x:_e,y:w})}),Wn.data.labels=N,Wn.getDataset("count").data=ze;const ra=U.options.scales.wpm;if(ra.title.text=B.fullUnitString,zt.length>0){let w=0;const Ye=[];for(let Te=zt.length-1;Te>=0;Te--){const Mt=zt[Te];Mt.y>w&&(w=Mt.y,Ye.push(Mt))}Ye.push({x:1,y:Nn(Ye)?.y});const _e=[],la=[],gl=[],un=[];for(let Te=0;Te<zt.length;Te++){const Mt=zt.slice(Te,Te+10),yi=vn.slice(Te,Te+10),hl=Mt.reduce((Wt,{y:wi})=>Wt+wi,0)/Mt.length,bl=yi.reduce((Wt,{y:wi})=>Wt+wi,0)/yi.length;_e.push({x:Te+1,y:hl}),la.push({x:Te+1,y:bl});const lo=zt.slice(Te,Te+100),vi=vn.slice(Te,Te+100),yl=lo.reduce((Wt,{y:wi})=>Wt+wi,0)/lo.length,Qe=vi.reduce((Wt,{y:wi})=>Wt+wi,0)/vi.length;gl.push({x:Te+1,y:yl}),un.push({x:Te+1,y:Qe})}U.getDataset("wpm").data=zt,U.getDataset("pb").data=Ye,U.getDataset("acc").data=vn,U.getDataset("wpmAvgTen").data=_e,U.getDataset("accAvgTen").data=la,U.getDataset("wpmAvgHundred").data=gl,U.getDataset("accAvgHundred").data=un,U.getScale("x").max=zt.length+1}const Sa=zt.map(w=>w.y),za=Math.min(...Sa),Io=Math.max(...Sa),m2=isFinite(za)?za:0,Mg=isFinite(Io)?Io:0,ml=Math.floor(Mg)+(ae-Math.floor(Mg)%ae);if(ra.max=ml,ra.ticks.stepSize=ae,U.getScale("pb").max=ml,U.getScale("wpmAvgTen").max=ml,U.getScale("wpmAvgHundred").max=ml,r.startGraphsAtZero)U.getScale("wpm").min=0,U.getScale("pb").min=0,U.getScale("wpmAvgTen").min=0,U.getScale("wpmAvgHundred").min=0;else{const w=Math.floor(m2/ae)*ae;U.getScale("wpm").min=w,U.getScale("pb").min=w,U.getScale("wpmAvgTen").min=w,U.getScale("wpmAvgHundred").min=w}zt===void 0||zt.length===0?(s(".pageAccount .group.noDataError").removeClass("hidden"),s(".pageAccount .group.chart").addClass("hidden"),s(".pageAccount .group.dailyActivityChart").addClass("hidden"),s(".pageAccount .group.histogramChart").addClass("hidden"),s(".pageAccount .group.aboveHistory").addClass("hidden"),s(".pageAccount .group.history").addClass("hidden"),s(".pageAccount .triplegroup.stats").addClass("hidden"),s(".pageAccount .group.estimatedWordsTyped").addClass("hidden")):(s(".pageAccount .group.noDataError").addClass("hidden"),s(".pageAccount .group.chart").removeClass("hidden"),s(".pageAccount .group.dailyActivityChart").removeClass("hidden"),s(".pageAccount .group.histogramChart").removeClass("hidden"),s(".pageAccount .group.aboveHistory").removeClass("hidden"),s(".pageAccount .group.history").removeClass("hidden"),s(".pageAccount .triplegroup.stats").removeClass("hidden"),s(".pageAccount .group.estimatedWordsTyped").removeClass("hidden")),s(".pageAccount .timeTotalFiltered .val").text(Re(Math.round(Dl),!0,!0));const dn=r.typingSpeedUnit;s(".pageAccount .highestWpm .title").text(`highest ${dn}`),s(".pageAccount .highestWpm .val").text(W.typingSpeed(a)),s(".pageAccount .averageWpm .title").text(`average ${dn}`),s(".pageAccount .averageWpm .val").text(W.typingSpeed(n/l)),s(".pageAccount .averageWpm10 .title").text(`average ${dn} (last 10 tests)`),s(".pageAccount .averageWpm10 .val").text(W.typingSpeed(d/c)),s(".pageAccount .highestRaw .title").text(`highest raw ${dn}`),s(".pageAccount .highestRaw .val").text(W.typingSpeed(g.max)),s(".pageAccount .averageRaw .title").text(`average raw ${dn}`),s(".pageAccount .averageRaw .val").text(W.typingSpeed(g.total/g.count)),s(".pageAccount .averageRaw10 .title").text(`average raw ${dn} (last 10 tests)`),s(".pageAccount .averageRaw10 .val").text(W.typingSpeed(g.last10Total/g.last10Count)),s(".pageAccount .highestWpm .mode").html(o),s(".pageAccount .testsTaken .val").text(l),s(".pageAccount .highestAcc .val").text(W.accuracy(u)),s(".pageAccount .avgAcc .val").text(W.accuracy(m/l)),s(".pageAccount .avgAcc10 .val").text(W.accuracy(p/c)),k===0||k===void 0?(s(".pageAccount .avgCons .val").text("-"),s(".pageAccount .avgCons10 .val").text("-")):(s(".pageAccount .highestCons .val").text(W.percentage(y)),s(".pageAccount .avgCons .val").text(W.percentage(k/C)),s(".pageAccount .avgCons10 .val").text(W.percentage(x/Math.min(c,C)))),s(".pageAccount .testsStarted .val").text(`${l+i}`),s(".pageAccount .testsCompleted .val").text(`${l}(${Math.floor(l/(l+i)*100)}%)`),s(".pageAccount .testsCompleted .avgres").text(`
    ${(i/l).toFixed(1)} restarts per completed test
  `);const g2=ea.map(w=>w.wpm).reverse(),Qd=bS(g2);if(Qd){const Ye=(Qd[1][1]-Qd[0][1])*(3600/Dl),_e=Ye>0?"+":"";s(".pageAccount .group.chart .below .text").text(`Speed change per hour spent typing: ${_e+W.typingSpeed(Ye,{showDecimalPlaces:!0})} ${r.typingSpeedUnit}`)}s(".pageAccount .estimatedWordsTyped .val").text(h),(zt.length||vn.length)&&(m6(),U.options.animation=!1,U.update(),delete U.options.animation),await Ee(0),Ho.update(),Wn.update(),eo(!1),s(".page.pageAccount").css("height","unset"),setTimeout(()=>{Wm("account")},0)}async function Om(e){const t=await kp(e);if(!t&&!nt()){f("Could not get results - you are offline",-1,{duration:5});return}M8(),t&&qo()}async function bs(){await Om();try{await Ee(0),await Hw()}catch(e){console.error(e),f(`Something went wrong: ${e}`,-1)}}function P7(e,t){const a=[];if(t.length>0)for(const i of t)S()?.tags?.forEach(n=>{i===n._id&&a.push(n.display)});const o=s(`.pageAccount .resultEditTagsButton[data-result-id='${e}']`);o.attr("data-tags",JSON.stringify(t)),t.length>0?(o.attr("aria-label",a.join(", ")),o.addClass("active"),t.length>1?o.html('<i class="fas fa-fw fa-tags"></i>'):o.html('<i class="fas fa-fw fa-tag"></i>')):(o.attr("aria-label","no tags"),o.removeClass("active"),o.html('<i class="fas fa-fw fa-tag"></i>'))}s(".pageAccount button.toggleResultsOnChart").on("click",()=>{const e=[...r.accountChart];e[0]=e[0]==="on"?"off":"on",v("accountChart",e)});s(".pageAccount button.toggleAccuracyOnChart").on("click",()=>{const e=[...r.accountChart];e[1]=e[1]==="on"?"off":"on",v("accountChart",e)});s(".pageAccount button.toggleAverage10OnChart").on("click",()=>{const e=[...r.accountChart];e[2]=e[2]==="on"?"off":"on",v("accountChart",e)});s(".pageAccount button.toggleAverage100OnChart").on("click",()=>{const e=[...r.accountChart];e[3]=e[3]==="on"?"off":"on",v("accountChart",e)});s(".pageAccount .loadMoreButton").on("click",()=>{Hm()});s(".pageAccount #accountHistoryChart").on("click",()=>{const e=iv;if(Hm(e),window===void 0)return;const t=ea[e]?._id;if(t===void 0)throw new Error("Cannot find result for index "+e);const a=s(`.resultRow[data-id="${t}"`);s(".resultRow").removeClass("active"),a[0]?.scrollIntoView({block:"center"}),a.addClass("active")});s(".pageAccount").on("click",".miniResultChartButton",async e=>{const t=s(e.currentTarget),a=t.parents("tr").data("id");if(t.hasClass("loading")||t.hasClass("disabled"))return;const o=ea.find(n=>n._id===a);if(o===void 0)return;let i=o.chartData;if(i===void 0){t.addClass("loading"),t.attr("aria-label",null),t.html('<i class="fas fa-fw fa-spin fa-circle-notch"></i>'),oe();const n=await $.results.getById({params:{resultId:o._id}});if(j(),t.html('<i class="fas fa-fw fa-chart-line"></i>'),t.removeClass("loading"),n.status!==200){f("Error fetching result",-1,{response:n});return}i=n.body.data.chartData,o.chartData=i;const l=S()?.results?.find(c=>c._id===o._id);if(l!==void 0&&(l.chartData=o.chartData),n.body.data.chartData==="toolong"){t.attr("aria-label","Graph history is not available for long tests"),t.attr("data-baloon-pos","up"),t.addClass("disabled"),f("Graph history is not available for long tests",0);return}}t.attr("aria-label","View graph"),y7(i)});s(".pageAccount .group.topFilters, .pageAccount .filterButtons").on("click","button",()=>{setTimeout(()=>{bs()},0)});s(".pageAccount .group.presetFilterButtons").on("click",".filterBtns .filterPresets .select-filter-preset",async e=>{await s7(s(e.target).data("id")),bs()});s(".pageAccount .content .group.aboveHistory .exportCSV").on("click",()=>{M2(ea)});s(".pageAccount .profile").on("click",".details .copyLink",()=>{const e=S();if(!e)return;const{name:t}=e,a=`${location.origin}/profile/${t}`;navigator.clipboard.writeText(a).then(function(){f("URL Copied to clipboard",0)},function(){alert("Failed to copy using the Clipboard API. Here's the link: "+a)})});s(".pageAccount button.loadMoreResults").on("click",async()=>{const e=S()?.results?.length??0;oe(),Ef(),await Om(e),await Hw(),j()});Ce(({key:e})=>{pe()==="account"&&e==="typingSpeedUnit"&&bs()});const B7=new so({id:"account",element:V(".page.pageAccount"),path:"/account",loadingOptions:{loadingMode:()=>S()?.results===void 0?"sync":"none",loadingPromise:async()=>{if(S()===null)throw new Error("Looks like your account data didn't download correctly. Please refresh the page.<br>If this error persists, please contact support.");return Om()},style:"bar",keyframes:[{percentage:90,durationMs:2e3,text:"Downloading results..."}]},afterHide:async()=>{F7(),Tt("pageAccount")},beforeShow:async()=>{Gt("pageAccount","main");const e=S();await m7(bs),qo(),await Ee(0),qf=document.querySelector(".page.pageAccount .testActivity"),Rw(qf,"current",e!==void 0?new Date(e.addedAt).getFullYear():2020),hs??=new E7({limit:10,table:".pageAccount .content .history table",data:ea,buildRow:t=>I7(t),initialSort:{property:"timestamp",descending:!0}}),await bs().then(()=>{D7(),s(".pageAccount .content .accountVerificatinNotice").remove(),ct()?.emailVerified===!1&&s(".pageAccount .content").prepend('<div class="accountVerificatinNotice"><i class="fas icon fa-exclamation-triangle"></i><p>Your email address is still not verified</p><button class="sendVerificationEmail">resend verification email</button></div>'),$7()})}});s(()=>{Qt("pageAccount")});let jc=!1;const Gc=V(".scrollToTopButton");function Ow(){Gc.addClass("invisible"),jc=!1}function R7(){Gc.removeClass("invisible"),jc=!0}Gc.on("click",()=>{Gc.addClass("invisible"),window.scrollTo({top:0,behavior:A2()?"instant":"smooth"})});window.addEventListener("scroll",()=>{if(pe()==="test")return;const t=window.scrollY;!jc&&t>100?R7():jc&&t<100&&Ow()});const W7=new so({id:"test",element:V(".page.pageTest"),path:"/",beforeHide:async()=>{Ap()},afterHide:async()=>{ie(),R({noAnim:!0}),_n(),sa(),zc(!0)},beforeShow:async()=>{zc(!1),z0(),ie(),R({noAnim:!0}),j0(),Hc(),Ow()}});function z7(){s(".pageAbout .contributors").empty(),s(".pageAbout .supporters").empty(),zn.getDataset("count").data=[],zn.updateColors()}let Qc,Ro;function H7(){if(Qc){zn.updateColors();const e=U7(Qc);zn.data.labels=e.labels,zn.getDataset("count").data=e.data}if(Ro){const e=Math.round(Ro.timeTyping),t=fp({start:0,end:e*1e3});s(".pageAbout #totalTimeTypingStat .val").text(t.years?.toString()??""),s(".pageAbout #totalTimeTypingStat .valSmall").text("years"),s(".pageAbout #totalTimeTypingStat").attr("aria-label",Jd(Math.round(e/3600))+" hours");const a=Hg(Ro.testsStarted);s(".pageAbout #totalStartedTestsStat .val").text(a.rounded<10?a.roundedTo2:a.rounded),s(".pageAbout #totalStartedTestsStat .valSmall").text(a.orderOfMagnitude),s(".pageAbout #totalStartedTestsStat").attr("aria-label",Jd(Ro.testsStarted)+" tests");const o=Hg(Ro.testsCompleted);s(".pageAbout #totalCompletedTestsStat .val").text(o.rounded<10?o.roundedTo2:o.rounded),s(".pageAbout #totalCompletedTestsStat .valSmall").text(o.orderOfMagnitude),s(".pageAbout #totalCompletedTestsStat").attr("aria-label",Jd(Ro.testsCompleted)+" tests")}}async function O7(){if(Qc&&Ro)return;if(!nt()){f("Cannot update all time stats - offline",0);return}const e=await $.public.getSpeedHistogram({query:{language:"english",mode:"time",mode2:"60"}});e.status===200?Qc=e.body.data:f(`Failed to get global speed stats for histogram: ${e.body.message}`,-1);const t=await $.public.getTypingStats();t.status===200?Ro=t.body.data:f(`Failed to get global typing stats: ${e.body.message}`,-1)}async function N7(){const{data:e,error:t}=await jt(hx());t&&f(se(t,"Failed to get supporters"),-1);const{data:a,error:o}=await jt(bx());o&&f(se(o,"Failed to get contributors"),-1),O7().then(()=>{H7()});const i=document.querySelector(".pageAbout .supporters");let n="";for(const d of e??[])n+=`<div>${at(d)}</div>`;i&&(i.innerHTML=n);const l=document.querySelector(".pageAbout .contributors");let c="";for(const d of a??[])c+=`<div>${at(d)}</div>`;l&&(l.innerHTML=c)}function U7(e){const t=[],a=[],o=Object.keys(e).sort((i,n)=>parseInt(i,10)-parseInt(n,10));for(const[i,n]of o.entries()){const l=o[i+1],c=parseInt(n,10);if(t.push({x:c,y:e[c]}),a.push(`${c} - ${c+9}`),l!==void 0&&c+10!==parseInt(l,10))for(let d=c+10;d<parseInt(l,10);d+=10)t.push({x:d,y:0}),a.push(`${d} - ${d+9}`)}return{data:t,labels:a}}const V7=new so({id:"about",element:V(".page.pageAbout"),path:"/about",afterHide:async()=>{z7(),Tt("pageAbout")},beforeShow:async()=>{Gt("pageAbout","main"),N7()}});s(()=>{Qt("pageAbout")});const K7=["gmaill.com","gamil.com","gmali.com","gnail.com","gmil.com","gamail.com","hotmai.com","gmial.com","hotmal.com","yaho.com","outlokk.com","gmil.com","hotmial.com","yahooo.com","otulook.com","gamil.com","hotnail.com","yaoo.com","outlok.com","gmail.cmo","hotmail.cmo","yahho.com","outloook.com","gmaail.com","hottmail.com","yaho.com","outllok.com","gmai.com","hotmil.com","yhaoo.com","outlookk.com","gmil.com","htmial.com","yaahoo.com","otlook.com","gamail.com","hotnail.com","yaoho.com","outlok.com","gemail.com","hotmiall.com","yahhoo.com","outloookk.com","gmal.com","hottmail.com","yahio.com","outlokkk.com",".comm",".con",".cmo",".coom",".cim",".vom","-online.de","-tonline.de","acor.de","aecor.de","ahoo.de","al.com","ao.com","aol.cm","aol.con","aol.ocm","aol.om","aoll.com","apl.com","arco.de","arocr.de","aror.de","feenet.de","freeenet.de","freeent.de","freeet.de","freemet.de","freeneet.de","freent.de","frenet.de","gm.de","gm.net","gm.xde","gmc.de","gmx.ded","gmx.dw","gmxx.de","gmy.de","gx.de","hmx.de","homail.de","hotmai.de","hotmal.de","@mx.de","mx.net","@otmail.com","r-online.de","rcor.de","reenet.de","t--online.de","t-0nline.de","t-nline.de","t-oline.de","t-omline.de","t-onine.de","t-onlien.de","t-onliine.de","t-onlin.de","t-onlinde.de","t-onlinr.de","t-onlione.de","t-onlline.de","t-onlne.de","t-onlone.de","t.-online.de","t.online.de","tonline.de","wb.de","we.de","web.ded","web.dw","wed.de","weeb.de","wen.de","wweb.de","yaho.de","yahooo.de","yaoo.de","yhoo.de","yahhoo.de","icoud.com","icloud.cim","icloud.con","icloud.ocm","icloud.om","icloud.cm"];function cl(e,t){return async a=>{const o=await e(a);if(o.status<=299)return t?.check?.(o.body.data)??!0;let i;return o.status<=499?i=t?.on4xx??(n=>n):i=t?.on5xx??"Server unavailable. Please try again later.",typeof i=="function"?i(o.body.message):i}}let jo={};function Nm(){s(".page.pageLogin .register.side button").prop("disabled",!1)}function dl(){s(".page.pageLogin .register.side button").prop("disabled",!0)}function oo(){s(".pageLogin input").prop("disabled",!1),s(".pageLogin button").prop("disabled",!1)}function Um(){s(".pageLogin input").prop("disabled",!0),s(".pageLogin button").prop("disabled",!0)}function Vm(){s(".pageLogin .preloader").removeClass("hidden")}function Xa(){s(".pageLogin .preloader").addClass("hidden")}function Nw(){return jo.name!==void 0&&jo.email!==void 0&&jo.password!==void 0}const Yi=()=>{Nw()?Nm():dl()};function j7(){return Nw()?jo:!1}const Vh=V(".page.pageLogin .register.side input.usernameInput");new Ca(Vh,{schema:Cs,isValid:cl(async e=>$.users.getNameAvailability({params:{name:e}}),{check:e=>e.available||"Name not available"}),debounceDelay:1e3,callback:e=>{jo.name=e.status==="success"?Vh?.getValue():void 0,Yi()}});let sc=null,Kh=!1;const rc=new Ca(V(".page.pageLogin .register.side input.emailInput"),{schema:bc,isValid:async e=>{if(/@.*(student|education|school|\.edu$|\.edu\.|\.ac\.|\.sch\.)/i.test(e))return{warning:"Some education emails will fail to receive our messages, or disable the account as soon as you graduate. Consider using a personal email address."};if(K7.some(o=>e.endsWith(o)))return{warning:"Please check your email address, it may contain a typo."};if(sc&&sc.isDisposableEmail!==void 0)try{if(sc.isDisposableEmail(e))return{warning:"Using a temporary email may cause issues with logging in, password resets and support. Consider using a permanent email address. Don't worry, we don't send spam."}}catch{}return!0},debounceDelay:0,callback:e=>{e.status==="success"&&Uw?.dispatch("input")}});rc.on("focus",async()=>{if(!Kh){Kh=!0;try{sc=await Hr(()=>import("./vendor.DcpIuIDj.js").then(e=>e.i),__vite__mapDeps([2,3,1]))}catch{}}});const Uw=V(".page.pageLogin .register.side input.verifyEmailInput");new Ca(Uw,{isValid:async e=>rc.getValue()===e?!0:"verify email not matching email",debounceDelay:0,callback:e=>{jo.email=rc.getValidationResult().status==="success"&&e.status==="success"?rc.getValue():void 0,Yi()}});const hu=new Ca(V(".page.pageLogin .register.side .passwordInput"),{schema:Xb,callback:e=>{e.status==="success"&&Vw?.dispatch("input")}}),Vw=V(".page.pageLogin .register.side .verifyPasswordInput");new Ca(Vw,{isValid:async e=>hu.getValue()===e?!0:"verify password not matching password",debounceDelay:0,callback:e=>{jo.password=hu.getValidationResult().status==="success"&&e.status==="success"?hu.getValue():void 0,Yi()}});const G7=new so({id:"login",element:V(".page.pageLogin"),path:"/login",afterHide:async()=>{Xa(),Tt("pageLogin")},beforeShow:async()=>{Gt("pageLogin","main"),jo={},s(".pageLogin input").val(""),s(".pageLogin .register .indicator").addClass("hidden"),oo(),dl()}});s(()=>{Qt("pageLogin")});const Rd=s(".page.pageLoading"),Wd=Rd.find(".bar"),Km=Rd.find(".error"),jm=Rd.find(".spinner"),zd=Rd.find(".text");async function If(e,t){await gt(Wd[0]?.querySelector(".fill"),{width:e+"%",duration:t})}function Yc(e){zd.removeClass("hidden").html(e)}function Q7(){Wd.addClass("hidden"),Km.addClass("hidden"),jm.removeClass("hidden"),zd.addClass("hidden")}function Y7(){Wd.addClass("hidden"),jm.addClass("hidden"),Km.removeClass("hidden"),zd.addClass("hidden")}async function X7(){Wd.removeClass("hidden"),Km.addClass("hidden"),jm.addClass("hidden"),zd.addClass("hidden")}const Ti=new so({id:"loading",element:V(".page.pageLoading"),path:"/",afterHide:async()=>{Tt("pageLoading")},beforeShow:async()=>{Gt("pageLoading","main")}}),J7=ks.recaptchaSiteKey,vo={};function Gm(){if(!("grecaptcha"in window))throw new Error("grecaptcha is not defined");return window.grecaptcha}function Xi(){return"grecaptcha"in window}function Is(e,t,a){if(vo[t]!==void 0&&vo[t]!==null)return;const o=Gm().render(e,{sitekey:J7,callback:a});vo[t]=o}function Mo(e){vo[e]===void 0||vo[e]===null||Gm().reset(vo[e])}function ul(e){return vo[e]===void 0||vo[e]===null?"":Gm().getResponse(vo[e])}class qr{constructor(t,a){this.textareaElement=t,this.maxLength=a,this.textareaElement.setAttribute("maxlength",this.maxLength.toString());const o=this.textareaElement.getParent();if(o)this.parentElement=o;else{const n=this.textareaElement?.wrapWith('<div class="textareaWithCounter"></div>');this.parentElement=n}const i=this.parentElement.qs(".char-counter");if(i!==null)this.counterElement=i;else{const n=_2("span",{classList:["char-counter"]});this.parentElement.append(n),this.counterElement=n}this.updateCounter(),this.textareaElement.on("input",()=>this.updateCounter())}updateCounter(){const t=this.maxLength,a=(this.textareaElement.getValue()??"").length,o=t-a;this.counterElement.setText(`${a}/${t}`);const i=o/this.maxLength*100;this.counterElement.removeClass("warning"),this.counterElement.removeClass("error"),i===0?this.counterElement.addClass("error"):i<10&&this.counterElement.addClass("warning")}setMaxLength(t){this.maxLength=t,this.updateCounter()}}const Xc={userUid:void 0,lbOptOut:void 0};let Df;async function Z7(e){if(!_()){f("You must be logged in to submit a report",0);return}if(!Xi()){f("Could not show user report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}Kw.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async t=>{Is(t.querySelector(".g-recaptcha"),"userReportModal");const{name:a}=e;Xc.userUid=e.uid,Xc.lbOptOut=e.lbOptOut,t.querySelector(".user").textContent=a,t.querySelector(".reason").value="Inappropriate name",t.querySelector(".comment").value="",Df=new et({select:t.querySelector(".reason"),settings:{showSearch:!1,contentLocation:t}})}}),new qr(V("#userReportModal .comment"),250)}async function eT(){Kw.hide()}async function tT(){const e=ul("userReportModal");if(!e){f("Please complete the captcha");return}const t=s("#userReportModal .reason").val(),a=s("#userReportModal .comment").val(),o=e;if(!t){f("Please select a valid report reason");return}if(!a){f("Please provide a comment");return}if(t==="Suspected cheating"&&Xc.lbOptOut){f("You cannot report this user for suspected cheating as they have opted out of the leaderboards.",0,{duration:10});return}const i=a.length-250;if(i>0){f(`Report comment is ${i} character(s) too long`);return}oe();const n=await $.users.report({body:{uid:Xc.userUid,reason:t,comment:a,captcha:o}});if(j(),n.status!==200){f("Failed to report user",-1,{response:n});return}f("Report submitted. Thank you!",1),eT()}const Kw=new ue({dialogId:"userReportModal",setup:async e=>{e.querySelector("button")?.addEventListener("click",()=>{tT()})},cleanup:async()=>{Df?.destroy(),Df=void 0,Mo("userReportModal")}});function Fl({tagname:e,classes:t,attributes:a,innerHTML:o}){let i=`<${e}`;return t!==void 0&&(i+=` class="${t.join(" ")}"`),a!==void 0&&(i+=" "+Object.entries(a).filter(n=>n[1]!==void 0).sort((n,l)=>n[0].localeCompare(l[0])).map(n=>n[1]===!0?`${n[0]}`:`${n[0]}="${n[1]}"`).join(" ")),o!==void 0?i+=`>${o}</${e}>`:i+=" />",i}class fe{constructor(t){this.parameters=[],this.id=t.id,this.execFn=t.execFn,this.title=t.title,this.inputs=t.inputs??[],this.text=t.text,this.textAllowHtml=t.textAllowHtml??!1,this.wrapper=Os.getWrapper(),this.element=Os.getModal(),this.modal=Os,this.buttonText=t.buttonText,this.beforeInitFn=t.beforeInitFn,this.beforeShowFn=t.beforeShowFn,this.canClose=t.canClose??!0,this.onlineOnly=t.onlineOnly??!1,this.hideCallsExec=t.hideCallsExec??!1,this.showLabels=t.showLabels??!1,this.afterClickAway=t.afterClickAway}reset(){this.element.innerHTML=`
    <div class="title"></div>
    <div class="inputs"></div>
    <div class="text"></div>
    <button type="submit" class="submitButton"></button>`}init(){const t=s(this.element);t.find("input").val(""),this.reset(),t.attr("data-popup-id",this.id),t.find(".title").text(this.title),this.textAllowHtml?t.find(".text").html(this.text??""):t.find(".text").text(this.text??""),this.initInputs(),this.buttonText===""?t.find(".submitButton").remove():(t.find(".submitButton").text(this.buttonText),this.updateSubmitButtonState()),(this.text??"")===""?t.find(".text").addClass("hidden"):t.find(".text").removeClass("hidden")}initInputs(){const t=s(this.element);if(this.inputs.every(i=>i.hidden)||this.inputs.length===0){t.find(".inputs").addClass("hidden");return}const o=t.find(".inputs");this.showLabels&&o.addClass("withLabel"),this.inputs.forEach((i,n)=>{const l=`${this.id}_${n}`;this.showLabels&&!i.hidden&&o.append(`<label for="${l}">${i.label??""}</label>`);const c=i.type==="textarea"?"textarea":"input",d=i.hidden?["hidden"]:void 0,u={id:l,placeholder:i.placeholder??"",autocomplete:"off"};if(i.type!=="textarea"&&(u.value=i.initVal?.toString()??"",u.type=i.type),!i.hidden&&!i.optional&&(u.required=!0),i.disabled&&(u.disabled=!0),i.type==="textarea")o.append(Fl({tagname:c,classes:d,attributes:u,innerHTML:i.initVal}));else if(i.type==="checkbox"){let g=Fl({tagname:c,classes:d,attributes:u});i.description!==void 0&&(g+=`<span>${i.description}</span>`),this.showLabels?g=`<div>${g}</div>`:g=`
          <label class="checkbox">
            ${g}
            <div>${i.label}</div>
          </label>
        `,o.append(g)}else if(i.type==="range")o.append(`
          <div>
            ${Fl({tagname:c,classes:d,attributes:{...u,min:i.min.toString(),max:i.max.toString(),step:i.step?.toString(),oninput:"this.nextElementSibling.innerHTML = this.value"}})}
            <span>${i.initVal??""}</span>
          </div>
          `);else{switch(i.type){case"text":case"password":case"email":break;case"datetime-local":{i.min!==void 0&&(u.min=te(i.min,"yyyy-MM-dd'T'HH:mm:ss")),i.max!==void 0&&(u.max=te(i.max,"yyyy-MM-dd'T'HH:mm:ss")),i.initVal!==void 0&&(u.value=te(i.initVal,"yyyy-MM-dd'T'HH:mm:ss"));break}case"date":{i.min!==void 0&&(u.min=te(i.min,"yyyy-MM-dd")),i.max!==void 0&&(u.max=te(i.max,"yyyy-MM-dd")),i.initVal!==void 0&&(u.value=te(i.initVal,"yyyy-MM-dd"));break}case"number":{u.min=i.min?.toString(),u.max=i.max?.toString();break}}o.append(Fl({tagname:c,classes:d,attributes:u}))}const m=V("#"+u.id),p=m.native.oninput;if(m.native.oninput=g=>{p&&p.call(m.native,g),i.oninput?.(g),this.updateSubmitButtonState()},i.currentValue=()=>m.native.type==="checkbox"?m.native.checked?"true":"false":m.native.value,i.validation!==void 0){const g={schema:i.validation.schema??void 0,isValid:i.validation.isValid!==void 0?async h=>i.validation.isValid(h,this):void 0,callback:h=>{i.hasError=h.status!=="success",this.updateSubmitButtonState()},debounceDelay:i.validation.debounceDelay};new Ca(m,g)}}),t.find(".inputs").removeClass("hidden")}exec(){if(!this.canClose)return;if(this.hasMissingRequired()){f("Please fill in all fields",0);return}if(this.hasValidationErrors()){f("Please solve all validation errors",0);return}this.disableInputs(),oe();const t=this.inputs.map(a=>a.currentValue());this.execFn(this,...t).then(a=>{j(),(a.showNotification??!0)&&f(a.message,a.status,a.notificationOptions),a.status===1||a.alwaysHide?this.hide(!0,a.hideOptions).then(()=>{a.afterHide&&a.afterHide()}):(this.enableInputs(),s(s("#simpleModal").find("input")[0]).trigger("focus"))})}disableInputs(){s("#simpleModal input").prop("disabled",!0),s("#simpleModal button").prop("disabled",!0),s("#simpleModal textarea").prop("disabled",!0),s("#simpleModal .checkbox").addClass("disabled")}enableInputs(){s("#simpleModal input").prop("disabled",!1),s("#simpleModal button").prop("disabled",!1),s("#simpleModal textarea").prop("disabled",!1),s("#simpleModal .checkbox").removeClass("disabled")}show(t=[],a){if(this.onlineOnly&&!nt()){f("You are offline",0,{duration:2});return}ys=this,this.parameters=t,Os.show({focusFirstInput:!0,...a,beforeAnimation:async()=>{this.beforeInitFn?.(this),this.init(),this.beforeShowFn?.(this)}})}async hide(t,a){this.canClose&&(this.hideCallsExec&&!t?this.exec():(ys=null,await Os.hide(a)))}hasMissingRequired(){return this.inputs.filter(t=>t.hidden!==!0&&t.optional!==!0).some(t=>t.currentValue()===void 0||t.currentValue()==="")}hasValidationErrors(){return this.inputs.some(t=>t.hasError===!0)}updateSubmitButtonState(){const t=this.element.querySelector(".submitButton");t!==null&&(this.hasMissingRequired()||this.hasValidationErrors()?t.disabled=!0:t.disabled=!1)}}function jh(){if(ys){ys.hide();return}}let ys=null;const Os=new ue({dialogId:"simpleModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),ys?.exec()})},customEscapeHandler:e=>{jh()},customWrapperClickHandler:e=>{ys?.afterClickAway?.(),jh()}});let En,Ja,Ea;function Qm(e){const t=ct();if(t===null)throw new Error("expected to be authenticated in getReceiverUid");return t.uid===e.initiatorUid?e.receiverUid:e.initiatorUid}async function jw(e){const t=await $.connections.create({body:{receiverName:e}});if(t.status!==200)return`Friend request failed: ${t.body.message}`;{const a=S();if(a!==void 0){const o=Qm(t.body.data);a.connections[o]=t.body.data.status,Ym()}return!0}}const aT=new fe({id:"addFriend",title:"Add a friend",inputs:[{placeholder:"user name",type:"text",initVal:"",validation:{schema:Cs,isValid:cl(async e=>$.users.getNameAvailability({params:{name:e}}),{check:e=>!e.available||"Unknown user"}),debounceDelay:1e3}}],buttonText:"request",onlineOnly:!0,execFn:async(e,t)=>{const a=await jw(t);if(a===!0)return{status:1,message:`Request sent to ${t}`};let o=-1,i="Unknown error";return a.includes("already exists")?(o=0,i=`You are already friends with ${t}`):a.includes("request already sent")?(o=0,i=`You have already sent a friend request to ${t}`):a.includes("blocked by initiator")?(o=0,i=`You have blocked ${t}`):a.includes("blocked by receiver")&&(o=0,i=`${t} has blocked you`),{status:o,message:i,alwaysHide:!0}}}),oT=new fe({id:"confirmUnfriend",title:"Remove friend",buttonText:"remove friend",text:"Are you sure you want to remove as a friend?",beforeInitFn:e=>{e.text=`Are you sure you want to remove ${e.parameters[1]} as a friend?`},execFn:async e=>{const t=e.parameters[0],a=await $.connections.delete({params:{id:t}});return a.status!==200?{status:-1,message:a.body.message}:(Ea=Ea?.filter(o=>o.connectionId!==t),En?.setData(Ea??[]),En?.updateBody(),{status:1,message:"Friend removed"})}});async function iT(){const e=await $.connections.get({query:{status:"pending",type:"incoming"}});e.status!==200?(f("Error getting connections: "+e.body.message,-1),Ja=void 0):(Ja=e.body.data,b5(Ja))}function Ym(){if(s(".pageFriends .pendingRequests").addClass("hidden"),Ja===void 0||Ja.length===0)s(".pageFriends .pendingRequests").addClass("hidden");else{s(".pageFriends .pendingRequests").removeClass("hidden");const e=Ja.map(t=>`<tr data-id="${t._id}" data-receiver-uid="${Qm(t)}">
        <td><a href="${location.origin}/profile/${t.initiatorUid}?isUid" router-link>${t.initiatorName}</a></td>
        <td>
          <span data-balloon-pos="up" aria-label="since ${te(t.lastModified,"dd MMM yyyy HH:mm")}">
            ${Yw(t.lastModified)} ago
          <span>
        </td>
        <td class="actions">
          <button class="accepted" aria-label="accept" data-balloon-pos="up">
            <i class="fas fa-check fa-fw"></i>
          </button> 
          <button class="rejected" aria-label="reject" data-balloon-pos="up">
            <i class="fas fa-times fa-fw"></i>
          </button> 
          <button class="blocked" aria-label="block" data-balloon-pos="up">
            <i class="fas fa-shield-alt fa-fw"></i>
          </button>
        </td>
      </tr>`).join(`
`);s(".pageFriends .pendingRequests tbody").html(e)}}async function Gw(){const e=await $.users.getFriends();e.status!==200?(f("Error getting friends: "+e.body.message,-1),Ea=void 0):Ea=e.body.data}function Qw(){s(".pageFriends .friends .nodata").addClass("hidden"),s(".pageFriends .friends table").addClass("hidden"),s(".pageFriends .friends .error").addClass("hidden"),Ea===void 0||Ea.length===0?(s(".pageFriends .friends table").addClass("hidden"),s(".pageFriends .friends .nodata").removeClass("hidden")):(s(".pageFriends .friends table").removeClass("hidden"),s(".pageFriends .friends .nodata").addClass("hidden"),En===void 0?En=new zw({table:".pageFriends .friends table",data:Ea,buildRow:nT,persistence:new ut({key:"friendsListSort",schema:_7,fallback:{property:"name",descending:!1}})}):En.setData(Ea),En.updateBody())}function nT(e){const t=Qn(e.xp??0),a=Ub(e),o=Gh(e.top15),i=Gh(e.top60),n=document.createElement("tr");n.dataset.connectionId=e.connectionId;const l=e.uid===ct()?.uid;let c="";return l?n.classList.add("me"):c=`<button class="remove">
            <i class="fas fa-user-times fa-fw"></i>
          </button>`,n.innerHTML=`<tr>
        <td>
          <div class="avatarNameBadge">
            <div class="avatarPlaceholder"></div>
              <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>            <div class="flagsAndBadge">
            ${Ss(e)}
              ${ge(e.badgeId)?gs(e.badgeId):""}
            </div>
          </div>
        </td>
        <td><span data-balloon-pos="up" aria-label="${e.lastModified!==void 0?"since "+te(e.lastModified,"dd MMM yyyy HH:mm"):""}">${e.lastModified!==void 0?Yw(e.lastModified,"short"):"-"}</span></td>
        <td><span aria-label="total xp: ${ge(e.xp)?Ns(e.xp):""}" data-balloon-pos="up">
          ${t.level}
        </span></td>
        <td><span aria-label="${a.completedPercentage}% (${a.restartRatio} restarts per completed test)" data-balloon-pos="up">${e.completedTests}/${e.startedTests}</span></td>
        <td>${Re(Math.round(e.timeTyping??0),!0,!0)}</td>
        <td><span aria-label="${Qh(e.streak?.maxLength,"longest streak")}" data-balloon-pos="up">
          ${Qh(e.streak?.length)} 
        </span></td>
        <td class="small"><span aria-label="${o?.details}" data-balloon-pos="up" data-balloon-break="">${o?.wpm??"-"}<div class="sub">${o?.acc??"-"}</div><span></td>
        <td class="small"><span aria-label="${i?.details}" data-balloon-pos="up" data-balloon-break="">${i?.wpm??"-"}<div class="sub">${i?.acc??"-"}</div></span></td>
  <td class="actions">
  ${c}
            
        </td>
      </tr>`,n.querySelector(".avatarPlaceholder")?.replaceWith(Ur(e)),n}function Yw(e,t){if(e===void 0)return"";let a="";const o=fp({start:e,end:Date.now()});return t===void 0||t==="full"?a=ay(o,{format:["years","months","days","hours","minutes"]}):a=oy(e),a!==""?a:"less then a minute"}function Gh(e){if(e===void 0)return;const t={wpm:W.typingSpeed(e.wpm,{showDecimalPlaces:!0}),acc:W.percentage(e.acc,{showDecimalPlaces:!0}),raw:W.typingSpeed(e.raw,{showDecimalPlaces:!0}),con:W.percentage(e.consistency,{showDecimalPlaces:!0}),details:""};return t.details=[`${Ra(e.language)}`,`${t.wpm} wpm`,`${t.acc} acc`,`${t.raw} raw`,`${t.con} con`,`${te(e.timestamp,"dd MMM yyyy")}`].join(`
`),t}function Qh(e,t){return e===1?"-":ge(e)?`${t!==void 0?t+" ":""}${e} days`:"-"}s(".pageFriends button.friendAdd").on("click",()=>{aT.show(void 0,{})});s(".pageFriends .pendingRequests table").on("click",async e=>{const t=Array.from(e.target.classList).find(n=>["accepted","rejected","blocked"].includes(n));if(t===void 0)return;const a=e.target.closest("tr"),o=a.dataset.id;if(o===void 0)throw new Error("Cannot find id of target.");a.querySelectorAll("button").forEach(n=>n.disabled=!0),oe();const i=t==="rejected"?await $.connections.delete({params:{id:o}}):await $.connections.update({params:{id:o},body:{status:t}});if(j(),i.status!==200)f(`Cannot update friend request: ${i.body.message}`,-1);else{Ja=Ja?.filter(l=>l._id!==o),Ym();const n=S();if(n){const l=a.dataset.receiverUid;if(l===void 0)throw new Error("Cannot find receiverUid of target.");t==="rejected"?delete n.connections[l]:n.connections[l]=t,dt(n)}t==="blocked"&&f("User has been blocked",0),t==="accepted"&&f("Request accepted",1),t==="rejected"&&f("Request rejected",0),t==="accepted"&&(Xw(),await Gw(),Qw(),Jw())}});s(".pageFriends .friends table").on("click",async e=>{const t=Array.from(e.target.classList).find(i=>["remove"].includes(i));if(t===void 0)return;const a=e.target.closest("tr"),o=a.dataset.connectionId;if(o===void 0)throw new Error("Cannot find id of target.");if(t==="remove"){const i=a.querySelector("a.entryName")?.textContent??"";oT.show([o,i],{})}});function Xw(){document.querySelector(".friends .spinner")?.classList.remove("hidden")}function Jw(){document.querySelector(".friends .spinner")?.classList.add("hidden")}function Yh(){Ym(),Qw()}const sT=new so({id:"friends",display:"Friends",element:V(".page.pageFriends"),path:"/friends",loadingOptions:{loadingMode:()=>ct()?Ea!==void 0&&Ja!==void 0?{mode:"async",beforeLoading:Xw,afterLoading:()=>{Jw(),Yh()}}:"sync":"none",loadingPromise:async()=>{if(await Cp,!Ba()?.connections.enabled)throw new Error("Connectins are disabled.");await Promise.all([iT(),Gw()])},style:"bar",keyframes:[{percentage:50,durationMs:1500,text:"Downloading friends..."},{percentage:50,durationMs:1500,text:"Downloading friend requests..."}]},afterHide:async()=>{Tt("pageFriends")},beforeShow:async()=>{Gt("pageFriends","main"),Yh()}});s(()=>{Qt("pageFriends")});Wa(e=>{e.type==="authStateChanged"&&!e.data.isUserSignedIn&&(Ja=void 0,Ea=void 0)});const rT=Sy();function Xh(){s(".page.pageProfile .error").addClass("hidden"),s(".page.pageProfile .preloader").removeClass("hidden"),s(".page.pageProfile .profile").html(`
      <div class="details none">
        <div class="avatarAndName">
          <div class="avatar"></div>
          <div>
             <div class="user">
              <div class="name">-</div>
              <div class="userFlags"></div>
            </div>
            <div class="badges"></div>
            <div class="allBadges"></div>
            <div class="joined" data-balloon-pos="up">-</div>
	          <div class="streak" data-balloon-pos="up">-</div>
          </div>
          <div class="levelAndBar">
            <div class="level" data-balloon-pos="up">-</div>
            <div class="xpBar" data-balloon-pos="up">
              <div class="bar" style="width: 0%;"></div>
            </div>
            <div class="xp" data-balloon-pos="up">-/-</div>
          </div>
        </div>
        <div class="separator sep1"></div>
        <div class="typingStats vertical">
          <div class="started">
            <div class="title">tests started</div>
            <div class="value">-</div>
          </div>
          <div class="completed">
            <div class="title">tests completed</div>
            <div class="value">-</div>
          </div>
          <div class="timeTyping">
            <div class="title">time typing</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep2 hidden"></div>

        <div class="bioAndKeyboard vertical hidden">
          <div class="bio">
            <div class="title">bio</div>
            <div class="value">-</div>
          </div>
          <div class="keyboard hidden">
            <div class="title">keyboard</div>
            <div class="value">-</div>
          </div>
        </div>
        <div class="separator sep3 hidden"></div>

        <div class="socials big hidden">
          <div class="title">socials</div>
          <div class="value">-</div>
        </div>
        <div class="buttonGroup">
          <button
            class="userReportButton hidden"
            data-balloon-pos="left"
            aria-label="Report user"
          >
            <i class="fas fa-flag"></i>
          </button>
          <button
            class="addFriendButton hidden"
            data-balloon-pos="left"
            aria-label="Send friend request"
          >
            <i class="fas fa-user-plus"></i>
          </button>
        </div>
      </div>
      <div class="leaderboardsPositions">
        <div class="title">All-Time English Leaderboards</div>
        <div class="group t15">
          <div class="testType">15 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
        <div class="group t60">
          <div class="testType">60 seconds</div>
          <div class="pos">-</div>
          <div class="topPercentage">-</div>
        </div>
      </div>
      <div class="pbsWords">
        <div class="group">
          <div class="quick">
            <div class="test">10 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">25 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">50 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">100 words</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div>
      <div class="pbsTime">
        <div class="group">
          <div class="quick">
            <div class="test">15 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">30 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">60 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
        <div class="group">
          <div class="quick">
            <div class="test">120 seconds</div>
            <div class="wpm">-</div>
            <div class="acc">-</div>
          </div>
        </div>
      </div><div class="lbOptOutReminder hidden"></div>
      `);const e=document.querySelector(".page.pageProfile .testActivity");e!==null&&zm(e)}async function lT(e){const t=E2("isUid");if(e.data)s(".page.pageProfile .preloader").addClass("hidden"),await Kc("profile",e.data),Af(e.data.personalBests,!0);else if(e.uidOrName!==void 0&&e.uidOrName!==""){const a=await $.users.getProfile({params:{uidOrName:e.uidOrName},query:{isUid:t}});if(s(".page.pageProfile .preloader").addClass("hidden"),a.status===404){const o=t?"User not found":`User ${e.uidOrName} not found`;s(".page.pageProfile .preloader").addClass("hidden"),s(".page.pageProfile .error").removeClass("hidden"),s(".page.pageProfile .error .message").text(o)}else if(a.status===200){const o=a.body.data;window.history.replaceState(null,"",`/profile/${o.name}`),await Kc("profile",o),Af(o.personalBests,!0);const i=document.querySelector(".page.pageProfile .testActivity");if(o.testActivity!==void 0){const n=new er(o.testActivity.testsByDays,new Date(o.testActivity.lastDay),rT);Pw(i,n);const l=i.querySelector(".top .title");l.innerHTML=l?.innerHTML+" in last 12 months"}else zm(i)}else{f("Failed to load profile: "+a.body.message,-1);return}}else f("Missing update parameter!",-1)}s(".page.pageProfile").on("click",".profile .userReportButton",()=>{const e=s(".page.pageProfile .profile").attr("uid")??"",t=s(".page.pageProfile .profile").attr("name")??"",a=(s(".page.pageProfile .profile").attr("lbOptOut")??"false")==="true";Z7({uid:e,name:t,lbOptOut:a})});s(".page.pageProfile").on("click",".profile .addFriendButton",async()=>{const e=s(".page.pageProfile .profile").attr("name")??"",t=await jw(e);t===!0?(f(`Request sent to ${e}`),s(".profile .details .addFriendButton").addClass("disabled")):f(t,-1)});const cT=new so({id:"profile",element:V(".page.pageProfile"),path:"/profile",afterHide:async()=>{Tt("pageProfile"),Xh()},beforeShow:async e=>{Gt("pageProfile","main");const t=e?.params?.uidOrName??"";t?(s(".page.pageProfile .preloader").removeClass("hidden"),s(".page.pageProfile .search").addClass("hidden"),s(".page.pageProfile .content").removeClass("hidden"),Xh(),lT({uidOrName:t,data:e?.data})):(s(".page.pageProfile .preloader").addClass("hidden"),s(".page.pageProfile .search").removeClass("hidden"),s(".page.pageProfile .content").addClass("hidden"))}});Qt("pageProfile");const Zw=[];function dT(e){Zw.push(e)}function uT(e,t){Zw.forEach(a=>{try{a(e,t)}catch(o){console.error("Navigation event subscriber threw an error"),console.error(o)}})}let Jh=null,lr=null;function fT(){s('.page.pageProfileSearch button[type="submit"]').prop("disabled",!1)}function Zh(){s('.page.pageProfileSearch button[type="submit"]').prop("disabled",!0)}const pT=new so({id:"profileSearch",element:V(".page.pageProfileSearch"),path:"/profile",afterHide:async()=>{Tt("pageProfileSearch")},beforeShow:async()=>{Gt("pageProfileSearch","main"),Jh??=new Ca(V(".page.pageProfileSearch input"),{schema:Cs,isValid:cl(async e=>$.users.getProfile({params:{uidOrName:e}}),{check:e=>(lr=e,!0),on4xx:()=>"Unknown user"}),callback:e=>{e.status==="success"?fT():(Zh(),lr=null)}}),Jh.setValue(null),Zh()},afterShow:async()=>{s(".page.pageProfileSearch input").trigger("focus")}});s(".page.pageProfileSearch form").on("submit",e=>{e.preventDefault(),lr!==null&&uT(`/profile/${lr.name}`,{data:lr})});s(()=>{Qt("pageProfileSearch")});const mT=new so({id:"404",element:V(".page.page404"),path:"/404",afterHide:async()=>{Tt("page404")},beforeShow:async()=>{Gt("page404","main")}});Qt("page404");const gT=I.enum(["allTime","weekly","daily"]),bu="EEEE, do MMMM yyyy",eb="EEEE, do MMMM yyyy HH:mm",b={loading:!0,updating:!1,type:"allTime",mode:"time",mode2:"15",data:null,userData:null,page:0,pageSize:50,friendsOnly:!1,title:"All-time English Time 15 Leaderboard",scrollToUserAfterFill:!1,goToUserPage:!1},e1=I.object({type:gT,mode:Jb.optional(),mode2:I.string().optional(),language:Qb.optional(),yesterday:I.boolean().optional(),lastWeek:I.boolean().optional(),friendsOnly:I.boolean().optional()}),hT=e1.extend({page:I.number(),goToUserPage:I.boolean()}).partial(),t1=new ut({key:"leaderboardSelector",schema:e1,fallback:{type:"allTime",mode2:"15"}}),Go={allTime:{time:{15:["english"],60:["english"]}},daily:{}};function Ds(){const e=b.type==="allTime"?"All-time":b.type==="weekly"?"Weekly XP":"Daily",t=b.friendsOnly?"Friends ":"",a=b.type!=="weekly"?Pt(b.language):"",o=b.type!=="weekly"?` ${Pt(b.mode)} ${b.mode2}`:"";if(b.title=`${e} ${a} ${o} ${t}Leaderboard`,s(".page.pageLeaderboards .bigtitle >.text").text(b.title),s(".page.pageLeaderboards .bigtitle .subtext").addClass("hidden"),s(".page.pageLeaderboards .bigtitle button").addClass("hidden"),s(".page.pageLeaderboards .bigtitle .subtext .divider").addClass("hidden"),b.type==="daily"){s(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),s(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").removeClass("hidden"),s(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),b.yesterday?s(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-forward"></i>
            show today
        `):s(".page.pageLeaderboards .bigtitle button[data-action='toggleYesterday']").html(`
        <i class="fas fa-backward"></i>
            show yesterday
        `);let i=Pk(new Ka);b.yesterday&&(i=Bk(i)),sb(te(i,bu)+" UTC",Pl(i),Pl(iy(i)))}else if(b.type==="weekly"){s(".page.pageLeaderboards .bigtitle .subtext").removeClass("hidden"),s(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").removeClass("hidden"),s(".page.pageLeaderboards .bigtitle .subtext .divider").removeClass("hidden"),b.lastWeek?s(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-forward"></i>
            show this week
        `):s(".page.pageLeaderboards .bigtitle button[data-action='toggleLastWeek']").html(`
        <i class="fas fa-backward"></i>
            show last week
        `);let i=Rk(new Ka,{weekStartsOn:1});b.lastWeek&&(i=Wk(i,7));const n=ny(i,{weekStartsOn:1}),l=`${te(i,bu)} - ${te(n,bu)} UTC`;sb(l,Pl(i),Pl(n))}}async function rn(e=!1){e?(b.updating=!0,b.error=void 0):(b.loading=!0,b.error=void 0,b.data=null,b.userData=null),io();const t=(n,l,c)=>({rank:async()=>l({query:{...c,friendsOnly:b.friendsOnly||void 0}}),data:async()=>n({query:{...c,page:b.page,pageSize:b.pageSize,friendsOnly:b.friendsOnly||void 0}})});let a;if(b.type==="allTime")a=t($.leaderboards.get,$.leaderboards.getRank,{language:"english",mode:"time",mode2:b.mode2});else if(b.type==="daily")a=t($.leaderboards.getDaily,$.leaderboards.getDailyRank,{language:b.language,mode:b.mode,mode2:b.mode2,daysBefore:b.yesterday?1:void 0});else if(b.type==="weekly")a=t($.leaderboards.getWeeklyXp,$.leaderboards.getWeeklyXpRank,{weeksBefore:b.lastWeek?1:void 0});else throw new Error("unknown state type");if((!_()||b.userData!==null)&&(a.rank=void 0),b.goToUserPage&&a.rank!==void 0){b.goToUserPage=!1;const n=await a.rank();n!==void 0&&n.status===200&&n.body.data!==null&&(b.userData=n.body.data,b.page=Math.floor((b.userData.rank-1)/b.pageSize),hi()),a.rank=void 0}const[o,i]=await Promise.all([a.data(),a.rank?.()]);o.status===200?(b.data=o.body.data.entries,b.count=o.body.data.count,b.pageSize=o.body.data.pageSize,b.type==="daily"&&(b.minWpm=o.body.data.minWpm)):(b.data=null,o.status===404?b.error="No leaderboard found":(b.error="Something went wrong",f("Failed to get leaderboard: "+o.body.message,-1))),b.userData===null&&i!==void 0&&(i.status===200?i.body.data!==null&&(b.userData=i.body.data):(b.userData=null,b.error="Something went wrong",f("Failed to get rank: "+i.body.message,-1))),b.loading=!1,b.updating=!1,io(),!e&&_()&&a1()}function bT(){const e=s(".page.pageLeaderboards .titleAndButtons .jumpButtons");e.find("button").removeClass("active");const t=Math.ceil(b.count/b.pageSize);if(t<=1?e.find("button").addClass("disabled"):e.find("button").removeClass("disabled"),b.page===0?(e.find("button[data-action='previousPage']").addClass("disabled"),e.find("button[data-action='firstPage']").addClass("disabled")):(e.find("button[data-action='previousPage']").removeClass("disabled"),e.find("button[data-action='firstPage']").removeClass("disabled")),_()){const a=e.find("button[data-action='userPage']");if(!b.userData)a.addClass("disabled");else{const o=Math.floor((b.userData.rank-1)/b.pageSize);b.page===o?a.addClass("disabled"):a.removeClass("disabled")}}b.page>=t-1?e.find("button[data-action='nextPage']").addClass("disabled"):e.find("button[data-action='nextPage']").removeClass("disabled")}function yT(e,t=!1){const a={wpm:W.typingSpeed(e.wpm,{showDecimalPlaces:!0}),acc:W.percentage(e.acc,{showDecimalPlaces:!0}),raw:W.typingSpeed(e.raw,{showDecimalPlaces:!0}),con:W.percentage(e.consistency,{showDecimalPlaces:!0})},o=document.createElement("tr");return t&&o.classList.add("me"),o.dataset.uid=e.uid,o.innerHTML=`
      <td>${vs(e.friendsRank)}</td>
      <td>${vs(e.rank)}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${Ss({...e,isFriend:Sp(e.uid)})}
            ${ge(e.badgeId)?gs(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat narrow">
      ${a.wpm}
        <div class="sub">${a.acc}</div>
      </td>
      </td>
      <td class="stat narrow rawAndConsistency">
      ${a.raw}
        <div class="sub">${a.con}</div>
      </td>
      <td class="stat wide">${a.wpm}</td>
      <td class="stat wide">${a.acc}</td>
      <td class="stat wide">${a.raw}</td>
      <td class="stat wide">${a.con}</td>
      <td class="date">${te(e.timestamp,"dd MMM yyyy")}<div class="sub">${te(e.timestamp,"HH:mm")}</div></td>
    
  `,o.querySelector(".avatarPlaceholder")?.replaceWith(Ur(e)),o}function vT(e,t=!1){const a=oy(e.lastActivityTimestamp,{addSuffix:!0}),o=document.createElement("tr");return t&&o.classList.add("me"),o.dataset.uid=e.uid,o.innerHTML=`
      <td>${vs(e.friendsRank)}</td>
      <td>${vs(e.rank)}</td>
      <td>
        <div class="avatarNameBadge">
          <div class="avatarPlaceholder"></div>
          <a href="${location.origin}/profile/${e.uid}?isUid" class="entryName" uid=${e.uid} router-link>${e.name}</a>
          <div class="flagsAndBadge">
            ${Ss({...e,isFriend:Sp(e.uid)})}
            ${ge(e.badgeId)?gs(e.badgeId):""}
          </div>
        </div>
      </td>
      <td class="stat wide">${e.totalXp<1e3?e.totalXp:wc(e.totalXp)}</td>
      <td class="stat wide">${Re(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      <td class="stat narrow">
      ${e.totalXp<1e3?e.totalXp:wc(e.totalXp)}
      <div class="sub">${Re(Math.round(e.timeTypedSeconds),!0,!0,":")}</td>
      </td>
      <td class="date" data-balloon-pos="left"  aria-label="${a}">
        ${te(e.lastActivityTimestamp,"dd MMM yyyy")}
        <div class="sub">
          ${te(e.lastActivityTimestamp,"HH:mm")}
        </div>
      </td>
    </tr>
  `,o.querySelector(".avatarPlaceholder")?.replaceWith(Ur(e)),o}function wT(){const e=s(".page.pageLeaderboards table tbody");if(e.empty(),b.friendsOnly?e.parent().addClass("friendsOnly"):e.parent().removeClass("friendsOnly"),s(".page.pageLeaderboards table thead").addClass("hidden"),b.type==="allTime"||b.type==="daily"?s(".page.pageLeaderboards table thead.allTimeAndDaily").removeClass("hidden"):b.type==="weekly"&&s(".page.pageLeaderboards table thead.weekly").removeClass("hidden"),b.data===null||b.data.length===0){e.append('<tr><td colspan="7" class="empty">No data</td></tr>'),s(".page.pageLeaderboards table").removeClass("hidden");return}if(b.type==="allTime"||b.type==="daily")for(const t of b.data){const a=ct()?.uid===t.uid;e.append(yT(t,a))}else if(b.type==="weekly")for(const t of b.data){const a=ct()?.uid===t.uid;e.append(vT(t,a))}s(".page.pageLeaderboards table").removeClass("hidden")}function tb(){if(b.type!=="allTime"||b.userData===null)return null;const e=S()?.lbMemory?.time?.[b.mode2]?.english??0,t=b.userData.rank,a=e-t;return a!==0&&u5("time",b.mode2,"english",t,!0),a}function a1(){if(_()&&S()?.lbOptOut===!0){s(".page.pageLeaderboards .bigUser").html('<div class="warning">You have opted out of the leaderboards.</div>');return}if(_()&&S()?.banned===!0){s(".page.pageLeaderboards .bigUser").html('<div class="warning">Your account is banned</div>');return}const e=Ba()?.leaderboards.minTimeTyping??7200;if(_()&&(S()?.typingStats?.timeTyping??0)<e){s(".page.pageLeaderboards .bigUser").html(`<div class="warning">Your account must have ${ay(fp({start:0,end:e*1e3}))} typed to be placed on the leaderboard.</div>`);return}if(_()&&b.type==="daily"&&b.userData===null){let t="Not qualified";b.yesterday||(t+=` (min speed required: ${W.typingSpeed(b.minWpm,{showDecimalPlaces:!0,suffix:` ${r.typingSpeedUnit}`})})`),s(".page.pageLeaderboards .bigUser").html(`<div class="warning">${t}</div>`);return}if(_()&&b.userData===null){s(".page.pageLeaderboards .bigUser").html('<div class="warning">Not qualified</div>');return}if(b.data!==null){if(b.type==="allTime"||b.type==="daily"){if(!b.userData||!b.count){s(".page.pageLeaderboards .bigUser").addClass("hidden"),s(".page.pageLeaderboards .tableAndUser > .divider").removeClass("hidden");return}const t=b.userData,a=b.friendsOnly?t.friendsRank:t.rank;let i=`Top ${(a/b.count*100).toFixed(2)}%`;a===1&&(i="GOAT");const n=tb();let l;n===null?l="":n===0?l=" ( = since you last checked)":n>0?l=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(n)} since you last checked
      )`:l=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(n)} since you last checked
        )`;const c={wpm:W.typingSpeed(t.wpm,{showDecimalPlaces:!0}),acc:W.percentage(t.acc,{showDecimalPlaces:!0}),raw:W.typingSpeed(t.raw,{showDecimalPlaces:!0}),con:W.percentage(t.consistency,{showDecimalPlaces:!0})},d=`
          <div class="rank">${vs(a)}</div>
        <div class="userInfo">
          <div class="top">You (${i})</div>
          <div class="bottom">${l}</div>
        </div>
        <div class="stat wide">
          <div class="title">${r.typingSpeedUnit}</div>
          <div class="value">${c.wpm}</div>
        </div>
        <div class="stat wide">
          <div class="title">accuracy</div>
          <div class="value">${c.acc}</div>
        </div>
        <div class="stat wide">
          <div class="title">raw</div>
          <div class="value">${c.raw}</div>
        </div>
        <div class="stat wide">
          <div class="title">consistency</div>
          <div class="value">${c.con}</div>
        </div>
        <div class="stat wide">
          <div class="title">date</div>
          <div class="value">${te(t.timestamp,"dd MMM yyyy HH:mm")}</div>
        </div>


        <div class="stat narrow">
          <div>${c.wpm}</div>
          <div class="sub">${c.acc}</div>
        </div>
        <div class="stat narrow rawAndConsistency">
          <div>${c.raw}</div>
          <div class="sub">${c.con}</div>
        </div>
        <div class="stat narrow">
          <div>${te(t.timestamp,"dd MMM yyyy")}</div>
          <div class="sub">${te(t.timestamp,"HH:mm")}</div>
        </div>
        `;s(".page.pageLeaderboards .bigUser").html(d)}else if(b.type==="weekly"){if(!b.userData||!b.count){s(".page.pageLeaderboards .bigUser").addClass("hidden");return}const t=b.userData,a=b.friendsOnly?t.friendsRank:t.rank;let i=`Top ${(a/b.count*100).toFixed(2)}%`;a===1&&(i="GOAT");const n=tb();let l;n===null?l="":n===0?l=" ( = since you last checked)":n>0?l=` (<i class="fas fa-fw fa-angle-up"></i>${Math.abs(n)} since you last checked
      )`:l=` (<i class="fas fa-fw fa-angle-down"></i>${Math.abs(n)} since you last checked
        )`;const c={xp:t.totalXp<1e3?t.totalXp:wc(t.totalXp),time:Re(Math.round(t.timeTypedSeconds),!0,!0,":")},d=`
          <div class="rank">${vs(a)}</div>
        <div class="userInfo">
          <div class="top">You (${i})</div>
          <div class="bottom">${l}</div>
        </div>
        <div class="stat wide">
          <div class="title">xp gained</div>
          <div class="value">${c.xp}</div>
        </div>
        <div class="stat wide">
          <div class="title">time typed</div>
          <div class="value">${c.time}</div>
        </div>
        <div class="stat narrow">
          <div>${c.xp}</div>
          <div class="sub">${c.time}</div>
        </div>
        <div class="stat wide">
          <div class="title">last activity</div>
          <div class="value">${te(t.lastActivityTimestamp,"dd MMM yyyy HH:mm")}</div>
        </div>
        <div class="stat narrow">
          <div>${te(t.lastActivityTimestamp,"dd MMM yyyy")}</div>
          <div class="sub">${te(t.lastActivityTimestamp,"HH:mm")}</div>
        </div>
        `;s(".page.pageLeaderboards .bigUser").html(d)}s(".page.pageLeaderboards .bigUser").removeClass("hidden"),s(".page.pageLeaderboards .tableAndUser > .divider").addClass("hidden")}}function io(){if(s(".page.pageLeaderboards .loading").addClass("hidden"),s(".page.pageLeaderboards .updating").addClass("invisible"),s(".page.pageLeaderboards .error").addClass("hidden"),b.error!==void 0){s(".page.pageLeaderboards .error").removeClass("hidden"),s(".page.pageLeaderboards .error p").text(b.error),nb();return}if(b.updating){ib(),s(".page.pageLeaderboards .updating").removeClass("invisible");return}else if(b.loading){ib(),s(".page.pageLeaderboards .bigUser").addClass("hidden"),s(".page.pageLeaderboards .titleAndButtons").addClass("hidden"),s(".page.pageLeaderboards .loading").removeClass("hidden"),s(".page.pageLeaderboards table").addClass("hidden");return}else nb();if(_()?s(".page.pageLeaderboards .needAuth").removeClass("hidden"):s(".page.pageLeaderboards .needAuth").addClass("hidden"),b.data===null){f("Data is null");return}s(".page.pageLeaderboards .titleAndButtons").removeClass("hidden"),bT(),TT(),wT();for(const e of document.querySelectorAll(".page.pageLeaderboards .wide.speedUnit, .page.pageLeaderboards .narrow.speedUnit span"))e.innerHTML=r.typingSpeedUnit;b.scrollToUserAfterFill&&(document.querySelector(".tableAndUser .me")?.scrollIntoView({block:"center"}),b.scrollToUserAfterFill=!1)}function fl(){CT(),kT(),ST(),xT()}function CT(){const e=s(".page.pageLeaderboards .buttonGroup.typeButtons");e.find("button").removeClass("active"),e.find(`button[data-type=${b.type}]`).addClass("active")}function kT(){const e=s(".page.pageLeaderboards .buttonGroup.friendsOnlyButtons");if(_()&&(Ba()?.connections.enabled??!1))e.removeClass("hidden");else{e.addClass("hidden"),b.friendsOnly=!1;return}const t=s(".page.pageLeaderboards .buttonGroup.friendsOnlyButtons .everyone"),a=s(".page.pageLeaderboards .buttonGroup.friendsOnlyButtons .friendsOnly");b.friendsOnly?(a.addClass("active"),t.removeClass("active")):(a.removeClass("active"),t.addClass("active"))}function ST(){if(b.type!=="allTime"&&b.type!=="daily"){s(".page.pageLeaderboards .buttonGroup.modeButtons").addClass("hidden");return}s(".page.pageLeaderboards .buttonGroup.modeButtons").removeClass("hidden");const e=s(".page.pageLeaderboards .buttonGroup.modeButtons");e.find("button").removeClass("active"),e.find(`button[data-mode=${b.mode}][data-mode2=${b.mode2}]`).addClass("active"),s(".page.pageLeaderboards .buttonGroup.modeButtons button").addClass("hidden");for(const t of Object.keys(Go[b.type]))for(const a of Object.keys(Go[b.type][t]))s(`.page.pageLeaderboards .buttonGroup.modeButtons button[data-mode="${t}"][data-mode2="${a}"]`).removeClass("hidden")}function xT(){if(b.type!=="daily"){s(".page.pageLeaderboards .buttonGroup.languageButtons").addClass("hidden");return}s(".page.pageLeaderboards .buttonGroup.languageButtons").removeClass("hidden");const e=s(".page.pageLeaderboards .buttonGroup.languageButtons");e.find("button").removeClass("active"),e.find(`button[data-language=${b.language}]`).addClass("active"),s(".page.pageLeaderboards .buttonGroup.languageButtons button").addClass("hidden");for(const t of Go[b.type][b.mode]?.[b.mode2]??[])s(`.page.pageLeaderboards .buttonGroup.languageButtons button[data-language="${t}"]`).removeClass("hidden")}let Ff;function ab(){if(b.type==="daily"){const e=Bg(new Date,iy(new Ka));s(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+Re(e,!0))}else if(b.type==="allTime"){const e=new Date,t=14-e.getMinutes()%15,a=60-e.getSeconds(),o=t*60+a;s(".page.pageLeaderboards .titleAndButtons .timer").text("Next update in: "+Re(o,!0))}else if(b.type==="weekly"){const e=ny(new Ka,{weekStartsOn:1}),t=Bg(new Date,e);s(".page.pageLeaderboards .titleAndButtons .timer").text("Next reset in: "+Re(t,!0,!0,":",!0,!0))}}function TT(){let e=!0;(b.type==="daily"&&b.yesterday||b.type==="weekly"&&b.lastWeek)&&(e=!1),e?s(".page.pageLeaderboards .titleAndButtons .timer").removeClass("invisible"):s(".page.pageLeaderboards .titleAndButtons .timer").addClass("invisible")}function LT(){ab(),Ff=setInterval(()=>{ab()},1e3)}function $T(){clearInterval(Ff),Ff=void 0,s(".page.pageLeaderboards .titleAndButtons .timer").text("-")}function ob(e){return e.startsWith("(")?e.slice(1,-1).split("|"):[e]}async function MT(){const e=Ba()?.dailyLeaderboards.validModeRules;if(e===void 0)throw new Error("cannot load server configuration for dailyLeaderboards.validModeRules");const t=e.flatMap(a=>{const o=ob(a.language);return ob(a.mode2).map(n=>({mode:a.mode,mode2:n,languages:o}))});Go.daily=t.reduce((a,{mode:o,mode2:i,languages:n})=>{let l=a[o];l===void 0&&(l={},a[o]=l);let c=l[i];return c===void 0&&(c=[],l[i]=c),c.push(...n),a},{})}function Hd(){if(b.type==="weekly")return;const e=Go[b.type];let t=e[b.mode];if(t===void 0){const o=Object.keys(e).sort()[0];if(o===void 0)throw new Error(`no valid leaderboard config for type ${b.type}`);b.mode=o,t=e[b.mode]}let a=t[b.mode2];if(a===void 0){const o=Object.keys(t).sort((i,n)=>parseInt(i)-parseInt(n))[0];if(o===void 0)throw new Error(`no valid leaderboard config for type ${b.type} and mode ${b.mode}`);b.mode2=o,a=t[b.mode2]}if(a===void 0||a.length<1)throw new Error(`Daily leaderboard config not valid for mode:${b.mode} mode2:${b.mode2}`);a.includes(b.language)||(b.language=a.sort()[0])}async function AT(){const t=Array.from(new Set(Object.values(Go).flatMap(i=>Object.keys(i)))).sort().flatMap(i=>{const n=Array.from(new Set(Object.values(Go).flatMap(c=>Object.keys(c[i]??{})))).sort((c,d)=>parseInt(c)-parseInt(d)),l=i==="time"?"fas fa-clock":"fas fa-align-left";return n.map(c=>`<button data-mode="${i}" data-mode2="${c}">
      <i class="${l}"></i>
       ${i} ${c}
    </button>`)});s(".modeButtons").html('<div class="divider"></div>'+t.join(`
`));const o=Array.from(new Set(Object.values(Go).flatMap(i=>Object.values(i)).flatMap(i=>Object.values(i)).flatMap(i=>i))).sort().map(i=>`<button data-language="${i}">
          <i class="fas fa-globe"></i>
          ${i}
        </button>`);s(".languageButtons").html('<div class="divider"></div>'+o.join(`
`))}function ib(){s(".page.pageLeaderboards button").prop("disabled",!0)}function nb(){s(".page.pageLeaderboards button").prop("disabled",!1)}function _T(e){e<0||e===b.page||o1("goToPage",e)}function o1(e,t){if(e==="firstPage")b.page=0;else if(e==="previousPage"&&b.page>0){const a=Math.ceil(b.count/b.pageSize);b.page>a?b.page=a-1:b.page-=1}else if(e==="nextPage")b.page+=1;else if(e==="goToPage"&&t!==void 0)b.page=t;else if(e==="userPage"){if(_()){const a=b.userData?.rank;if(ge(a)){const o=Math.floor((a-1)/b.pageSize);if(b.page===o)return;b.page=o,b.scrollToUserAfterFill=!0}}}else return;hi(),rn(!0),io()}function ET(e){b.type==="daily"&&e==="toggleYesterday"?b.yesterday=!b.yesterday:b.type==="weekly"&&e==="toggleLastWeek"&&(b.lastWeek=!b.lastWeek),hi(),rn(),io(),Ds()}function hi(){if(b.goToUserPage)return;const e={};e.type=b.type,b.type==="allTime"?e.mode2=b.mode2:b.type==="daily"?(e.mode=b.mode,e.language=b.language,e.mode2=b.mode2,b.yesterday&&(e.yesterday=!0)):b.type==="weekly"&&b.lastWeek&&(e.lastWeek=!0),e.page=b.page+1,b.friendsOnly&&(e.friendsOnly=!0),i1.setUrlParams(e),t1.set(b)}function qT(e){if(e===void 0){Object.assign(b,t1.get());return}e.type!==void 0&&(b.type=e.type),b.friendsOnly=e.friendsOnly??!1,b.type==="allTime"?e.mode2!==void 0&&(b.mode2=e.mode2):b.type==="daily"?(e.language!==void 0&&(b.language=e.language),e.mode2!==void 0&&(b.mode2=e.mode2),e.mode!==void 0&&(b.mode=e.mode),e.yesterday!==void 0&&(b.yesterday=e.yesterday)):b.type==="weekly"&&e.lastWeek!==void 0&&(b.lastWeek=e.lastWeek),e.page!==void 0&&(b.page=e.page-1,b.page<0&&(b.page=0)),e.goToUserPage===!0&&(b.goToUserPage=!0)}function Pl(e){return zk(e,new Date().getTimezoneOffset())}function sb(e,t,a){const o=`local time 
`+te(t,eb)+` - 
`+te(a,eb),i=s(".page.pageLeaderboards .bigtitle .subtext > .text");i.text(`${e}`),i.attr("aria-label",o)}function vs(e){return e===void 0?"":e===1?'<i class="fas fa-fw fa-crown"></i>':e.toString()}s(".page.pageLeaderboards .jumpButtons button").on("click",function(){const e=s(this).data("action");e!=="goToPage"&&o1(e)});s(".page.pageLeaderboards .bigtitle button").on("click",function(){const e=s(this).data("action");ET(e)});s(".page.pageLeaderboards .buttonGroup.typeButtons").on("click","button",function(){const e=s(this).data("type");b.type!==e&&(b.type=e,b.type==="daily"&&(b.language="english",b.yesterday=!1),b.type==="weekly"&&(b.lastWeek=!1),Hd(),b.data=null,b.page=0,rn(),Ds(),fl(),io(),hi())});s(".page.pageLeaderboards .buttonGroup.modeButtons").on("click","button",function(){const e=s(this).attr("data-mode"),t=s(this).attr("data-mode2");if(e!==void 0&&t!==void 0&&(b.type==="allTime"||b.type==="daily")){if(b.mode===e&&b.mode2===t)return;b.mode=e,b.mode2=t,b.page=0}else return;Hd(),b.data=null,rn(),fl(),Ds(),io(),hi()});s(".page.pageLeaderboards .buttonGroup.languageButtons").on("click","button",function(){const e=s(this).attr("data-language");if(e!==void 0&&b.type==="daily"){if(b.language===e)return;b.language=e,b.page=0}else return;Hd(),b.data=null,rn(),fl(),Ds(),io(),hi()});s(".page.pageLeaderboards .buttonGroup.friendsOnlyButtons").on("click","button",()=>{b.friendsOnly=!b.friendsOnly,b.page=0,rn(),Ds(),fl(),io(),hi()});const i1=new Im({id:"leaderboards",element:V(".page.pageLeaderboards"),path:"/leaderboards",urlParamsSchema:hT,afterHide:async()=>{Tt("pageLeaderboards"),$T()},beforeShow:async e=>{await Cp,Gt("pageLeaderboards","main"),await MT(),await AT(),qT(e.urlParams),Hd(),LT(),Ds(),io(),fl(),hi(),rn(!1)},afterShow:async()=>{}});s(async()=>{Qt("pageLeaderboards")});Ce(({key:e})=>{pe()==="leaderboards"&&e==="typingSpeedUnit"&&(io(),a1())});function IT(){if(!nt()){f("You are offline",0,{duration:2});return}Ir.show({focusFirstInput:!0,beforeAnimation:async e=>{S()?.streakHourOffset!==void 0?(e.querySelector("input")?.remove(),e.querySelector(".preview")?.remove(),e.querySelector("button")?.remove(),e.querySelector(".text").textContent="You have already set your streak hour offset."):(e.querySelector("input").value="0",n1())}})}function n1(){const e=parseInt(Ir.getModal().querySelector("input")?.value,10),t=Ir.getModal().querySelector(".preview"),a=new Date;a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0),a.setUTCMilliseconds(0);const o=new Date;o.setUTCHours(0),o.setUTCMinutes(0),o.setUTCSeconds(0),o.setUTCMilliseconds(0),o.setHours(o.getHours()- -1*e),t.innerHTML=`
    <div class="row"><div>Current local reset time:</div><div>${a.toLocaleTimeString()}</div></div>
    <div class="row"><div>New local reset time:</div><div>${o.toLocaleTimeString()}</div></div>
  `}function DT(){Ir.hide()}async function FT(){const e=parseInt(Ir.getModal().querySelector("input")?.value,10);if(isNaN(e)){f("Streak hour offset must be a number",0);return}if(e<-11||e>12){f("Streak hour offset must be between -11 and 12",0);return}oe();const t=await $.users.setStreakHourOffset({body:{hourOffset:e}});if(j(),t.status!==200)f("Failed to set streak hour offset",-1,{response:t});else{f("Streak hour offset set",1);const a=S();a.streakHourOffset=e,dt(a),DT()}}const Ir=new ue({dialogId:"streakHourOffsetModal",setup:async e=>{e.querySelector("input")?.addEventListener("input",()=>{n1()}),e.querySelector("button")?.addEventListener("click",()=>{FT()})}}),PT=new fe({id:"editApeKey",title:"Edit Ape key",inputs:[{type:"text",placeholder:"name",initVal:""}],buttonText:"edit",onlineOnly:!0,execFn:async(e,t)=>{const a=await $.apeKeys.save({params:{apeKeyId:e.parameters[0]??""},body:{name:t}});return a.status!==200?{status:-1,message:"Failed to update key",notificationOptions:{response:a}}:{status:1,message:"Key updated",hideOptions:{clearModalChain:!0}}}}),BT=new fe({id:"deleteApeKey",title:"Delete Ape key",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>{const t=await $.apeKeys.delete({params:{apeKeyId:e.parameters[0]??""}});return t.status!==200?{status:-1,message:"Failed to delete key",notificationOptions:{response:t}}:(Xm?.(),{status:1,message:"Key deleted",hideOptions:{clearModalChain:!0}})}}),RT=new fe({id:"viewApeKey",title:"Ape key",inputs:[{type:"textarea",disabled:!0,placeholder:"key",initVal:""}],textAllowHtml:!0,text:`
    This is your new Ape Key. Please keep it safe. You will only see it once!<br><br>
    <strong>Note:</strong> Ape Keys are disabled by default, you need to enable them before they can be used.`,buttonText:"close",hideCallsExec:!0,execFn:async e=>({status:1,message:"Key generated",showNotification:!1,hideOptions:{clearModalChain:!0}}),beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},beforeShowFn:e=>{e.canClose=!1,s("#simpleModal textarea").css("height","110px"),s("#simpleModal .submitButton").addClass("hidden"),setTimeout(()=>{e.canClose=!0,s("#simpleModal .submitButton").removeClass("hidden")},5e3)}}),WT=new fe({id:"generateApeKey",title:"Generate new Ape key",inputs:[{type:"text",placeholder:"Name",initVal:""}],buttonText:"generate",onlineOnly:!0,execFn:async(e,t)=>{const a=await $.apeKeys.add({body:{name:t,enabled:!1}});if(a.status!==200)return{status:-1,message:"Failed to generate key",notificationOptions:{response:a}};const o=a.body.data,i=e.modal.getPreviousModalInChain();return Xm?.(),{status:1,message:"Key generated",hideOptions:{clearModalChain:!0,animationMode:"modalOnly"},afterHide:()=>{RT.show([o.apeKey],{modalChain:i,animationMode:"modalOnly"})}}}});let Jc={};const s1=s("#pageAccountSettings .tab[data-tab='apeKeys']");async function zT(){if(!_())return!1;HT();const e=await $.apeKeys.get();return e.status!==200?e.body.message==="You have lost access to ape keys, please contact support"?(l1=!0,c1(),!1):(f("Error getting ape keys",-1,{response:e}),!1):(Jc=e.body.data,!0)}function HT(){const e=s1.find("table tbody");e.empty(),e.append("<tr><td colspan='6' style='text-align: center;font-size:1rem;'><i class='fas fa-spin fa-circle-notch'></i></td></tr>")}function r1(){const e=Jc;if(e==null)return;const t=s1.find("table tbody");t.empty();const a=Object.keys(e);if(a.length===0){t.append("<tr><td colspan='6' style='text-align: center;'>No keys found</td></tr>");return}a.forEach(o=>{const i=e[o];t.append(`
      <tr keyId="${o}">
        <td>
          <button class="textButton toggleActive" style="font-size: 1.25rem">
            ${i.enabled?'<i class="fas fa-fw fa-check-square"></i>':'<i class="far fa-fw fa-square"></i>'}
          </button>
        </td>
        <td>${i.name}</td>
        <td>${te(new Date(i.createdOn),"dd MMM yyyy HH:mm")}</td>
        <td>${te(new Date(i.modifiedOn),"dd MMM yyyy HH:mm")}</td>
        <td>${i.lastUsedOn===-1?"-":te(new Date(i.lastUsedOn),"dd MMM yyyy HH:mm")}</td>
        <td>
          <div class="keyButtons">
            <button class="editButton">
              <i class="fas fa-fw fa-pen"></i>
            </button>
            <button class="deleteButton">
              <i class="fas fa-fw fa-trash-alt"></i>
            </button>
          </div>
        </td>
      </tr>
    `)});for(const o of t.find("tr")){const i=o.getAttribute("keyid");o.querySelector("button.toggleActive")?.addEventListener("click",n=>{OT(i)}),o.querySelector("button.deleteButton")?.addEventListener("click",n=>{BT.show([i],{})}),o.querySelector("button.editButton")?.addEventListener("click",n=>{PT.show([i],{})})}}async function OT(e){const t=Jc?.[e];if(!t||Jc===void 0)return;oe();const a=await $.apeKeys.save({params:{apeKeyId:e},body:{enabled:!t.enabled}});if(j(),a.status!==200){f("Failed to update key",-1,{response:a});return}t.enabled=!t.enabled,r1(),t.enabled?f("Key active",1):f("Key inactive",1)}let Xm,l1=!1;async function c1(e){if(l1){s(".pageAccountSettings .tab[data-tab='apeKeys'] table").remove(),s(".pageAccountSettings .section.apeKeys .buttons").remove(),s(".pageAccountSettings .section.apeKeys .lostAccess").removeClass("hidden");return}Xm=e,await zT(),r1()}s(".pageAccountSettings").on("click","#generateNewApeKey",()=>{WT.show([],{})});let Hi=[];const Jm=s("#pageAccountSettings .tab[data-tab='blockedUsers']");async function NT(){if(VT(),!_())return Hi=[],!1;const e=await $.connections.get({query:{status:"blocked",type:"incoming"}});return e.status!==200?(Hi=[],f("Error getting blocked users",-1,{response:e}),!1):(Hi=e.body.data,!0)}async function UT(){await NT(),d1()}function VT(){const e=Jm.find("table tbody");e.empty(),e.append("<tr><td colspan='3' style='text-align: center;font-size:1rem;'><i class='fas fa-spin fa-circle-notch'></i></td></tr>")}function d1(){const e=Jm.find("table tbody");if(e.empty(),Hi.length===0){e.append("<tr><td colspan='3' style='text-align: center;'>No blocked users</td></tr>");return}const t=Hi.map(a=>`
    <tr data-id="${a._id}" data-uid="${Qm(a)}">
       <td><a href="${location.origin}/profile/${a.initiatorUid}?isUid" router-link>${a.initiatorName}</a></td>
       <td>${te(new Date(a.lastModified),"dd MMM yyyy HH:mm")}</td>
       <td>
         <button class="delete">
           <i class="fas fa-fw fa-trash-alt"></i>
         </button>
       </td>
    </tr>
    `);e.append(t.join())}Jm.on("click","table button.delete",async e=>{const t=e.target.closest("tr"),a=t.dataset.id;if(a===void 0)throw new Error("Cannot find id of target.");t.querySelectorAll("button").forEach(i=>i.disabled=!0);const o=await $.connections.delete({params:{id:a}});if(o.status!==200)f(`Cannot unblock user: ${o.body.message}`,-1);else{Hi=Hi.filter(n=>n._id!==a),d1();const i=S();if(i){const n=t.dataset.uid;if(n===void 0)throw new Error("Cannot find uid of target.");delete i.connections[n],By()}}});const ce=V(".page.pageAccountSettings"),KT=I.object({tab:I.enum(["authentication","account","apeKeys","dangerZone","blockedUsers"])}),jT=KT.partial(),Qo={tab:"account"};function GT(){ce.qsa(".section.passwordAuthSettings button")?.addClass("hidden"),ce.qsa(".section.googleAuthSettings button")?.addClass("hidden"),ce.qsa(".section.githubAuthSettings button")?.addClass("hidden");const e=ct();if(e===null)return;const t=e.providerData.some(i=>i.providerId==="password"),a=e.providerData.some(i=>i.providerId==="google.com"),o=e.providerData.some(i=>i.providerId==="github.com");t?(ce.qs(".section.passwordAuthSettings #emailPasswordAuth")?.show(),ce.qs(".section.passwordAuthSettings #passPasswordAuth")?.show(),(a||o)&&ce.qs(".section.passwordAuthSettings #removePasswordAuth")?.show()):ce.qs(".section.passwordAuthSettings #addPasswordAuth")?.show(),a?(ce.qs(".section.googleAuthSettings #removeGoogleAuth")?.show(),t||o?ce.qs(".section.googleAuthSettings #removeGoogleAuth")?.enable():ce.qs(".section.googleAuthSettings #removeGoogleAuth")?.disable()):ce.qs(".section.googleAuthSettings #addGoogleAuth")?.show(),o?(ce.qs(".section.githubAuthSettings #removeGithubAuth")?.show(),t||a?ce.qs(".section.githubAuthSettings #removeGithubAuth")?.enable():ce.qs(".section.githubAuthSettings #removeGithubAuth")?.disable()):ce.qs(".section.githubAuthSettings #addGithubAuth")?.show()}function QT(){if(!_())ce.qs(".section.discordIntegration")?.hide();else{if(!S())return;ce.qs(".section.discordIntegration")?.show(),S()?.discordId===void 0?(ce.qs(".section.discordIntegration .buttons")?.show(),ce.qs(".section.discordIntegration .info")?.hide()):(ce.qs(".section.discordIntegration .buttons")?.hide(),ce.qs(".section.discordIntegration .info")?.show())}}function u1(){dr(ce.qs(".tab.active"),ce.qs(`.tab[data-tab="${Qo.tab}"]`),250,async()=>{},async()=>{ce.qsa(".tab")?.removeClass("active"),ce.qs(`.tab[data-tab="${Qo.tab}"]`)?.addClass("active")}),ce.qsa("button")?.removeClass("active"),ce.qs(`button[data-tab="${Qo.tab}"]`)?.addClass("active")}function YT(){ce.qs(".section.optOutOfLeaderboards .optedOut")?.hide(),ce.qs(".section.optOutOfLeaderboards .buttons")?.show(),ce.qs(".section.setStreakHourOffset .info")?.hide(),ce.qs(".section.setStreakHourOffset .buttons")?.show();const e=S();if(e?.lbOptOut===!0&&(ce.qs(".section.optOutOfLeaderboards .optedOut")?.show(),ce.qs(".section.optOutOfLeaderboards .buttons")?.hide()),e?.streakHourOffset!==void 0){ce.qs(".section.setStreakHourOffset .info")?.show();const t=e?.streakHourOffset>0?"+":"";ce.qs(".section.setStreakHourOffset .info span")?.setText(t+e?.streakHourOffset),ce.qs(".section.setStreakHourOffset .buttons")?.hide()}}function bi(){pe()==="accountSettings"&&(GT(),QT(),YT(),c1(bi),UT(),u1(),Zm.setUrlParams(Qo))}L(".page.pageAccountSettings")?.onChild("click",".tabs button",e=>{Qo.tab=e.target.getAttribute("data-tab"),u1(),Zm.setUrlParams(Qo)});Za(".page.pageAccountSettings .section.discordIntegration .getLinkAndGoToOauth")?.on("click",()=>{oe(),$.users.getDiscordOAuth().then(e=>{e.status===200?window.open(e.body.data.url,"_self"):f("Failed to get OAuth from discord: "+e.body.message,-1)})});L(".page.pageAccountSettings #setStreakHourOffset")?.on("click",()=>{IT()});Wa(e=>{e.type==="authConfigUpdated"&&bi()});const Zm=new Im({id:"accountSettings",display:"Account Settings",element:ce,path:"/account-settings",urlParamsSchema:jT,afterHide:async()=>{Tt("pageAccountSettings")},beforeShow:async e=>{e.urlParams?.tab!==void 0&&(Qo.tab=e.urlParams.tab),Gt("pageAccountSettings","main"),ce.qs(`.tab[data-tab="${Qo.tab}"]`)?.addClass("active"),bi()}});q2(()=>{Qt("pageAccountSettings")});function XT(){const e=document.querySelector('meta[property="og:url"]'),t=window.location.href;if(e)e.setAttribute("content",t);else{const a=document.createElement("meta");a.setAttribute("property","og:url"),a.content=t,document.head.appendChild(a)}}function JT(e){if(e.id==="test")Eg();else{const t=e.display??an(e.id);Eg(`${t} | Monkeytype`)}}async function ZT({loadingOptions:e,totalDuration:t}){Ti.element.show().setStyle({opacity:"0"}),await Ti.beforeShow({});const a=e.length,o=100/a;Ti.element.promiseAnimate({opacity:"1",duration:t/2});for(let i=0;i<e.length;i++){const n=o*i,l=e[i];l.style==="bar"?(await X7(),i===0&&(await If(0,0),Yc(""))):Q7(),l.style==="bar"?(await eL(l,a,n),If(100,125),Yc("Done")):await l.loadingPromise()}await Ti.element.promiseAnimate({opacity:"0",duration:t/2}),await Ti.afterHide(),Ti.element.hide()}let Wo=null;async function eL(e,t,a){let o=e.loadingPromise();const i=new AbortController;Wo=i;const n=(async()=>{for(const l of e.keyframes){if(i.signal.aborted)break;l.text!==void 0&&Yc(l.text),await If(a+l.percentage/t,l.durationMs)}})();await Promise.race([n,(async()=>{await o,i.abort()})()]),await o,Wo===i&&(Wo=null)}async function ua(e,t={}){if(t={...{force:!1},...t},Kn()&&!t.force)return console.debug(`change page to ${e} stopped, page transition is true`),!1;if(!t.force&&pe()===e)return console.debug(`change page ${e} stoped, page already active`),!1;console.log(`changing page ${e}`);const o={loading:Ti,test:W7,settings:_w,about:V7,account:B7,login:G7,profile:cT,profileSearch:pT,friends:sT,404:mT,accountSettings:Zm,leaderboards:i1},i=o[pe()],n=o[e],l=Y(250);Xd(!0),Za(".page")?.removeClass("active"),await i?.beforeHide?.(),i.element.show().setStyle({opacity:"1"}),await i.element.promiseAnimate({opacity:"0",duration:l/2}),i.element.hide(),await i?.afterHide();const c=n.loadingOptions?.loadingMode();try{let d=[];t.loadingOptions?.loadingMode()==="sync"&&d.push(t.loadingOptions),n.loadingOptions?.loadingMode()==="sync"&&d.push(n.loadingOptions),d.length>0&&await ZT({loadingOptions:d,totalDuration:l}),Wo&&(Wo=null)}catch(d){return Wo&&(Wo.abort(),Wo=null),o.loading.element.addClass("active"),dh(o.loading.id),eo(!1),Y7(),Yc(`Failed to load the ${n.id} page: ${d instanceof Error?d.message:String(d)}`),Xd(!1),!1}return JT(n),dh(n.id),XT(),eo(!1),await n?.beforeShow({params:t.params,data:t.data}),typeof c=="object"&&c.mode==="async"&&(c.beforeLoading(),n?.loadingOptions?.loadingPromise().then(()=>{c.afterLoading()})),n.element.show().setStyle({opacity:"0"}),await n.element.promiseAnimate({opacity:"1",duration:l/2}),n.element.addClass("active"),await n?.afterShow(),Xd(!1),X4(),!0}function tL(e){return new RegExp("^"+e.replace(/\//g,"\\/").replace(/:\w+/g,"(.+)")+"$")}function aL(e){const t=e.result.slice(1),o=Array.from(e.route.path.matchAll(/:(\w+)/g)).map(i=>i[1]).map((i,n)=>[i,t[n]]);return Object.fromEntries(o)}const oL={path:"404",load:async(e,t)=>{await ua("404",t)}},iL=[{path:"/",load:async(e,t)=>{await ua("test",t)}},{path:"/verify",load:async(e,t)=>{await ua("test",t)}},{path:"/leaderboards",load:async(e,t)=>{await ua("leaderboards",t)}},{path:"/about",load:async(e,t)=>{await ua("about",t)}},{path:"/settings",load:async(e,t)=>{await ua("settings",t)}},{path:"/login",load:async(e,t)=>{if(!ga()){await Ke("/",t);return}if(_()){await Ke("/account",t);return}await ua("login",t)}},{path:"/account",load:async(e,t)=>{if(!ga()){await Ke("/",t);return}if(!_()){await Ke("/login",t);return}await ua("account",t)}},{path:"/account-settings",load:async(e,t)=>{if(!ga()){await Ke("/",t);return}if(!_()){await Ke("/login",t);return}await ua("accountSettings",t)}},{path:"/profile",load:async(e,t)=>{await ua("profileSearch",t)}},{path:"/profile/:uidOrName",load:async(e,t)=>{await ua("profile",{...t,force:!0,params:{uidOrName:e.uidOrName},data:t.data})}},{path:"/friends",load:async(e,t)=>{if(!ga()){await Ke("/",t);return}if(!_()){await Ke("/login",t);return}await ua("friends",t)}}];async function Ke(e=window.location.pathname+window.location.search+window.location.hash,t={}){if(!t.force&&(Lt||ao||Kn())){console.debug(`navigate: ${e} ignored, page is busy (testRestarting: ${Lt}, resultCalculating: ${ao}, pageTransition: ${Kn()})`);return}const a=M0("no_quit");if(Me&&a){f("No quit funbox is active. Please finish the test.",0,{important:!0});return}e=e.replace(/\/$/,""),e===""&&(e="/");const o=new URL(window.location.href),i=new URL(e,window.location.origin);o.pathname+o.search+o.hash!==i.pathname+i.search+i.hash&&history.pushState(null,"",e),await f1(t)}async function f1(e={}){const a=iL.map(o=>({route:o,result:location.pathname.match(tL(o.path))})).find(o=>o.result!==null);if(a===void 0){await oL.load({},{force:!0});return}await a.route.load(aL(a),e)}window.addEventListener("popstate",()=>{f1()});document.addEventListener("DOMContentLoaded",()=>{document.body.addEventListener("click",e=>{const t=e?.target;t.matches("[router-link]")&&t?.href&&(e.preventDefault(),Ke(t.href))})});dT((e,t)=>{Ke(e,t)});const nL=[{id:"viewTypingPage",display:"View Typing Page",alias:"navigate go to start begin type test",icon:"fa-keyboard",exec:()=>{Ke("/")}},{id:"viewLeaderboards",display:"View Leaderboards",alias:"navigate go to",icon:"fa-crown",exec:()=>{Ke("/leaderboards")}},{id:"viewAbout",display:"View About Page",alias:"navigate go to",icon:"fa-info",exec:()=>{Ke("/about")}},{id:"viewSettings",display:"View Settings Page",alias:"navigate go to",icon:"fa-cog",exec:()=>{Ke("/settings")}},{id:"viewAccount",display:"View Account Page",alias:"navigate go to stats",icon:"fa-user",exec:()=>{_()?Ke("/account"):Ke("/login")}},{id:"toggleFullscreen",display:"Toggle Fullscreen",icon:"fa-expand",exec:()=>{I2()}}],Oo={missed:"words",slow:!1},wn="#practiseWordsModal .modal";function yu(){s(`${wn} .group[data-id="missed"] button`).removeClass("active"),s(`${wn} .group[data-id="missed"] button[value="${Oo.missed}"]`).addClass("active"),s(`${wn} .group[data-id="slow"] button`).removeClass("active"),s(`${wn} .group[data-id="slow"] button[value="${Oo.slow}"]`).addClass("active"),Oo.missed==="off"&&!Oo.slow?s(`${wn} .start`).prop("disabled",!0):s(`${wn} .start`).prop("disabled",!1)}async function sL(e){for(const t of e.querySelectorAll(".group[data-id='missed'] button"))t.addEventListener("click",a=>{Oo.missed=a.target.value,yu()});for(const t of e.querySelectorAll(".group[data-id='slow'] button"))t.addEventListener("click",a=>{Oo.slow=a.target.value==="true",yu()});e.querySelector(".start")?.addEventListener("click",()=>{rb()}),e.addEventListener("submit",t=>{t.preventDefault(),rb()}),yu()}function p1(e){m1.show(e)}function rL(e=!1){m1.hide({clearModalChain:e})}function rb(){Jl(Oo.missed,Oo.slow),rL(!0),R({practiseMissed:!0})}const m1=new ue({dialogId:"practiseWordsModal",setup:sL});let g1=!1,Pf=!1;function lb(){j(),s("#ad-result-wrapper").removeClass("hidden"),s("#ad-result-small-wrapper").removeClass("hidden"),s("#testConfig").removeClass("hidden"),s(".pageTest .screenshotSpacer").remove(),s("#notificationCenter").removeClass("hidden"),s("#commandLineMobileButton").removeClass("hidden"),s(".pageTest .ssWatermark").addClass("hidden"),s(".pageTest .ssWatermark").text("monkeytype.com"),s(".pageTest .buttons").removeClass("hidden"),s("noscript").removeClass("hidden"),s("#nocss").removeClass("hidden"),s("header, footer").removeClass("invisible"),s("#result").removeClass("noBalloons"),s(".wordInputHighlight").removeClass("hidden"),s(".highlightContainer").removeClass("hidden"),Pf&&s("#cookiesModal").removeClass("hidden"),g1&&s("#resultReplay").removeClass("hidden"),_()||s(".pageTest .loginTip").removeClass("hidden"),document.querySelector("html").style.scrollBehavior="smooth";for(const e of $t("applyGlobalCSS"))e.functions.applyGlobalCSS()}let cb=!1;async function h1(){const{domToCanvas:e}=await Hr(async()=>{const{domToCanvas:p}=await import("./vendor.DcpIuIDj.js").then(g=>g.ag);return{domToCanvas:p}},__vite__mapDeps([2,3,1]));oe(!0),s("#resultReplay").hasClass("hidden")||(g1=!0,ll()),(D2("#cookiesModal")||document.contains(document.querySelector("#cookiesModal")))&&(Pf=!0);const t=new Date(Date.now());s("#resultReplay").addClass("hidden"),s(".pageTest .ssWatermark").removeClass("hidden");const a=S(),o=[te(t,"dd MMM yyyy HH:mm"),"monkeytype.com"];if(a?.name!==void 0){const p=`${a?.name}${Ss(a,{iconsOnly:!0})}`;o.unshift(p)}s(".pageTest .ssWatermark").html(o.map(p=>`<span>${p}</span>`).join("<span class='pipe'>|</span>")),s(".pageTest .buttons").addClass("hidden"),s("#notificationCenter").addClass("hidden"),s("#commandLineMobileButton").addClass("hidden"),s(".pageTest .loginTip").addClass("hidden"),s("noscript").addClass("hidden"),s("#nocss").addClass("hidden"),s("#ad-result-wrapper").addClass("hidden"),s("#ad-result-small-wrapper").addClass("hidden"),s("#testConfig").addClass("hidden"),s(".pageTest .screenshotSpacer").remove(),s(".page.pageTest").prepend("<div class='screenshotSpacer'></div>"),s("header, footer").addClass("invisible"),s("#result").addClass("noBalloons"),s(".wordInputHighlight").addClass("hidden"),s(".highlightContainer").addClass("hidden"),Pf&&s("#cookiesModal").addClass("hidden");for(const p of $t("clearGlobal"))p.functions.clearGlobal();document.querySelector("html").style.scrollBehavior="auto",window.scrollTo({top:0,behavior:"auto"});const i=s("#result .wrapper");if(!i.length)return console.error("Result wrapper not found for screenshot"),f("Screenshot target element not found",-1),lb(),null;await Ee(50);const n=i.offset()?.left??0,l=i.offset()?.top??0,c=i.outerWidth(!0),d=i.outerHeight(!0),u=pr(2),m=pr(2);try{const p=document.documentElement,{scrollWidth:g,clientWidth:h,scrollHeight:y,clientHeight:k}=p,x=Math.max(g,h),C=Math.max(y,k),D=await e(p,{backgroundColor:await Zt("bg"),scale:window.devicePixelRatio??1,style:{width:`${x}px`,height:`${C}px`,overflow:"hidden"},fetch:{requestInit:{mode:"cors",credentials:"omit"},bypassingCache:!0},filter:Sa=>{if(!(Sa instanceof HTMLElement))return!0;const za=getComputedStyle(Sa);return!(Sa.classList.contains("hidden")||za.display==="none")},onCloneEachNode:Sa=>{if(Sa instanceof HTMLElement){const za=Sa;if(za.classList.contains("customBackground")){za.style.zIndex="0",za.style.width=`${x}px`,za.style.height=`${C}px`;const Io=za.querySelector("img");Io&&(window.innerWidth<=720?(Io.style.transform="translateY(20vh)",Io.style.height="100%"):(Io.style.width="100%",Io.style.height="100%"))}}}}),E=D.width/x,B=c+u*2,z=d+m*2,H=Math.round(B*E),ae=Math.round(z*E),xe=Math.ceil(B*E),Fe=Math.ceil(z*E),ze=document.createElement("canvas");ze.width=H,ze.height=ae;const N=ze.getContext("2d");if(!N)return f("Failed to get canvas context for screenshot",-1),null;N.imageSmoothingEnabled=!0,N.imageSmoothingQuality="high";const re=Math.max(0,Math.floor((n-u)*E)),vt=Math.max(0,Math.floor((l-m)*E)),Rt=Math.min(xe,D.width-re),ra=Math.min(Fe,D.height-vt);return N.drawImage(D,re,vt,Rt,ra,0,0,ze.width,ze.height),ze}catch(p){return f(se(p,"Error creating screenshot canvas"),-1),null}finally{lb()}}async function b1(){const e=await h1();e&&e.toBlob(async t=>{if(!t){f("Failed to generate image data (blob is null)",-1);return}try{const a=new ClipboardItem(Object.defineProperty({},t.type,{value:t,enumerable:!0}));await navigator.clipboard.write([a]),f("Copied screenshot to clipboard",1,{duration:2})}catch(a){console.error("Error saving image to clipboard",a),navigator.userAgent.toLowerCase().includes("firefox")&&!cb&&(cb=!0,f("On Firefox you can enable the asyncClipboard.clipboardItem permission in about:config to enable copying straight to the clipboard",0,{duration:10})),f("Could not copy screenshot to clipboard. Opening in new tab instead (make sure popups are allowed)",0,{duration:5});try{const o=URL.createObjectURL(t);window.open(o)}catch(o){f("Failed to open screenshot in new tab",-1),console.error("Error opening blob URL:",o)}}})}async function lL(){const e=await h1();return e?new Promise(t=>{e.toBlob(a=>{a?t(a):(f("Failed to convert canvas to Blob for download",-1),t(null))},"image/png")}):null}async function y1(){try{const e=await lL();if(!e){f("Failed to generate screenshot data",-1);return}const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t;const o=new Date().toISOString().replace(/[:.]/g,"-");a.download=`monkeytype-result-${o}.png`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t),f("Screenshot download started",1)}catch(e){console.error("Error downloading screenshot:",e),f("Failed to download screenshot",-1)}}s(".pageTest").on("click","#saveScreenshotButton",e=>{e.shiftKey?y1():b1(),s("#saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});s(document).on("keydown",e=>{Ie&&pe()==="test"&&e.key==="Shift"&&s("#result #saveScreenshotButton i").removeClass("far fa-image").addClass("fas fa-download")});s(document).on("keyup",e=>{Ie&&pe()==="test"&&e.key==="Shift"&&s("#result #saveScreenshotButton i").removeClass("fas fa-download").addClass("far fa-image")});const cL={title:"Practice words...",list:[{id:"practiseWordsMissed",display:"missed",exec:()=>{Jl("words",!1),R({practiseMissed:!0})}},{id:"practiseWordsSlow",display:"slow",exec:()=>{Jl("off",!0),R({practiseMissed:!0})}},{id:"practiseWordsBoth",display:"both",exec:()=>{Jl("words",!0),R({practiseMissed:!0})}},{id:"practiseWordsCustom",display:"custom...",opensModal:!0,exec:e=>{p1({animationMode:"modalOnly",modalChain:e.commandlineModal})}}]},dL=[{id:"nextTest",display:"Next test",alias:"restart start begin type test typing",icon:"fa-chevron-right",available:()=>Ie,exec:()=>{R()}},{id:"repeatTest",display:"Repeat test",icon:"fa-sync-alt",exec:()=>{R({withSameWordset:!0})},available:()=>Ie},{id:"practiseWords",display:"Practice words...",icon:"fa-exclamation-triangle",subgroup:cL,available:()=>Ie},{id:"toggleWordHistory",display:"Toggle word history",icon:"fa-align-left",exec:()=>{ym()},available:()=>Ie},{id:"copyScreenshot",display:"Copy screenshot to clipboard",icon:"fa-copy",alias:"copy image clipboard",exec:()=>{setTimeout(()=>{b1()},500)},available:()=>Ie},{id:"downloadScreenshot",display:"Download screenshot",icon:"fa-download",alias:"save image download file",exec:()=>{setTimeout(async()=>{y1()},500)},available:()=>Ie},{id:"copyWordsToClipboard",display:"Copy words to clipboard",icon:"fa-copy",exec:()=>{const e=(r.mode==="zen"?A.getHistory():F.list.slice(0,A.getHistory().length)).join(" ");navigator.clipboard.writeText(e).then(()=>{f("Copied to clipboard",1)},()=>{f("Failed to copy!",-1)})},available:()=>Ie}];let Bf=!1;function v1(e){document.documentElement.style.setProperty("--font",'"'+e.replaceAll(/_/g," ")+'", "Roboto Mono", "Vazirmatn"'),Ed(),Bf=!0}function Rf(){Bf&&(v1(r.fontFamily),Bf=!1)}function uL(){const e=window.navigator.userAgent.toLowerCase(),t=e.includes("mac")&&!e.includes("firefox")?"cmd":"ctrl",a=r.quickRestart==="esc"?"tab":"esc";L("footer .keyTips")?.setHtml(`
    ${r.quickRestart==="off"?"<key>tab</key> + <key>enter</key>":`<key>${r.quickRestart}</key>`} - restart test<br>
    <key>${a}</key> or <key>${t}</key>+<key>shift</key>+<key>p</key> - command line`)}window.addEventListener("beforeunload",e=>{Dd(r.mode,r.words,r.time,xo(),to()??!1)||Me&&(e.preventDefault(),e.returnValue="")});const fL=Bt(250,()=>{pe()==="test"&&!Ie&&(r.tapeMode!=="off"?qd():($v(),Ed()),setTimeout(()=>{hm(),nl(),i0()},250))}),pL=ey(250,()=>{Gr()});window.addEventListener("resize",()=>{pL(),fL()});Ce(async({key:e})=>{if(e==="quickRestart"&&uL(),e==="showKeyTips"){const t=L("footer .keyTips");r.showKeyTips?t?.removeClass("hidden"):t?.addClass("hidden")}e==="fontFamily"&&await xr()});const mL={punctuation:{subgroup:{options:"fromSchema",afterExec:()=>{R()}}},numbers:{subgroup:{options:"fromSchema",afterExec:()=>{R()}}},words:{alias:"words",subgroup:{options:[10,25,50,100],afterExec:()=>{ie(),R()}},input:{inputValueConvert:Number,afterExec:()=>{ie(),R()}}},time:{subgroup:{options:[15,30,60,120],afterExec:()=>{ie(),R()}},input:{inputValueConvert:Number,afterExec:()=>{ie(),R()}}},mode:{subgroup:{options:"fromSchema",afterExec:()=>{ie(),R()}}},quoteLength:{alias:"quotes",subgroup:{options:[[0,1,2,3],[0],[1],[2],[3],[-3]],configValueMode:()=>"include",isAvailable:e=>{if(e[0]===-3)return _},display:e=>ui(e,[0,1,2,3])?"all":{0:"short",1:"medium",2:"long",3:"thicc","-3":"favorite"}[e[0]],afterExec:()=>{R()}}},language:{subgroup:{options:"fromSchema",display:e=>Ra(e)}},difficulty:{subgroup:{options:"fromSchema"}},quickRestart:{subgroup:{options:"fromSchema"}},repeatQuotes:{subgroup:{options:"fromSchema"}},blindMode:{subgroup:{options:"fromSchema"}},alwaysShowWordsHistory:{subgroup:{options:"fromSchema"}},singleListCommandLine:{subgroup:{options:"fromSchema"}},minWpm:{display:"Minimum speed...",alias:"wpm",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minWpmCustomSpeed",inputValueConvert:e=>{let t=Number(e);return t=bt(r.typingSpeedUnit).toWpm(t),t}}},minAcc:{display:"Minimum accuracy...",subgroup:{options:["off"]},input:{configValue:"custom",display:"custom...",secondKey:"minAccCustom",inputValueConvert:e=>Number(e)}},britishEnglish:{subgroup:{options:"fromSchema",afterExec:()=>{R()}}},customLayoutfluid:{input:{defaultValue:()=>r.customLayoutfluid.join(" "),inputValueConvert:e=>e.trim().split(" ")}},customPolyglot:{input:{defaultValue:()=>r.customPolyglot.join(" "),inputValueConvert:e=>e.trim().split(" "),afterExec:()=>{pe()==="test"&&R()}}},freedomMode:{subgroup:{options:"fromSchema"}},strictSpace:{subgroup:{options:"fromSchema"}},oppositeShiftMode:{subgroup:{options:"fromSchema",afterExec:()=>{sa()}}},stopOnError:{subgroup:{options:"fromSchema"}},confidenceMode:{subgroup:{options:"fromSchema"}},quickEnd:{subgroup:{options:"fromSchema"}},indicateTypos:{subgroup:{options:"fromSchema"}},compositionDisplay:{subgroup:{options:"fromSchema"}},hideExtraLetters:{subgroup:{options:"fromSchema"}},lazyMode:{subgroup:{options:"fromSchema",afterExec:()=>R()}},layout:{subgroup:{options:"fromSchema",display:e=>e==="default"?"off":e.replace(/_/g," "),afterExec:()=>R()}},codeUnindentOnBackspace:{subgroup:{options:"fromSchema"}},soundVolume:{subgroup:{options:[.1,.5,1],display:e=>new Map([[.1,"quiet"],[.5,"medium"],[1,"loud"]]).get(e)??"custom...",afterExec:()=>Ki},input:{inputValueConvert:Number}},playSoundOnClick:{alias:"play",display:"Sound on click...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"click",2:"beep",3:"pop",4:"nk creams",5:"typewriter",6:"osu",7:"hitmarker",8:"sine",9:"sawtooth",10:"square",11:"triangle",12:"pentatonic",13:"wholetone",14:"fist fight",15:"rubber keys"})[e],hover:e=>{e!=="off"&&o4(e)},afterExec:()=>{Ki()}}},playSoundOnError:{alias:"play",display:"Sound on error...",subgroup:{options:"fromSchema",display:e=>({off:"off",1:"damage",2:"triangle",3:"square",4:"punch miss"})[e],hover:e=>{e!=="off"&&i4(e)},afterExec:()=>{kd()}}},playTimeWarning:{alias:"sound",subgroup:{options:"fromSchema",display:e=>e==="off"?"off":`${e} second${e!=="1"?"s":""}`,afterExec:e=>{e!=="off"&&Pc()},hover:e=>{e!=="off"&&Pc()}}},smoothCaret:{subgroup:{options:"fromSchema"}},caretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot","monkey"].includes(e)}},paceCaret:{display:"Pace caret mode...",subgroup:{options:["off","pb","tagPb","last","average","daily"],afterExec:()=>{R()}},input:{secondKey:"paceCaretCustomSpeed",configValue:"custom",inputValueConvert:e=>{let t=Number(e);return t=bt(r.typingSpeedUnit).toWpm(t),t},afterExec:()=>{R()}}},repeatedPace:{subgroup:{options:"fromSchema"}},paceCaretStyle:{subgroup:{options:"fromSchema",isVisible:e=>!["banana","carrot","monkey"].includes(e)}},liveSpeedStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveAccStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},liveBurstStyle:{subgroup:{options:"fromSchema"},alias:"wpm"},timerStyle:{subgroup:{options:"fromSchema",display:e=>e.replaceAll(/_/g," ")},alias:"timer"},timerColor:{display:"Live progress color...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},timerOpacity:{display:"Live progress opacity...",alias:"timer speed wpm burst acc",subgroup:{options:"fromSchema",alias:()=>"timer"}},highlightMode:{subgroup:{options:"fromSchema"}},tapeMode:{subgroup:{options:"fromSchema"}},tapeMargin:{input:{inputValueConvert:Number}},smoothLineScroll:{subgroup:{options:"fromSchema"}},showAllLines:{subgroup:{options:"fromSchema"}},typingSpeedUnit:{subgroup:{options:"fromSchema",isVisible:e=>e!=="wph"}},alwaysShowDecimalPlaces:{subgroup:{options:"fromSchema"}},startGraphsAtZero:{subgroup:{options:"fromSchema"}},maxLineWidth:{input:{alias:"page",inputValueConvert:Number}},fontSize:{input:{inputValueConvert:Number}},fontFamily:{subgroup:{options:lt(mo).sort((e,t)=>(mo[e]?.display??e.replace(/_/g," ")).localeCompare(mo[t]?.display??t.replace(/_/g," "))),display:e=>mo[e]?.display??e.replaceAll(/_/g," "),customData:e=>{const t=mo[e];return t===void 0?{}:{name:e.replaceAll(/_/g," "),isSystem:t.systemFont===!0,display:t.display}},hover:e=>v1(e)}},keymapMode:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="react"?"flash":""}},keymapStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapLegendStyle:{subgroup:{options:"fromSchema"},alias:"keyboard"},keymapSize:{input:{alias:"keyboard",inputValueConvert:Number}},keymapLayout:{alias:"keyboard",subgroup:{options:"fromSchema",alias:e=>e==="overrideSync"?"default":"",display:e=>e==="overrideSync"?"emulator sync":e.replace(/_/g," "),afterExec:()=>R()}},keymapShowTopRow:{subgroup:{options:"fromSchema"},alias:"keyboard"},customTheme:{subgroup:{options:"fromSchema"}},flipTestColors:{subgroup:{options:"fromSchema"}},colorfulMode:{subgroup:{options:"fromSchema"}},customBackground:{input:{}},customBackgroundSize:{subgroup:{options:"fromSchema"}},randomTheme:{subgroup:{options:"fromSchema",isAvailable:e=>e==="custom"?_:void 0}},showKeyTips:{subgroup:{options:"fromSchema"},display:"Key tips..."},showOutOfFocusWarning:{subgroup:{options:"fromSchema"},display:"Out of focus warning..."},capsLockWarning:{subgroup:{options:"fromSchema"}},showAverage:{subgroup:{options:"fromSchema"}},showPb:{subgroup:{options:"fromSchema"},alias:"pb"},monkeyPowerLevel:{alias:"powermode",isVisible:!1,subgroup:{options:"fromSchema",display:e=>({off:"off",1:"mellow",2:"high",3:"ultra",4:"over 9000"})[e]}},monkey:{subgroup:{options:"fromSchema"}},ads:{subgroup:{options:"fromSchema"}}};function Wf(e){if(e instanceof I.ZodLiteral)return[e.value];if(e instanceof I.ZodEnum)return e.options;if(e instanceof I.ZodBoolean)return[!0,!1];if(e instanceof I.ZodUnion)return e.options.flatMap(Wf).filter(t=>t!==void 0)}function De(e){const t=Tp[e],a=mL[e],o=zr.shape[e];return gL(e,t,a,o)}function gL(e,t,a,o){if(a==null)throw new Error(`No commandline metadata found for config key "${e}".`);let i;if("subgroup"in a&&a.subgroup!==void 0&&(i=hL(e,a.display,a.alias,a.subgroup,t,o)),"input"in a&&a.input!==void 0){const n=a.input,l=yL({key:"secondKey"in n?n.secondKey:e,isPartOfSubgruop:"subgroup"in a,inputProps:n,configMeta:t,schema:"secondKey"in n?zr.shape[n.secondKey]:o});if(i===void 0)return l;i.subgroup?.list.push(l)}if(i===void 0)throw new Error(`Nothing returned for config key "${e}". This is a bug in the commandline metadata.`);return i}function hL(e,t,a,o,i,n){if(o===null)throw new Error(`No commandline metadata found for config key "${e}".`);const l=t??`${Pt(i?.displayString??e)}...`;let c=o.options??Wf(n);if(c==="fromSchema"&&(c=Wf(n)),c===void 0)throw new Error(`Unsupported schema type for key "${e}": ${n._def.typeName}`);const d=c.map(u=>bL(e,u,o));return d.sort((u,m)=>u.configValue==="off"||u.configValue===!1?-1:m.configValue==="off"||m.configValue===!1?1:0),{id:`change${Pt(e)}`,display:l,icon:i?.icon??"fa-cog",subgroup:{title:l,configKey:e,list:d},alias:a}}function bL(e,t,{afterExec:a,hover:o,display:i,alias:n,configValueMode:l,isVisible:c,isAvailable:d,customData:u}){const m=t;let p=i?.(t);return p===void 0&&(t===!0?p="on":t===!1?p="off":p=t.toString()),{id:`set${Pt(e)}${Pt(m.toString())}`,display:p,configValueMode:l?.(t),alias:n?.(t)??void 0,configValue:m,visible:c?.(t)??void 0,available:d?.(t)??void 0,exec:()=>{v(e,m),a?.(m)},hover:o!==void 0?()=>{o?.(m)}:void 0,customData:u?.(m)??void 0}}function yL({key:e,isPartOfSubgruop:t,inputProps:a,configMeta:o,schema:i}){const n=a?.validation??{schema:!0},l=a?.display??(t?"custom...":`${Pt(o.displayString??e)}...`),c={id:`set${Pt(e)}Custom`,defaultValue:a?.defaultValue??(()=>r[e]?.toString()??""),configValue:a!==void 0&&"configValue"in a?a.configValue??void 0:void 0,display:l,alias:a?.alias??void 0,input:!0,icon:o.icon??"fa-cog",exec:({input:d})=>{d!==void 0&&(v(e,d),a?.afterExec?.(d))},hover:a?.hover};return a?.inputValueConvert!==void 0&&(c.inputValueConvert=a.inputValueConvert),c.validation={schema:n.schema===!0?i:void 0,isValid:n.isValid},c}const vL=De("customBackground"),wL={id:"customBackground",display:"Custom background...",icon:"fa-image",subgroup:{title:"Custom background...",list:[vL,{id:"customLocalBackground",display:"Local background...",icon:"fa-file-import fa-fw",alias:"upload background",available:async()=>!await it.hasFile("LocalBackgroundFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async a=>{const o=a.target.files?.[0];if(!o){t();return}if(!o.type.match(/image\/(jpeg|jpg|png|gif|webp)/)){f("Unsupported image format",0),t();return}const i=new FileReader;i.onload=async n=>{const l=n.target?.result;try{await it.storeFile("LocalBackgroundFile",l),await rs(),await _r()}catch(c){f("Error uploading background: "+c.message,0)}t()},i.onerror=t,i.readAsDataURL(o)},e.click()}},{id:"removeLocalBackground",display:"Remove local background",icon:"fa-trash",alias:"remove background",available:async()=>await it.hasFile("LocalBackgroundFile"),exec:async()=>{try{await it.deleteFile("LocalBackgroundFile"),await rs(),await _r()}catch(e){f("Error removing background: "+e.message,0)}}}]}},CL=[wL],zf=De("fontFamily");zf.subgroup&&zf.subgroup.list.push({id:"customFont",display:"Custom font...",icon:"fa-font",alias:"custom font options",subgroup:{title:"Custom font...",list:[{id:"customFontName",display:"Custom name...",icon:"fa-font",alias:"custom font name",input:!0,defaultValue:()=>r.fontFamily.replace(/_/g," "),exec:({input:e})=>{if(e===void 0||e==="")return;const t=e.replaceAll(/ /g,"_");v("fontFamily",t)}},{id:"customLocalFont",display:"Local font...",icon:"fa-file-import fa-fw",alias:"upload font",available:async()=>!await it.hasFile("LocalFontFamilyFile"),exec:async()=>{const e=document.createElement("input");e.type="file",e.accept="font/woff,font/woff2,font/ttf,font/otf",e.style.display="none",document.body.appendChild(e);const t=()=>{document.body.removeChild(e)};e.onchange=async a=>{const o=a.target.files?.[0];if(!o){t();return}if(!o.type.match(/font\/(woff|woff2|ttf|otf)/)&&!o.name.match(/\.(woff|woff2|ttf|otf)$/i)){f("Unsupported font format, must be woff, woff2, ttf or otf.",0),t();return}const i=new FileReader;i.onload=async n=>{const l=n.target?.result;try{await it.storeFile("LocalFontFamilyFile",l),await xr(),await Er()}catch(c){f("Error uploading font: "+c.message,0)}t()},i.onerror=t,i.readAsDataURL(o)},e.click()}},{id:"removeLocalFont",display:"Remove local font",icon:"fa-trash",alias:"remove font",available:async()=>await it.hasFile("LocalFontFamilyFile"),exec:async()=>{try{await it.deleteFile("LocalFontFamilyFile"),await Er(),await xr()}catch(e){f("Error removing font: "+e.message,0)}}}]}});const kL=[zf],SL={title:"Custom background filter...",configKey:"customBackgroundFilter",list:[{id:"setCustomBackgroundBlur",display:"blur...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[0].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[0]=parseFloat(e),v("customBackgroundFilter",t)}},{id:"setCustomBackgroundBrightness",display:"brightness...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[1].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[1]=parseFloat(e),v("customBackgroundFilter",t)}},{id:"setCustomBackgroundSaturation",display:"saturation...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[2].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[2]=parseFloat(e),v("customBackgroundFilter",t)}},{id:"setCustomBackgroundOpacity",display:"opacity...",icon:"fa-image",input:!0,defaultValue:()=>r.customBackgroundFilter[3].toString(),exec:({input:e})=>{if(e===void 0||e==="")return;const t=r.customBackgroundFilter;t[3]=parseFloat(e),v("customBackgroundFilter",t)}}]},xL=[{id:"setCustomBackgroundFilter",display:"Custom background filter...",icon:"fa-image",subgroup:SL}],TL=[{id:"addThemeToFavorite",display:"Add current theme to favorite",icon:"fa-star",available:()=>!r.customTheme&&!r.favThemes.includes(je??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:a}=r,o=je??e;!a&&!t.includes(o)&&v("favThemes",[...t,o])}},{id:"removeThemeFromFavorite",display:"Remove current theme from favorite",icon:"fa-star",iconType:"regular",available:()=>!r.customTheme&&r.favThemes.includes(je??r.theme),exec:()=>{const{theme:e,favThemes:t,customTheme:a}=r,o=je??e;!a&&t.includes(o)&&v("favThemes",[...t.filter(i=>i!==o)])}}],Hf=e=>e.replaceAll(" ","_"),db=async e=>{const t=G2.safeParse(Hf(e));return t.success?!0:t.error.errors.map(a=>a.message).join(", ")},LL={add:new fe({id:"addTag",title:"Add new tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:db,debounceDelay:0}}],onlineOnly:!0,buttonText:"add",execFn:async(e,t)=>{const a=Hf(t),o=await $.users.createTag({body:{tagName:a}});return o.status!==200?{status:-1,message:"Failed to add tag: "+o.body.message.replace(a,t),notificationOptions:{response:o}}:(S()?.tags?.push({display:t,name:o.body.data.name,_id:o.body.data._id,personalBests:{time:{},words:{},quote:{},zen:{},custom:{}}}),bo(),{status:1,message:"Tag added"})}}),edit:new fe({id:"editTag",title:"Edit tag",inputs:[{placeholder:"tag name",type:"text",validation:{isValid:db,debounceDelay:0}}],onlineOnly:!0,buttonText:"save",beforeInitFn:e=>{e.inputs[0].initVal=e.parameters[0]},execFn:async(e,t)=>{const a=Hf(t),o=e.parameters[1],i=await $.users.editTag({body:{tagId:o,newName:a}});return i.status!==200?{status:-1,message:"Failed to edit tag",notificationOptions:{response:i}}:(S()?.tags?.forEach(n=>{n._id===o&&(n.name=a,n.display=t)}),bo(),{status:1,message:"Tag updated"})}}),remove:new fe({id:"removeTag",title:"Delete tag",onlineOnly:!0,buttonText:"delete",beforeInitFn:e=>{e.text=`Are you sure you want to delete tag ${e.parameters[0]} ?`},execFn:async e=>{const t=e.parameters[1],a=await $.users.deleteTag({params:{tagId:t}});return a.status!==200?{status:-1,message:"Failed to remove tag",notificationOptions:{response:a}}:(S()?.tags?.forEach((o,i)=>{o._id===t&&S()?.tags?.splice(i,1)}),bo(),{status:1,message:"Tag removed"})}}),clearPb:new fe({id:"clearTagPb",title:"Clear personal bests",onlineOnly:!0,buttonText:"clear",beforeInitFn:e=>{e.text=`Are you sure you want to clear personal bests for tag ${e.parameters[0]} ?`},execFn:async e=>{const t=e.parameters[1],a=await $.users.deleteTagPersonalBest({params:{tagId:t}});return a.status!==200?{status:-1,message:"Failed to clear tag pb",notificationOptions:{response:a}}:(bo(),{status:1,message:"Tag PB cleared"})}})};function Gs(e,t,a,o){const i={modalChain:o,focusFirstInput:"focusAndSelect"};e!=="add"&&(a===void 0||t===void 0)||LL[e].show([a??"",t??""],i)}const Qs={title:"Tags...",list:[],beforeList:()=>{$L()}},w1=[{id:"changeTags",display:"Tags...",icon:"fa-tag",subgroup:Qs,available:()=>_()}];function $L(){const e=S();if(Qs.list=[],e!==void 0&&e.tags!==void 0&&e.tags.length>0){Qs.list.push({id:"clearTags",display:"Clear tags",icon:"fa-times",sticky:!0,exec:async()=>{const t=S();t&&(t.tags=t.tags?.map(a=>(a.active=!1,a)),dt(t),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Ic(),sa(),qs())}});for(const t of e.tags)Qs.list.push({id:"toggleTag"+t._id,display:t.display,sticky:!0,active:()=>S()?.tags?.find(a=>a._id===t._id)?.active??!1,exec:async()=>{qm(t._id),(r.paceCaret==="average"||r.paceCaret==="tagPb"||r.paceCaret==="daily")&&await Ic(),sa()}})}Qs.list.push({id:"createTag",display:"Create tag",icon:"fa-plus",shouldFocusTestUI:!1,opensModal:!0,exec:({commandlineModal:t})=>{Gs("add",void 0,void 0,t)}})}const Of={title:"Custom themes list...",beforeList:()=>AL(),list:[]},ML=[{id:"setCustomThemeId",display:"Custom themes...",icon:"fa-palette",subgroup:Of,available:()=>_()}];function AL(){if(!_())return;Of.list=[];const e=S();if(e&&e.customThemes!==void 0&&e.customThemes?.length!==0)for(const t of e.customThemes)Of.list.push({id:"setCustomThemeId"+t._id,display:t.name.replace(/_/gi," "),configValue:t._id,hover:()=>{pm("custom",t.colors)},exec:()=>{v("customTheme",!0),v("customThemeColors",t.colors)}})}const he={presetType:"full",checkboxes:new Map(nd.options.map(e=>[e,!0])),setPresetToCurrent:!1};let Li=null;function lc(e,t,a){if(!nt()){f("You are offline",0,{duration:2});return}k1.show({focusFirstInput:!0,beforeAnimation:async()=>{s("#editPresetModal .modal .text").addClass("hidden"),qL(),Li??=new Ca(V("#editPresetModal .modal input"),{schema:Y2}),e==="add"?(s("#editPresetModal .modal").attr("data-action","add"),s("#editPresetModal .modal .popupTitle").html("Add new preset"),s("#editPresetModal .modal .submit").html("add"),Li.setValue(null),Li.getParent()?.removeClass("hidden"),s("#editPresetModal .modal input").removeClass("hidden"),s("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),s("#editPresetModal .modal .inputs").removeClass("hidden"),s("#editPresetModal .modal .presetType").removeClass("hidden"),s("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),he.presetType="full"):e==="edit"&&t!==void 0&&a!==void 0?(s("#editPresetModal .modal").attr("data-action","edit"),s("#editPresetModal .modal").attr("data-preset-id",t),s("#editPresetModal .modal .popupTitle").html("Edit preset"),s("#editPresetModal .modal .submit").html("save"),Li?.setValue(a),Li?.getParent()?.removeClass("hidden"),s("#editPresetModal .modal input").removeClass("hidden"),s("#editPresetModal .modal label.changePresetToCurrentCheckbox").removeClass("hidden"),s("#editPresetModal .modal .presetNameTitle").removeClass("hidden"),he.setPresetToCurrent=!1,await C1()):e==="remove"&&t!==void 0&&a!==void 0&&(s("#editPresetModal .modal").attr("data-action","remove"),s("#editPresetModal .modal").attr("data-preset-id",t),s("#editPresetModal .modal .popupTitle").html("Delete preset"),s("#editPresetModal .modal .submit").html("delete"),s("#editPresetModal .modal input").addClass("hidden"),s("#editPresetModal .modal label.changePresetToCurrentCheckbox").addClass("hidden"),s("#editPresetModal .modal .text").removeClass("hidden"),s("#editPresetModal .modal .deletePrompt").text(`Are you sure you want to delete the preset ${a}?`),s("#editPresetModal .modal .inputs").addClass("hidden"),s("#editPresetModal .modal .presetType").addClass("hidden"),s("#editPresetModal .modal .presetNameTitle").addClass("hidden"),Li?.getParent()?.addClass("hidden")),eg()}})}async function _L(e){for(const a of he.checkboxes.keys())he.checkboxes.set(a,!1);const t=await U9(e);if(t===void 0){f("Preset not found",-1);return}if(t.settingGroups===void 0||t.settingGroups===null){he.presetType="full";for(const a of he.checkboxes.keys())he.checkboxes.set(a,!0)}else he.presetType="partial",t.settingGroups.forEach(a=>he.checkboxes.set(a,!0));he.setPresetToCurrent=!1,eg()}function EL(){nd.options.forEach(t=>{const a=s(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${t}"] input`);a.on("change",o=>{he.checkboxes.set(t,a.prop("checked"))})});const e=s("#editPresetModal .modal .changePresetToCurrentCheckbox input");e.on("change",async()=>{he.setPresetToCurrent=e.prop("checked"),await C1()})}function qL(){function e(a){return a.replace(/([a-z])([A-Z])/g,"$1 $2")}const t=s("#editPresetModal .modal .inputs .checkboxList").empty();nd.options.forEach(a=>{const o=e(a),i=`<label class="checkboxTitlePair" data-id="${a}">
              <input type="checkbox" />
              <div class="title">${o}</div>
              </label>`;t.append(i)});for(const a of he.checkboxes.keys())he.checkboxes.set(a,!0);EL()}function eg(){nd.options.forEach(e=>{s(`#editPresetModal .modal .checkboxList .checkboxTitlePair[data-id="${e}"] input`).prop("checked",he.checkboxes.get(e))}),s("#editPresetModal .modal .presetType button").removeClass("active"),s(`#editPresetModal .modal .presetType button[value="${he.presetType}"]`).addClass("active"),s("#editPresetModal .modal .partialPresetGroups").removeClass("hidden"),he.presetType==="full"&&s("#editPresetModal .modal .partialPresetGroups").addClass("hidden")}async function C1(){if(s("#editPresetModal .modal label.changePresetToCurrentCheckbox input").prop("checked",he.setPresetToCurrent),he.setPresetToCurrent){const e=s("#editPresetModal .modal").attr("data-preset-id");await _L(e),s("#editPresetModal .modal .inputs").removeClass("hidden"),s("#editPresetModal .modal .presetType").removeClass("hidden")}else s("#editPresetModal .modal .inputs").addClass("hidden"),s("#editPresetModal .modal .presetType").addClass("hidden")}function IL(){k1.hide()}async function DL(){const e=s("#editPresetModal .modal").attr("data-action"),t=s("#editPresetModal .modal input").val(),a=t.replaceAll(" ","_"),o=s("#editPresetModal .modal").attr("data-preset-id"),i=s("#editPresetModal .modal label input").prop("checked"),n=S()?.presets??[];if(e===void 0)return;if(["add","edit"].includes(e)&&he.presetType==="partial"&&Array.from(he.checkboxes.values()).every(d=>!d)){f("At least one setting group must be active while saving partial presets",0);return}if(e==="add"||e==="edit"){if(a.replace(/^_+|_+$/g,"").length===0){f("Preset name cannot be empty",0);return}if(Li?.getValidationResult().status==="failed"){f("Preset name is not valid",0);return}}if(IL(),oe(),e==="add"){const d=ub(),u=vu(),m=await $.presets.add({body:{name:a,config:d,...he.presetType==="partial"&&{settingGroups:u}}});m.status!==200||m.body.data===null?f("Failed to add preset"+m.body.message.replace(a,t),-1):(f("Preset added",1,{duration:2}),n.push({name:a,config:d,...he.presetType==="partial"&&{settingGroups:u},display:t,_id:m.body.data.presetId}))}else if(e==="edit"){const d=n.find(g=>g._id===o);if(d===void 0){f("Preset not found",-1);return}const u=ub(),m=he.presetType==="partial"?vu():null,p=await $.presets.save({body:{_id:o,name:a,...i&&{config:u,settingGroups:m}}});p.status!==200?f("Failed to edit preset",-1,{response:p}):(f("Preset updated",1),d.name=a,d.display=a.replace(/_/g," "),i&&(d.config=u,he.presetType==="partial"?d.settingGroups=vu():d.settingGroups=null))}else if(e==="remove"){const d=await $.presets.delete({params:{presetId:o}});d.status!==200?f("Failed to remove preset",-1,{response:d}):(f("Preset removed",1),n.forEach((u,m)=>{u._id===o&&n.splice(m,1)}))}bo(),j()}function FL(e){return Tp[e].group}function PL(e){const t={},a=Pa();return Object.keys(a).filter(o=>{const i=FL(o);return i===null?!1:he.checkboxes.get(i)===!0}).forEach(o=>{const i=o,n=e[i]??a[i];t[i]=n}),t}function vu(){return Array.from(he.checkboxes.entries()).filter(([,e])=>e).map(([e])=>e)}function ub(){const e=he.presetType==="partial"?PL(oh()):oh(),a=(S()?.tags??[]).filter(i=>i.active).map(i=>i._id),o=he.presetType==="full"||he.checkboxes.get("behavior")===!0;return{...e,...o&&{tags:a}}}async function BL(e){e.addEventListener("submit",t=>{t.preventDefault(),DL()}),Q2.options.forEach(t=>{const a=e.querySelector(`.presetType button[value="${t}"]`);a!==null&&a.addEventListener("click",()=>{he.presetType=t,eg()})})}const k1=new ue({dialogId:"editPresetModal",setup:BL}),cc={title:"Presets...",list:[],beforeList:()=>{WL()}},RL=[{visible:!1,id:"applyPreset",display:"Presets...",icon:"fa-sliders-h",subgroup:cc,available:()=>_()}];function WL(){const e=S();cc.list=[],!(!e?.presets||e.presets.length===0)&&(e.presets.forEach(t=>{const a=t.display;cc.list.push({id:"applyPreset"+t._id,display:a,exec:async()=>{ps(!0),await mw(t._id),ps(!1),bo(),sa()}})}),cc.list.push({id:"createPreset",display:"Create preset",icon:"fa-plus",exec:()=>{lc("add")}}))}const S1=[{id:"changeFunboxNone",display:"none",configValue:"none",alias:"off",sticky:!0,exec:()=>{ie(),J6([])&&R()}}];for(const e of up())S1.push({id:"changeFunbox"+e.name,display:e.name.replace(/_/g," "),available:()=>{const t=na();return t.includes(e.name)?!0:Wr(t,e.name)},sticky:!0,alias:e.alias,configValue:e.name,configValueMode:"include",exec:()=>{Ev(e.name),ie(),R()}});const zL={title:"Funbox...",configKey:"funbox",list:S1},x1=[{id:"changeFunbox",display:"Funbox...",alias:"fun box",icon:"fa-gamepad",subgroup:zL}],Nf=e=>r.favThemes.includes(e.name),T1=e=>({id:"changeTheme"+an(e.name),display:e.name.replace(/_/g," "),configValue:e.name,customData:{mainColor:e.mainColor,bgColor:e.bgColor,subColor:e.subColor,textColor:e.textColor,isFavorite:Nf(e)},hover:()=>{pm(e.name)},exec:()=>{v("theme",e.name)}}),L1=e=>[...e.filter(Nf),...e.filter(X2(Nf))],Uf={title:"Theme...",configKey:"theme",list:L1(il).map(e=>T1(e))},$1=[{id:"changeTheme",display:"Theme...",icon:"fa-palette",subgroup:Uf}];function HL(e){Uf.list=[],Uf.list=L1(e).map(t=>T1(t))}Ce(({key:e})=>{if(e==="favThemes")try{HL(il)}catch(t){console.error(se(t,"Failed to update themes commands"))}});const M1={title:"Load challenge...",list:[]},A1=[{id:"loadChallenge",display:"Load challenge...",icon:"fa-award",subgroup:M1}];function OL(e){e.forEach(t=>{M1.list.push({id:"loadChallenge"+an(t.name),display:t.display,exec:async()=>{await Ke("/"),await Ov(t.name),R({nosave:!0})}})})}const Zc=s("#wordFilterModal #exactMatchOnly"),_1={homeKeys:{display:"home keys",getIncludeString:e=>{const t=e.keys.row3.slice(0,4),a=e.keys.row3.slice(6,10);return[...t,...a]},exactMatch:!0},leftHand:{display:"left hand",getIncludeString:e=>{const t=e.keys.row2.slice(0,5),a=e.keys.row3.slice(0,5),o=e.keys.row4.slice(0,5);return[...t,...a,...o]},exactMatch:!0},rightHand:{display:"right hand",getIncludeString:e=>{const t=e.keys.row2.slice(5),a=e.keys.row3.slice(5),o=e.keys.row4.slice(4);return[...t,...a,...o]},exactMatch:!0},homeRow:{display:"home row",getIncludeString:e=>e.keys.row3,exactMatch:!0},topRow:{display:"top row",getIncludeString:e=>e.keys.row2,exactMatch:!0},bottomRow:{display:"bottom row",getIncludeString:e=>e.keys.row4,exactMatch:!0}};async function NL(){s("#wordFilterModal .languageInput").empty(),s("#wordFilterModal .layoutInput").empty(),s("wordFilterModal .presetInput").empty(),Qp.forEach(e=>{const t=e.replace(/_/gi," ");s("#wordFilterModal .languageInput").append(`
        <option value=${e}>${t}</option>
      `)});for(const e of Vc){const t=e.replace(/_/gi," ");s("#wordFilterModal .layoutInput").append(`
      <option value=${e}>${t}</option>
    `)}for(const[e,t]of Object.entries(_1))s("#wordFilterModal .presetInput").append(`<option value=${e}>${t.display}</option>`)}let Vf,Kf,jf;async function UL(e){Hn.show({...e,beforeAnimation:async t=>{Vf=new et({select:"#wordFilterModal .languageInput",settings:{contentLocation:t}}),Kf=new et({select:"#wordFilterModal .layoutInput",settings:{contentLocation:Hn.getModal()}}),jf=new et({select:"#wordFilterModal .presetInput",settings:{contentLocation:Hn.getModal()}}),s("#wordFilterModal .loadingIndicator").removeClass("hidden"),E1()}})}function VL(e){Hn.hide({...e})}async function KL(e){const t=Zc.is(":checked");let a=s("#wordFilterModal .wordIncludeInput").val();a=qg(a?.trim()),a=a.replace(/\s+/gi,"|");let o;t?o=new RegExp("^["+a+"]+$","i"):o=new RegExp(a,"i");let i=s("#wordFilterModal .wordExcludeInput").val();i=qg(i.trim()),i=i.replace(/\s+/gi,"|");const n=new RegExp(i,"i"),l=[],{data:c,error:d}=await jt(ii(e));if(d)return f(se(d,"Failed to filter language words"),-1),[];const u=s("#wordFilterModal .wordMaxInput").val(),m=s("#wordFilterModal .wordMinInput").val();let p,g;u===""?p=999:p=parseInt(u),m===""?g=1:g=parseInt(m);for(const h of c.words){const y=o.test(h),k=t?!1:n.test(h);(y&&!k||y&&i==="")&&h.length<=p&&h.length>=g&&l.push(h)}return l}async function fb(e){const t=s("#wordFilterModal .languageInput").val(),a=await KL(t);if(a.length===0){f("No words found",0),E1();return}const o=a.join(Ls()?"|":" ");VL({modalChainData:{text:o,set:e}})}function wu(e){const t=s("#wordFilterModal #wordExcludeInput");e?(s("#wordFilterModal #wordExcludeInput").val(""),t.attr("disabled","disabled")):t.removeAttr("disabled"),Zc.prop("checked",e)}function pb(){for(const e of Hn.getModal().querySelectorAll("button"))e.setAttribute("disabled","true")}function E1(){for(const e of Hn.getModal().querySelectorAll("button"))e.removeAttribute("disabled")}async function jL(){await NL(),s("#wordFilterModal button.generateButton").on("click",async()=>{const e=s("#wordFilterModal .presetInput").val(),t=s("#wordFilterModal .layoutInput").val(),a=_1[e];if(a===void 0){f(`Preset ${e} not found`,-1);return}const o=await zi(t);s("#wordIncludeInput").val(a.getIncludeString(o).map(i=>i[0]).join(" ")),a.exactMatch===!0?wu(!0):(wu(!1),a.getExcludeString!==void 0&&s("#wordExcludeInput").val(a.getExcludeString(o).map(i=>i[0]).join(" ")))}),Zc.on("change",()=>{wu(Zc.is(":checked"))}),s("#wordFilterModal button.addButton").on("click",()=>{s("#wordFilterModal .loadingIndicator").removeClass("hidden"),pb(),setTimeout(()=>{fb(!1)},0)}),s("#wordFilterModal button.setButton").on("click",()=>{s("#wordFilterModal .loadingIndicator").removeClass("hidden"),pb(),setTimeout(()=>{fb(!0)},0)})}async function GL(){Vf?.destroy(),Kf?.destroy(),jf?.destroy(),Vf=void 0,Kf=void 0,jf=void 0}const Hn=new ue({dialogId:"wordFilterModal",setup:jL,cleanup:GL}),mb={alphas:{display:"a-z",characters:"abcdefghijklmnopqrstuvwxyz".split("")},numbers:{display:"0-9",characters:"0123456789".split("")},special:{display:"symbols",characters:"!@#$%^&*()_+-=[]{}|;:',.<>?/`~".split("")},bigrams:{display:"bigrams",characters:["th","he","in","er","an","re","on","at","en","nd","ed","es","or","te","st","ar","ou","it","al","as"]},trigrams:{display:"trigrams",characters:["the","and","ing","ion","tio","ent","ati","for","her","ter","ate","ver","all","con","res","are","rea","int"]}};async function QL(e){q1.show({...e,beforeAnimation:async t=>{new et({select:"#customGeneratorModal .presetInput",settings:{contentLocation:t}})}})}function YL(){const e=s("#customGeneratorModal .presetInput").val();if(e!==void 0&&e!==""&&mb[e]){const t=mb[e];s("#customGeneratorModal .characterInput").val(t.characters.join(" "))}}function XL(e){q1.hide({...e})}function JL(){const e=s("#customGeneratorModal .characterInput").val(),t=parseInt(s("#customGeneratorModal .minLengthInput").val())||2,a=parseInt(s("#customGeneratorModal .maxLengthInput").val())||5,o=parseInt(s("#customGeneratorModal .wordCountInput").val())||100;if(!e||e.trim()==="")return f("Character set cannot be empty",0),[];const i=e.trim().split(/\s+/),n=[];for(let l=0;l<o;l++){const c=Math.floor(Math.random()*(a-t+1))+t;let d="";for(let u=0;u<c;u++){const m=i[Math.floor(Math.random()*i.length)];d+=m}n.push(d)}return n}async function gb(e){const t=JL();if(t.length===0)return;const a=t.join(Ls()?"|":" ");XL({modalChainData:{text:a,set:e}})}async function ZL(e){e.querySelector(".setButton")?.addEventListener("click",()=>{gb(!0)}),e.querySelector(".addButton")?.addEventListener("click",()=>{gb(!1)}),e.querySelector(".generateButton")?.addEventListener("click",()=>{YL()})}const q1=new ue({dialogId:"customGeneratorModal",setup:ZL});let{promise:I1,resolve:dc}=ci();async function e$(){if(!Xi()){f("Could not show register popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1),dc(void 0);return}await D1.show({mode:"dialog",beforeAnimation:async e=>{({promise:I1,resolve:dc}=ci()),Mo("register"),Is(e.querySelector(".g-recaptcha"),"register",t=>{dc(t),Gf()})}})}function Gf(e=!1){e&&dc(void 0),D1.hide()}const D1=new ue({dialogId:"registerCaptchaModal",customEscapeHandler:async()=>{Gf(!0)},customWrapperClickHandler:async()=>{Gf(!0)}}),tg=new nS,ag=new sS;async function F1(){if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}oe(),L(".sendVerificationEmail")?.disable();const e=await $.users.verificationEmail();L(".sendVerificationEmail")?.enable(),e.status!==200?(j(),f("Failed to request verification email",-1,{response:e})):(j(),f("Verification email sent",1))}async function t$(){try{console.log("getting account data");const e=await o5();if(e===!1)throw new Error("Snapshot didn't initialize due to lacking authentication even though user is authenticated");v5(e.uid,e.name),e.needsToChangeName&&Pi("You need to update your account name. <a class='openNameChange'>Click here</a> to change it and learn more about why.",-1,void 0,!0,void 0,!0);const t=JSON.stringify(r)===JSON.stringify(e.config);if(r===void 0||!t){console.log("no local config or local and db configs are different - applying db"),await Yn(e.config),xs(!0);for(const a of $t("applyGlobalCSS"))a.functions.applyGlobalCSS()}return!0}catch(e){if(console.error(e),oo(),L("header nav .view-account")?.setStyle({opacity:"1"}),e instanceof Sn)e.responseCode===429&&(f("Doing so will save you bandwidth, make the next test be ready faster and will not sign you out (which could mean your new personal best would not save to your account).",0,{duration:0}),f("You will run into this error if you refresh the website to restart the test. It is NOT recommended to do that. Instead, use tab + enter or just tab (with quick tab mode enabled) to restart the test.",0,{duration:0})),f("Failed to get user data: "+e.message,-1);else{const t=se(e,"Failed to get user data");f(t,-1)}return!1}}async function P1(e){if(!await t$()){ln();return}ld({type:"snapshotUpdated",data:{isInitial:!0}})}async function B1(e,t){console.debug("account controller ready");let a=Promise.resolve();e&&(console.debug(`auth state changed, user ${t?"true":"false"}`),console.debug(t),t?a=P1():dt(void 0)),(!e||!t)&&w5(),await Ke(void 0,{force:!0,loadingOptions:{loadingMode:()=>t!==null?"sync":"none",loadingPromise:async()=>{await a},style:"bar",keyframes:[{percentage:90,durationMs:1e3,text:"Downloading user data..."}]}}),ld({type:"authStateChanged",data:{isUserSignedIn:t!==null}})}async function a$(e,t){if(!ga()){f("Authentication uninitialized",-1);return}if(!nt()){f("You are offline",0,{duration:2});return}if(Vm(),Um(),dl(),e===""||t===""){f("Please fill in all fields",0),Xa(),oo(),Nm();return}const a=L(".pageLogin .login #rememberMe input")?.isChecked()??!1,{error:o}=await jt(_S(e,t,a));if(o!==null){f(o.message,-1),Xa(),oo(),Yi();return}}async function R1(e){if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}if(!nt()){f("You are offline",0,{duration:2});return}Vm(),Um(),dl();const t=L(".pageLogin .login #rememberMe input")?.isChecked()??!1,{error:a}=await jt(ES(e,t));if(a!==null){a.message!==""&&f(a.message,-1),Xa(),oo(),Yi();return}}async function o$(){return R1(tg)}async function i$(){return R1(ag)}async function n$(){return W1("Google",tg)}async function s$(){return W1("GitHub",ag)}async function W1(e,t){if(!nt()){f("You are offline",0,{duration:2});return}if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}oe();const a=ct();if(a)try{await rS(a,t),j(),f(`${e} authentication added`,1),ld({type:"authConfigUpdated"})}catch(o){j();const i=se(o,`Failed to add ${e} authentication`);f(i,-1)}}function ln(){if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}_()&&AS()}async function r$(){if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}if(!nt()){f("You are offline",0,{duration:2});return}await e$();const e=await I1;if(e===void 0||e===""){f("Please complete the captcha",-1);return}Um(),dl(),Vm();const t=j7();if(t===!1){Xa(),oo(),Yi(),f("Please fill in all fields",0);return}const{name:a,email:o,password:i}=t;try{const n=await qS(o,i),l=await $.users.create({body:{name:a,captcha:e,email:o,uid:n.user.uid}});if(l.status!==200)throw new Error(`Failed to sign in: ${l.body.message}`);await ry(n.user,{displayName:a}),await F1(),Xa(),await B1(!0,n.user),gy(),f("Account created",1)}catch(n){let l=se(n,"Failed to create account");n instanceof Error&&"code"in n&&n.code==="auth/email-already-in-use"&&(l=se({message:"Email already in use"},"Failed to create account")),f(l,-1),Xa(),oo(),Yi(),ln();return}}L(".pageLogin .login form")?.on("submit",e=>{e.preventDefault();const t=Za(".pageLogin .login input")?.[0]?.getValue()??"",a=Za(".pageLogin .login input")?.[1]?.getValue()??"";a$(t,a)});L(".pageLogin .login button.signInWithGoogle")?.on("click",()=>{o$()});L(".pageLogin .login button.signInWithGitHub")?.on("click",()=>{i$()});L("nav .accountButtonAndMenu .menu button.signOut")?.on("click",()=>{if(!ga()){f("Authentication uninitialized",-1,{duration:3});return}ln()});L(".pageLogin .register form")?.on("submit",e=>{e.preventDefault(),r$()});L(".pageAccountSettings")?.onChild("click","#addGoogleAuth",()=>{n$()});L(".pageAccountSettings")?.onChild("click","#addGithubAuth",()=>{s$()});L(".pageAccount")?.onChild("click",".sendVerificationEmail",()=>{if(!nt()){f("You are offline",0,{duration:2});return}F1()});const We={updateEmail:void 0,updateName:void 0,updatePassword:void 0,removeGoogleAuth:void 0,removeGithubAuth:void 0,removePasswordAuth:void 0,addPasswordAuth:void 0,deleteAccount:void 0,resetAccount:void 0,optOutOfLeaderboards:void 0,applyCustomFont:void 0,resetPersonalBests:void 0,resetSettings:void 0,revokeAllTokens:void 0,unlinkDiscord:void 0,editApeKey:void 0,deleteCustomText:void 0,deleteCustomTextLong:void 0,resetProgressCustomTextLong:void 0,updateCustomTheme:void 0,deleteCustomTheme:void 0,devGenerateData:void 0,lbGoToPage:void 0};function l$(e){const a=["password","github.com","google.com"].filter(o=>o!==e);for(const o of a)if(Od(o))return o}function ro(){return Od("password")}function c$(){return Od("github.com")}function d$(){return Od("google.com")}function Od(e){return ct()?.providerData.some(t=>t.providerId===e)??!1}async function ka(e){if(!ga())return{status:-1,message:"Authentication is not initialized"};const t=ct();if(t===null)return{status:-1,message:"User is not signed in"};const a=l$(e.excludeMethod);try{if(a===void 0)return{status:-1,message:"Failed to reauthenticate: there is no valid authentication present on the account."};if(a==="password"){if(e.password===void 0)return{status:-1,message:"Failed to reauthenticate using password: password missing."};const o=ly.credential(t.email,e.password);await cS(t,o)}else await dS(t,a==="github.com"?ag:tg);return{status:1,message:"Reauthenticated",user:t}}catch(o){const i=o;return i.code==="auth/wrong-password"?{status:0,message:"Incorrect password"}:i.code==="auth/invalid-credential"?{status:0,message:"Password is incorrect or your account does not have password authentication enabled."}:{status:-1,message:"Failed to reauthenticate: "+(i?.message??JSON.stringify(o))}}}We.updateEmail=new fe({id:"updateEmail",title:"Update email",inputs:[{placeholder:"Password",type:"password",initVal:""},{type:"text",placeholder:"New email",initVal:"",validation:{schema:bc}},{type:"text",placeholder:"Confirm new email",initVal:"",validation:{schema:bc,isValid:async(e,t)=>e===t.inputs?.[1]?.currentValue()||"Emails don't match",debounceDelay:0}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,o)=>{if(a!==o)return{status:0,message:"Emails don't match"};const i=await ka({password:t});if(i.status!==1)return{status:i.status,message:i.message};const n=await $.users.updateEmail({body:{newEmail:a,previousEmail:i.user.email}});return n.status!==200?{status:-1,message:"Failed to update email",notificationOptions:{response:n}}:(ln(),{status:1,message:"Email updated"})},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});We.removeGoogleAuth=new fe({id:"removeGoogleAuth",title:"Remove Google authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const a=await ka({password:t,excludeMethod:"google.com"});if(a.status!==1)return{status:a.status,message:a.message};try{await mp(a.user,"google.com")}catch(o){return{status:-1,message:se(o,"Failed to unlink Google account")}}return bi(),Ao(3),{status:1,message:"Google authentication removed"}},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],c$()||(e.buttonText="",e.text="Password or GitHub authentication is not enabled")))}});We.removeGithubAuth=new fe({id:"removeGithubAuth",title:"Remove GitHub authentication",inputs:[{placeholder:"Password",type:"password",initVal:""}],onlineOnly:!0,buttonText:"remove",execFn:async(e,t)=>{const a=await ka({password:t,excludeMethod:"github.com"});if(a.status!==1)return{status:a.status,message:a.message};try{await mp(a.user,"github.com")}catch(o){return{status:-1,message:se(o,"Failed to unlink GitHub account")}}return bi(),Ao(3),{status:1,message:"GitHub authentication removed"}},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],d$()||(e.buttonText="",e.text="Password or Google authentication is not enabled")))}});We.removePasswordAuth=new fe({id:"removePaswordAuth",title:"Remove Password authentication",inputs:[{type:"checkbox",label:"I understand I will lose access to my Monkeytype account if my Google/GitHub account is lost or disabled."}],onlineOnly:!0,buttonText:"reauthenticate to remove",execFn:async e=>{const t=await ka({excludeMethod:"password"});if(t.status!==1)return{status:t.status,message:t.message};try{await mp(t.user,"password")}catch(a){return{status:-1,message:se(a,"Failed to remove password authentication")}}return bi(),Ao(3),{status:1,message:"Password authentication removed"}},beforeInitFn:()=>{_()}});We.updateName=new fe({id:"updateName",title:"Update name",inputs:[{placeholder:"password",type:"password",initVal:""},{placeholder:"new name",type:"text",initVal:"",validation:{schema:Cs,isValid:cl(async e=>$.users.getNameAvailability({params:{name:e}}),{check:e=>e.available||"Name not available"}),debounceDelay:1e3}}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{const o=await ka({password:t});if(o.status!==1)return{status:o.status,message:o.message};const i=await $.users.updateName({body:{name:a}});if(i.status!==200)return{status:-1,message:"Failed to update name",notificationOptions:{response:i}};const n=S();return n&&(n.name=a,dt(n),n.needsToChangeName&&Ao(2)),{status:1,message:"Name updated"}},beforeInitFn:e=>{if(!_())return;const t=S();t&&(ro()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to update"),t.needsToChangeName===!0&&(e.text="You need to change your account name. This might be because you have a duplicate name, no account name or your name is not allowed (contains whitespace or invalid characters). Sorry for the inconvenience."))}});We.updatePassword=new fe({id:"updatePassword",title:"Update password",inputs:[{placeholder:"current password",type:"password",initVal:""},{placeholder:"new password",type:"password",initVal:"",validation:{schema:Xb}},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a,o)=>{if(a!==o)return{status:0,message:"New passwords don't match"};if(a===t)return{status:0,message:"New password must be different from previous password"};const i=await ka({password:t});if(i.status!==1)return{status:i.status,message:i.message};const n=await $.users.updatePassword({body:{newPassword:a}});return n.status!==200?{status:-1,message:"Failed to update password",notificationOptions:{response:n}}:(ln(),{status:1,message:"Password updated"})},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="",e.text="Password authentication is not enabled"))}});We.addPasswordAuth=new fe({id:"addPasswordAuth",title:"Add password authentication",inputs:[{placeholder:"email",type:"email",initVal:""},{placeholder:"confirm email",type:"email",initVal:""},{placeholder:"new password",type:"password",initVal:""},{placeholder:"confirm new password",type:"password",initVal:""}],buttonText:"reauthenticate to add",onlineOnly:!0,execFn:async(e,t,a,o,i)=>{if(t!==a)return{status:0,message:"Emails don't match"};if(o!==i)return{status:0,message:"Passwords don't match"};const n=await ka({password:o});if(n.status!==1)return{status:n.status,message:n.message};try{const c=ly.credential(t,o);await lS(n.user,c)}catch(c){return{status:-1,message:se(c,"Failed to add password authentication")}}const l=await $.users.updateEmail({body:{newEmail:t,previousEmail:n.user.email}});return l.status!==200?{status:-1,message:"Password authentication added but updating the database email failed. This shouldn't happen, please contact support. Error",notificationOptions:{response:l}}:(bi(),{status:1,message:"Password authentication added"})}});We.deleteAccount=new fe({id:"deleteAccount",title:"Delete account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"delete",onlineOnly:!0,execFn:async(e,t)=>{const a=await ka({password:t});if(a.status!==1)return{status:a.status,message:a.message};f("Deleting all data...",0);const o=await $.users.delete();return o.status!==200?{status:-1,message:"Failed to delete user data",notificationOptions:{response:o}}:(Ao(3),{status:1,message:"Account deleted, goodbye"})},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="reauthenticate to delete"))}});We.resetAccount=new fe({id:"resetAccount",title:"Reset account",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"This is the last time you can change your mind. After pressing the button everything is gone.",buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await ka({password:t});if(a.status!==1)return{status:a.status,message:a.message};f("Resetting settings...",0),await Mp(),await it.deleteFile("LocalBackgroundFile"),f("Resetting account...",0);const o=await $.users.reset();return o.status!==200?{status:-1,message:"Failed to reset account",notificationOptions:{response:o}}:(Ao(3),{status:1,message:"Account reset"})},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});We.optOutOfLeaderboards=new fe({id:"optOutOfLeaderboards",title:"Opt out of leaderboards",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to opt out of leaderboards?",buttonText:"opt out",onlineOnly:!0,execFn:async(e,t)=>{const a=await ka({password:t});if(a.status!==1)return{status:a.status,message:a.message};const o=await $.users.optOutOfLeaderboards();return o.status!==200?{status:-1,message:"Failed to opt out",notificationOptions:{response:o}}:(Ao(3),{status:1,message:"Leaderboards opt out successful"})},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="reauthenticate to opt out"))}});We.applyCustomFont=new fe({id:"applyCustomFont",title:"Custom font",inputs:[{type:"text",placeholder:"Font name",initVal:""}],text:"Make sure you have the font installed on your computer before applying",buttonText:"apply",execFn:async(e,t)=>(q.fontFamily?.setValue(t.replace(/\s/g,"_")),{status:1,message:"Font applied"})});We.resetPersonalBests=new fe({id:"resetPersonalBests",title:"Reset personal bests",inputs:[{placeholder:"password",type:"password",initVal:""}],buttonText:"reset",onlineOnly:!0,execFn:async(e,t)=>{const a=await ka({password:t});if(a.status!==1)return{status:a.status,message:a.message};const o=await $.users.deletePersonalBests();if(o.status!==200)return{status:-1,message:"Failed to reset personal bests",notificationOptions:{response:o}};const i=S();return i?(i.personalBests={time:{},words:{},quote:{},zen:{},custom:{}},{status:1,message:"Personal bests reset"}):{status:-1,message:"Failed to reset personal bests: no snapshot"}},beforeInitFn:e=>{_()&&(ro()||(e.inputs=[],e.buttonText="reauthenticate to reset"))}});We.resetSettings=new fe({id:"resetSettings",title:"Reset settings",text:"Are you sure you want to reset all your settings?",buttonText:"reset",onlineOnly:!0,execFn:async()=>(await Mp(),await it.deleteFile("LocalBackgroundFile"),{status:1,message:"Settings reset"})});We.revokeAllTokens=new fe({id:"revokeAllTokens",title:"Revoke all tokens",inputs:[{placeholder:"password",type:"password",initVal:""}],text:"Are you sure you want to do this? This will log you out of all devices.",buttonText:"revoke all",onlineOnly:!0,execFn:async(e,t)=>{const a=await ka({password:t});if(a.status!==1)return{status:a.status,message:a.message};const o=await $.users.revokeAllTokens();return o.status!==200?{status:-1,message:"Failed to revoke tokens",notificationOptions:{response:o}}:(Ao(3),{status:1,message:"Tokens revoked"})},beforeInitFn:e=>{!_()||!S()||ro()||(e.inputs[0].hidden=!0,e.buttonText="reauthenticate to revoke all tokens")}});We.unlinkDiscord=new fe({id:"unlinkDiscord",title:"Unlink Discord",text:"Are you sure you want to unlink your Discord account?",buttonText:"unlink",onlineOnly:!0,execFn:async()=>{const e=S();if(!e)return{status:-1,message:"Failed to unlink Discord: no snapshot"};const t=await $.users.unlinkDiscord();return t.status!==200?{status:-1,message:"Failed to unlink Discord",notificationOptions:{response:t}}:(e.discordAvatar=void 0,e.discordId=void 0,dt(e),bi(),{status:1,message:"Discord unlinked"})}});We.deleteCustomText=new fe({id:"deleteCustomText",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(l0(e.parameters[0],!1),ri("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});We.deleteCustomTextLong=new fe({id:"deleteCustomTextLong",title:"Delete custom text",text:"Are you sure?",buttonText:"delete",execFn:async e=>(l0(e.parameters[0],!0),ri("",void 0),{status:1,message:"Custom text deleted"}),beforeInitFn:e=>{e.text=`Are you sure you want to delete custom text ${e.parameters[0]}?`}});We.resetProgressCustomTextLong=new fe({id:"resetProgressCustomTextLong",title:"Reset progress for custom text",text:"Are you sure?",buttonText:"reset",execFn:async e=>{Ou(e.parameters[0],0);const t=Mc(e.parameters[0],!0);return So(t),{status:1,message:"Custom text progress reset"}},beforeInitFn:e=>{e.text=`Are you sure you want to reset your progress for custom text ${e.parameters[0]}?`}});We.updateCustomTheme=new fe({id:"updateCustomTheme",title:"Update custom theme",inputs:[{type:"text",placeholder:"name",initVal:""},{type:"checkbox",initVal:!1,label:"Update custom theme to current colors",optional:!0}],buttonText:"update",onlineOnly:!0,execFn:async(e,t,a)=>{const o=S();if(!o)return{status:-1,message:"Failed to update custom theme: no snapshot"};const i=o.customThemes?.find(d=>d._id===e.parameters[0]);if(i===void 0)return{status:-1,message:"Failed to update custom theme: theme not found"};let n=[];if(a==="true")for(const d of To)n.push(s(`.pageSettings .tabContent.customTheme #${d}[type='color']`).attr("value"));else n=i.colors;const l={name:t.replaceAll(" ","_"),colors:n};return await n5(i._id,l)?(v("customThemeColors",n),Fd(),{status:1,message:"Custom theme updated"}):{status:-1,message:"Failed to update custom theme"}},beforeInitFn:e=>{const t=S();if(!t)return;const a=t.customThemes?.find(o=>o._id===e.parameters[0]);a&&(e.inputs[0].initVal=a.name)}});We.deleteCustomTheme=new fe({id:"deleteCustomTheme",title:"Delete custom theme",text:"Are you sure?",buttonText:"delete",onlineOnly:!0,execFn:async e=>(await s5(e.parameters[0]),Fd(),{status:1,message:"Custom theme deleted"})});We.devGenerateData=new fe({id:"devGenerateData",title:"Generate data",showLabels:!0,inputs:[{type:"text",label:"username",placeholder:"username",oninput:e=>{const t=e.target,a=document.querySelector("#devGenerateData_1 + span");a.innerText=`if checked, user will be created with ${t.value}@example.com and password: password`},validation:{schema:Cs}},{type:"checkbox",label:"create user",description:"if checked, user will be created with {username}@example.com and password: password",optional:!0},{type:"date",label:"first test",optional:!0},{type:"date",label:"last test",max:new Date,optional:!0},{type:"range",label:"min tests per day",initVal:0,min:0,max:200,step:10},{type:"range",label:"max tests per day",initVal:50,min:0,max:200,step:10}],buttonText:"generate (might take a while)",execFn:async(e,t,a,o,i,n,l)=>{const c={username:t,createUser:a==="true"};o!==void 0&&o.length>0&&(c.firstTestTimestamp=Date.parse(o)),i!==void 0&&i.length>0&&(c.lastTestTimestamp=Date.parse(i)),n!==void 0&&n.length>0&&(c.minTestsPerDay=Number.parseInt(n)),l!==void 0&&l.length>0&&(c.maxTestsPerDay=Number.parseInt(l));const d=await $.dev.generateData({body:c});return{status:d.status===200?1:-1,message:d.body.message,hideOptions:{clearModalChain:!0}}}});We.lbGoToPage=new fe({id:"lbGoToPage",title:"Go to page",inputs:[{type:"number",placeholder:"Page number"}],buttonText:"Go",execFn:async(e,t)=>{const a=parseInt(t,10);return isNaN(a)||a<1?{status:0,message:"Invalid page number"}:(_T(a-1),{status:1,message:"Navigating to page "+a,showNotification:!1})}});function Oe(e,t=[],a={}){const o=We[e];if(o===void 0){f("Failed to show popup - popup is not defined",-1);return}o.show(t,a)}s(".pageAccountSettings").on("click","#unlinkDiscordButton",()=>{Oe("unlinkDiscord")});s(".pageAccountSettings").on("click","#removeGoogleAuth",()=>{Oe("removeGoogleAuth")});s(".pageAccountSettings").on("click","#removeGithubAuth",()=>{Oe("removeGithubAuth")});s(".pageAccountSettings").on("click","#removePasswordAuth",()=>{Oe("removePasswordAuth")});s("#resetSettingsButton").on("click",()=>{Oe("resetSettings")});s(".pageAccountSettings").on("click","#revokeAllTokens",()=>{Oe("revokeAllTokens")});s(".pageAccountSettings").on("click","#resetPersonalBestsButton",()=>{Oe("resetPersonalBests")});s(".pageAccountSettings").on("click","#updateAccountName",()=>{Oe("updateName")});s("#bannerCenter").on("click",".banner .text .openNameChange",()=>{Oe("updateName")});s(".pageAccountSettings").on("click","#addPasswordAuth",()=>{Oe("addPasswordAuth")});s(".pageAccountSettings").on("click","#emailPasswordAuth",()=>{Oe("updateEmail")});s(".pageAccountSettings").on("click","#passPasswordAuth",()=>{Oe("updatePassword")});s(".pageAccountSettings").on("click","#deleteAccount",()=>{Oe("deleteAccount")});s(".pageAccountSettings").on("click","#resetAccount",()=>{Oe("resetAccount")});s(".pageAccountSettings").on("click","#optOutOfLeaderboardsButton",()=>{Oe("optOutOfLeaderboards")});s(".pageSettings").on("click",".section.themes .customTheme .delButton",e=>{const a=s(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Oe("deleteCustomTheme",[a])});s(".pageSettings").on("click",".section.themes .customTheme .editButton",e=>{const a=s(e.currentTarget).parent(".customTheme.button").attr("customThemeId");Oe("updateCustomTheme",[a],{focusFirstInput:"focusAndSelect"})});s(".pageSettings").on("click",".section[data-config-name='fontFamily'] button[data-config-value='custom']",()=>{Oe("applyCustomFont")});async function z1(){const e=Nu(),t=s("#savedTextsModal .list").empty();let a="";if(e.length===0)a+="<div>No saved custom texts found</div>";else for(const l of e)a+=`<div class="savedText" data-name="${at(l)}">
      <div class="button name">${at(l)}</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;t.html(a);const o=Nu(!0),i=s("#savedTextsModal .listLong").empty();let n="";if(o.length===0)n+="<div>No saved long custom texts found</div>";else for(const l of o)n+=`<div class="savedLongText" data-name="${at(l)}">
      <div class="button name">${at(l)}</div>
      <div class="button ${Rp(l)<=0?"disabled":""} resetProgress">reset</div>
      <div class="button delete">
      <i class="fas fa-fw fa-trash"></i>
      </div>
      </div>`;i.html(n),s("#savedTextsModal .list .savedText .button.delete").on("click",l=>{const c=s(l.target).closest(".savedText").data("name");if(c===void 0){f("Failed to show delete modal: no name found",-1);return}Oe("deleteCustomText",[c],{modalChain:cr})}),s("#savedTextsModal .listLong .savedLongText .button.delete").on("click",l=>{const c=s(l.target).closest(".savedLongText").data("name");if(c===void 0){f("Failed to show delete modal: no name found",-1);return}Oe("deleteCustomTextLong",[c],{modalChain:cr})}),s("#savedTextsModal .listLong .savedLongText .button.resetProgress").on("click",l=>{const c=s(l.target).closest(".savedLongText").data("name");if(c===void 0){f("Failed to show delete modal: no name found",-1);return}Oe("resetProgressCustomTextLong",[c],{modalChain:cr})}),s("#savedTextsModal .list .savedText .button.name").on("click",l=>{const c=s(l.target).text();ri(c,!1);const d=bb(c,!1);hb({modalChainData:{text:d,long:!1}})}),s("#savedTextsModal .listLong .savedLongText .button.name").on("click",l=>{const c=s(l.target).text();ri(c,!0);const d=bb(c,!0);hb({modalChainData:{text:d,long:!0}})})}async function u$(e){cr.show({...e,beforeAnimation:async()=>{z1()}})}function hb(e){cr.hide({...e})}function bb(e,t){let a=Mc(e,t);return t&&(a=a.slice(Rp(e))),a.join(" ")}async function f$(){}const cr=new ue({dialogId:"savedTextsModal",setup:f$,showOptionsWhenInChain:{beforeAnimation:async()=>{z1()}}}),ed={textToSave:[]},yb=new Ca(V("#saveCustomTextModal .textName"),{debounceDelay:500,schema:I.string().min(1).max(32).regex(/^[\w\s-]+$/,{message:"Name can only contain letters, numbers, spaces, underscores and hyphens"}),isValid:async e=>{const t=s("#saveCustomTextModal .isLongText").prop("checked");return Nu(t).includes(e)?"Duplicate name":!0},callback:e=>{e.status==="success"?s("#saveCustomTextModal button.save").prop("disabled",!1):s("#saveCustomTextModal button.save").prop("disabled",!0)}});async function p$(e){ed.textToSave=[],H1.show({...e,beforeAnimation:async(t,a)=>{ed.textToSave=a?.text??[],s("#saveCustomTextModal .textName").val(""),s("#saveCustomTextModal .isLongText").prop("checked",!1),s("#saveCustomTextModal button.save").prop("disabled",!0)}})}function m$(){const e=s("#saveCustomTextModal .textName").val(),t=s("#saveCustomTextModal .isLongText").prop("checked");return e?ed.textToSave.length===0?(f("Custom text can't be empty",0),!1):A3(e,ed.textToSave,t)?(ri(e,t),f("Custom text saved",1),!0):(f("Error saving custom text",-1),!1):(f("Custom text needs a name",0),!1)}async function g$(e){e.addEventListener("submit",t=>{t.preventDefault(),yb.getValidationResult().status==="success"&&m$()&&H1.hide()}),e.querySelector(".isLongText")?.addEventListener("input",t=>{yb.triggerValidation()})}const H1=new ue({dialogId:"saveCustomTextModal",setup:g$}),X="#customTextModal .modal",T={textarea:Yr().join(Ls()?"|":" "),longCustomTextWarning:!1,challengeWarning:!1,customTextMode:"simple",customTextLimits:{word:"",time:"",section:""},removeFancyTypographyEnabled:!0,replaceControlCharactersEnabled:!0,customTextPipeDelimiter:!1,replaceNewlines:"off",removeZeroWidthCharactersEnabled:!0};function Xt(){s(`${X} .inputs .group[data-id="mode"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="mode"] button[value="${T.customTextMode}"]`).addClass("active"),s(`${X} .inputs .group[data-id="limit"] input.words`).addClass("hidden"),s(`${X} .inputs .group[data-id="limit"] input.sections`).addClass("hidden"),s(`${X} .inputs .group[data-id="limit"] input.words`).val(T.customTextLimits.word),s(`${X} .inputs .group[data-id="limit"] input.time`).val(T.customTextLimits.time),s(`${X} .inputs .group[data-id="limit"] input.sections`).val(T.customTextLimits.section),T.customTextLimits.word!==""&&s(`${X} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),T.customTextLimits.section!==""&&s(`${X} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),T.customTextPipeDelimiter?(s(`${X} .inputs .group[data-id="limit"] input.sections`).removeClass("hidden"),s(`${X} .inputs .group[data-id="limit"] input.words`).addClass("hidden")):(s(`${X} .inputs .group[data-id="limit"] input.words`).removeClass("hidden"),s(`${X} .inputs .group[data-id="limit"] input.sections`).addClass("hidden")),T.customTextMode==="simple"?(s(`${X} .inputs .group[data-id="limit"]`).addClass("disabled"),s(`${X} .inputs .group[data-id="limit"] input`).val(""),s(`${X} .inputs .group[data-id="limit"] input`).prop("disabled",!0)):(s(`${X} .inputs .group[data-id="limit"]`).removeClass("disabled"),s(`${X} .inputs .group[data-id="limit"] input`).prop("disabled",!1)),s(`${X} .inputs .group[data-id="fancy"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="fancy"] button[value="${T.removeFancyTypographyEnabled}"]`).addClass("active"),s(`${X} .inputs .group[data-id="control"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="control"] button[value="${T.replaceControlCharactersEnabled}"]`).addClass("active"),s(`${X} .inputs .group[data-id="zeroWidth"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="zeroWidth"] button[value="${T.removeZeroWidthCharactersEnabled}"]`).addClass("active"),s(`${X} .inputs .group[data-id="delimiter"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="delimiter"] button[value="${T.customTextPipeDelimiter}"]`).addClass("active"),s(`${X} .inputs .group[data-id="newlines"] button`).removeClass("active"),s(`${X} .inputs .group[data-id="newlines"] button[value="${T.replaceNewlines}"]`).addClass("active"),s(`${X} textarea`).val(T.textarea),T.longCustomTextWarning?(s(`${X} .longCustomTextWarning`).removeClass("hidden"),s(`${X} .randomWordsCheckbox input`).prop("checked",!1),s(`${X} .delimiterCheck input`).prop("checked",!1),s(`${X} .typographyCheck`).prop("checked",!0),s(`${X} .replaceNewlineWithSpace input`).prop("checked",!1),s(`${X} .inputs`).addClass("disabled")):(s(`${X} .longCustomTextWarning`).addClass("hidden"),s(`${X} .inputs`).removeClass("disabled")),T.challengeWarning?(s(`${X} .challengeWarning`).removeClass("hidden"),s(`${X} .randomWordsCheckbox input`).prop("checked",!1),s(`${X} .delimiterCheck input`).prop("checked",!1),s(`${X} .typographyCheck`).prop("checked",!0),s(`${X} .replaceNewlineWithSpace input`).prop("checked",!1),s(`${X} .inputs`).addClass("disabled")):(s(`${X} .challengeWarning`).addClass("hidden"),s(`${X} .inputs`).removeClass("disabled"))}async function O1(e,t){if(T.customTextMode=Kl(),T.customTextMode==="repeat"&&Se()==="word"&&we()===Yr().length&&(T.customTextMode="simple"),T.customTextLimits.word="",T.customTextLimits.time="",T.customTextLimits.section="",Se()==="word"?T.customTextLimits.word=`${we()}`:Se()==="time"?T.customTextLimits.time=`${we()}`:Se()==="section"&&(T.customTextLimits.section=`${we()}`),T.customTextPipeDelimiter=Ls(),T.longCustomTextWarning=to()??!1,t?.text!==void 0){t.long!==!0&&to()&&(ri("",void 0),f("Disabled long custom text progress tracking",0,{duration:5}),T.longCustomTextWarning=!1);const a=t.set??!0?t.text:T.textarea+" "+t.text;T.textarea=a,T.customTextMode="simple",T.customTextLimits.word=`${td().length}`,T.customTextLimits.time="",T.customTextLimits.section=""}Xt()}async function N1(){!T.challengeWarning&&!T.longCustomTextWarning&&s(`${X} textarea`).trigger("focus")}function og(e){T.textarea=Yr().join(Ls()?"|":" ").replace(/^ +/gm,""),qn.show({...e,beforeAnimation:O1,afterAnimation:N1})}function Qf(){qn.hide()}function h$(){const e=s("#fileInput")[0].files?.[0];if(e){if(e.type!=="text/plain"){f("File is not a text file",-1,{duration:5});return}const t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=a=>{const o=a.target?.result;T.textarea=o,Xt(),s("#fileInput").val("")},t.onerror=()=>{f("Failed to read file",-1,{duration:5})}}}function td(){let e=T.textarea;return e===""?[]:(e=e.normalize(),e=e.replace(/[\u2000-\u200A\u202F\u205F\u00A0]/g," "),T.removeZeroWidthCharactersEnabled&&(e=e.replace(/[\u200B-\u200D\u2060\uFEFF]/g,"")),T.replaceControlCharactersEnabled&&(e=B5(e)),e=e.replace(/ +/gm," "),e=e.replace(/( *(\r\n|\r|\n) *)/g,`
 `),T.removeFancyTypographyEnabled&&(e=zy(e)),T.replaceNewlines!=="off"&&(T.replaceNewlines==="periodSpace"?(e=e.replace(/\n/gm,". "),e=e.replace(/\.\. /gm,". "),e=e.replace(/ +/gm," ")):(e=e.replace(/\n/gm," "),e=e.replace(/ +/gm," "))),e.split(T.customTextPipeDelimiter?"|":" ").filter(a=>a!==""))}function b$(){if(T.textarea===""){f("Text cannot be empty",0);return}if([T.customTextLimits.word,T.customTextLimits.time,T.customTextLimits.section].filter(t=>t!=="").length>1){f("You can only specify one limit",0,{duration:5});return}if(T.customTextMode!=="simple"&&T.customTextLimits.word===""&&T.customTextLimits.time===""&&T.customTextLimits.section===""){f("You need to specify a limit",0,{duration:5});return}(T.customTextLimits.section==="0"||T.customTextLimits.word==="0"||T.customTextLimits.time==="0")&&f("Infinite test! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});const e=td();if(e.length===0){f("Text cannot be empty",0);return}T.customTextMode==="simple"?(os("repeat"),T.customTextLimits.word=`${e.length}`,T.customTextLimits.time="",T.customTextLimits.section=""):os(T.customTextMode),Ui(T.customTextPipeDelimiter),So(e),T.customTextMode==="simple"&&T.customTextPipeDelimiter?(_a("section"),ja(e.length)):T.customTextLimits.word!==""?(_a("word"),ja(parseInt(T.customTextLimits.word))):T.customTextLimits.time!==""?(_a("time"),ja(parseInt(T.customTextLimits.time))):T.customTextLimits.section!==""&&(_a("section"),ja(parseInt(T.customTextLimits.section))),Hv(),ie(),r.mode!=="custom"&&v("mode","custom"),Cm(),R(),Qf()}function y$(){let e=T.textarea.split(T.customTextPipeDelimiter?" ":"|").join(T.customTextPipeDelimiter?"|":" ");e=e.replace(/\n /g,`
`),T.textarea=e}async function v$(e){e.querySelector("#fileInput")?.addEventListener("change",h$);const t=e.querySelectorAll(".group[data-id='mode'] button");for(const o of t)o.addEventListener("click",i=>{if(T.customTextMode=i.target.value,T.customTextMode==="simple"){const n=td();T.customTextLimits.word=`${n.length}`,T.customTextLimits.time="",T.customTextLimits.section=""}Xt()});for(const o of e.querySelectorAll(".group[data-id='fancy'] button"))o.addEventListener("click",i=>{T.removeFancyTypographyEnabled=i.target.value==="true",Xt()});for(const o of e.querySelectorAll(".group[data-id='control'] button"))o.addEventListener("click",i=>{T.replaceControlCharactersEnabled=i.target.value==="true",Xt()});for(const o of e.querySelectorAll(".group[data-id='zeroWidth'] button"))o.addEventListener("click",i=>{T.removeZeroWidthCharactersEnabled=i.target.value==="true",Xt()});for(const o of e.querySelectorAll(".group[data-id='delimiter'] button"))o.addEventListener("click",i=>{T.customTextPipeDelimiter=i.target.value==="true",T.customTextPipeDelimiter&&T.customTextLimits.word!==""&&(T.customTextLimits.word=""),!T.customTextPipeDelimiter&&T.customTextLimits.section!==""&&(T.customTextLimits.section=""),y$(),Xt()});for(const o of e.querySelectorAll(".group[data-id='newlines'] button"))o.addEventListener("click",i=>{T.replaceNewlines=i.target.value,Xt()});e.querySelector(".group[data-id='limit'] input.words")?.addEventListener("input",o=>{T.customTextLimits.word=o.target.value,T.customTextLimits.time="",T.customTextLimits.section="",Xt()}),e.querySelector(".group[data-id='limit'] input.time")?.addEventListener("input",o=>{T.customTextLimits.time=o.target.value,T.customTextLimits.word="",T.customTextLimits.section="",Xt()}),e.querySelector(".group[data-id='limit'] input.sections")?.addEventListener("input",o=>{T.customTextLimits.section=o.target.value,T.customTextLimits.word="",T.customTextLimits.time="",Xt()});const a=e.querySelector("textarea");a?.addEventListener("input",o=>{T.textarea=o.target.value}),a?.addEventListener("keydown",o=>{if(o.key!=="Tab")return;o.preventDefault();const i=o.target,n=i.selectionStart,l=i.selectionEnd;i.value=i.value.substring(0,n)+"	"+i.value.substring(l),i.selectionStart=i.selectionEnd=n+1,T.textarea=i.value}),a?.addEventListener("keypress",o=>{if(T.longCustomTextWarning||T.challengeWarning){o.preventDefault();return}o.code==="Enter"&&o.ctrlKey&&s(`${X} .button.apply`).trigger("click"),to()&&mm()!==""&&(ri("",void 0),T.longCustomTextWarning=!1,f("Disabled long custom text progress tracking",0,{duration:5}))}),e.querySelector(".button.apply")?.addEventListener("click",()=>{b$()}),e.querySelector(".button.wordfilter")?.addEventListener("click",()=>{UL({modalChain:qn})}),e.querySelector(".button.customGenerator")?.addEventListener("click",()=>{QL({modalChain:qn})}),e.querySelector(".button.showSavedTexts")?.addEventListener("click",()=>{u$({modalChain:qn})}),e.querySelector(".button.saveCustomText")?.addEventListener("click",()=>{p$({modalChain:qn,modalChainData:{text:td()}})}),e.querySelector(".longCustomTextWarning")?.addEventListener("click",()=>{T.longCustomTextWarning=!1,Xt()}),e.querySelector(".challengeWarning")?.addEventListener("click",()=>{T.challengeWarning=!1,Xt()})}const qn=new ue({dialogId:"customTextModal",setup:v$,customEscapeHandler:async()=>{Qf()},customWrapperClickHandler:async()=>{Qf()},showOptionsWhenInChain:{beforeAnimation:O1,afterAnimation:N1}}),Dr="videoAdPopupWrapper";async function U1(){if(Gt(Dr,"popups"),await um(),$d){f("Looks like you're using an adblocker. Video ads will not work until you disable it.",0,{duration:6});return}if(await fm(),kr){f("Looks like you're using a cookie popup blocker. Video ads will not work without giving your consent through the popup.",0,{duration:7});return}if(!Fn(Dr)){const e=document.querySelector("#videoAdPopupWrapper");O(e,{opacity:[0,1],duration:125,onBegin:()=>{e.classList.remove("hidden")},onComplete:()=>{window.dataLayer.push({event:"EG_Video"})}})}}function vb(){if(Fn(Dr)){const e=document.querySelector("#videoAdPopupWrapper");O(e,{opacity:[1,0],duration:125,onComplete:()=>{e.classList.add("hidden"),Tt(Dr)}})}}function w$(e){const t=e.event;t==="started"||(t==="finished"?vb():t==="empty"&&(f("Failed to load video ad. Please try again later",-1,{duration:3}),vb()))}s(".pageTest #watchVideoAdButton").on("click",()=>{U1()});Qt(Dr);function V1(e){return s(`#shareTestSettingsModal label.${e} input`).prop("checked")}function K1(){const e=location.origin+"?testSettings=",t=new Array(8).fill(null),a=[{key:"mode",getValue:()=>r.mode},{key:"mode2",getValue:()=>di(r,be)},{key:"customText",getValue:()=>xo()},{key:"punctuation",getValue:()=>r.punctuation},{key:"numbers",getValue:()=>r.numbers},{key:"language",getValue:()=>r.language},{key:"difficulty",getValue:()=>r.difficulty},{key:"funbox",getValue:()=>r.funbox}];for(const[n,{key:l,getValue:c}]of a.entries())V1(l)&&(t[n]=c());const o=sy.compressToURI(JSON.stringify(t)),i=e+o;C$(i)}function C$(e){const t=s("#shareTestSettingsModal");t.find("textarea.url").val(e),t.find(".tooLongWarning").toggleClass("hidden",e.length<=2e3)}function j1(){V1("mode")?s("#shareTestSettingsModal .subgroup").removeClass("hidden"):s("#shareTestSettingsModal .subgroup").addClass("hidden")}function ig(e){S$.show({...e,beforeAnimation:async()=>{K1(),j1()}})}async function k$(e){e.querySelector("textarea.url")?.addEventListener("click",async a=>{a.target.select()});const t=e.querySelectorAll("label input");for(const a of t)a.addEventListener("change",async()=>{K1(),j1()})}const S$=new ue({dialogId:"shareTestSettingsModal",setup:k$});let wb=!1;async function x$(){if(!wb){for(const e of Yp)e!=="swiss_german"&&s("#quoteSubmitModal .newQuoteLanguage").append(`<option value="${e}">${e.replace(/_/g," ")}</option>`);wb=!0}}let Yf;async function T$(){const e=s("#quoteSubmitModal .newQuoteText").val(),t=s("#quoteSubmitModal .newQuoteSource").val(),a=s("#quoteSubmitModal .newQuoteLanguage").val(),o=ul("submitQuote");if(!e||!t||!a){f("Please fill in all fields",0);return}oe();const i=await $.quotes.add({body:{text:e,source:t,language:a,captcha:o}});if(j(),i.status!==200){f("Failed to submit quote",-1,{response:i});return}f("Quote submitted.",1),s("#quoteSubmitModal .newQuoteText").val(""),s("#quoteSubmitModal .newQuoteSource").val(""),Mo("submitQuote")}async function L$(e){if(!Xi()){f("Could not show quote submit popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}G1.show({...e,mode:"dialog",focusFirstInput:!0,afterAnimation:async()=>{Is(document.querySelector("#quoteSubmitModal .g-recaptcha"),"submitQuote"),await x$(),Yf=new et({select:"#quoteSubmitModal .newQuoteLanguage"}),s("#quoteSubmitModal .newQuoteLanguage").val(Ta(r.language)),s("#quoteSubmitModal .newQuoteLanguage").trigger("change"),s("#quoteSubmitModal input").val(""),new qr(V("#quoteSubmitModal .newQuoteText"),250)}})}function $$(e){G1.hide({clearModalChain:e})}async function M$(e){e.querySelector("button")?.addEventListener("click",()=>{T$(),$$(!0)})}async function A$(){Mo("submitQuote"),Yf?.destroy(),Yf=void 0}const G1=new ue({dialogId:"quoteSubmitModal",setup:M$,cleanup:A$});let li=[];function Nd(){s("#quoteApproveModal .quotes").empty(),li.forEach((e,t)=>{const a=s(`
      <div class="quote" data-id="${t}" data-db-id="${e._id}">
        <textarea class="text">${at(e.text)}</textarea>
        <input type="text" class="source" placeholder="Source" value="${at(e.source)}">
        <div class="buttons">
          <button disabled class="textButton undo" aria-label="Undo changes" data-balloon-pos="left"><i class="fas fa-fw fa-undo-alt"></i></button>
          <button class="textButton refuse" aria-label="Refuse quote" data-balloon-pos="left"><i class="fas fa-fw fa-times"></i></button>
          <button class="textButton approve" aria-label="Approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-check"></i></button>
          <button class="textButton edit hidden" aria-label="Edit and approve quote" data-balloon-pos="left"><i class="fas fa-fw fa-pen"></i></button>
        </div>
        <div class="bottom">
          <div class="length ${e.text.length<60?"red":""}"><i class="fas fa-fw fa-ruler"></i>${e.text.length}</div>
          <div class="language"><i class="fas fa-fw fa-globe-americas"></i>${e.language}</div>
          <div class="timestamp"><i class="fas fa-fw fa-calendar"></i>${te(new Date(e.timestamp),"dd MMM yyyy HH:mm")}</div>
        </div>
      </div>
    `);s("#quoteApproveModal .quotes").append(a),a.find(".source").on("input",()=>{s(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),s(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),s(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden")}),a.find(".text").on("input",()=>{s(`#quoteApproveModal .quote[data-id=${t}] .undo`).prop("disabled",!1),s(`#quoteApproveModal .quote[data-id=${t}] .approve`).addClass("hidden"),s(`#quoteApproveModal .quote[data-id=${t}] .edit`).removeClass("hidden"),Q1(t)}),a.find(".undo").on("click",()=>{E$(t)}),a.find(".approve").on("click",()=>{q$(t,e._id)}),a.find(".refuse").on("click",()=>{I$(t,e._id)}),a.find(".edit").on("click",()=>{D$(t,e._id)})})}function Q1(e){const t=s(`#quoteApproveModal .quote[data-id=${e}] .text`).val()?.length;s(`#quoteApproveModal .quote[data-id=${e}] .length`).html(`<i class="fas fa-fw fa-ruler"></i>${t}`),t<60?s(`#quoteApproveModal .quote[data-id=${e}] .length`).addClass("red"):s(`#quoteApproveModal .quote[data-id=${e}] .length`).removeClass("red")}async function Y1(){oe();const e=await $.quotes.get();if(j(),e.status!==200){f("Failed to get new quotes",-1,{response:e});return}li=e.body.data??[],Nd()}async function _$(e){P$.show({...e,beforeAnimation:async()=>{li=[],Y1()}})}function ng(e){const t=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);t.find("button").prop("disabled",!1),t.find(".edit").hasClass("hidden")&&t.find(".undo").prop("disabled",!0)}function E$(e){s(`#quoteApproveModal .quote[data-id=${e}] .text`).val(li[e]?.text??""),s(`#quoteApproveModal .quote[data-id=${e}] .source`).val(li[e]?.source??""),s(`#quoteApproveModal .quote[data-id=${e}] .undo`).prop("disabled",!0),s(`#quoteApproveModal .quote[data-id=${e}] .approve`).removeClass("hidden"),s(`#quoteApproveModal .quote[data-id=${e}] .edit`).addClass("hidden"),Q1(e)}async function q$(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),oe();const o=await $.quotes.approveSubmission({body:{quoteId:t}});if(j(),o.status!==200){ng(e),a.find("textarea, input").prop("disabled",!1),f("Failed to approve quote",-1,{response:o});return}f(`Quote approved. ${o.body.message??""}`,1),li.splice(e,1),Nd()}async function I$(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);a.find("button").prop("disabled",!0),a.find("textarea, input").prop("disabled",!0),oe();const o=await $.quotes.rejectSubmission({body:{quoteId:t}});if(j(),o.status!==200){ng(e),a.find("textarea, input").prop("disabled",!1),f("Failed to refuse quote",-1,{response:o});return}f("Quote refused.",1),li.splice(e,1),Nd()}async function D$(e,t){if(!confirm("Are you sure?"))return;const a=s(`#quoteApproveModal .quote[data-id=${e}] .text`).val(),o=s(`#quoteApproveModal .quote[data-id=${e}] .source`).val(),i=s(`#quoteApproveModal .quotes .quote[data-id=${e}]`);i.find("button").prop("disabled",!0),i.find("textarea, input").prop("disabled",!0),oe();const n=await $.quotes.approveSubmission({body:{quoteId:t,editText:a,editSource:o}});if(j(),n.status!==200){ng(e),i.find("textarea, input").prop("disabled",!1),f("Failed to approve quote",-1,{response:n});return}f(`Quote edited and approved. ${n.body.message??""}`,1),li.splice(e,1),Nd()}async function F$(e){e.querySelector("button.refreshList")?.addEventListener("click",()=>{s("#quoteApproveModal .quotes").empty(),Y1()})}const P$=new ue({dialogId:"quoteApproveModal",setup:F$});let X1=0,J1=0,Z1=!1;function eC(e){Z1=e}function Cb(){const e=new CustomEvent("refresh");document.dispatchEvent(e)}const B$=new fe({id:"quoteFilter",title:"Enter minimum and maximum values",inputs:[{placeholder:"1",type:"number"},{placeholder:"100",type:"number"}],buttonText:"save",execFn:async(e,t,a)=>{const o=parseInt(t,10),i=parseInt(a,10);return isNaN(o)||isNaN(i)?{status:0,message:"Invalid min/max values"}:(X1=o,J1=i,Cb(),{status:1,message:"saved custom filter"})},afterClickAway:()=>{eC(!0),Cb()}}),On={quoteToReport:void 0,reasonSelect:void 0};async function tC(e,t){if(!Xi()){f("Could not show quote report popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}aC.show({mode:"dialog",...t,beforeAnimation:async()=>{Is(document.querySelector("#quoteReportModal .g-recaptcha"),"quoteReportModal");const a=r.language==="swiss_german"?"german":r.language,{quotes:o}=await rt.getQuotes(a);On.quoteToReport=o.find(i=>i.id===e),s("#quoteReportModal .quote").text(On.quoteToReport?.text),s("#quoteReportModal .reason").val("Grammatical error"),s("#quoteReportModal .comment").val(""),On.reasonSelect=new et({select:"#quoteReportModal .reason",settings:{showSearch:!1}}),new qr(V("#quoteReportModal .comment"),250)}})}async function R$(e=!1){aC.hide({clearModalChain:e})}async function W$(){const e=ul("quoteReportModal");if(!e){f("Please complete the captcha");return}const t=On.quoteToReport?.id.toString(),a=Ta(r.language),o=s("#quoteReportModal .reason").val(),i=s("#quoteReportModal .comment").val(),n=e;if(t===void 0||t===""){f("Please select a quote");return}if(!o){f("Please select a valid report reason");return}if(!i){f("Please provide a comment");return}const l=i.length-250;if(l>0){f(`Report comment is ${l} character(s) too long`);return}oe();const c=await $.quotes.report({body:{quoteId:t,quoteLanguage:a,reason:o,comment:i,captcha:n}});if(j(),c.status!==200){f("Failed to report quote",-1,{response:c});return}f("Report submitted. Thank you!",1),R$(!0)}async function z$(e){e.querySelector("button")?.addEventListener("click",async()=>{await W$()})}async function H$(){Mo("quoteReportModal"),On.reasonSelect?.destroy(),On.reasonSelect=void 0}const aC=new ue({dialogId:"quoteReportModal",setup:z$,cleanup:H$}),O$={fuzzyMatchSensitivity:.2,scoreForSimilarMatch:.5,scoreForExactMatch:1};function N$(e,t){return t===0?0:Math.log10(e/t)}const kb=.4;function U$(e,t){return kb+(1-kb)*(t.termFrequencies[e]/t.maxTermFrequency)}function Sb(e){return e.match(/[^\\\][.,"/#!?$%^&*;:{}=\-_`~()\s]+/g)??[]}const V$=(e,t,a=O$)=>{const o={},i={};e.forEach((c,d)=>{const u=Sb(t(c)),m={id:d,termFrequencies:{},maxTermFrequency:0};let p=0;u.forEach(g=>{const h=Rg(g);Object.hasOwn(i,h)||(i[h]=new Set),i[h]?.add(g),Object.hasOwn(o,h)||(o[h]=new Set),o[h]?.add(m),h in m.termFrequencies||(m.termFrequencies[h]=0),m.termFrequencies[h]++,p=Math.max(p,m.termFrequencies[h])}),m.maxTermFrequency=p});const n=Object.keys(o);return{query:(c,d)=>{const u={results:[],matchedQueryTerms:[]},m=new Set(Sb(c).map(y=>Rg(y)));if(m.size===0)return u;const p=new Map,g=new Set;m.forEach(y=>{n.forEach(k=>{const{similarity:x}=Hk(y,k),C=k===y,D=x>=1-a.fuzzyMatchSensitivity;if(C||D){const E=o[k],B=N$(e.length,E.size);E.forEach(z=>{const H=p.get(z.id)??0,ae=U$(k,z),xe=C?a.scoreForExactMatch:0,Fe=D?a.scoreForSimilarMatch:0,N=(xe+Fe)*B*ae,re=e[z.id];(d.length===0||re!=null&&d.includes(re.id))&&p.set(z.id,H+N)}),i[k]?.forEach(z=>{g.add(z)})}})});const h=[...p].sort((y,k)=>k[1]-y[1]).map(y=>e[y[0]]);return u.results=h,u.matchedQueryTerms=[...g],u}}},Cu={},ku=100;let Ii=1,Bl=!0,Ln;async function K$(){({quotes:Ln}=await rt.getQuotes(r.language))}function j$(e,t,a){if(e in Cu)return Cu[e];const o=V$(t,a);return Cu[e]=o,o}function G$(e){if(!Fa.isOpen())return[];const t=s("#quoteSearchModal .quoteLengthFilter"),a=t.val();if(a.length===0)return Bl=!0,e;const o=new Set(a.map(l=>parseInt(l,10)));if(a.indexOf("4")!==-1)if(Z1){eC(!1);const l=t.get(0);if(!l)return e;const c=l.slim;if(c!==void 0){const d=c.getSelected(),u=d.indexOf("4");u>-1&&d.splice(u,1),c.setSelected(d)}}else if(Bl)B$.show(void 0,{}),Bl=!1;else return e.filter(c=>c.length>=X1&&c.length<=J1||o.has(c.group));else Bl=!0;return e.filter(l=>o.has(l.group))}function Q$(e){if(!Fa.isOpen())return[];const t=document.querySelector(".toggleFavorites").classList.contains("active");return e.filter(o=>t?rt.isQuoteFavorite(o):!0)}function Y$(e,t){let a;e.length<101?a="short":e.length<301?a="medium":e.length<601?a="long":a="thicc";const o=!_(),i=!o&&rt.isQuoteFavorite(e);return`
  <div class="searchResult" data-quote-id="${e.id}">

    <div class="text">
      ${eu(e.text,t)}
    </div>

    <div class="id">
      <div class="sub">id</div>
      <span class="quote-id">
        ${eu(e.id.toString(),t)}
      </span>
    </div>

    <div class="length">
      <div class="sub">length</div>
      ${a}
    </div>

    <div class="source">
      <div class="sub">source</div>
      ${eu(e.source,t)}
    </div>

    <div class="textButton report ${o&&"hidden"}" aria-label="Report quote" data-balloon-pos="left">
      <i class="fas fa-flag report"></i>
    </div>

    <div class="textButton favorite ${o&&"hidden"}" aria-label="Favorite quote" data-balloon-pos="left">
      <i class="${i?"fas":"far"} fa-heart favorite"></i>
    </div>

  </div>
  `}function X$(e,t){const a=[],o=new Set;for(const i of e){const n=i.text+i.source,l=[];let c=!1;for(const d of t){const u=n.match(d);if(!u){c=!0;break}l.push(u[0])}c||(l.forEach(d=>o.add(d)),a.push(i))}return[a,Array.from(o)]}async function uc(e){if(!Fa.isOpen())return;Ln===void 0&&({quotes:Ln}=await rt.getQuotes(r.language));let t=[],a=[],o=[],i=[];const n=/"(.*?)"/g,l=Array.from(e.matchAll(n)),c=e.replaceAll(n,"");if(l[0]){const k=l.map(x=>new RegExp(x[1]??"","i"));[o,i]=X$(Ln,k)}const d=j$(r.language,Ln,k=>`${k.text} ${k.id} ${k.source}`);if(o.length>0||c===e){const k=o.map(x=>x.id);({results:t,matchedQueryTerms:a}=d.query(c,k)),o.forEach(x=>{t.includes(x)||t.push(x)}),a=[...i,...a]}const u=G$(Q$(e===""?Ln:t)),m=s("#quoteSearchResults");m.empty();const p=Math.ceil(u.length/ku);if(Ii>=p?s("#quoteSearchPageNavigator .nextPage").prop("disabled",!0):s("#quoteSearchPageNavigator .nextPage").prop("disabled",!1),Ii<=1?s("#quoteSearchPageNavigator .prevPage").prop("disabled",!0):s("#quoteSearchPageNavigator .prevPage").prop("disabled",!1),u.length===0){s("#quoteSearchModal  .pageInfo").html("No search results");return}const g=(Ii-1)*ku,h=Math.min(Ii*ku,u.length);s("#quoteSearchModal  .pageInfo").html(`${g+1} - ${h} of ${u.length}`),u.slice(g,h).forEach(k=>{const x=Y$(k,a);m.append(x)});const y=Fa.getModal().querySelectorAll(".searchResult");for(const k of y){const x=parseInt(k.dataset.quoteId);k.querySelector(".textButton.favorite")?.addEventListener("click",C=>{if(C.stopPropagation(),x===void 0||isNaN(x)){f("Could not toggle quote favorite: quote id is not a number",-1);return}eM(`${x}`)}),k.querySelector(".textButton.report")?.addEventListener("click",C=>{if(C.stopPropagation(),x===void 0||isNaN(x)){f("Could not open quote report modal: quote id is not a number",-1);return}tC(x,{modalChain:Fa})}),k.addEventListener("click",C=>{vp(x),Z$(x)})}}let Xf;async function sg(e){Fa.show({...e,focusFirstInput:!0,beforeAnimation:async()=>{_()?(s("#quoteSearchModal .goToQuoteSubmit").removeClass("hidden"),s("#quoteSearchModal .toggleFavorites").removeClass("hidden")):(s("#quoteSearchModal .goToQuoteSubmit").addClass("hidden"),s("#quoteSearchModal .toggleFavorites").addClass("hidden"));const t=S()?.quoteMod;t!==void 0&&(t===!0||t!=="")?s("#quoteSearchModal .goToQuoteApprove").removeClass("hidden"):s("#quoteSearchModal .goToQuoteApprove").addClass("hidden"),Xf=new et({select:"#quoteSearchModal .quoteLengthFilter",settings:{showSearch:!1,placeholderText:"filter by length",contentLocation:Fa.getModal()},data:[{text:"short",value:"0"},{text:"medium",value:"1"},{text:"long",value:"2"},{text:"thicc",value:"3"},{text:"custom",value:"4"}]})},afterAnimation:async()=>{K$()}})}function J$(e=!1){Fa.hide({clearModalChain:e})}function Z$(e){if(isNaN(e)&&(e=parseInt(document.getElementById("searchBox").value)),e!==null&&!isNaN(e)&&e>=0)v("quoteLength",[-2]),vp(e),ie();else{f("Quote ID must be at least 1",0);return}R(),J$(!0)}const Su=Bt(250,()=>{if(!Fa.isOpen())return;const e=document.getElementById("searchBox").value;Ii=1,uc(e)});async function eM(e){const t=r.language;if(t===void 0||e===""){f("Could not get quote stats!",-1);return}const a={language:t,id:parseInt(e,10)},o=rt.isQuoteFavorite(a),i=s(`#quoteSearchModal .searchResult[data-quote-id=${e}] .textButton.favorite i`);if(S())if(o)try{oe(),await rt.setQuoteFavorite(a,!1),j(),i.removeClass("fas").addClass("far")}catch(l){j();const c=se(l,"Failed to remove quote from favorites");f(c,-1)}else try{oe(),await rt.setQuoteFavorite(a,!0),j(),i.removeClass("far").addClass("fas")}catch(l){j();const c=se(l,"Failed to add quote to favorites");f(c,-1)}}async function tM(e){e.querySelector(".searchBox")?.addEventListener("input",t=>{Su()}),e.querySelector("button.toggleFavorites")?.addEventListener("click",t=>{_()&&(s(t.target).toggleClass("active"),Su())}),e.querySelector(".goToQuoteApprove")?.addEventListener("click",t=>{_$({modalChain:Fa})}),e.querySelector(".goToQuoteSubmit")?.addEventListener("click",async t=>{oe();const a=await $.quotes.isSubmissionEnabled(),o=(a.status===200&&a.body.data?.isEnabled)??!1;if(j(),!o){f("Quote submission is disabled temporarily due to a large submission queue.",0,{duration:5});return}L$({modalChain:Fa})}),e.querySelector(".quoteLengthFilter")?.addEventListener("change",Su),e.querySelector(".nextPage")?.addEventListener("click",()=>{const t=document.getElementById("searchBox").value;Ii++,uc(t)}),e.querySelector(".prevPage")?.addEventListener("click",()=>{const t=document.getElementById("searchBox").value;Ii--,uc(t)}),document?.addEventListener("refresh",()=>{const t=document.getElementById("searchBox").value;uc(t)})}async function aM(){Xf?.destroy(),Xf=void 0}const Fa=new ue({dialogId:"quoteSearchModal",setup:tM,cleanup:aM});let fc=0,Jf,Zf,rg=!0;const Mi=document.querySelector("#fpsCounter");function oC(e){if(rg)return;const t=e-Zf;if(fc++,t>500){const a=K(fc*1e3/t).toFixed(2);fc=0,Zf=e,nM(a)}window.requestAnimationFrame(oC)}function oM(){rg=!1,fc=0,Zf=performance.now(),Jf||(Jf=window.requestAnimationFrame(oC)),Mi.classList.remove("hidden")}function iM(){cancelAnimationFrame(Jf),rg=!0,Mi.classList.add("hidden")}async function nM(e){Mi.innerHTML=`FPS ${e}`;const t=parseFloat(e);Mi.classList.remove("error"),Mi.classList.remove("main"),t<30?Mi.classList.add("error"):t>55&&Mi.classList.add("main")}const lg=x0();lg.then(e=>{OL(e)}).catch(e=>{console.error(se(e,"Failed to update challenges commands"))});const iC=De("language"),nC=De("difficulty"),sC=De("blindMode"),rC=De("oppositeShiftMode"),lC=De("stopOnError"),cC=De("confidenceMode"),dC=De("lazyMode"),uC=De("layout"),fC=De("showAverage"),pC=De("showPb"),mC=De("keymapLayout"),gC=De("customTheme"),hC=De("ads"),bC=De("minWpm"),yC=De("minAcc"),vC=De("paceCaret"),cg={title:"",list:[...dL,De("punctuation"),De("numbers"),De("mode"),De("time"),De("words"),De("quoteLength"),iC,{id:"changeCustomModeText",display:"Change custom text",icon:"fa-align-left",exec:()=>{og()}},{id:"viewQuoteSearchPopup",display:"Search for quotes",icon:"fa-search",exec:()=>{v("mode","quote"),sg()},shouldFocusTestUI:!1},...R9,...B9,{id:"shareTestSettings",display:"Share test settings",icon:"fa-share",exec:async()=>{ig()}},...w1,...RL,...dw,...Ci(nC,"quickRestart","repeatQuotes",sC,"alwaysShowWordsHistory","singleListCommandLine",bC,yC,...d0,"britishEnglish",...x1,"customLayoutfluid","customPolyglot"),...Ci("freedomMode","strictSpace",rC,lC,cC,"quickEnd","indicateTypos","compositionDisplay","hideExtraLetters",dC,uC,"codeUnindentOnBackspace"),...Ci("soundVolume","playSoundOnClick","playSoundOnError","playTimeWarning"),...Ci("smoothCaret","caretStyle",vC,"repeatedPace","paceCaretStyle"),...Ci("timerStyle","liveSpeedStyle","liveAccStyle","liveBurstStyle","timerColor","timerOpacity","highlightMode","tapeMode","tapeMargin","smoothLineScroll","showAllLines","typingSpeedUnit","alwaysShowDecimalPlaces","startGraphsAtZero","maxLineWidth","fontSize",...kL,"keymapMode","keymapStyle","keymapLegendStyle","keymapSize",mC,"keymapShowTopRow"),...Ci(...$1,gC,...ML,"flipTestColors","colorfulMode",...TL,...CL,"customBackgroundSize",...xL,"randomTheme"),{id:"randomizeTheme",display:"Next random theme",icon:"fa-random",exec:async()=>mv(),available:()=>r.randomTheme!=="off"},...Ci("showKeyTips","showOutOfFocusWarning","capsLockWarning",fC,pC,"monkeyPowerLevel","monkey"),hC,...A1,...nL,{id:"watchVideoAd",display:"Watch video ad",alias:"support donate",icon:"fa-ad",exec:()=>{U1()}},{id:"importSettingsJSON",display:"Import settings JSON",icon:"fa-cog",alias:"import config",input:!0,exec:async({input:e})=>{e===void 0||e===""||await Uy(e)}},{id:"exportSettingsJSON",display:"Export settings JSON",icon:"fa-cog",alias:"export config",input:!0,defaultValue:()=>JSON.stringify(r)},{id:"clearNotifications",display:"Clear all notifications",icon:"fa-trash-alt",alias:"dismiss",exec:async()=>{CS()}},{id:"clearSwCache",display:"Clear SW cache",icon:"fa-cog",exec:async()=>{const e=await caches.keys();for(const t of e)await caches.delete(t);window.location.reload()}},{id:"getSwCache",display:"Get SW cache",icon:"fa-cog",exec:async()=>{alert(await caches.keys())}},{id:"copyResultStats",display:"Copy result stats",icon:"fa-cog",visible:!1,exec:async()=>{navigator.clipboard.writeText(JSON.stringify(W0())).then(()=>{f("Copied to clipboard",1)}).catch(e=>{const t=se(e,"Failed to copy to clipboard");f(t,-1)})}},{id:"fpsCounter",display:"FPS counter...",icon:"fa-cog",visible:!1,subgroup:{title:"FPS counter...",list:[{id:"startFpsCounter",display:"show",icon:"fa-cog",exec:()=>{oM()}},{id:"stopFpsCounter",display:"hide",icon:"fa-cog",exec:()=>{iM()}}]}},{id:"fixSkillIssue",display:"Fix skill issue",icon:"fa-wrench",visible:!1,exec:async()=>{document.querySelector("body").innerHTML=`
          <div class="centerbox" style="position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;pointer-events: none;width: 100%; max-width: 800px;">
            <h1 style="font-size:3rem;margin-bottom:1rem;">Fixing skill issue...</h1>
            <iframe style="width: 100%; aspect-ratio: 4 / 3" src="https://www.youtube.com/embed/dQw4w9WgXcQ?si=Kr48u8WHcwvX95G7&amp;controls=0&autoplay=1&mute=0&disablekb=1&fs=0&modestbranding=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
          </div>
        `,setTimeout(()=>{document.querySelector(".centerbox")?.insertAdjacentHTML("beforeend",'<p style="margin-top:1rem;font-size:1.5rem;">If your skill issue is not fixed yet, please wait a bit longer...</p>')},5e3)}},{id:"joinDiscord",display:"Join the Discord server",icon:"fa-users",exec:()=>{window.open("https://discord.gg/monkeytype")}}]},wC={keymapLayouts:mC.subgroup,enableAds:hC.subgroup,customThemesList:gC.subgroup,themes:$1[0]?.subgroup,loadChallenge:A1[0]?.subgroup,languages:iC.subgroup,difficulty:nC.subgroup,lazyMode:dC.subgroup,paceCaretMode:vC.subgroup,showAverage:fC.subgroup,showPb:pC.subgroup,minWpm:bC.subgroup,minAcc:yC.subgroup,minBurst:d0[0]?.subgroup,funbox:x1[0]?.subgroup,confidenceMode:cC.subgroup,stopOnError:lC.subgroup,layouts:uC.subgroup,oppositeShiftMode:rC.subgroup,tags:w1[0]?.subgroup,resultSaving:dw[0]?.subgroup,blindMode:sC.subgroup};function sM(e){return wC[e]!==void 0}async function rM(e){await Promise.allSettled([lg]);const t=wC[e];if(!t)throw f(`List not found: ${e}`,-1),new Error(`List ${e} not found`);return t}let Ji=[];Ji=[cg];function lM(){return Ji.length}function cM(){dM([cg])}function dM(e){Ji=e}function uM(e){Ji.push(e)}function fM(){Ji.pop()}function pM(){return Ji[Ji.length-1]}let xb;async function mM(){await Promise.allSettled([lg]);const e=[];for(const t of cg.list){const a=CC(t);e.push(...a)}return xb={title:"",list:e},xb}function CC(e,t){const a=[];if(e.subgroup){e.subgroup.beforeList&&e.subgroup.beforeList();const o={...e,subgroup:{...e.subgroup,list:[]}};for(const i of e.subgroup.list)a.push(...CC(i,o))}else if(t){const o=t.display.replace(/\s?\.\.\.$/g,""),i=o+'<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+e.display,n=o+" "+e.display;let l;((t.alias??"")||(e.alias??""))&&(l=[t.alias,e.alias].filter(Boolean).join(" "));const c={...e,singleListDisplay:i,singleListDisplayNoIcon:n,configKey:t.subgroup?.configKey,icon:t.icon,alias:l,visible:(t.visible??!0)&&(e.visible??!0),available:async()=>(await t?.available?.()??!0)&&(await e?.available?.()??!0)};a.push(c)}else a.push(e);return a}function Ci(...e){return e.map(t=>typeof t=="string"?De(t):t)}let Ft=0,Vt=!1,ta="",ad=null,In=!1,wo="search",Le={command:null,placeholder:"",value:"",icon:""},No=null,Fr=!1,ep="",Ys;function gM(){L("#commandLine")?.addClass("noBackground"),r.showOutOfFocusWarning&&Jr()}function tp(){L("#commandLine")?.removeClass("noBackground"),Jn()||Np()}function cn(e,t){ba.show({...t,focusFirstInput:!0,beforeAnimation:async()=>{In=!1,ta="",Ft=0,wo="search",pc=null,Le={command:null,placeholder:null,value:null,icon:null},e?.subgroupOverride!==void 0?(typeof e.subgroupOverride=="string"?sM(e.subgroupOverride)?(oe(),No=await rM(e.subgroupOverride),j()):(No=null,Vt=r.singleListCommandLine==="on",f(`Command list ${e.subgroupOverride} not found`,0)):No=e.subgroupOverride,Vt=!1):(No=null,Vt=r.singleListCommandLine==="on");let a;if(e?.commandOverride!==void 0){const o=(await Kd()).find(i=>i.id===e.commandOverride);o===void 0?f(`Command ${e.commandOverride} not found`,0):o?.input!==!0?f(`Command ${e.commandOverride} is not an input command`,0):a=o}e?.singleListOverride&&(Vt=e.singleListOverride),ad=null,eo(!1),cM(),await tn(),await Zi(),await en(),await qa(),setTimeout(()=>{if(kC(),a){const o=a.display.split("</i>")[1]??a.display;wo="input",Le={command:a,placeholder:o,value:a.defaultValue?.()??"",icon:a.icon??"fa-chevron-right"},xC(a),tn(Le.value),dg()}},1)}})}function Ud(e=!1){Rf(),Sr(),Fr=!0,ba.hide({clearModalChain:e,afterAnimation:async()=>{od(),tp(),pe()!=="test"&&document.activeElement?.blur(),Fr=!1}})}async function hM(){if(wo==="input"){wo="search",Le={command:null,placeholder:null,value:null,icon:null},await tn(""),await Zi(),await en(),await qa(),od();return}lM()>1?(fM(),Ft=0,await tn(""),await Zi(),await en(),await qa(),od()):Ud()}async function Zi(){const e=await Vd();e.beforeList?.();const t=e.list,a=ta.replace(/^>/gi,"").toLowerCase().trim(),o=a.length===0?[]:a.split(" "),i=[],n=[];for(const d of t){if(!(await d.available?.()??!0)){i.push({matchCount:-1,matchStrength:-1});continue}if(a.length===0||o.length===0){i.push({matchCount:0,matchStrength:0});continue}const m=(Vt&&(d.singleListDisplayNoIcon??"")||d.display).toLowerCase().split(" "),p=d.alias?.toLowerCase().split(" ")??[],g=m.concat(p),h=g.map(()=>null);let y=0;for(const[x,C]of o.entries())for(const[D,E]of g.entries()){const B=h[D];E.startsWith(C)&&B===null&&!h.includes(x)&&(h[D]=x,y+=C.length)}const k=h.filter(x=>x!==null).length;n.push(k),i.push({matchCount:k,matchStrength:y})}const l=Math.max(...i.map(d=>d.matchStrength));let c=o.length;do{if(n.filter(u=>u>=c).length>0)break;c--}while(c>0);c===0&&(c=1);for(const[d,u]of t.entries()){const m=i[d];if(m===void 0){u.found=!1;continue}m.matchCount>=c&&m.matchStrength>=l?u.found=!0:u.found=!1}}function dg(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");e.innerHTML="",Ys=void 0}let pc=null;async function Vd(){if(No!==null)return No;if(Vt)if(pc===null)pc=await mM();else return pc;return pM()}async function Kd(){return(await Vd()).list}function bM(e){let t='<i class="fas fa-fw fa-chevron-right"></i>';if(e.icon!==void 0&&e.icon!==""){const o=e.icon.startsWith("fa-"),n=(e.iconType??"solid")==="solid"?"fas":"far";o?t=`<i class="${n} fa-fw ${e.icon}"></i>`:t=`<div class="textIcon">${e.icon}</div>`}let a='<i class="fas fa-fw"></i>';return e.isActive&&(a='<i class="fas fa-fw fa-check"></i>'),{iconHtml:t,configIconHtml:a}}async function en(){const e=document.querySelector("#commandLine .suggestions");if(e===null)throw new Error("Commandline element not found");if(ta===""&&Vt){dg();return}const t=await Vd(),a=t.list.filter(n=>n.found===!0).map(n=>{let l=!1;if(n.active!==void 0)l=n.active();else{const c=n.configKey??t.configKey;c!==void 0&&(n.configValueMode==="include"?Array.isArray(n.configValue)?l=ui(jb(r[c],n.configValue),n.configValue):l=r[c].includes(n.configValue):l=r[c]===n.configValue)}return{...n,isActive:l}});if(Ys&&Vt===Ys.usingSingleList&&ur(a,Ys.list))return;Ys={list:a,usingSingleList:Vt};let o="",i=0;for(const n of a){if(n.found!==!0)continue;let l="";n.customStyle!==void 0&&n.customStyle!==""&&(l=n.customStyle);const{iconHtml:c,configIconHtml:d}=bM(n);let u=n.display;Vt&&(u=(n.singleListDisplay??"")||n.display,(n.configValue!==void 0||n.active!==void 0)&&(u=u.replace('<i class="fas fa-fw fa-chevron-right chevronIcon"></i>','<i class="fas fa-fw fa-chevron-right chevronIcon"></i>'+d)));let m=c;if((!Vt&&n.subgroup===void 0&&n.configValue!==void 0||!Vt&&n.active!==void 0)&&(m=d),n.customData!==void 0){if(n.id.startsWith("changeTheme")&&(o+=`<div class="command changeThemeCommand" data-command-id="${n.id}" data-index="${i}" style="${l}">
      <div class="icon">${m}</div><div>${u}</div>
      <div class="themeFavIcon ${n.customData.isFavorite===!0?"":"hidden"}">
        <i class="fas fa-star"></i>
      </div>
      <div class="themeBubbles" style="background: ${n.customData.bgColor};outline: 0.25rem solid ${n.customData.bgColor};">
        <div class="themeBubble" style="background: ${n.customData.mainColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.subColor}"></div>
        <div class="themeBubble" style="background: ${n.customData.textColor}"></div>
      </div>
      </div>`),n.id.startsWith("setFontFamily")){let p=n.customData.name;p==="Helvetica"&&(p="Comic Sans MS"),n.customData.isSystem===!1&&(p+=" Preview"),o+=`<div class="command" data-command-id="${n.id}" data-index="${i}" style="font-family: '${p}'"><div class="icon">${m}</div><div>${u}</div></div>`}}else o+=`<div class="command" data-command-id="${n.id}" data-index="${i}" style="${l}"><div class="icon">${m}</div><div>${u}</div></div>`;i++}e.innerHTML=o}async function qa(){if(Fr)return;const e=[...document.querySelectorAll("#commandLine .suggestions .command")];for(const o of e)o.classList.remove("active");const t=e[Ft],a=(await Kd()).filter(o=>o.found)[Ft];if(ad=a??null,t===void 0||a===void 0){Rf(),Sr(!1),tp();return}t.classList.add("active"),kC(),Rf(),a.id?.startsWith("changeTheme")||a.id?.startsWith("setCustomThemeId")?gM():(Sr(),tp()),a.hover?.()}let xu;function yM(){if(!Fr){if(Le.command===null)throw new Error("Can't handle input submit - command is null");if(Le.validation?.status!=="checking"){if(Le.validation?.status==="failed"){ba.getModal().classList.add("hasError"),xu!==null&&clearTimeout(xu),xu=setTimeout(()=>{ba.getModal().classList.remove("hasError")},500);return}"inputValueConvert"in Le.command?Le.command.exec?.({commandlineModal:ba,input:Le.command.inputValueConvert(ta)}):Le.command.exec?.({commandlineModal:ba,input:ta}),Qi("usedCommandLine",{command:Le.command.id}),Ud()}}}async function Tb(){if(Fr||ad===null)return;const e=ad;if(e.input){const t=e.display.split("</i>")[1]??e.display;wo="input",Le={command:e,placeholder:t,value:e.defaultValue?.()??"",icon:e.icon??"fa-chevron-right"},xC(e),await tn(Le.value),dg()}else e.subgroup?(uM(e.subgroup),await tn(""),await Zi(),await en(),await qa()):(e.exec?.({commandlineModal:ba}),r.singleListCommandLine==="on"&&(ep=ta),e.sticky??!1?(await Zi(),await en(),await qa()):(Qi("usedCommandLine",{command:e.id}),e.opensModal||Ud(!0)))}let Lb;function kC(){if(In)return;const e=document.querySelector(".suggestions .command.active");e===null||e.dataset.index===Lb||(e.scrollIntoView({behavior:"auto",block:"center"}),Lb=e.dataset.index)}async function tn(e){const t=document.querySelector("#commandLine .searchicon"),a=document.querySelector("#commandLine input");if(a===null||t===null)throw new Error("Commandline element or icon element not found");if(e!==void 0&&(ta=e),a.value=ta,wo==="input")Le.icon!==null&&(t.innerHTML=`<i class="fas fa-fw ${Le.icon}"></i>`),Le.placeholder!==null&&(a.placeholder=Le.placeholder),Le.value!==null&&(a.value=Le.value,a.setSelectionRange(0,a.value.length));else{t.innerHTML='<i class="fas fa-fw fa-search"></i>',a.placeholder="Search...";const o=await Vd();o.title!==void 0&&o.title!==""&&(a.placeholder=`${o.title}`);let i=ta.length;e!==void 0&&(i=e.length),setTimeout(()=>{a.setSelectionRange(i,i)},0)}}async function $b(){Ft++,Ft>=(await Kd()).filter(e=>e.found).length&&(Ft=0),await qa()}async function Mb(){Ft--,Ft<0&&(Ft=(await Kd()).filter(e=>e.found).length-1),await qa()}function vM(e){const t=ba.getModal().querySelector(".warning"),a=ba.getModal().querySelector(".warning .text");if(t===null||a===null)throw new Error("Commandline warning element not found");t.classList.remove("hidden"),a.textContent=e}const SC=Bt(200,async()=>{const e=ba.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.remove("hidden")});function Ab(){SC.cancel({upcomingOnly:!0});const e=ba.getModal().querySelector(".checkingicon");if(e===null)throw new Error("Commandline checking icon element not found");e.classList.add("hidden")}function od(){const e=ba.getModal().querySelector(".warning");if(e===null)throw new Error("Commandline warning element not found");e.classList.add("hidden")}function wM(e){Le.validation=e,e.status==="checking"?SC():e.status==="failed"&&e.errorMessage!==void 0?(vM(e.errorMessage),Ab()):(od(),Ab())}const ap=new Map;function xC(e){if("validation"in e&&!ap.has(e.id)){const t=e,a=fw(wM,t.validation,"inputValueConvert"in t?t.inputValueConvert:void 0);ap.set(e.id,a)}}const ba=new ue({dialogId:"commandLine",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{Ud()},showOptionsWhenInChain:{focusFirstInput:!0},setup:async e=>{const t=e.querySelector("input");t.addEventListener("input",Bt(50,async i=>{ta=i.target.value,No===null&&(r.singleListCommandLine==="on"?Vt=!0:Vt=ta.startsWith(">")),wo==="search"&&(In=!1,Ft=0,await Zi(),await en(),await qa())})),t.addEventListener("keydown",async i=>{if(In=!1,i.key==="ArrowUp"||i.ctrlKey&&(i.key.toLowerCase()==="k"||i.key.toLowerCase()==="p")){if(r.singleListCommandLine==="on"&&No===null&&ta===""&&ep!==""){ta=ep,await tn(),await Zi(),await en(),await qa();return}i.preventDefault(),await Mb()}if((i.key==="ArrowDown"||i.ctrlKey&&(i.key.toLowerCase()==="j"||i.key.toLowerCase()==="n"))&&(i.preventDefault(),await $b()),i.key==="Tab"&&(i.preventDefault(),i.shiftKey?await Mb():await $b()),i.key==="Enter")if(i.preventDefault(),wo==="search")await Tb();else if(wo==="input")yM();else throw new Error("Unknown mode, can't handle enter press");i.key==="Escape"&&(i.preventDefault(),i.stopPropagation(),await hM())}),t.addEventListener("input",async i=>{if(Le===null||Le.command===null||!("validation"in Le.command))return;const n=ap.get(Le.command.id);if(n===void 0)throw new Error(`Expected handler for command ${Le.command.id} is missing`);await n(i)}),e.addEventListener("mousemove",i=>{In=!0});const a=document.querySelector(".suggestions");let o;a.addEventListener("mousemove",async i=>{In=!0;const n=i.target;if(n===o)return;const l=Og(n?.getAttribute("data-index"));l!==void 0&&(o=i.target,Ft=l,await qa())}),a.addEventListener("click",async i=>{const n=i.target,l=Og(n?.getAttribute("data-index"));if(l===void 0)return;const c=Ft;Ft=l,c!==Ft&&await qa(),await Tb()})}}),CM=["Alt","AltGraph","CapsLock","Control","Fn","FnLock","Hyper","Meta","OS","NumLock","ScrollLock","Scroll","Shift","Super","Symbol","SymbolLock"];document.addEventListener("keydown",e=>{if(Kn()||e.key===void 0)return;if(pe()==="test"&&!Ie&&!Jn()&&!Ig()&&!["Enter"," ","Escape","Tab",...CM].includes(e.key)&&!e.metaKey&&!e.ctrlKey&&(nl(),r.showOutOfFocusWarning&&e.preventDefault()),(e.key==="Escape"&&r.quickRestart!=="esc"||e.key==="Tab"&&r.quickRestart==="esc"&&!Wi&&!e.shiftKey||e.key==="Tab"&&r.quickRestart==="esc"&&Wi&&e.shiftKey||e.key.toLowerCase()==="p"&&(e.metaKey||e.ctrlKey)&&e.shiftKey)&&(e.preventDefault(),Ig()||cn()),!Jn()){const a=document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.tagName==="SELECT"||document.activeElement?.tagName==="BUTTON"||document.activeElement?.classList.contains("button")===!0||document.activeElement?.classList.contains("textButton")===!0;(e.key==="Tab"&&r.quickRestart==="tab"&&!a||e.key==="Escape"&&r.quickRestart==="esc"||e.key==="Enter"&&r.quickRestart==="enter"&&!a)&&(e.preventDefault(),pe()==="test"?(e.shiftKey&&ie(),R()):Ke(""))}});window.addEventListener("keydown",function(e){e.code==="Space"&&(e.target===document.body||e.target?.id==="result")&&e.preventDefault()});window.onerror=function(e,t,a,o,i){};window.onunhandledrejection=function(e){};function TC(){LC.show()}const LC=new ue({dialogId:"supportModal",setup:async e=>{e.querySelector("button.ads")?.addEventListener("click",async()=>{cn({subgroupOverride:"enableAds"},{modalChain:LC})})}});function $C(){kM.show()}const kM=new ue({dialogId:"contactModal"});function SM(){xM.show({beforeAnimation:async()=>{s("#versionHistoryModal .modal").html(`
    <div class="preloader">
      <i class="fas fa-fw fa-spin fa-circle-notch"></i>
    </div
  `),vx().then(e=>{s("#versionHistoryModal .modal").html('<div class="releases"></div'),e.forEach(t=>{if(!t.draft&&!t.prerelease){let a=t.body;a=a.replace(/\r\n/g,"<br>"),a=a.replace(/### (.*?)<br>/g,"<h3>$1</h3>"),a=a.replace(/<\/h3><br>/gi,"</h3>"),a=a.replace(/^- /gm,""),a=a.replace(/\*\*(.*?)\*\*/g,"<b>$1</b>"),a=a.replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" target="_blank">$1</a>'),s("#versionHistoryModal .modal .releases").append(`
        <div class="release">
          <div class="title">${t.name}</div>
          <div class="date">${te(new Date(t.published_at),"dd MMM yyyy")}</div>
          <div class="body">${a}</div>
        </div>
      `)}})}).catch(e=>{const t=se(e,"Failed to fetch version history");s("#versionHistoryModal .modal").html(`<div class="releases">${t}</div`)}),s("#newVersionIndicator").addClass("hidden")}})}const xM=new ue({dialogId:"versionHistoryModal"});document.querySelector("footer #commandLineMobileButton")?.addEventListener("click",async()=>{cn({singleListOverride:!1})});document.querySelector("footer #newVersionIndicator")?.addEventListener("click",e=>{e.stopPropagation(),document.querySelector("#newVersionIndicator")?.classList.add("hidden")});document.querySelector("footer .currentVersion")?.addEventListener("click",e=>{e.shiftKey?alert(JSON.stringify({clientVersion:ks.clientVersion,clientCompatibility:Au,lastSeenServerCompatibility:hy},null,2)):SM()});document.querySelector("footer .right .current-theme")?.addEventListener("click",async e=>{if(e.shiftKey){if(r.customTheme){v("customTheme",!1);return}if(_()&&(S()?.customThemes?.length??0)<1){f("No custom themes!",0),v("customTheme",!1);return}v("customTheme",!0)}else{const a=r.customTheme?"customThemesList":"themes";cn({subgroupOverride:a})}});document.querySelector("footer #supportMeButton")?.addEventListener("click",()=>{TC()});document.querySelector("footer #contactPopupButton")?.addEventListener("click",()=>{$C()});s("#keymap").on("click",".r5 .layoutIndicator",async()=>{cn({subgroupOverride:"keymapLayouts"})});function MC(e){ug.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.words}`}})}function TM(e=!1){ug.hide({clearModalChain:e})}function LM(){const e=parseInt(ug.getModal().querySelector("input")?.value,10);e!==null&&!isNaN(e)&&e>=0&&isFinite(e)?v("words",e)&&(ie(),R(),e>2e3?f("Stay safe and take breaks!",0):e===0&&f("Infinite words! Make sure to use Bail Out from the command line to save your result.",0,{duration:7})):f("Custom word amount must be at least 1",0),TM(!0)}const ug=new ue({dialogId:"customWordAmountModal",setup:async e=>{e.addEventListener("submit",t=>{t.preventDefault(),LM()})}}),Be={resultId:"",startingTags:[],tags:[],source:"accountPage"};function AC(e,t,a){if(!nt()){f("You are offline",0,{duration:2});return}if(e===""){f("Failed to show edit result tags modal: result id is empty",-1);return}Be.resultId=e,Be.startingTags=[...t],Be.tags=[...t],Be.source=a,fg.show({beforeAnimation:async()=>{$M(),_C()}})}function _b(){fg.hide()}function $M(){const e=fg.getModal().querySelector(".buttons");if(e===null){f("Failed to append buttons to edit result tags modal: could not find buttons element",-1);return}const t=new Set([...S()?.tags.map(a=>a._id)??[],...Be.tags]);e.innerHTML="";for(const a of t){const o=S()?.tags.find(n=>n._id===a),i=document.createElement("button");i.classList.add("toggleTag"),i.setAttribute("data-tag-id",a),i.innerHTML=o?.display??"unknown tag",i.addEventListener("click",n=>{MM(a),_C()}),e.appendChild(i)}}function _C(){for(const e of s("#editResultTagsModal .modal .buttons button")){const t=s(e).attr("data-tag-id")??"";Be.tags.includes(t)?s(e).addClass("active"):s(e).removeClass("active")}}function MM(e){Be.tags.includes(e)?Be.tags=Be.tags.filter(t=>t!==e):Be.tags.push(e)}async function AM(){oe();const e=await $.results.updateTags({body:{resultId:Be.resultId,tagIds:Be.tags}});if(j(),Be.tags=Be.tags.filter(a=>a!==void 0),e.status!==200){f("Failed to update result tags",-1,{response:e});return}const t=e.body.data?.tagPbs??[];f("Tags updated",1,{duration:2}),S()?.results?.forEach(a=>{a._id===Be.resultId&&(a.tags=Be.tags)}),Be.source==="accountPage"?P7(Be.resultId,Be.tags):Be.source==="resultPage"&&n9(Be.tags,t)}const fg=new ue({dialogId:"editResultTagsModal",setup:async e=>{e.querySelector("button.saveButton")?.addEventListener("click",t=>{if(ui(Be.startingTags,Be.tags)){_b();return}_b(),AM()})}});function EC(e){const t=/((-\s*)?\d+(\.\d+)?\s*[hms]?)/g,a=[...e.toLowerCase().matchAll(t)].map(o=>{const i=o[0],n=parseFloat(i.replace(/\s+/g,""));return i.includes("h")?3600*n:i.includes("m")?60*n:n}).reduce((o,i)=>o+i,0);return Math.floor(a)}function _M(e){const t=Math.floor(e/3600),a=Math.floor(e%3600/60),o=e%3600%60,i=[];return t>0&&i.push(`${t} hour${t===1?"":"s"}`),a>0&&i.push(`${a} minute${a===1?"":"s"}`),o>0&&i.push(`${o} second${o===1?"":"s"}`),i.length===3?`${i[0]}, ${i[1]} and ${i[2]}`:i.length===2?`${i[0]} and ${i[1]}`:`${i[0]}`}function qC(){const e=s("#customTestDurationModal input").val(),t=EC(e);let a="";t<0?a="Negative time? Really?":t===0?a="Infinite test":a=_M(t),s("#customTestDurationModal .preview").text(a)}function IC(e){DC.show({...e,focusFirstInput:"focusAndSelect",beforeAnimation:async t=>{t.querySelector("input").value=`${r.time}`,qC()}})}function EM(e=!1){DC.hide({clearModalChain:e})}function qM(){const e=EC(s("#customTestDurationModal input").val());if(e!==null&&!isNaN(e)&&e>=0&&isFinite(e))v("time",e),ie(),R(),e>=1800?f("Stay safe and take breaks!",0):e===0&&f("Infinite time! Make sure to use Bail Out from the command line to save your result.",0,{duration:7});else{f("Custom time must be a positive number or zero",0);return}EM(!0)}async function IM(e){e.addEventListener("submit",t=>{t.preventDefault(),qM()}),e.querySelector("input")?.addEventListener("input",t=>{qC()})}const DC=new ue({dialogId:"customTestDurationModal",setup:IM});function FC(){const e=s("#mobileTestConfigModal");if(e.find("button").removeClass("active"),e.find(`.modeGroup button[data-mode='${r.mode}']`).addClass("active"),e.find(".timeGroup").addClass("hidden"),e.find(".wordsGroup").addClass("hidden"),e.find(".quoteGroup").addClass("hidden"),e.find(".customGroup").addClass("hidden"),e.find(`.${r.mode}Group`).removeClass("hidden"),r.punctuation?e.find(".punctuation").addClass("active"):e.find(".punctuation").removeClass("active"),r.numbers?e.find(".numbers").addClass("active"):e.find(".numbers").removeClass("active"),r.mode==="time")e.find(`.timeGroup button[data-time='${r.time}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="words")e.find(`.wordsGroup button[data-words='${r.words}']`).addClass("active"),e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled");else if(r.mode==="quote"){if(ui(r.quoteLength,[0,1,2,3]))e.find(".quoteGroup button[data-quoteLength='all']").addClass("active");else for(const t of r.quoteLength)e.find(`.quoteGroup button[data-quoteLength='${t}']`).addClass("active");e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")}else r.mode==="zen"?(e.find(".punctuation").addClass("disabled"),e.find(".numbers").addClass("disabled")):r.mode==="custom"&&(e.find(".punctuation").removeClass("disabled"),e.find(".numbers").removeClass("disabled"))}function DM(){$n.show({beforeAnimation:async()=>{FC()}})}async function FM(e){const t=e.querySelectorAll(".wordsGroup button");for(const l of t)l.addEventListener("click",c=>{const u=c.currentTarget.getAttribute("data-words");if(u==="custom")MC({modalChain:$n});else if(u!==void 0){const m=parseInt(u);v("words",m),ie(),R()}});const a=e.querySelectorAll(".modeGroup button");for(const l of a)l.addEventListener("click",c=>{const u=c.currentTarget.getAttribute("data-mode");u!==r.mode&&(v("mode",u),ie(),R())});const o=e.querySelectorAll(".timeGroup button");for(const l of o)l.addEventListener("click",c=>{const u=c.currentTarget.getAttribute("data-time");if(u==="custom")IC({modalChain:$n});else if(u!==void 0){const m=parseInt(u);v("time",m),ie(),R()}});const i=e.querySelectorAll(".quoteGroup button");for(const l of i)l.addEventListener("click",c=>{const u=c.currentTarget.getAttribute("data-quoteLength")??"0";if(u==="all")Rn()&&(ie(),R());else if(u==="-2")sg({modalChain:$n});else{const m=parseInt(u,10);let p=[];c.shiftKey?p=[...r.quoteLength,m]:p=[m],v("quoteLength",p)&&(ie(),R())}});e.querySelector(".customChange")?.addEventListener("click",()=>{og({modalChain:$n})}),e.querySelector(".punctuation")?.addEventListener("click",()=>{v("punctuation",!r.punctuation),ie(),R()}),e.querySelector(".numbers")?.addEventListener("click",()=>{v("numbers",!r.numbers),ie(),R()}),e.querySelector(".shareButton")?.addEventListener("click",()=>{ig({modalChain:$n})});const n=e.querySelectorAll("button");for(const l of n)l.addEventListener("click",()=>{FC()})}const $n=new ue({dialogId:"mobileTestConfigModal",setup:FM});s(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=s(e.currentTarget).attr("commands");t!==void 0&&cn({subgroupOverride:t})});s(".pageTest").on("click","#testModesNotice .textButton",async e=>{const t=s(e.currentTarget).attr("commandId");t!==void 0&&cn({commandOverride:t})});s(".pageTest").on("click","#testConfig .wordCount .textButton",e=>{s(e.currentTarget).attr("wordCount")==="custom"&&MC()});s(".pageTest").on("click","#testConfig .time .textButton",e=>{s(e.currentTarget).attr("timeconfig")==="custom"&&IC()});s(".pageTest").on("click","#testConfig .shareButton",e=>{ig()});s(".pageTest").on("click",".tags .editTagsButton",()=>{if((S()?.tags?.length??0)>0){const e=s(".pageTest .tags .editTagsButton").attr("data-result-id"),t=s(".pageTest .tags .editTagsButton").attr("data-active-tag-ids"),a=t===""?[]:t.split(",");AC(e,a,"resultPage")}});s(".pageTest").on("click","#mobileTestConfigButton",()=>{DM()});s(".pageTest #rateQuoteButton").on("click",async()=>{if(be===null){f("Failed to show quote rating popup: no quote",-1);return}B8(be)});s(".pageTest #reportQuoteButton").on("click",async()=>{if(be===null){f("Failed to show quote report popup: no quote",-1);return}tC(be?.id)});s(".pageTest").on("click","#testConfig .quoteLength .textButton",e=>{parseInt(s(e.currentTarget).attr("quoteLength")??"0")===-2&&sg()});s(".pageTest").on("click","#testConfig .customText .textButton",()=>{og()});s(".pageTest").on("click","#practiseWordsButton",()=>{if(r.mode==="zen"){f("Practice words is unsupported in zen mode",0);return}p1()});s(".pageTest #dailyLeaderboardRank").on("click",async()=>{Ke(`/leaderboards?type=daily&language=${r.language}&mode2=${di(r,null)}&goToUserPage=true`)});document.querySelector("#pageAbout #supportMeAboutButton")?.addEventListener("click",()=>{TC()});document.querySelector("#pageAbout #contactPopupButton2")?.addEventListener("click",()=>{$C()});const pg={includeBackground:!1};function PM(){op.show({beforeAnimation:async e=>{e.querySelector("input[type='checkbox']").checked=!1,pg.includeBackground=!1}})}async function BM(){const e={c:To.map(t=>s(`.pageSettings .tabContent.customTheme #${t}[type='color']`).attr("value"))};return pg.includeBackground&&(e.i=r.customBackground,e.s=r.customBackgroundSize,e.f=r.customBackgroundFilter),window.location.origin+"?customTheme="+btoa(JSON.stringify(e))}async function RM(){const e=await BM();try{await navigator.clipboard.writeText(e),f("URL Copied to clipboard",1),op.hide()}catch{f("Looks like we couldn't copy the link straight to your clipboard. Please copy it manually.",0,{duration:5}),ip.show({modalChain:op,focusFirstInput:"focusAndSelect",beforeAnimation:async a=>{a.querySelector("input").value=e}})}}const op=new ue({dialogId:"shareCustomThemeModal",setup:async e=>{e.querySelector("button")?.addEventListener("click",RM),e.querySelector("input[type='checkbox']")?.addEventListener("change",t=>{pg.includeBackground=t.target.checked})}}),ip=new ue({dialogId:"shareCustomThemeUrlModal",customEscapeHandler:async()=>{await ip.hide({clearModalChain:!0})},customWrapperClickHandler:async()=>{await ip.hide({clearModalChain:!0})}}),WM=I.object({security:I.boolean(),analytics:I.boolean(),sentry:I.boolean()}).strict().nullable();function mg(){return PC.get()}function Tu(e){PC.set(e),BC()}const PC=new ut({key:"acceptedCookies",schema:WM,fallback:null});function BC(){const e=mg();e?.analytics&&T9(),e?.sentry&&y5()}function RC(e){Di.show({beforeAnimation:async()=>{if(e){const t=mg();WC(t)}},afterAnimation:async()=>{Fn("cookiesModal")||Di.destroy()}})}function WC(e){Di.getModal().querySelector(".main")?.classList.add("hidden"),Di.getModal().querySelector(".settings")?.classList.remove("hidden"),e&&(e.analytics&&(Di.getModal().querySelector(".cookie.analytics input").checked=!0),e.sentry&&(Di.getModal().querySelector(".cookie.sentry input").checked=!0))}async function Lu(){Di.hide({afterAnimation:async()=>{nl()}})}const Di=new ue({dialogId:"cookiesModal",customEscapeHandler:()=>{},customWrapperClickHandler:()=>{},setup:async e=>{e.querySelector(".acceptAll")?.addEventListener("click",()=>{Tu({security:!0,analytics:!0,sentry:!0}),Lu()}),e.querySelector(".rejectAll")?.addEventListener("click",()=>{Tu({security:!0,analytics:!1,sentry:!1}),Lu()}),e.querySelector(".openSettings")?.addEventListener("click",()=>{WC()}),e.querySelector(".cookie.ads .textButton")?.addEventListener("click",()=>{try{Z4()}catch{console.error("Failed to open ad consent UI"),f("Failed to open Ad consent popup. Do you have an ad or cookie popup blocker enabled?",-1)}}),e.querySelector(".acceptSelected")?.addEventListener("click",()=>{const t=e.querySelector(".cookie.analytics input").checked,a=e.querySelector(".cookie.sentry input").checked;Tu({security:!0,analytics:t,sentry:a}),Lu()})}}),jd=document.querySelector("#pageSettings");jd?.querySelector("#shareCustomThemeButton")?.addEventListener("click",()=>{PM()});jd?.querySelector(".section.updateCookiePreferences .buttons button")?.addEventListener("click",()=>{RC(!0)});jd?.querySelector(".section.presets")?.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("addPresetButton"))lc("add");else if(t.classList.contains("editButton")){const a=t.parentElement?.getAttribute("data-id"),o=t.parentElement?.getAttribute("data-display");if(a===void 0||o===void 0||a===""||o===""||a===null||o===null){f("Failed to edit preset: Could not find preset id or name",-1);return}lc("edit",a,o)}else if(t.classList.contains("removeButton")){const a=t.parentElement?.getAttribute("data-id"),o=t.parentElement?.getAttribute("data-display");if(a===void 0||o===void 0||a===""||o===""||a===null||o===null){f("Failed to remove preset: Could not find preset id or name",-1);return}lc("remove",a,o)}});jd?.querySelector(".section.tags")?.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("addTagButton"))Gs("add");else if(t.classList.contains("editButton")){const a=t.parentElement?.getAttribute("data-id"),o=t.parentElement?.getAttribute("data-display");if(a===void 0||o===void 0||a===""||o===""||a===null||o===null){f("Failed to edit tag: Could not find tag id or name",-1);return}Gs("edit",a,o)}else if(t.classList.contains("clearPbButton")){const a=t.parentElement?.getAttribute("data-id"),o=t.parentElement?.getAttribute("data-display");if(a===void 0||o===void 0||a===""||o===""||a===null||o===null){f("Failed to clear tag PB: Could not find tag id or name",-1);return}Gs("clearPb",a,o)}else if(t.classList.contains("removeButton")){const a=t.parentElement?.getAttribute("data-id"),o=t.parentElement?.getAttribute("data-display");if(a===void 0||o===void 0||a===""||o===""||a===null||o===null){f("Failed to remove tag: Could not find tag id or name",-1);return}Gs("remove",a,o)}});function zM(e){const t=HC.getModal();t.querySelector("table tbody").innerHTML="",t.querySelector("table thead tr td").textContent=e,t.querySelector("table thead tr td span.unit").textContent=r.typingSpeedUnit;const a=S();if(!a)return;const o=a.personalBests?.[e];if(o===void 0)return;const i=[];Object.keys(o).forEach(function(l){let c=o[l]??[];c=c.sort(function(d,u){return u.wpm-d.wpm}),c.forEach(function(d){d.mode2=l,i.push(d)})});let n;i.forEach(l=>{let c='-<br><span class="sub">-</span>';const d=new Date(l.timestamp);l.timestamp&&(c=te(d,"dd MMM yyyy")+"<br><div class='sub'>"+te(d,"HH:mm")+"</div>"),t.querySelector("table tbody")?.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${n===l.mode2?"":l.mode2}</td>
        <td>
          ${W.typingSpeed(l.wpm)}
          <br />
          <span class="sub">${W.accuracy(l.acc)}</span>
        </td>
        <td>
          ${W.typingSpeed(l.raw)}
          <br />
          <span class="sub">${W.percentage(l.consistency)}</span>
        </td>
        <td>${l.difficulty}</td>
        <td>${l.language?Ra(l.language):"-"}</td>
        <td>${l.punctuation?'<i class="fas fa-check"></i>':""}</td>
        <td>${l.numbers?'<i class="fas fa-check"></i>':""}</td>
        <td>${l.lazyMode?'<i class="fas fa-check"></i>':""}</td>
        <td>${c}</td>
      </tr>
    `),n=l.mode2})}function zC(e){HC.show({beforeAnimation:async()=>{zM(e)}})}const HC=new ue({dialogId:"pbTablesModal"});function HM(){if(!nt()){f("You are offline",0,{duration:2});return}NC.show({beforeAnimation:async()=>{UM(),VM()}})}function OM(){NC.hide({afterAnimation:async()=>{const e=S();e&&Kc("account",e)}})}const gg=V("#editProfileModal .bio"),hg=V("#editProfileModal .keyboard"),bg=V("#editProfileModal .twitter"),yg=V("#editProfileModal .github"),vg=V("#editProfileModal .website"),Rl=V("#editProfileModal .badgeSelectionContainer"),OC=V("#editProfileModal .editProfileShowActivityOnPublicProfile"),NM=[$u(bg,J2),$u(yg,Z2),$u(vg,ek)];let Dn=-1;function UM(){const e=S();if(!e)return;const t=e.inventory?.badges??[],{bio:a,keyboard:o,socialProfiles:i,showActivityOnPublicProfile:n}=e.details??{};Dn=-1,gg.setValue(a??""),hg.setValue(o??""),bg.setValue(i?.twitter??""),yg.setValue(i?.github??""),vg.setValue(i?.website??""),Rl.setHtml(""),OC.native.checked=n??!1,t?.forEach(l=>{l.selected&&(Dn=l.id);const c=gs(l.id,!1,!0),d=`<button type="button" class="badgeSelectionItem ${l.selected?"selected":""}" selection-id=${l.id}>${c}</button>`;Rl?.appendHtml(d)}),Rl?.prependHtml(`<button type="button" class="badgeSelectionItem ${Dn===-1?"selected":""}" selection-id=-1>
      <div class="badge">
        <i class="fas fa-frown-open"></i>
        <div class="text">none</div>
      </div>
    </button>`),s(".badgeSelectionItem").on("click",({currentTarget:l})=>{const c=s(l).attr("selection-id");Dn=parseInt(c,10),Rl?.qsa(".badgeSelectionItem")?.removeClass("selected"),s(l).addClass("selected")}),NM.forEach(l=>l.hide())}function VM(){new qr(gg,250),new qr(hg,75)}function KM(){const e=gg.getValue()??"",t=hg.getValue()??"",a=bg.getValue()??"",o=yg.getValue()??"",i=vg.getValue()??"",n=OC.isChecked()??!1;return{bio:e,keyboard:t,socialProfiles:{twitter:a,github:o,website:i},showActivityOnPublicProfile:n}}async function jM(){const e=S();if(!e)return;const t=KM(),a=39;if(t.socialProfiles?.github!==void 0&&t.socialProfiles?.github.length>a){f(`GitHub username exceeds maximum allowed length (${a} characters).`,-1);return}const o=20;if(t.socialProfiles?.twitter!==void 0&&t.socialProfiles?.twitter.length>o){f(`Twitter username exceeds maximum allowed length (${o} characters).`,-1);return}oe();const i=await $.users.updateProfile({body:{...t,selectedBadgeId:Dn}});if(j(),i.status!==200){f("Failed to update profile",-1,{response:i});return}e.details=i.body.data??t,e.inventory?.badges.forEach(n=>{n.id===Dn?n.selected=!0:delete n.selected}),f("Profile updated",1),OM()}function $u(e,t){const a=new uw(e,{valid:{icon:"fa-check",level:1},invalid:{icon:"fa-times",level:-1},checking:{icon:"fa-circle-notch",spinIcon:!0,level:0}});return e.on("input",o=>{const i=o.target.value;if(i===void 0||i===""){a.hide();return}const n=t.safeParse(i);if(!n.success){a.show("invalid",n.error.errors.map(l=>l.message).join(", "));return}a.show("valid")}),a}const NC=new ue({dialogId:"editProfileModal",setup:async e=>{e.addEventListener("submit",async t=>{t.preventDefault(),await jM()})}});function GM(){QM.show(void 0,{})}const QM=new fe({id:"newFilterPresetModal",title:"New Filter Preset",inputs:[{placeholder:"Preset Name",type:"text",initVal:"",validation:{schema:hc.shape.name}}],buttonText:"add",onlineOnly:!0,execFn:async(e,t)=>await l7(t)===1?{status:1,message:"Filter preset created"}:{status:-1,message:"Error creating filter preset",alwaysHide:!0}}),pl=document.querySelector("#pageAccount");s(pl).on("click",".pbsTime .showAllButton",()=>{zC("time")});s(pl).on("click",".pbsWords .showAllButton",()=>{zC("words")});s(pl).on("click",".editProfileButton",()=>{if(!_()){f("You must be logged in to edit your profile",0);return}const e=S();if(!e){f("Failed to open edit profile modal: No user snapshot found",-1);return}if(e.banned===!0){f("Banned users cannot edit their profile",0);return}HM()});const YM=I.array(I.string());s(pl).on("click",".group.history .resultEditTagsButton",e=>{const t=s(e.target).attr("data-result-id"),a=s(e.target).attr("data-tags");AC(t??"",ws(a??"[]",YM),"accountPage")});s(pl).find("button.createFilterPresetBtn").on("click",()=>{GM()});const XM=document.getElementById("pageLeaderboards");for(const e of XM?.querySelectorAll(".jumpButtons button[data-action='goToPage']")??[])e?.addEventListener("click",()=>{Oe("lbGoToPage")});function JM(){if(!Xi()){f("Could not show forgot password popup: Captcha is not available. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}wg.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async e=>{Mo("forgotPasswordModal"),Is(e.querySelector(".g-recaptcha"),"forgotPasswordModal",async()=>{await UC()})}})}async function UC(){const e=ul("forgotPasswordModal");if(!e){f("Please complete the captcha");return}const t=wg.getModal().querySelector("input").value.trim();if(!t){f("Please enter your email address"),Mo("forgotPasswordModal");return}if(!bc.safeParse(t).success){f("Please enter a valid email address"),Mo("forgotPasswordModal");return}oe(),$.users.forgotPasswordEmail({body:{email:t,captcha:e}}).then(o=>{if(j(),o.status!==200){f("Failed to send password reset email: "+o.body.message,-1);return}f(o.body.message,1,{duration:5})}),np()}function np(){wg.hide()}async function ZM(e){e.querySelector("button")?.addEventListener("click",async()=>{await UC()})}const wg=new ue({dialogId:"forgotPasswordModal",setup:ZM,customEscapeHandler:async()=>{np()},customWrapperClickHandler:async()=>{np()}}),eA=document.querySelector("#pageLogin");s(eA).on("click","#forgotPasswordButton",()=>{JM()});let Nt;function tA(e){VC.show({mode:"dialog",focusFirstInput:!0,beforeAnimation:async()=>{if(Nt=e,!Xi()){f("Could not show google sign up popup: Captcha is not avilable. This could happen due to a blocked or failed network request. Please refresh the page or contact support if this issue persists.",-1);return}Mo("googleSignUpModal"),Is(s("#googleSignUpModal .captcha")[0],"googleSignUpModal"),iA(),Cg()},afterAnimation:async()=>{Xi()||Pr()}})}async function Pr(){VC.hide({afterAnimation:async()=>{gy(),Nt!==void 0&&(f("Sign up process cancelled",0,{duration:5}),Xa(),oo(),pp(Nt)?.isNewUser&&(await $.users.delete(),await Nt?.user.delete().catch(()=>{})),ln(),Nt=void 0)}})}async function aA(){if(!Nt){f("Missing user credential. Please close the popup and try again.",-1);return}const e=ul("googleSignUpModal");if(!e){f("Please complete the captcha",0);return}nA(),Cg(),oe();const t=s("#googleSignUpModal input").val();try{if(t.length===0)throw new Error("Name cannot be empty");const a=await $.users.create({body:{name:t,captcha:e}});if(a.status!==200)throw new Error(`Failed to create user: ${a.body.message}`);a.status===200&&(await ry(Nt.user,{displayName:t}),await uS(Nt.user),f("Account created",1),oo(),Xa(),await P1(Nt.user),Nt=void 0,j(),Pr())}catch(a){console.log(a);const o=se(a,"Failed to sign in with Google");f(o,-1),Xa(),oo(),Nm(),Nt&&pp(Nt)?.isNewUser&&(await $.users.delete(),await Nt?.user.delete().catch(()=>{})),ln(),Nt=void 0,Pr(),j();return}}function oA(){s("#googleSignUpModal button").prop("disabled",!1)}function Cg(){s("#googleSignUpModal button").prop("disabled",!0)}const kg=V("#googleSignUpModal input");function iA(){kg?.enable()}function nA(){kg?.disable()}new Ca(kg,{schema:Cs,isValid:cl(async e=>$.users.getNameAvailability({params:{name:e}}),{check:e=>e.available||"Name not available"}),debounceDelay:1e3,callback:e=>{e.status==="success"?oA():Cg()}});async function sA(e){e.addEventListener("submit",t=>{t.preventDefault(),aA()})}SS((e,t)=>{e!==void 0&&t&&tA(e)});const VC=new ue({dialogId:"googleSignUpModal",setup:sA,customEscapeHandler:async()=>{Pr()},customWrapperClickHandler:async()=>{Pr()}}),KC=console.log,rA=console.warn,lA=console.error,jC=new ut({key:"debugLogs",schema:I.boolean(),fallback:!1});let Xs=jC.get();function cA(){Xs=!Xs,GC(`Debug logs ${Xs?"enabled":"disabled"}`),jC.set(Xs)}function GC(...e){KC("%cINFO","background:#4CAF50;color: #111;padding:0 5px;border-radius:10px",...e)}function dA(...e){rA("%cWRN","background:#FFC107;color: #111;padding:0 5px;border-radius:10px",...e)}function uA(...e){lA("%cERR","background:#F44336;color: #111;padding:0 5px;border-radius:10px",...e)}function fA(...e){Xs&&KC("%cDEBG","background:#2196F3;color: #111;padding:0 5px;border-radius:10px",...e)}console.log=GC;console.warn=dA;console.error=uA;console.debug=fA;const QC=new ut({key:"accountSettingsMessageDismissed",schema:I.boolean(),fallback:!1});QC.get()&&s(".pageSettings .accountSettingsNotice").remove();s(".pageSettings .accountSettingsNotice .dismissAndGo").on("click",()=>{QC.set(!0),Ke("/account-settings"),s(".pageSettings .accountSettingsNotice").remove()});let YC=!0,Sg=0,XC=!1,JC=-1,ZC="";function pA(){return YC}function Eb(e){YC=e}function mA(){return Sg}function gA(){Sg++}function hA(){Sg=0}function e2(){return XC}function qb(e){XC=e}function Ib(){return JC}function bA(e){JC=e}function yA(){return ZC}function xg(e){ZC=e}function vA(e){const{testInputWithData:t,currentWord:a,lastBurst:o}=e;if(r.minBurst!=="off"&&o!==null){let i;r.mode==="zen"?i=t.length:i=a.length;const n=F2(r.minBurstCustomSpeed,i);if(r.minBurst==="fixed"&&o<r.minBurstCustomSpeed||r.minBurst==="flex"&&o<n)return!0}return!1}function wA(e){const{testInputWithData:t,correct:a,spaceOrNewline:o}=e;if(r.mode==="zen")return!1;const i=r.difficulty==="expert"&&!a&&o&&t.length>1,n=r.difficulty==="master"&&!a;return!!(i||n)}function CA(e){const{shouldGoToNextWord:t,testInputWithData:a,currentWord:o,allWordsTyped:i,allWordsGenerated:n}=e,l=a===o,c=r.quickEnd&&o.length===a.length&&r.stopOnError==="off";return!!(i&&n&&(l||c||t))}async function kA({correctInsert:e,isCompositionEnding:t,zenNewline:a}){const o={increasedWordIndex:!1,lastBurst:0};Mv("forward",e,t||a===!0),$r(e?"submitCorrectWord":"submitErrorWord");for(const l of $t("handleSpace"))l.functions.handleSpace();const i=H0();return e0(i),o.lastBurst=i,Qx(e,F.getCurrent()),km(F.get(ne+1)),A.pushHistory(),on.pushHistory(),ne>=F.length-1?(qb(!0),oe(),await Eh(),j(),qb(!1)):Eh(),(ne<F.length-1||r.mode==="zen")&&(o.increasedWordIndex=!0,HS()),La(""),A.syncWithInputElement(),Av("forward"),o}function Db(e,t=!1){if(ne===0){La(""),A.syncWithInputElement();return}Mv("back",null,t),$r("backWord");const a=A.popHistory();OS(),on.popHistory(),km(F.get(ne));const o=_o("nospace");e==="deleteWordBackward"?La(""):e==="deleteContentBackward"&&(o||a.endsWith(`
`)?La(a.slice(0,-1)):La(a)),A.syncWithInputElement(),Av("back")}function SA(e){const{data:t,inputValue:a,targetWord:o,correctShiftUsed:i}=e;if(r.mode==="zen")return!0;if(i===!1)return!1;if(t===void 0)throw new Error("Failed to check if char is correct - data is undefined");if(hr(t))return a===o;const n=o[a.length];return n===void 0?!1:t===n}function t2(e){const{data:t,inputValue:a,targetWord:o}=e;if(!hr(t))return null;if(r.mode==="zen")return!1;const i=(o+" ").startsWith(a+" "),n=r.stopOnError==="letter"&&!i,l=r.stopOnError==="word"&&!i,c=a.length===0&&(r.strictSpace||r.difficulty!=="normal");return n||l||c}function a2(e){if(Lt||e2()||ao)return!0;const{inputValue:t}=Ts(),a=hr(e),o=t2({data:e,inputValue:t,targetWord:F.getCurrent()});if(a&&t===""&&r.difficulty==="normal"&&!r.strictSpace||a&&_o("nospace")||e===`
`&&!Xn&&r.mode!=="zen")return!0;const i=r.mode==="zen"?30:F.getCurrent().length+20;if(A.current.length>=i&&(o===!0||!a))return console.error("Hitting word limit"),!0;const l=e!==null&&e!=="",c=A.current.length>=F.getCurrent().length;if(!Sd()&&l&&!r.blindMode&&!r.hideExtraLetters&&c&&(o===!0||!a)&&r.mode!=="zen"){const d=lf.get(ne),{top:u,height:m}=U6((d??A.current)+e);if(u>Tr||m>gm)return!0}return!1}const xA=new Map([["…","..."]]);async function Gd(e){const{now:t,lastInMultiIndex:a,isCompositionEnding:o}=e,{inputValue:i}=Ts();if(e.data.length>1){La(i.slice(0,-e.data.length)),A.syncWithInputElement();for(let N=0;N<e.data.length;N++){const re=e.data[N];await Br({...e,data:re,lastInMultiIndex:N===e.data.length-1})}return}const n=xA.get(e.data);if(n!==void 0&&F.getCurrent()[A.current.length]!==e.data){La(i.slice(0,-e.data.length)+n),await Gd({...e,data:n});return}const l=A.current,c=F.getCurrent(),u=TA(e.data,l,c)??e.data;Me||lw(t);const m=a===!0||a===void 0,p=ne,g=hr(u),h=u===`
`,y=t2({data:u,inputValue:l,targetWord:c})===!0,k=r.oppositeShiftMode==="off"?null:pA(),C=Eo("isCharCorrect")?.functions.isCharCorrect(u,c[(l+u).length-1]??"")??SA({data:u,inputValue:l,targetWord:c,correctShiftUsed:k}),D=_o("nospace")&&(l+u).length===F.getCurrent().length,E=(g||h)&&!y||D;(!g||y)&&A.syncWithInputElement(),Yy(),$r(C?"correctLetter":"incorrectLetter",u),s3(C),Ix(u,C),a3(),i3(p),C||(o3(),u3(F.getCurrent())),r.keymapMode==="react"&&sx(u,C),l.length===0&&n3(t),E||on.update(u,C);let B=!1,z;r.stopOnError==="letter"&&!C&&(r.blindMode||(z=l+u),B=!0),!hr(u)&&k===!1?(B=!0,z=void 0,gA(),mA()>=5&&f("Opposite shift mode is on.",0,{important:!0,customTitle:"Reminder"})):hA(),B&&(Gy(""),A.syncWithInputElement());let H=null,ae=null;if(E){const N=await kA({correctInsert:C,isCompositionEnding:o===!0,zenNewline:h&&r.mode==="zen"});ae=N.lastBurst,H=N.increasedWordIndex}const xe=F.getCurrent(),Fe=/^\t+/.test(xe),ze=xe[A.current.length]==="	";r.language.startsWith("code")&&C&&Fe&&ze&&setTimeout(()=>{Br({data:"	",now:t})},0),!m3()&&m&&(wA({testInputWithData:l+u,correct:C,spaceOrNewline:g||h})?yf("difficulty"):H&&vA({testInputWithData:l+u,currentWord:c,lastBurst:ae})?yf("min burst"):CA({shouldGoToNextWord:E,testInputWithData:l+u,currentWord:c,allWordsTyped:p>=F.length-1,allWordsGenerated:Em()})&&ds()),m&&V6(C,H,z)}function TA(e,t,a){let o=null;const i=a[t.length];return i!==void 0&&O5(e,i,r.language)&&(Gy(i),o=i),o}async function Br(e){a2(e.data)||(J5(e.data),await Gd(e))}const Tg=mi();Tg.addEventListener("compositionstart",e=>{console.debug("wordsInput event compositionstart",{event:e,data:e.data}),!(Lt||ao)&&(Ep(!0),gd(""),xg(""),Me||lw(performance.now()))});Tg.addEventListener("compositionupdate",e=>{console.debug("wordsInput event compositionupdate",{event:e,data:e.data}),!(Lt||ao)&&(gd(e.data),xd(e.data))});Tg.addEventListener("compositionend",async e=>{if(console.debug("wordsInput event compositionend",{event:e,data:e.data}),Lt||ao)return;Ep(!1),gd(""),xd(""),xg("");const t=performance.now();e.data!==""&&await Gd({data:e.data,now:t,isCompositionEnding:!0})});async function LA(e){const t=performance.now();l3(t,e);const a=r.funbox.includes("arrows");if(e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key.startsWith("Arrow")&&!a){e.preventDefault();return}setTimeout(()=>{b4(e)},0)}let sp=!1;const $A=new RegExp("\\p{P}","u");async function MA(e){function t(u,m){let p=u.shiftKey;const g=sp&&m.length>2?2:0,h=!$A.test(m.slice(g,g+2).join(""));fo&&h&&(p=!u.shiftKey);const y=m[(p?1:0)+g]??"",k=m[p?1:0]??"",x=m[0];return y||k||x}let a;try{a=await zi(r.layout)}catch(u){return f(se(u,"Failed to emulate event"),-1),null}na().includes("layout_mirror")&&(a=em(a));let i=[];if(a.type==="ansi"?i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="iso"?i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","Backslash","IntlBackslash","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]:a.type==="matrix"&&(i=["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal","KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash","KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote","KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash","Space"]),!i.includes(e.code))return null;const n=a.keys,l=n.row1.concat(n.row2).concat(n.row3).concat(n.row4).concat(n.row5),c=i.indexOf(e.code);if(c===-1)return e.code.includes("Numpad")?e.key:null;const d=t(e,l[c]??[]);return d!==void 0?d:null}function o2(e){const t=e.code==="AltLeft"&&navigator.userAgent.includes("Mac");e.code!=="AltRight"&&!t||(e.type==="keydown"&&(sp=!0),e.type==="keyup"&&(sp=!1))}s(document).on("keydown",o2);s(document).on("keyup",o2);async function AA(e,t){if(r.quickRestart==="tab"&&(e.preventDefault(),Wi&&e.shiftKey||!Wi)){e.shiftKey&&ie(),R();return}if(Wi){await Br({data:"	",now:t}),e.preventDefault();return}}async function _A(e,t){if(e.shiftKey){if(r.mode==="zen"){ds();return}else if(!Dd(r.mode,r.words,r.time,xo(),to()??!1)){const a=Date.now()-Ib();if(Ib()===-1||a>200){bA(Date.now()),a>=5e3&&f("Please double tap shift+enter to confirm bail out",0,{important:!0,duration:5}),e.preventDefault();return}else{yp(!0),ds();return}}}if(r.quickRestart==="enter"&&(e.preventDefault(),Xn&&e.shiftKey||!Xn)){e.shiftKey&&ie(),R();return}}async function EA(e){if(r.oppositeShiftMode==="keymap"&&r.keymapLayout!=="overrideSync"){let t=await zi(r.keymapLayout).catch(()=>{});if(t===void 0){f("Failed to load keymap layout",-1);return}na().includes("layout_mirror")&&(t=em(t));const o=E0(e.key,t);Eb(o===void 0?!0:Yu(o))}else Eb(Yu(e.code))}async function qA(e,t){for(const a of $t("handleKeydown"))a.functions.handleKeydown(e);for(const a of $t("getEmulatedChar")){const o=a.functions.getEmulatedChar(e);if(o!==null)return await Br({data:o,now:t}),!0}return!1}async function IA(e){const t=performance.now();c3(t,e);const a=r.funbox.includes("arrows");if(e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key.startsWith("Arrow")&&!a){e.preventDefault();return}if(r.oppositeShiftMode!=="off"&&await EA(e),await qA(e,t)){e.preventDefault();return}if(r.layout!=="default"){const i=await MA(e);if(i!==null){await Br({data:i,now:t}),e.preventDefault();return}}if(e.repeat||setTimeout(()=>{h4(e)},0),e.key==="Tab"){await AA(e,t);return}if(e.key==="Enter"){await _A(e);return}if(e.key==="Escape"&&r.quickRestart==="esc"){e.preventDefault(),e.shiftKey&&ie(),R();return}}const i2=mi();i2.addEventListener("keyup",async e=>{console.debug("wordsInput event keyup",{event:e,key:e.key,code:e.code}),await LA(e)});i2.addEventListener("keydown",async e=>{console.debug("wordsInput event keydown",{event:e,key:e.key,code:e.code}),await IA(e)});function DA(e){const{realInputValue:t}=Ts(),a=A.current;A.syncWithInputElement(),$r("setLetterIndex",A.current.length),Yy();const o=/^\t*$/.test(a),i=F.getCurrent().startsWith(A.current);r.language.startsWith("code")&&r.codeUnindentOnBackspace&&a.length>0&&o&&i?(La(""),A.syncWithInputElement(),Db(e,!0)):t===""&&Db(e),j6()}const FA=new Set(["insertText","insertCompositionText","insertFromComposition","insertLineBreak","deleteWordBackward","deleteContentBackward"]);function n2(e){return FA.has(e)}function PA(e){if(!Me){e.preventDefault();return}if(Lt||e2()||ao)return;const{inputValue:t}=Ts(),a=t==="";if(a&&Es(ne-1)===null){e.preventDefault();return}if(r.freedomMode)return;const o=r.confidenceMode,i=(A.get(ne-1)??"")===F.get(ne-1);if(o==="on"&&a&&!i){e.preventDefault();return}if(o==="max"){e.preventDefault();return}if(a&&i){e.preventDefault();return}}const s2=mi();s2.addEventListener("beforeinput",async e=>{if(!(e instanceof InputEvent)){e.preventDefault();return}if(console.debug("wordsInput event beforeinput",{event:e,inputType:e.inputType,data:e.data,value:e.target.value}),!n2(e.inputType)){e.preventDefault();return}const t=e.inputType;if(t==="insertText"&&e.data!==null||t==="insertLineBreak"){let a=e.data;t==="insertLineBreak"&&(a=`
`),a2(a)&&e.preventDefault()}else if(t==="deleteWordBackward"||t==="deleteContentBackward")PA(e);else if(t==="insertCompositionText"||t==="insertFromComposition")e.isComposing||e.preventDefault();else throw new Error("Unhandled beforeinput type: "+t)});s2.addEventListener("input",async e=>{if(!(e instanceof InputEvent)){e.preventDefault();return}if(console.debug("wordsInput event input",{event:e,inputType:e.inputType,data:e.data,value:e.target.value}),!n2(e.inputType)){e.preventDefault();return}const t=performance.now(),a=e.inputType;if(a==="insertText"&&e.data!==null||a==="insertLineBreak"){let o=e.data;a==="insertLineBreak"&&(o=`
`),await Gd({data:o,now:t})}else if(a==="deleteWordBackward"||a==="deleteContentBackward")DA(a);else if(a==="insertCompositionText"||a==="insertFromComposition"){const o=ne>=F.length-1,i=A.current+(nn()??""),n=F.getCurrent()===i;Em()&&o&&n&&mi().dispatchEvent(new CompositionEvent("compositionend",{data:e.data??""})),yA()!==e.data&&(xg(e.data??""),K6())}else throw new Error("Unhandled input type: "+a)});const Na=mi();Na.addEventListener("focus",()=>{jy()});Na.addEventListener("copy paste",e=>{e.preventDefault()});Na.addEventListener("select selectstart",e=>{e.preventDefault()});Na.addEventListener("selectionchange",e=>{const t=window.getSelection();console.debug("wordsInput event selectionchange",{event:e,selection:t?.toString(),isCollapsed:t?.isCollapsed,selectionStart:Na.selectionStart,selectionEnd:Na.selectionEnd});const a=Na.selectionStart!==Na.selectionEnd,o=Na.selectionStart===Na.value.length;(a||!o)&&jy()});const Fb=new ut({key:"merchBannerClosed3",schema:I.boolean(),fallback:!1});function BA(){Fb.get()||wS('New merch store now open, including a limited edition metal keycap! <a target="_blank" rel="noopener" href="https://mktp.co/merch">monkeytype.store</a>',1,"./images/merch3.png",!1,()=>{Fb.set(!0)},!0)}Ob(async()=>{await Vy,await TS,L("body")?.setStyle({transition:"background .25s, transform .05s"}),BA();for(const t of $t("applyGlobalCSS"))t.functions.applyGlobalCSS();const e=document.querySelector("#app");e?.classList.remove("hidden"),O(e,{opacity:[0,1],duration:Y(250)}),nt()&&a5().then(()=>{Ba()?.users.signUp||(I5(),L(".register")?.addClass("hidden"),L(".login")?.addClass("hidden"),L(".disabledNotification")?.removeClass("hidden")),Ba()?.connections.enabled||L(".accountButtonAndMenu .goToFriends")?.addClass("hidden")}),A4(),new Ok("https://keymash.io/"),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(t=>{console.log("ServiceWorker registration successful with scope: ",t.scope)}).catch(t=>{console.error("ServiceWorker registration failed: ",t)})})});L("#nocss .requestedStylesheets")?.setHtml("Requested stylesheets:<br>"+[...document.querySelectorAll("link[rel=stylesheet")].map(e=>e.href).filter(e=>/\/css\/style/gi.test(e)).join("<br>"));L("#nocss .requestedJs")?.setHtml("Requested Javascript files:<br>"+[...document.querySelectorAll("script")].map(e=>e.src).filter(e=>/(\/js\/mon|\/js\/vendor)/gi.test(e)).join("<br>")+"<br><br>Client version:<br>"+ks.clientVersion);window.navigator.userAgent.toLowerCase().includes("mac")?L("#nocss .keys")?.setHtml(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-top: 1rem;
        margin-bottom: 1rem;
      "
    >
      Cmd
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `):L("#nocss .keys")?.setHtml(`
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
        margin-bottom: 1rem;
      "
    >
      Ctrl
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      Shift
    </span>
    +
    <span
      style="
        padding: 1rem;
        display: inline-block;
        border-radius: 1rem;
        background: #2c2e31;
      "
    >
      R
    </span>
  `);let Uo;async function r2(e=r.language){if(!Uo)return;const a=(await ii(e)).bcp47??"en-US";Uo.lang=a}async function l2(){Uo=new SpeechSynthesisUtterance,await r2()}function RA(){Uo=void 0}async function WA(e){window.speechSynthesis.cancel(),Uo===void 0&&await l2(),Uo!==void 0&&(Uo.text=e,window.speechSynthesis.speak(Uo))}Ce(({key:e,newValue:t})=>{e==="funbox"&&(t.includes("tts")?l2():RA()),e==="language"&&r.funbox.includes("tts")&&r2()});Z3(e=>{WA(e)});const c2=new ut({key:"lastSeenVersion",schema:I.string(),fallback:""});let rp=null,id=null;function zA(e){c2.set(e)}function HA(){return c2.get()}async function OA(){const{data:e,error:t}=await jt(yx());if(t){const o=se(t,"Failed to fetch version number from GitHub");console.error(o);return}const a=HA();rp=e,id=a===""?!1:a!==e,(id||a==="")&&(zA(e),NA())}function NA(){"caches"in window&&caches.keys().then(function(e){for(const t of e)caches.delete(t)})}async function UA(){return(rp===null||id===null)&&await OA(),{version:rp,isNew:id}}function VA(e){s("footer .currentVersion .text").text(e)}function KA(e){e?s("#newVersionIndicator").removeClass("hidden"):s("#newVersionIndicator").addClass("hidden")}async function jA(){const{version:e,isNew:t}=await UA();VA(e),KA(t)}Qt("devOptionsModal");const ot=V("#alertsPopup"),uo=ot.qsr(".accountAlerts .list"),mc=ot.qsr(".psas .list"),gc=ot.qsr(".notificationHistory .list");let va=[],d2=0,Ya=[],Co=[],GA=0;const ko={notifications:[],psas:[]};function Mu(){lp(!1),m5(0),f2.hide({afterAnimation:async()=>{gc?.empty(),mc?.empty();const e=[];let t=0;if(Ya.length===0&&Co.length===0)return;const a=await $.users.updateInbox({body:{mailIdsToMarkRead:Ya.length>0?Ya:void 0,mailIdsToDelete:Co.length>0?Co:void 0}}),o=a.status,i=a.body.message;if(o!==200){f(`Failed to update inbox: ${i}`,-1);return}const n=va.filter(l=>l.rewards.length>0&&Ya.includes(l.id)).map(l=>l.rewards).reduce(function(l,c){return l.concat(c)},[]);for(const l of n)if(l.type==="xp")t+=l.item;else if(l.type==="badge"){const c=C7(l.item.id);c&&(e.push(c.name),g5(l.item))}if(e.length>0&&f(`New badge${e.length>1?"s":""} unlocked: ${e.join(", ")}`,1,{duration:5,customTitle:"Reward",customIcon:"gift"}),t>0){const l=S()?.xp??0;Fy(l,t);const c=pe();(c==="account"||c==="profile")&&Fw(c,l+t,!0),p5(t)}}})}async function QA(){f2.show({beforeAnimation:async()=>{_()?(ot.qs(".accountAlerts")?.show(),ot.qs(".separator.accountSeparator")?.show(),uo.setHtml(`
          <div class="preloader"><i class="fas fa-fw fa-spin fa-circle-notch"></i></div>`)):(ot.qs(".accountAlerts")?.hide(),ot.qs(".separator.accountSeparator")?.hide()),va=[],Co=[],Ya=[],ZA(),JA()},afterAnimation:async()=>{_()&&YA()}})}async function YA(){if(!nt()){uo.setHtml(`
    <div class="nothing">
    You are offline
    </div>
    `);return}const e=await $.users.getInbox();if(e.status===503){uo.setHtml(`
    <div class="nothing">
    Account inboxes are temporarily unavailable
    </div>
    `);return}else if(e.status!==200){uo.setHtml(`
    <div class="nothing">
    Error getting inbox: ${e.body.message} Please try again later
    </div>
    `);return}const t=e.body.data;if(va=t.inbox,Lg(),va.length===0){uo.setHtml(`
    <div class="nothing">
    Nothing to show
    </div>
    `);return}d2=t.maxMail,u2(),uo.empty();for(const a of va){!a.read&&a.rewards.length===0&&Ya.push(a.id);let o="";a.rewards.length>0&&!a.read&&(o=`<div class="rewards">
        <i class="fas fa-fw fa-gift"></i>
        <span>${a.rewards.length}</span>
      </div>`),uo.appendHtml(`
    
      <div class="item" data-id="${a.id}">
        <div class="indicator ${a.read?"":"main"}"></div>
        <div class="timestamp">${ty(new Date(a.timestamp))} ago</div>
        <div class="title">${a.subject}</div>
        <div class="body">
          ${a.body}

${o}
        </div>
        <div class="buttons">
          ${a.rewards.length>0&&!a.read?'<button class="markReadAlert textButton" aria-label="Claim" data-balloon-pos="left"><i class="fas fa-gift"></i></button>':""}
          ${a.rewards.length>0&&a.read||a.rewards.length===0?'<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>':""}
        </div>
      </div>
    
    `)}}function XA(e,t){ko.psas.push({message:e,level:t})}function JA(){if(ko.psas.length===0)mc.setHtml('<div class="nothing">Nothing to show</div>');else{mc.empty();for(const e of ko.psas){const{message:t,level:a}=e;let o="";a===-1?o="error":a===1?o="main":a===0&&(o="sub"),mc.prependHtml(`
        <div class="item">
        <div class="indicator ${o}"></div>
        <div class="body">
          ${at(t)}
        </div>
      </div>
      `)}}}function ZA(){if(ko.notifications.length===0)gc.setHtml('<div class="nothing">Nothing to show</div>');else{gc.empty();for(const e of ko.notifications){const{message:t,level:a,title:o}=e;let i="sub";a===-1?i="error":a===1&&(i="main"),gc.prependHtml(`
      <div class="item" data-id="${e.id}">
      <div class="indicator ${i}"></div>
      <div class="title">${o}</div>
      <div class="body">
        ${at(t)}
      </div>
      <div class="buttons">
        ${e.details!==void 0?'<button class="copyNotification textButton" aria-label="Copy details to clipboard" data-balloon-pos="left"><i class="fas fa-fw fa-clipboard"></i></button>':""}
      </div>
    </div>
    `)}}}function lp(e){e?L("header nav .showAlerts .notificationBubble")?.show():L("header nav .showAlerts .notificationBubble")?.hide()}function u2(){const e=va.length-Co.length;ot.qs(".accountAlerts .title .right")?.setText(`${e}/${d2}`)}function Pb(e){Co.push(e),ot.qs(`.accountAlerts .list .item[data-id="${e}"]`)?.remove(),ot.qsa(".accountAlerts .list .item").length===0&&uo.setHtml(`
    <div class="nothing">
    Nothing to show
    </div>
    `),Lg(),u2()}function Bb(e){Ya.push(e);const t=ot.qsr(`.accountAlerts .list .item[data-id="${e}"]`);Lg(),t.qs(".indicator")?.removeClass("main"),t.qs(".buttons")?.empty(),t.qs(".buttons")?.appendHtml('<button class="deleteAlert textButton" aria-label="Delete" data-balloon-pos="left"><i class="fas fa-trash"></i></button>');const a=t.qsr(".rewards");O(a.native,{opacity:0,height:0,marginTop:0,duration:250,onComplete:()=>{a.remove()}})}function Lg(){const e=ot.qs(".accountAlerts .claimAll"),t=ot.qs(".accountAlerts .deleteAll");if(e?.hide(),t?.hide(),va.length>0){let a=0;for(const o of va)!o.read&&!Ya.includes(o.id)&&(a+=o.rewards.length);a>0?e?.show():t?.show()}Co.length===va.length&&t?.hide()}async function e_(e){const t=e?.closest(".item")?.getAttribute("data-id")?.toString();if(t===void 0)throw new Error("Notification ID is undefined");const a=ko.notifications.find(i=>i.id===t);if(a===void 0)return;const o=e.querySelector("i");try{await navigator.clipboard.writeText(JSON.stringify({title:a.title,message:a.message,details:a.details},null,4));const i=Y(100);await gt(o,{scale:[1,.8],opacity:[1,0],duration:i}),o.classList.remove("fa-clipboard"),o.classList.add("fa-check","highlight"),await gt(o,{scale:[.8,1],opacity:[0,1],duration:i}),await gt(o,{scale:[1,.8],opacity:[1,0],delay:3e3,duration:i}),o.classList.remove("fa-check","highlight"),o.classList.add("fa-clipboard"),await gt(o,{scale:[.8,1],opacity:[0,1],duration:i})}catch(i){const n=se(i,"Could not copy to clipboard");f(n,-1)}}L("header nav .showAlerts")?.on("click",()=>{QA()});gS((e,t,a)=>{let o="Notice";t===-1?o="Error":t===1&&(o="Success"),a.customTitle!==void 0&&(o=a.customTitle),ko.notifications.push({id:(GA++).toString(),title:o,message:e,level:t,details:a.details}),ko.notifications.length>25&&ko.notifications.shift()});Wa(e=>{if(e.type==="snapshotUpdated"&&e.data.isInitial){const t=S();lp((t?.inboxUnreadSize??0)>0)}e.type==="authStateChanged"&&!e.data.isUserSignedIn&&(lp(!1),va=[],Ya=[],Co=[],uo.empty())});const f2=new ue({dialogId:"alertsPopup",customAnimations:{show:{modal:{marginRight:["-10rem","0"]}},hide:{modal:{marginRight:["0","-10rem"]}}},customEscapeHandler:()=>{Mu()},customWrapperClickHandler:()=>{Mu()},setup:async()=>{ot.qs(".accountAlerts")?.onChild("click",".claimAll",()=>{for(const e of va)!e.read&&!Ya.includes(e.id)&&Bb(e.id)}),ot.qs(".accountAlerts")?.onChild("click",".deleteAll",()=>{for(const e of va)Co.includes(e.id)||Pb(e.id)}),ot.qs(".mobileClose")?.on("click",()=>{Mu()}),ot.qs(".accountAlerts .list")?.onChild("click",".item .buttons .deleteAlert",e=>{const t=e.target?.closest(".item")?.getAttribute("data-id")?.toString();if(t===void 0)throw new Error("Alert ID is undefined");Pb(t)}),ot.qs(".accountAlerts .list")?.onChild("click",".item .buttons .markReadAlert",e=>{const t=e.target?.closest(".item")?.getAttribute("data-id")?.toString();if(t===void 0)throw new Error("Alert ID is undefined");Bb(t)}),ot.qs(".notificationHistory .list")?.onChild("click",".item .buttons .copyNotification",e=>{e_(e.target)})}}),$g=new ut({key:"confirmedPSAs",schema:I.array(Yb),fallback:[]});function t_(){$g.set([])}function p2(){return $g.get()}function a_(e){const t=p2();t.push(e),$g.set(t)}async function o_(){const e=await $.psas.get();if(e.status===500){{const{data:t,error:a}=await jt(fetch("https://monkeytype.instatus.com/summary.json"));let o;a?console.log("Failed to fetch Instatus summary",a):o=(await t.json()).activeMaintenances,o!==void 0&&o.length>0&&o[0]!==void 0&&o[0].status==="INPROGRESS"?Pi(`Server is currently offline for scheduled maintenance. <a target= '_blank' href='${o[0].url}'>Check the status page</a> for more info.`,-1,"bullhorn",!0,void 0,!0):Pi("Looks like the server is experiencing unexpected down time.<br>Check the <a target= '_blank' href='https://monkeytype.instatus.com/'>status page</a> for more information.",-1,"exclamation-triangle",!1,void 0,!0)}return null}else{if(e.status===503)return Pi("Server is currently under maintenance. <a target= '_blank' href='https://monkeytype.instatus.com/'>Check the status page</a> for more info.",-1,"bullhorn",!0,void 0,!0),null;if(e.status!==200)return null}return e.body.data}async function i_(){const e=await o_();if(e===null)return;if(e.length===0){t_();return}const t=p2();e.forEach(a=>{if(ge(a.date)){const o=new Date(a.date),i=a.date-Date.now(),n=Re(i/1e3,!1,!1,"text",!1,!0);a.message=a.message.replace("{dateDifference}",n),a.message=a.message.replace("{dateNoTime}",te(o,"dd MMM yyyy")),a.message=a.message.replace("{date}",te(o,"dd MMM yyyy HH:mm"))}XA(a.message,a.level??-1),!(t.includes(a._id)&&!(a.sticky??!1))&&Pi(a.message,a.level,"bullhorn",a.sticky,()=>{a_(a._id)},!0)})}Wa(e=>{e.type==="authStateChanged"&&i_()});async function n_(e){if(!e)return;const t=new URLSearchParams(e.slice(1));if(t.has("access_token")){history.replaceState(null,"","/");const a=t.get("access_token"),o=t.get("token_type"),i=t.get("state");oe();const n=await $.users.linkDiscord({body:{tokenType:o,accessToken:a,state:i}});if(j(),n.status!==200){f("Failed to link Discord",-1,{response:n});return}if(n.body.data===null){f("Failed to link Discord: data returned was null",-1);return}f(n.body.message,1);const l=S();if(!l)return;const{discordId:c,discordAvatar:d}=n.body.data;c!==void 0&&(l.discordId=c),d!==void 0&&(l.discordAvatar=d),dt(l),Bu(l)}}const s_=I.object({c:ok,i:I.string().optional(),s:ak.optional(),f:tk.optional()});function r_(e){const t=cp("customTheme",e);if(t===null)return;const{data:a,error:o}=dp(()=>ws(atob(t),s_));if(o){console.log("Custom theme URL decoding failed",o),f("Failed to load theme from URL: "+o.message,0);return}let i,n,l,c;if(Array.isArray(a.c)&&a.c.length===10?(i=a.c,n=a.i,l=a.s,c=a.f):Array.isArray(a)&&a.length===10&&(i=a),i===void 0||i.length!==10){f("Failed to load theme from URL: no colors found",0);return}const d=r.customTheme,u=r.customThemeColors;try{v("customThemeColors",i),f("Custom theme applied",1),n!==void 0&&l!==void 0&&c!==void 0&&(v("customBackground",n),v("customBackgroundSize",l),v("customBackgroundFilter",c)),r.customTheme||v("customTheme",!0)}catch(m){f("Something went wrong. Reverting to previous state.",0),console.error(m),v("customTheme",d),v("customThemeColors",u)}}const l_=I.tuple([Jb.nullable(),ik.nullable(),r0.partial({pipeDelimiter:!0,limit:!0,mode:!0}).extend({isTimeRandom:I.boolean().optional(),isWordRandom:I.boolean().optional(),word:I.number().int().optional(),time:I.number().int().optional(),delimiter:I.string().optional()}).nullable(),I.boolean().nullable(),I.boolean().nullable(),I.string().nullable(),nk.nullable(),Gb.or(I.string().nullable())]);function c_(e){const t=cp("testSettings",e);if(t===null)return;const{data:a,error:o}=dp(()=>ws(sy.decompressFromURI(t)??"",l_));if(o){console.error("Failed to parse test settings:",o),f("Failed to load test settings from URL: "+o.message,0);return}const i={};a[0]!==null&&(v("mode",a[0],{nosave:!0}),i.mode=a[0]);const n=a[0]??r.mode;if(a[1]!==null&&(n==="time"?v("time",parseInt(a[1],10),{nosave:!0}):n==="words"?v("words",parseInt(a[1],10),{nosave:!0}):n==="quote"&&(v("quoteLength",[-2]),vp(parseInt(a[1],10)),ie()),i.mode2=a[1]),a[2]!==null){const c=a[2];So(c.text),os(c.mode??"repeat"),c.limit!==void 0?(_a(c.limit.mode),ja(c.limit.value)):(c.isWordRandom?_a("word"):c.isTimeRandom&&_a("time"),c.word!==void 0?ja(c.word):c.time!==void 0&&ja(c.time)),c.pipeDelimiter?Ui(c.pipeDelimiter):c.delimiter==="|"&&Ui(!0),i["custom text settings"]=""}if(a[3]!==null&&(v("punctuation",a[3],{nosave:!0}),i.punctuation=a[3]?"on":"off"),a[4]!==null&&(v("numbers",a[4],{nosave:!0}),i.numbers=a[4]?"on":"off"),a[5]!==null&&(v("language",a[5],{nosave:!0}),i.language=a[5]),a[6]!==null&&(v("difficulty",a[6],{nosave:!0}),i.difficulty=a[6]),a[7]!==null){let c=[];typeof a[7]=="string"?c=a[7].split("#"):c=a[7],v("funbox",c,{nosave:!0}),i.funbox=c.join(", ")}R({nosave:!0});let l="";Object.keys(i).forEach(c=>{const d=i[c];d!==void 0&&(l+=`${c}${at(d?": "+d:"")}<br>`)}),l!==""&&f("Settings applied from URL:<br><br>"+l,1,{duration:10,allowHTML:!0})}function d_(e){const t=(cp("challenge",e)??"").toLowerCase();t!==""&&(f("Loading challenge",0),Ov(t).then(a=>{a&&(f("Challenge loaded",1),R({nosave:!0}))}).catch(a=>{f("Failed to load challenge",-1),console.error(a)}))}Wa(e=>{if(e.type==="authStateChanged"){const t=window.location.search,a=window.location.hash;r_(t),c_(t),d_(t),n_(a)}});async function u_(e){const t=Ma;if(t===null)return;q9(e);const a=await $.results.add({body:{result:t}});if(a.status!==200){f("Failed to save last result",-1,{response:a});return}const o=structuredClone(t),i={xp:a.body.data.xp,streak:a.body.data.streak,result:o,isPb:a.body.data.isPb};o._id=a.body.data.insertedId,a.body.data.isPb&&(o.isPb=!0),_y(i),rw(),f(`Last test result saved ${a.body.data.isPb?"(new pb!)":""}`,1)}function f_(){Rr.getModal().querySelector(".result").innerHTML=`
  <div class="group wpm">
        <div class="sub">wpm</div>
        <div class="val">-</div>
      </div>
      <div class="group acc">
        <div class="sub">accuracy</div>
        <div class="val">-</div>
      </div>
      <div class="group raw">
        <div class="sub">raw</div>
        <div class="val">-</div>
      </div>
      <div class="group con">
        <div class="sub">consistency</div>
        <div class="val">-</div>
      </div>
      <div class="group chardata">
        <div class="sub">characters</div>
        <div class="val">-</div>
      </div>
      <div class="group testType">
        <div class="sub">test type</div>
        <div class="val">-</div>
      </div>`}function p_(){const e=Ma;Cn("wpm",e.wpm),Cn("acc",e.acc+"%"),Cn("raw",e.rawWpm),Cn("con",e.consistency+"%"),Cn("chardata",e.charStats.join("/"));let t=e.mode+" "+e.mode2;t+="<br>"+e.language,e.numbers&&(t+="<br>numbers"),e.punctuation&&(t+="<br>punctuation"),e.blindMode&&(t+="<br>blind"),e.lazyMode&&(t+="<br>lazy"),e.funbox.length>0&&(t+="<br>"+e.funbox.map(a=>a.replace(/_/g," ")).join(",")),e.difficulty!=="normal"&&(t+="<br>"+e.difficulty),e.tags.length>0&&(t+="<br>"+e.tags.length+" tags"),Cn("testType",t,!0)}function Cn(e,t,a=!1){a?s(Rr.getModal()).find(`.group.${e} .val`).html(`${t}`):s(Rr.getModal()).find(`.group.${e} .val`).text(t)}function m_(){if(!Ma){f("Failed to show last signed out result modal: no last result",-1);return}Rr.show({beforeAnimation:async()=>{f_(),p_()}})}function Rb(){Rr.hide()}Wa(e=>{e.type==="snapshotUpdated"&&e.data.isInitial&&Ma!==null&&m_()});const Rr=new ue({dialogId:"lastSignedOutResult",setup:async e=>{e.querySelector("button.save")?.addEventListener("click",async()=>{const t=ct();t!==null&&u_(t.uid),Rb()}),e.querySelector("button.discard")?.addEventListener("click",()=>{rw(),f("Last test result discarded",0),Rb()})},customWrapperClickHandler:()=>{}});Object.defineProperty(Math,"random",{value:Math.random,writable:!1,configurable:!1,enumerable:!0});Object.freeze(Math);Object.defineProperty(window,"Math",{value:Math,writable:!1,configurable:!1,enumerable:!0});Fv();K5();jA();eo(!0,!0);$S(B1);const g_=mg();g_===null?RC():BC();P2({snapshot:S,config:r,toggleFilterDebug:q7,glarsesMode:O8,stats:W0,replay:T8,enableTimerDebug:r8,getTimerStats:b8,toggleSmoothedBurst:V8,egVideoListener:w$,toggleDebugLogs:cA,toggleSentryDebug:C5,qs:L,qsa:Za,qsr:V});
//# sourceMappingURL=monkeytype.z27a04t5.js.map
